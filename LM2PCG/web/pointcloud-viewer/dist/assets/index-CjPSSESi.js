var Cw=Object.defineProperty;var Iw=(t,e,n)=>e in t?Cw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>Iw(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var $m={exports:{}},_l={},zm={exports:{}},Q={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var js=Symbol.for("react.element"),Pw=Symbol.for("react.portal"),kw=Symbol.for("react.fragment"),Mw=Symbol.for("react.strict_mode"),Ow=Symbol.for("react.profiler"),Nw=Symbol.for("react.provider"),Dw=Symbol.for("react.context"),Fw=Symbol.for("react.forward_ref"),Bw=Symbol.for("react.suspense"),Uw=Symbol.for("react.memo"),Lw=Symbol.for("react.lazy"),yd=Symbol.iterator;function Vw(t){return t===null||typeof t!="object"?null:(t=yd&&t[yd]||t["@@iterator"],typeof t=="function"?t:null)}var jm={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Wm=Object.assign,Hm={};function Ei(t,e,n){this.props=t,this.context=e,this.refs=Hm,this.updater=n||jm}Ei.prototype.isReactComponent={};Ei.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ei.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Xm(){}Xm.prototype=Ei.prototype;function Lf(t,e,n){this.props=t,this.context=e,this.refs=Hm,this.updater=n||jm}var Vf=Lf.prototype=new Xm;Vf.constructor=Lf;Wm(Vf,Ei.prototype);Vf.isPureReactComponent=!0;var vd=Array.isArray,Ym=Object.prototype.hasOwnProperty,$f={current:null},Km={key:!0,ref:!0,__self:!0,__source:!0};function qm(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Ym.call(e,r)&&!Km.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:js,type:t,key:s,ref:o,props:i,_owner:$f.current}}function $w(t,e){return{$$typeof:js,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function zf(t){return typeof t=="object"&&t!==null&&t.$$typeof===js}function zw(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var wd=/\/+/g;function zl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?zw(""+t.key):e.toString(36)}function Uo(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case js:case Pw:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+zl(o,0):r,vd(i)?(n="",t!=null&&(n=t.replace(wd,"$&/")+"/"),Uo(i,e,n,"",function(c){return c})):i!=null&&(zf(i)&&(i=$w(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(wd,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",vd(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+zl(s,a);o+=Uo(s,e,n,l,i)}else if(l=Vw(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+zl(s,a++),o+=Uo(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ro(t,e,n){if(t==null)return t;var r=[],i=0;return Uo(t,r,"","",function(s){return e.call(n,s,i++)}),r}function jw(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ge={current:null},Lo={transition:null},Ww={ReactCurrentDispatcher:Ge,ReactCurrentBatchConfig:Lo,ReactCurrentOwner:$f};function Zm(){throw Error("act(...) is not supported in production builds of React.")}Q.Children={map:ro,forEach:function(t,e,n){ro(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ro(t,function(){e++}),e},toArray:function(t){return ro(t,function(e){return e})||[]},only:function(t){if(!zf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Q.Component=Ei;Q.Fragment=kw;Q.Profiler=Ow;Q.PureComponent=Lf;Q.StrictMode=Mw;Q.Suspense=Bw;Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ww;Q.act=Zm;Q.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Wm({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=$f.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)Ym.call(e,l)&&!Km.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:js,type:t.type,key:i,ref:s,props:r,_owner:o}};Q.createContext=function(t){return t={$$typeof:Dw,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Nw,_context:t},t.Consumer=t};Q.createElement=qm;Q.createFactory=function(t){var e=qm.bind(null,t);return e.type=t,e};Q.createRef=function(){return{current:null}};Q.forwardRef=function(t){return{$$typeof:Fw,render:t}};Q.isValidElement=zf;Q.lazy=function(t){return{$$typeof:Lw,_payload:{_status:-1,_result:t},_init:jw}};Q.memo=function(t,e){return{$$typeof:Uw,type:t,compare:e===void 0?null:e}};Q.startTransition=function(t){var e=Lo.transition;Lo.transition={};try{t()}finally{Lo.transition=e}};Q.unstable_act=Zm;Q.useCallback=function(t,e){return Ge.current.useCallback(t,e)};Q.useContext=function(t){return Ge.current.useContext(t)};Q.useDebugValue=function(){};Q.useDeferredValue=function(t){return Ge.current.useDeferredValue(t)};Q.useEffect=function(t,e){return Ge.current.useEffect(t,e)};Q.useId=function(){return Ge.current.useId()};Q.useImperativeHandle=function(t,e,n){return Ge.current.useImperativeHandle(t,e,n)};Q.useInsertionEffect=function(t,e){return Ge.current.useInsertionEffect(t,e)};Q.useLayoutEffect=function(t,e){return Ge.current.useLayoutEffect(t,e)};Q.useMemo=function(t,e){return Ge.current.useMemo(t,e)};Q.useReducer=function(t,e,n){return Ge.current.useReducer(t,e,n)};Q.useRef=function(t){return Ge.current.useRef(t)};Q.useState=function(t){return Ge.current.useState(t)};Q.useSyncExternalStore=function(t,e,n){return Ge.current.useSyncExternalStore(t,e,n)};Q.useTransition=function(){return Ge.current.useTransition()};Q.version="18.3.1";zm.exports=Q;var Z=zm.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hw=Z,Xw=Symbol.for("react.element"),Yw=Symbol.for("react.fragment"),Kw=Object.prototype.hasOwnProperty,qw=Hw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Zw={key:!0,ref:!0,__self:!0,__source:!0};function Qm(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)Kw.call(e,r)&&!Zw.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Xw,type:t,key:s,ref:o,props:i,_owner:qw.current}}_l.Fragment=Yw;_l.jsx=Qm;_l.jsxs=Qm;$m.exports=_l;var Y=$m.exports,Jm={exports:{}},gt={},Gm={exports:{}},e_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(V,X){var q=V.length;V.push(X);e:for(;0<q;){var ce=q-1>>>1,Oe=V[ce];if(0<i(Oe,X))V[ce]=X,V[q]=Oe,q=ce;else break e}}function n(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var X=V[0],q=V.pop();if(q!==X){V[0]=q;e:for(var ce=0,Oe=V.length,to=Oe>>>1;ce<to;){var Hn=2*(ce+1)-1,$l=V[Hn],Xn=Hn+1,no=V[Xn];if(0>i($l,q))Xn<Oe&&0>i(no,$l)?(V[ce]=no,V[Xn]=q,ce=Xn):(V[ce]=$l,V[Hn]=q,ce=Hn);else if(Xn<Oe&&0>i(no,q))V[ce]=no,V[Xn]=q,ce=Xn;else break e}}return X}function i(V,X){var q=V.sortIndex-X.sortIndex;return q!==0?q:V.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,h=3,d=!1,y=!1,w=!1,x=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(V){for(var X=n(c);X!==null;){if(X.callback===null)r(c);else if(X.startTime<=V)r(c),X.sortIndex=X.expirationTime,e(l,X);else break;X=n(c)}}function T(V){if(w=!1,g(V),!y)if(n(l)!==null)y=!0,ge(C);else{var X=n(c);X!==null&&xe(T,X.startTime-V)}}function C(V,X){y=!1,w&&(w=!1,m(k),k=-1),d=!0;var q=h;try{for(g(X),f=n(l);f!==null&&(!(f.expirationTime>X)||V&&!L());){var ce=f.callback;if(typeof ce=="function"){f.callback=null,h=f.priorityLevel;var Oe=ce(f.expirationTime<=X);X=t.unstable_now(),typeof Oe=="function"?f.callback=Oe:f===n(l)&&r(l),g(X)}else r(l);f=n(l)}if(f!==null)var to=!0;else{var Hn=n(c);Hn!==null&&xe(T,Hn.startTime-X),to=!1}return to}finally{f=null,h=q,d=!1}}var S=!1,M=null,k=-1,F=5,D=-1;function L(){return!(t.unstable_now()-D<F)}function z(){if(M!==null){var V=t.unstable_now();D=V;var X=!0;try{X=M(!0,V)}finally{X?H():(S=!1,M=null)}}else S=!1}var H;if(typeof _=="function")H=function(){_(z)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,re=W.port2;W.port1.onmessage=z,H=function(){re.postMessage(null)}}else H=function(){x(z,0)};function ge(V){M=V,S||(S=!0,H())}function xe(V,X){k=x(function(){V(t.unstable_now())},X)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_continueExecution=function(){y||d||(y=!0,ge(C))},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(V){switch(h){case 1:case 2:case 3:var X=3;break;default:X=h}var q=h;h=X;try{return V()}finally{h=q}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(V,X){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var q=h;h=V;try{return X()}finally{h=q}},t.unstable_scheduleCallback=function(V,X,q){var ce=t.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?ce+q:ce):q=ce,V){case 1:var Oe=-1;break;case 2:Oe=250;break;case 5:Oe=1073741823;break;case 4:Oe=1e4;break;default:Oe=5e3}return Oe=q+Oe,V={id:u++,callback:X,priorityLevel:V,startTime:q,expirationTime:Oe,sortIndex:-1},q>ce?(V.sortIndex=q,e(c,V),n(l)===null&&V===n(c)&&(w?(m(k),k=-1):w=!0,xe(T,q-ce))):(V.sortIndex=Oe,e(l,V),y||d||(y=!0,ge(C))),V},t.unstable_shouldYield=L,t.unstable_wrapCallback=function(V){var X=h;return function(){var q=h;h=X;try{return V.apply(this,arguments)}finally{h=q}}}})(e_);Gm.exports=e_;var Qw=Gm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jw=Z,pt=Qw;function B(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var t_=new Set,ys={};function Tr(t,e){ci(t,e),ci(t+"Capture",e)}function ci(t,e){for(ys[t]=e,t=0;t<e.length;t++)t_.add(e[t])}var un=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nu=Object.prototype.hasOwnProperty,Gw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,bd={},Td={};function e3(t){return nu.call(Td,t)?!0:nu.call(bd,t)?!1:Gw.test(t)?Td[t]=!0:(bd[t]=!0,!1)}function t3(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function n3(t,e,n,r){if(e===null||typeof e>"u"||t3(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function et(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Ve={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ve[t]=new et(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ve[e]=new et(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ve[t]=new et(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ve[t]=new et(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ve[t]=new et(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ve[t]=new et(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ve[t]=new et(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ve[t]=new et(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ve[t]=new et(t,5,!1,t.toLowerCase(),null,!1,!1)});var jf=/[\-:]([a-z])/g;function Wf(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(jf,Wf);Ve[e]=new et(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(jf,Wf);Ve[e]=new et(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(jf,Wf);Ve[e]=new et(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ve[t]=new et(t,1,!1,t.toLowerCase(),null,!1,!1)});Ve.xlinkHref=new et("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ve[t]=new et(t,1,!1,t.toLowerCase(),null,!0,!0)});function Hf(t,e,n,r){var i=Ve.hasOwnProperty(e)?Ve[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(n3(e,n,i,r)&&(n=null),r||i===null?e3(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var gn=Jw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,io=Symbol.for("react.element"),Br=Symbol.for("react.portal"),Ur=Symbol.for("react.fragment"),Xf=Symbol.for("react.strict_mode"),ru=Symbol.for("react.profiler"),n_=Symbol.for("react.provider"),r_=Symbol.for("react.context"),Yf=Symbol.for("react.forward_ref"),iu=Symbol.for("react.suspense"),su=Symbol.for("react.suspense_list"),Kf=Symbol.for("react.memo"),wn=Symbol.for("react.lazy"),i_=Symbol.for("react.offscreen"),xd=Symbol.iterator;function Pi(t){return t===null||typeof t!="object"?null:(t=xd&&t[xd]||t["@@iterator"],typeof t=="function"?t:null)}var ye=Object.assign,jl;function zi(t){if(jl===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);jl=e&&e[1]||""}return`
`+jl+t}var Wl=!1;function Hl(t,e){if(!t||Wl)return"";Wl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Wl=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?zi(t):""}function r3(t){switch(t.tag){case 5:return zi(t.type);case 16:return zi("Lazy");case 13:return zi("Suspense");case 19:return zi("SuspenseList");case 0:case 2:case 15:return t=Hl(t.type,!1),t;case 11:return t=Hl(t.type.render,!1),t;case 1:return t=Hl(t.type,!0),t;default:return""}}function ou(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ur:return"Fragment";case Br:return"Portal";case ru:return"Profiler";case Xf:return"StrictMode";case iu:return"Suspense";case su:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case r_:return(t.displayName||"Context")+".Consumer";case n_:return(t._context.displayName||"Context")+".Provider";case Yf:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Kf:return e=t.displayName||null,e!==null?e:ou(t.type)||"Memo";case wn:e=t._payload,t=t._init;try{return ou(t(e))}catch{}}return null}function i3(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ou(e);case 8:return e===Xf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ln(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function s_(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function s3(t){var e=s_(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function so(t){t._valueTracker||(t._valueTracker=s3(t))}function o_(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=s_(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function ia(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function au(t,e){var n=e.checked;return ye({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Sd(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ln(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function a_(t,e){e=e.checked,e!=null&&Hf(t,"checked",e,!1)}function lu(t,e){a_(t,e);var n=Ln(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?cu(t,e.type,n):e.hasOwnProperty("defaultValue")&&cu(t,e.type,Ln(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Ed(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function cu(t,e,n){(e!=="number"||ia(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ji=Array.isArray;function ei(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ln(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function uu(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(B(91));return ye({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ad(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(B(92));if(ji(n)){if(1<n.length)throw Error(B(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ln(n)}}function l_(t,e){var n=Ln(e.value),r=Ln(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Rd(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function c_(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fu(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?c_(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var oo,u_=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(oo=oo||document.createElement("div"),oo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=oo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function vs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Qi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},o3=["Webkit","ms","Moz","O"];Object.keys(Qi).forEach(function(t){o3.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Qi[e]=Qi[t]})});function f_(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Qi.hasOwnProperty(t)&&Qi[t]?(""+e).trim():e+"px"}function h_(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=f_(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var a3=ye({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hu(t,e){if(e){if(a3[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(B(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(B(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(B(61))}if(e.style!=null&&typeof e.style!="object")throw Error(B(62))}}function du(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var pu=null;function qf(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var gu=null,ti=null,ni=null;function Cd(t){if(t=Xs(t)){if(typeof gu!="function")throw Error(B(280));var e=t.stateNode;e&&(e=Tl(e),gu(t.stateNode,t.type,e))}}function d_(t){ti?ni?ni.push(t):ni=[t]:ti=t}function p_(){if(ti){var t=ti,e=ni;if(ni=ti=null,Cd(t),e)for(t=0;t<e.length;t++)Cd(e[t])}}function g_(t,e){return t(e)}function m_(){}var Xl=!1;function __(t,e,n){if(Xl)return t(e,n);Xl=!0;try{return g_(t,e,n)}finally{Xl=!1,(ti!==null||ni!==null)&&(m_(),p_())}}function ws(t,e){var n=t.stateNode;if(n===null)return null;var r=Tl(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(B(231,e,typeof n));return n}var mu=!1;if(un)try{var ki={};Object.defineProperty(ki,"passive",{get:function(){mu=!0}}),window.addEventListener("test",ki,ki),window.removeEventListener("test",ki,ki)}catch{mu=!1}function l3(t,e,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Ji=!1,sa=null,oa=!1,_u=null,c3={onError:function(t){Ji=!0,sa=t}};function u3(t,e,n,r,i,s,o,a,l){Ji=!1,sa=null,l3.apply(c3,arguments)}function f3(t,e,n,r,i,s,o,a,l){if(u3.apply(this,arguments),Ji){if(Ji){var c=sa;Ji=!1,sa=null}else throw Error(B(198));oa||(oa=!0,_u=c)}}function xr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function y_(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Id(t){if(xr(t)!==t)throw Error(B(188))}function h3(t){var e=t.alternate;if(!e){if(e=xr(t),e===null)throw Error(B(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Id(i),t;if(s===r)return Id(i),e;s=s.sibling}throw Error(B(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(B(189))}}if(n.alternate!==r)throw Error(B(190))}if(n.tag!==3)throw Error(B(188));return n.stateNode.current===n?t:e}function v_(t){return t=h3(t),t!==null?w_(t):null}function w_(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=w_(t);if(e!==null)return e;t=t.sibling}return null}var b_=pt.unstable_scheduleCallback,Pd=pt.unstable_cancelCallback,d3=pt.unstable_shouldYield,p3=pt.unstable_requestPaint,Te=pt.unstable_now,g3=pt.unstable_getCurrentPriorityLevel,Zf=pt.unstable_ImmediatePriority,T_=pt.unstable_UserBlockingPriority,aa=pt.unstable_NormalPriority,m3=pt.unstable_LowPriority,x_=pt.unstable_IdlePriority,yl=null,Qt=null;function _3(t){if(Qt&&typeof Qt.onCommitFiberRoot=="function")try{Qt.onCommitFiberRoot(yl,t,void 0,(t.current.flags&128)===128)}catch{}}var Ut=Math.clz32?Math.clz32:w3,y3=Math.log,v3=Math.LN2;function w3(t){return t>>>=0,t===0?32:31-(y3(t)/v3|0)|0}var ao=64,lo=4194304;function Wi(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function la(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=Wi(a):(s&=o,s!==0&&(r=Wi(s)))}else o=n&~i,o!==0?r=Wi(o):s!==0&&(r=Wi(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Ut(e),i=1<<n,r|=t[n],e&=~i;return r}function b3(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function T3(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Ut(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=b3(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function yu(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function S_(){var t=ao;return ao<<=1,!(ao&4194240)&&(ao=64),t}function Yl(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ws(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ut(e),t[e]=n}function x3(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Ut(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Qf(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Ut(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var ne=0;function E_(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var A_,Jf,R_,C_,I_,vu=!1,co=[],Pn=null,kn=null,Mn=null,bs=new Map,Ts=new Map,Sn=[],S3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kd(t,e){switch(t){case"focusin":case"focusout":Pn=null;break;case"dragenter":case"dragleave":kn=null;break;case"mouseover":case"mouseout":Mn=null;break;case"pointerover":case"pointerout":bs.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ts.delete(e.pointerId)}}function Mi(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Xs(e),e!==null&&Jf(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function E3(t,e,n,r,i){switch(e){case"focusin":return Pn=Mi(Pn,t,e,n,r,i),!0;case"dragenter":return kn=Mi(kn,t,e,n,r,i),!0;case"mouseover":return Mn=Mi(Mn,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return bs.set(s,Mi(bs.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Ts.set(s,Mi(Ts.get(s)||null,t,e,n,r,i)),!0}return!1}function P_(t){var e=er(t.target);if(e!==null){var n=xr(e);if(n!==null){if(e=n.tag,e===13){if(e=y_(n),e!==null){t.blockedOn=e,I_(t.priority,function(){R_(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Vo(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=wu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);pu=r,n.target.dispatchEvent(r),pu=null}else return e=Xs(n),e!==null&&Jf(e),t.blockedOn=n,!1;e.shift()}return!0}function Md(t,e,n){Vo(t)&&n.delete(e)}function A3(){vu=!1,Pn!==null&&Vo(Pn)&&(Pn=null),kn!==null&&Vo(kn)&&(kn=null),Mn!==null&&Vo(Mn)&&(Mn=null),bs.forEach(Md),Ts.forEach(Md)}function Oi(t,e){t.blockedOn===e&&(t.blockedOn=null,vu||(vu=!0,pt.unstable_scheduleCallback(pt.unstable_NormalPriority,A3)))}function xs(t){function e(i){return Oi(i,t)}if(0<co.length){Oi(co[0],t);for(var n=1;n<co.length;n++){var r=co[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Pn!==null&&Oi(Pn,t),kn!==null&&Oi(kn,t),Mn!==null&&Oi(Mn,t),bs.forEach(e),Ts.forEach(e),n=0;n<Sn.length;n++)r=Sn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Sn.length&&(n=Sn[0],n.blockedOn===null);)P_(n),n.blockedOn===null&&Sn.shift()}var ri=gn.ReactCurrentBatchConfig,ca=!0;function R3(t,e,n,r){var i=ne,s=ri.transition;ri.transition=null;try{ne=1,Gf(t,e,n,r)}finally{ne=i,ri.transition=s}}function C3(t,e,n,r){var i=ne,s=ri.transition;ri.transition=null;try{ne=4,Gf(t,e,n,r)}finally{ne=i,ri.transition=s}}function Gf(t,e,n,r){if(ca){var i=wu(t,e,n,r);if(i===null)rc(t,e,r,ua,n),kd(t,r);else if(E3(i,t,e,n,r))r.stopPropagation();else if(kd(t,r),e&4&&-1<S3.indexOf(t)){for(;i!==null;){var s=Xs(i);if(s!==null&&A_(s),s=wu(t,e,n,r),s===null&&rc(t,e,r,ua,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else rc(t,e,r,null,n)}}var ua=null;function wu(t,e,n,r){if(ua=null,t=qf(r),t=er(t),t!==null)if(e=xr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=y_(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ua=t,null}function k_(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(g3()){case Zf:return 1;case T_:return 4;case aa:case m3:return 16;case x_:return 536870912;default:return 16}default:return 16}}var An=null,eh=null,$o=null;function M_(){if($o)return $o;var t,e=eh,n=e.length,r,i="value"in An?An.value:An.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return $o=i.slice(t,1<r?1-r:void 0)}function zo(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function uo(){return!0}function Od(){return!1}function mt(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?uo:Od,this.isPropagationStopped=Od,this}return ye(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=uo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=uo)},persist:function(){},isPersistent:uo}),e}var Ai={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},th=mt(Ai),Hs=ye({},Ai,{view:0,detail:0}),I3=mt(Hs),Kl,ql,Ni,vl=ye({},Hs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ni&&(Ni&&t.type==="mousemove"?(Kl=t.screenX-Ni.screenX,ql=t.screenY-Ni.screenY):ql=Kl=0,Ni=t),Kl)},movementY:function(t){return"movementY"in t?t.movementY:ql}}),Nd=mt(vl),P3=ye({},vl,{dataTransfer:0}),k3=mt(P3),M3=ye({},Hs,{relatedTarget:0}),Zl=mt(M3),O3=ye({},Ai,{animationName:0,elapsedTime:0,pseudoElement:0}),N3=mt(O3),D3=ye({},Ai,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),F3=mt(D3),B3=ye({},Ai,{data:0}),Dd=mt(B3),U3={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},L3={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},V3={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $3(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=V3[t])?!!e[t]:!1}function nh(){return $3}var z3=ye({},Hs,{key:function(t){if(t.key){var e=U3[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=zo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?L3[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nh,charCode:function(t){return t.type==="keypress"?zo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?zo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),j3=mt(z3),W3=ye({},vl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fd=mt(W3),H3=ye({},Hs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nh}),X3=mt(H3),Y3=ye({},Ai,{propertyName:0,elapsedTime:0,pseudoElement:0}),K3=mt(Y3),q3=ye({},vl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Z3=mt(q3),Q3=[9,13,27,32],rh=un&&"CompositionEvent"in window,Gi=null;un&&"documentMode"in document&&(Gi=document.documentMode);var J3=un&&"TextEvent"in window&&!Gi,O_=un&&(!rh||Gi&&8<Gi&&11>=Gi),Bd=" ",Ud=!1;function N_(t,e){switch(t){case"keyup":return Q3.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function D_(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Lr=!1;function G3(t,e){switch(t){case"compositionend":return D_(e);case"keypress":return e.which!==32?null:(Ud=!0,Bd);case"textInput":return t=e.data,t===Bd&&Ud?null:t;default:return null}}function eb(t,e){if(Lr)return t==="compositionend"||!rh&&N_(t,e)?(t=M_(),$o=eh=An=null,Lr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return O_&&e.locale!=="ko"?null:e.data;default:return null}}var tb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ld(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!tb[t.type]:e==="textarea"}function F_(t,e,n,r){d_(r),e=fa(e,"onChange"),0<e.length&&(n=new th("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var es=null,Ss=null;function nb(t){Y_(t,0)}function wl(t){var e=zr(t);if(o_(e))return t}function rb(t,e){if(t==="change")return e}var B_=!1;if(un){var Ql;if(un){var Jl="oninput"in document;if(!Jl){var Vd=document.createElement("div");Vd.setAttribute("oninput","return;"),Jl=typeof Vd.oninput=="function"}Ql=Jl}else Ql=!1;B_=Ql&&(!document.documentMode||9<document.documentMode)}function $d(){es&&(es.detachEvent("onpropertychange",U_),Ss=es=null)}function U_(t){if(t.propertyName==="value"&&wl(Ss)){var e=[];F_(e,Ss,t,qf(t)),__(nb,e)}}function ib(t,e,n){t==="focusin"?($d(),es=e,Ss=n,es.attachEvent("onpropertychange",U_)):t==="focusout"&&$d()}function sb(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return wl(Ss)}function ob(t,e){if(t==="click")return wl(e)}function ab(t,e){if(t==="input"||t==="change")return wl(e)}function lb(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Vt=typeof Object.is=="function"?Object.is:lb;function Es(t,e){if(Vt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!nu.call(e,i)||!Vt(t[i],e[i]))return!1}return!0}function zd(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function jd(t,e){var n=zd(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=zd(n)}}function L_(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?L_(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function V_(){for(var t=window,e=ia();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ia(t.document)}return e}function ih(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function cb(t){var e=V_(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&L_(n.ownerDocument.documentElement,n)){if(r!==null&&ih(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=jd(n,s);var o=jd(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var ub=un&&"documentMode"in document&&11>=document.documentMode,Vr=null,bu=null,ts=null,Tu=!1;function Wd(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Tu||Vr==null||Vr!==ia(r)||(r=Vr,"selectionStart"in r&&ih(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ts&&Es(ts,r)||(ts=r,r=fa(bu,"onSelect"),0<r.length&&(e=new th("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Vr)))}function fo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var $r={animationend:fo("Animation","AnimationEnd"),animationiteration:fo("Animation","AnimationIteration"),animationstart:fo("Animation","AnimationStart"),transitionend:fo("Transition","TransitionEnd")},Gl={},$_={};un&&($_=document.createElement("div").style,"AnimationEvent"in window||(delete $r.animationend.animation,delete $r.animationiteration.animation,delete $r.animationstart.animation),"TransitionEvent"in window||delete $r.transitionend.transition);function bl(t){if(Gl[t])return Gl[t];if(!$r[t])return t;var e=$r[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in $_)return Gl[t]=e[n];return t}var z_=bl("animationend"),j_=bl("animationiteration"),W_=bl("animationstart"),H_=bl("transitionend"),X_=new Map,Hd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zn(t,e){X_.set(t,e),Tr(e,[t])}for(var ec=0;ec<Hd.length;ec++){var tc=Hd[ec],fb=tc.toLowerCase(),hb=tc[0].toUpperCase()+tc.slice(1);zn(fb,"on"+hb)}zn(z_,"onAnimationEnd");zn(j_,"onAnimationIteration");zn(W_,"onAnimationStart");zn("dblclick","onDoubleClick");zn("focusin","onFocus");zn("focusout","onBlur");zn(H_,"onTransitionEnd");ci("onMouseEnter",["mouseout","mouseover"]);ci("onMouseLeave",["mouseout","mouseover"]);ci("onPointerEnter",["pointerout","pointerover"]);ci("onPointerLeave",["pointerout","pointerover"]);Tr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Tr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Tr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Tr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Tr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Tr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),db=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hi));function Xd(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,f3(r,e,void 0,t),t.currentTarget=null}function Y_(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Xd(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Xd(i,a,c),s=l}}}if(oa)throw t=_u,oa=!1,_u=null,t}function ue(t,e){var n=e[Ru];n===void 0&&(n=e[Ru]=new Set);var r=t+"__bubble";n.has(r)||(K_(e,t,2,!1),n.add(r))}function nc(t,e,n){var r=0;e&&(r|=4),K_(n,t,r,e)}var ho="_reactListening"+Math.random().toString(36).slice(2);function As(t){if(!t[ho]){t[ho]=!0,t_.forEach(function(n){n!=="selectionchange"&&(db.has(n)||nc(n,!1,t),nc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ho]||(e[ho]=!0,nc("selectionchange",!1,e))}}function K_(t,e,n,r){switch(k_(e)){case 1:var i=R3;break;case 4:i=C3;break;default:i=Gf}n=i.bind(null,e,n,t),i=void 0,!mu||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function rc(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=er(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}__(function(){var c=s,u=qf(n),f=[];e:{var h=X_.get(t);if(h!==void 0){var d=th,y=t;switch(t){case"keypress":if(zo(n)===0)break e;case"keydown":case"keyup":d=j3;break;case"focusin":y="focus",d=Zl;break;case"focusout":y="blur",d=Zl;break;case"beforeblur":case"afterblur":d=Zl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=Nd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=k3;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=X3;break;case z_:case j_:case W_:d=N3;break;case H_:d=K3;break;case"scroll":d=I3;break;case"wheel":d=Z3;break;case"copy":case"cut":case"paste":d=F3;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=Fd}var w=(e&4)!==0,x=!w&&t==="scroll",m=w?h!==null?h+"Capture":null:h;w=[];for(var _=c,g;_!==null;){g=_;var T=g.stateNode;if(g.tag===5&&T!==null&&(g=T,m!==null&&(T=ws(_,m),T!=null&&w.push(Rs(_,T,g)))),x)break;_=_.return}0<w.length&&(h=new d(h,y,null,n,u),f.push({event:h,listeners:w}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",h&&n!==pu&&(y=n.relatedTarget||n.fromElement)&&(er(y)||y[fn]))break e;if((d||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,d?(y=n.relatedTarget||n.toElement,d=c,y=y?er(y):null,y!==null&&(x=xr(y),y!==x||y.tag!==5&&y.tag!==6)&&(y=null)):(d=null,y=c),d!==y)){if(w=Nd,T="onMouseLeave",m="onMouseEnter",_="mouse",(t==="pointerout"||t==="pointerover")&&(w=Fd,T="onPointerLeave",m="onPointerEnter",_="pointer"),x=d==null?h:zr(d),g=y==null?h:zr(y),h=new w(T,_+"leave",d,n,u),h.target=x,h.relatedTarget=g,T=null,er(u)===c&&(w=new w(m,_+"enter",y,n,u),w.target=g,w.relatedTarget=x,T=w),x=T,d&&y)t:{for(w=d,m=y,_=0,g=w;g;g=Rr(g))_++;for(g=0,T=m;T;T=Rr(T))g++;for(;0<_-g;)w=Rr(w),_--;for(;0<g-_;)m=Rr(m),g--;for(;_--;){if(w===m||m!==null&&w===m.alternate)break t;w=Rr(w),m=Rr(m)}w=null}else w=null;d!==null&&Yd(f,h,d,w,!1),y!==null&&x!==null&&Yd(f,x,y,w,!0)}}e:{if(h=c?zr(c):window,d=h.nodeName&&h.nodeName.toLowerCase(),d==="select"||d==="input"&&h.type==="file")var C=rb;else if(Ld(h))if(B_)C=ab;else{C=sb;var S=ib}else(d=h.nodeName)&&d.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(C=ob);if(C&&(C=C(t,c))){F_(f,C,n,u);break e}S&&S(t,h,c),t==="focusout"&&(S=h._wrapperState)&&S.controlled&&h.type==="number"&&cu(h,"number",h.value)}switch(S=c?zr(c):window,t){case"focusin":(Ld(S)||S.contentEditable==="true")&&(Vr=S,bu=c,ts=null);break;case"focusout":ts=bu=Vr=null;break;case"mousedown":Tu=!0;break;case"contextmenu":case"mouseup":case"dragend":Tu=!1,Wd(f,n,u);break;case"selectionchange":if(ub)break;case"keydown":case"keyup":Wd(f,n,u)}var M;if(rh)e:{switch(t){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else Lr?N_(t,n)&&(k="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(O_&&n.locale!=="ko"&&(Lr||k!=="onCompositionStart"?k==="onCompositionEnd"&&Lr&&(M=M_()):(An=u,eh="value"in An?An.value:An.textContent,Lr=!0)),S=fa(c,k),0<S.length&&(k=new Dd(k,t,null,n,u),f.push({event:k,listeners:S}),M?k.data=M:(M=D_(n),M!==null&&(k.data=M)))),(M=J3?G3(t,n):eb(t,n))&&(c=fa(c,"onBeforeInput"),0<c.length&&(u=new Dd("onBeforeInput","beforeinput",null,n,u),f.push({event:u,listeners:c}),u.data=M))}Y_(f,e)})}function Rs(t,e,n){return{instance:t,listener:e,currentTarget:n}}function fa(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=ws(t,n),s!=null&&r.unshift(Rs(t,s,i)),s=ws(t,e),s!=null&&r.push(Rs(t,s,i))),t=t.return}return r}function Rr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Yd(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=ws(n,s),l!=null&&o.unshift(Rs(n,l,a))):i||(l=ws(n,s),l!=null&&o.push(Rs(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var pb=/\r\n?/g,gb=/\u0000|\uFFFD/g;function Kd(t){return(typeof t=="string"?t:""+t).replace(pb,`
`).replace(gb,"")}function po(t,e,n){if(e=Kd(e),Kd(t)!==e&&n)throw Error(B(425))}function ha(){}var xu=null,Su=null;function Eu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Au=typeof setTimeout=="function"?setTimeout:void 0,mb=typeof clearTimeout=="function"?clearTimeout:void 0,qd=typeof Promise=="function"?Promise:void 0,_b=typeof queueMicrotask=="function"?queueMicrotask:typeof qd<"u"?function(t){return qd.resolve(null).then(t).catch(yb)}:Au;function yb(t){setTimeout(function(){throw t})}function ic(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),xs(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);xs(e)}function On(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Zd(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ri=Math.random().toString(36).slice(2),Kt="__reactFiber$"+Ri,Cs="__reactProps$"+Ri,fn="__reactContainer$"+Ri,Ru="__reactEvents$"+Ri,vb="__reactListeners$"+Ri,wb="__reactHandles$"+Ri;function er(t){var e=t[Kt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[fn]||n[Kt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Zd(t);t!==null;){if(n=t[Kt])return n;t=Zd(t)}return e}t=n,n=t.parentNode}return null}function Xs(t){return t=t[Kt]||t[fn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function zr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(B(33))}function Tl(t){return t[Cs]||null}var Cu=[],jr=-1;function jn(t){return{current:t}}function fe(t){0>jr||(t.current=Cu[jr],Cu[jr]=null,jr--)}function le(t,e){jr++,Cu[jr]=t.current,t.current=e}var Vn={},Ke=jn(Vn),it=jn(!1),hr=Vn;function ui(t,e){var n=t.type.contextTypes;if(!n)return Vn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function st(t){return t=t.childContextTypes,t!=null}function da(){fe(it),fe(Ke)}function Qd(t,e,n){if(Ke.current!==Vn)throw Error(B(168));le(Ke,e),le(it,n)}function q_(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(B(108,i3(t)||"Unknown",i));return ye({},n,r)}function pa(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Vn,hr=Ke.current,le(Ke,t),le(it,it.current),!0}function Jd(t,e,n){var r=t.stateNode;if(!r)throw Error(B(169));n?(t=q_(t,e,hr),r.__reactInternalMemoizedMergedChildContext=t,fe(it),fe(Ke),le(Ke,t)):fe(it),le(it,n)}var nn=null,xl=!1,sc=!1;function Z_(t){nn===null?nn=[t]:nn.push(t)}function bb(t){xl=!0,Z_(t)}function Wn(){if(!sc&&nn!==null){sc=!0;var t=0,e=ne;try{var n=nn;for(ne=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}nn=null,xl=!1}catch(i){throw nn!==null&&(nn=nn.slice(t+1)),b_(Zf,Wn),i}finally{ne=e,sc=!1}}return null}var Wr=[],Hr=0,ga=null,ma=0,_t=[],yt=0,dr=null,an=1,ln="";function Zn(t,e){Wr[Hr++]=ma,Wr[Hr++]=ga,ga=t,ma=e}function Q_(t,e,n){_t[yt++]=an,_t[yt++]=ln,_t[yt++]=dr,dr=t;var r=an;t=ln;var i=32-Ut(r)-1;r&=~(1<<i),n+=1;var s=32-Ut(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,an=1<<32-Ut(e)+i|n<<i|r,ln=s+t}else an=1<<s|n<<i|r,ln=t}function sh(t){t.return!==null&&(Zn(t,1),Q_(t,1,0))}function oh(t){for(;t===ga;)ga=Wr[--Hr],Wr[Hr]=null,ma=Wr[--Hr],Wr[Hr]=null;for(;t===dr;)dr=_t[--yt],_t[yt]=null,ln=_t[--yt],_t[yt]=null,an=_t[--yt],_t[yt]=null}var dt=null,ht=null,he=!1,Ft=null;function J_(t,e){var n=vt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Gd(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,dt=t,ht=On(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,dt=t,ht=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=dr!==null?{id:an,overflow:ln}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=vt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,dt=t,ht=null,!0):!1;default:return!1}}function Iu(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Pu(t){if(he){var e=ht;if(e){var n=e;if(!Gd(t,e)){if(Iu(t))throw Error(B(418));e=On(n.nextSibling);var r=dt;e&&Gd(t,e)?J_(r,n):(t.flags=t.flags&-4097|2,he=!1,dt=t)}}else{if(Iu(t))throw Error(B(418));t.flags=t.flags&-4097|2,he=!1,dt=t}}}function ep(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;dt=t}function go(t){if(t!==dt)return!1;if(!he)return ep(t),he=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Eu(t.type,t.memoizedProps)),e&&(e=ht)){if(Iu(t))throw G_(),Error(B(418));for(;e;)J_(t,e),e=On(e.nextSibling)}if(ep(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(B(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ht=On(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ht=null}}else ht=dt?On(t.stateNode.nextSibling):null;return!0}function G_(){for(var t=ht;t;)t=On(t.nextSibling)}function fi(){ht=dt=null,he=!1}function ah(t){Ft===null?Ft=[t]:Ft.push(t)}var Tb=gn.ReactCurrentBatchConfig;function Di(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(B(309));var r=n.stateNode}if(!r)throw Error(B(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(B(284));if(!n._owner)throw Error(B(290,t))}return t}function mo(t,e){throw t=Object.prototype.toString.call(e),Error(B(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function tp(t){var e=t._init;return e(t._payload)}function ey(t){function e(m,_){if(t){var g=m.deletions;g===null?(m.deletions=[_],m.flags|=16):g.push(_)}}function n(m,_){if(!t)return null;for(;_!==null;)e(m,_),_=_.sibling;return null}function r(m,_){for(m=new Map;_!==null;)_.key!==null?m.set(_.key,_):m.set(_.index,_),_=_.sibling;return m}function i(m,_){return m=Bn(m,_),m.index=0,m.sibling=null,m}function s(m,_,g){return m.index=g,t?(g=m.alternate,g!==null?(g=g.index,g<_?(m.flags|=2,_):g):(m.flags|=2,_)):(m.flags|=1048576,_)}function o(m){return t&&m.alternate===null&&(m.flags|=2),m}function a(m,_,g,T){return _===null||_.tag!==6?(_=hc(g,m.mode,T),_.return=m,_):(_=i(_,g),_.return=m,_)}function l(m,_,g,T){var C=g.type;return C===Ur?u(m,_,g.props.children,T,g.key):_!==null&&(_.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===wn&&tp(C)===_.type)?(T=i(_,g.props),T.ref=Di(m,_,g),T.return=m,T):(T=qo(g.type,g.key,g.props,null,m.mode,T),T.ref=Di(m,_,g),T.return=m,T)}function c(m,_,g,T){return _===null||_.tag!==4||_.stateNode.containerInfo!==g.containerInfo||_.stateNode.implementation!==g.implementation?(_=dc(g,m.mode,T),_.return=m,_):(_=i(_,g.children||[]),_.return=m,_)}function u(m,_,g,T,C){return _===null||_.tag!==7?(_=sr(g,m.mode,T,C),_.return=m,_):(_=i(_,g),_.return=m,_)}function f(m,_,g){if(typeof _=="string"&&_!==""||typeof _=="number")return _=hc(""+_,m.mode,g),_.return=m,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case io:return g=qo(_.type,_.key,_.props,null,m.mode,g),g.ref=Di(m,null,_),g.return=m,g;case Br:return _=dc(_,m.mode,g),_.return=m,_;case wn:var T=_._init;return f(m,T(_._payload),g)}if(ji(_)||Pi(_))return _=sr(_,m.mode,g,null),_.return=m,_;mo(m,_)}return null}function h(m,_,g,T){var C=_!==null?_.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return C!==null?null:a(m,_,""+g,T);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case io:return g.key===C?l(m,_,g,T):null;case Br:return g.key===C?c(m,_,g,T):null;case wn:return C=g._init,h(m,_,C(g._payload),T)}if(ji(g)||Pi(g))return C!==null?null:u(m,_,g,T,null);mo(m,g)}return null}function d(m,_,g,T,C){if(typeof T=="string"&&T!==""||typeof T=="number")return m=m.get(g)||null,a(_,m,""+T,C);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case io:return m=m.get(T.key===null?g:T.key)||null,l(_,m,T,C);case Br:return m=m.get(T.key===null?g:T.key)||null,c(_,m,T,C);case wn:var S=T._init;return d(m,_,g,S(T._payload),C)}if(ji(T)||Pi(T))return m=m.get(g)||null,u(_,m,T,C,null);mo(_,T)}return null}function y(m,_,g,T){for(var C=null,S=null,M=_,k=_=0,F=null;M!==null&&k<g.length;k++){M.index>k?(F=M,M=null):F=M.sibling;var D=h(m,M,g[k],T);if(D===null){M===null&&(M=F);break}t&&M&&D.alternate===null&&e(m,M),_=s(D,_,k),S===null?C=D:S.sibling=D,S=D,M=F}if(k===g.length)return n(m,M),he&&Zn(m,k),C;if(M===null){for(;k<g.length;k++)M=f(m,g[k],T),M!==null&&(_=s(M,_,k),S===null?C=M:S.sibling=M,S=M);return he&&Zn(m,k),C}for(M=r(m,M);k<g.length;k++)F=d(M,m,k,g[k],T),F!==null&&(t&&F.alternate!==null&&M.delete(F.key===null?k:F.key),_=s(F,_,k),S===null?C=F:S.sibling=F,S=F);return t&&M.forEach(function(L){return e(m,L)}),he&&Zn(m,k),C}function w(m,_,g,T){var C=Pi(g);if(typeof C!="function")throw Error(B(150));if(g=C.call(g),g==null)throw Error(B(151));for(var S=C=null,M=_,k=_=0,F=null,D=g.next();M!==null&&!D.done;k++,D=g.next()){M.index>k?(F=M,M=null):F=M.sibling;var L=h(m,M,D.value,T);if(L===null){M===null&&(M=F);break}t&&M&&L.alternate===null&&e(m,M),_=s(L,_,k),S===null?C=L:S.sibling=L,S=L,M=F}if(D.done)return n(m,M),he&&Zn(m,k),C;if(M===null){for(;!D.done;k++,D=g.next())D=f(m,D.value,T),D!==null&&(_=s(D,_,k),S===null?C=D:S.sibling=D,S=D);return he&&Zn(m,k),C}for(M=r(m,M);!D.done;k++,D=g.next())D=d(M,m,k,D.value,T),D!==null&&(t&&D.alternate!==null&&M.delete(D.key===null?k:D.key),_=s(D,_,k),S===null?C=D:S.sibling=D,S=D);return t&&M.forEach(function(z){return e(m,z)}),he&&Zn(m,k),C}function x(m,_,g,T){if(typeof g=="object"&&g!==null&&g.type===Ur&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case io:e:{for(var C=g.key,S=_;S!==null;){if(S.key===C){if(C=g.type,C===Ur){if(S.tag===7){n(m,S.sibling),_=i(S,g.props.children),_.return=m,m=_;break e}}else if(S.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===wn&&tp(C)===S.type){n(m,S.sibling),_=i(S,g.props),_.ref=Di(m,S,g),_.return=m,m=_;break e}n(m,S);break}else e(m,S);S=S.sibling}g.type===Ur?(_=sr(g.props.children,m.mode,T,g.key),_.return=m,m=_):(T=qo(g.type,g.key,g.props,null,m.mode,T),T.ref=Di(m,_,g),T.return=m,m=T)}return o(m);case Br:e:{for(S=g.key;_!==null;){if(_.key===S)if(_.tag===4&&_.stateNode.containerInfo===g.containerInfo&&_.stateNode.implementation===g.implementation){n(m,_.sibling),_=i(_,g.children||[]),_.return=m,m=_;break e}else{n(m,_);break}else e(m,_);_=_.sibling}_=dc(g,m.mode,T),_.return=m,m=_}return o(m);case wn:return S=g._init,x(m,_,S(g._payload),T)}if(ji(g))return y(m,_,g,T);if(Pi(g))return w(m,_,g,T);mo(m,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,_!==null&&_.tag===6?(n(m,_.sibling),_=i(_,g),_.return=m,m=_):(n(m,_),_=hc(g,m.mode,T),_.return=m,m=_),o(m)):n(m,_)}return x}var hi=ey(!0),ty=ey(!1),_a=jn(null),ya=null,Xr=null,lh=null;function ch(){lh=Xr=ya=null}function uh(t){var e=_a.current;fe(_a),t._currentValue=e}function ku(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ii(t,e){ya=t,lh=Xr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(nt=!0),t.firstContext=null)}function At(t){var e=t._currentValue;if(lh!==t)if(t={context:t,memoizedValue:e,next:null},Xr===null){if(ya===null)throw Error(B(308));Xr=t,ya.dependencies={lanes:0,firstContext:t}}else Xr=Xr.next=t;return e}var tr=null;function fh(t){tr===null?tr=[t]:tr.push(t)}function ny(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,fh(e)):(n.next=i.next,i.next=n),e.interleaved=n,hn(t,r)}function hn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var bn=!1;function hh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ry(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function cn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Nn(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,G&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,hn(t,n)}return i=r.interleaved,i===null?(e.next=e,fh(r)):(e.next=i.next,i.next=e),r.interleaved=e,hn(t,n)}function jo(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Qf(t,n)}}function np(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function va(t,e,n,r){var i=t.updateQueue;bn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var f=i.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,d=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=t,w=a;switch(h=e,d=n,w.tag){case 1:if(y=w.payload,typeof y=="function"){f=y.call(d,f,h);break e}f=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=w.payload,h=typeof y=="function"?y.call(d,f,h):y,h==null)break e;f=ye({},f,h);break e;case 2:bn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else d={eventTime:d,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=d,l=f):u=u.next=d,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(u===null&&(l=f),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);gr|=o,t.lanes=o,t.memoizedState=f}}function rp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(B(191,i));i.call(r)}}}var Ys={},Jt=jn(Ys),Is=jn(Ys),Ps=jn(Ys);function nr(t){if(t===Ys)throw Error(B(174));return t}function dh(t,e){switch(le(Ps,e),le(Is,t),le(Jt,Ys),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:fu(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=fu(e,t)}fe(Jt),le(Jt,e)}function di(){fe(Jt),fe(Is),fe(Ps)}function iy(t){nr(Ps.current);var e=nr(Jt.current),n=fu(e,t.type);e!==n&&(le(Is,t),le(Jt,n))}function ph(t){Is.current===t&&(fe(Jt),fe(Is))}var me=jn(0);function wa(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var oc=[];function gh(){for(var t=0;t<oc.length;t++)oc[t]._workInProgressVersionPrimary=null;oc.length=0}var Wo=gn.ReactCurrentDispatcher,ac=gn.ReactCurrentBatchConfig,pr=0,_e=null,ke=null,De=null,ba=!1,ns=!1,ks=0,xb=0;function $e(){throw Error(B(321))}function mh(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Vt(t[n],e[n]))return!1;return!0}function _h(t,e,n,r,i,s){if(pr=s,_e=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Wo.current=t===null||t.memoizedState===null?Rb:Cb,t=n(r,i),ns){s=0;do{if(ns=!1,ks=0,25<=s)throw Error(B(301));s+=1,De=ke=null,e.updateQueue=null,Wo.current=Ib,t=n(r,i)}while(ns)}if(Wo.current=Ta,e=ke!==null&&ke.next!==null,pr=0,De=ke=_e=null,ba=!1,e)throw Error(B(300));return t}function yh(){var t=ks!==0;return ks=0,t}function Xt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return De===null?_e.memoizedState=De=t:De=De.next=t,De}function Rt(){if(ke===null){var t=_e.alternate;t=t!==null?t.memoizedState:null}else t=ke.next;var e=De===null?_e.memoizedState:De.next;if(e!==null)De=e,ke=t;else{if(t===null)throw Error(B(310));ke=t,t={memoizedState:ke.memoizedState,baseState:ke.baseState,baseQueue:ke.baseQueue,queue:ke.queue,next:null},De===null?_e.memoizedState=De=t:De=De.next=t}return De}function Ms(t,e){return typeof e=="function"?e(t):e}function lc(t){var e=Rt(),n=e.queue;if(n===null)throw Error(B(311));n.lastRenderedReducer=t;var r=ke,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((pr&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var f={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,_e.lanes|=u,gr|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,Vt(r,e.memoizedState)||(nt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,_e.lanes|=s,gr|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function cc(t){var e=Rt(),n=e.queue;if(n===null)throw Error(B(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Vt(s,e.memoizedState)||(nt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function sy(){}function oy(t,e){var n=_e,r=Rt(),i=e(),s=!Vt(r.memoizedState,i);if(s&&(r.memoizedState=i,nt=!0),r=r.queue,vh(cy.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||De!==null&&De.memoizedState.tag&1){if(n.flags|=2048,Os(9,ly.bind(null,n,r,i,e),void 0,null),Fe===null)throw Error(B(349));pr&30||ay(n,e,i)}return i}function ay(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function ly(t,e,n,r){e.value=n,e.getSnapshot=r,uy(e)&&fy(t)}function cy(t,e,n){return n(function(){uy(e)&&fy(t)})}function uy(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Vt(t,n)}catch{return!0}}function fy(t){var e=hn(t,1);e!==null&&Lt(e,t,1,-1)}function ip(t){var e=Xt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ms,lastRenderedState:t},e.queue=t,t=t.dispatch=Ab.bind(null,_e,t),[e.memoizedState,t]}function Os(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function hy(){return Rt().memoizedState}function Ho(t,e,n,r){var i=Xt();_e.flags|=t,i.memoizedState=Os(1|e,n,void 0,r===void 0?null:r)}function Sl(t,e,n,r){var i=Rt();r=r===void 0?null:r;var s=void 0;if(ke!==null){var o=ke.memoizedState;if(s=o.destroy,r!==null&&mh(r,o.deps)){i.memoizedState=Os(e,n,s,r);return}}_e.flags|=t,i.memoizedState=Os(1|e,n,s,r)}function sp(t,e){return Ho(8390656,8,t,e)}function vh(t,e){return Sl(2048,8,t,e)}function dy(t,e){return Sl(4,2,t,e)}function py(t,e){return Sl(4,4,t,e)}function gy(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function my(t,e,n){return n=n!=null?n.concat([t]):null,Sl(4,4,gy.bind(null,e,t),n)}function wh(){}function _y(t,e){var n=Rt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&mh(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function yy(t,e){var n=Rt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&mh(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function vy(t,e,n){return pr&21?(Vt(n,e)||(n=S_(),_e.lanes|=n,gr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,nt=!0),t.memoizedState=n)}function Sb(t,e){var n=ne;ne=n!==0&&4>n?n:4,t(!0);var r=ac.transition;ac.transition={};try{t(!1),e()}finally{ne=n,ac.transition=r}}function wy(){return Rt().memoizedState}function Eb(t,e,n){var r=Fn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},by(t))Ty(e,n);else if(n=ny(t,e,n,r),n!==null){var i=Je();Lt(n,t,r,i),xy(n,e,r)}}function Ab(t,e,n){var r=Fn(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(by(t))Ty(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,Vt(a,o)){var l=e.interleaved;l===null?(i.next=i,fh(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=ny(t,e,i,r),n!==null&&(i=Je(),Lt(n,t,r,i),xy(n,e,r))}}function by(t){var e=t.alternate;return t===_e||e!==null&&e===_e}function Ty(t,e){ns=ba=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function xy(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Qf(t,n)}}var Ta={readContext:At,useCallback:$e,useContext:$e,useEffect:$e,useImperativeHandle:$e,useInsertionEffect:$e,useLayoutEffect:$e,useMemo:$e,useReducer:$e,useRef:$e,useState:$e,useDebugValue:$e,useDeferredValue:$e,useTransition:$e,useMutableSource:$e,useSyncExternalStore:$e,useId:$e,unstable_isNewReconciler:!1},Rb={readContext:At,useCallback:function(t,e){return Xt().memoizedState=[t,e===void 0?null:e],t},useContext:At,useEffect:sp,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Ho(4194308,4,gy.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Ho(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ho(4,2,t,e)},useMemo:function(t,e){var n=Xt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Xt();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=Eb.bind(null,_e,t),[r.memoizedState,t]},useRef:function(t){var e=Xt();return t={current:t},e.memoizedState=t},useState:ip,useDebugValue:wh,useDeferredValue:function(t){return Xt().memoizedState=t},useTransition:function(){var t=ip(!1),e=t[0];return t=Sb.bind(null,t[1]),Xt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=_e,i=Xt();if(he){if(n===void 0)throw Error(B(407));n=n()}else{if(n=e(),Fe===null)throw Error(B(349));pr&30||ay(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,sp(cy.bind(null,r,s,t),[t]),r.flags|=2048,Os(9,ly.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Xt(),e=Fe.identifierPrefix;if(he){var n=ln,r=an;n=(r&~(1<<32-Ut(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ks++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=xb++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Cb={readContext:At,useCallback:_y,useContext:At,useEffect:vh,useImperativeHandle:my,useInsertionEffect:dy,useLayoutEffect:py,useMemo:yy,useReducer:lc,useRef:hy,useState:function(){return lc(Ms)},useDebugValue:wh,useDeferredValue:function(t){var e=Rt();return vy(e,ke.memoizedState,t)},useTransition:function(){var t=lc(Ms)[0],e=Rt().memoizedState;return[t,e]},useMutableSource:sy,useSyncExternalStore:oy,useId:wy,unstable_isNewReconciler:!1},Ib={readContext:At,useCallback:_y,useContext:At,useEffect:vh,useImperativeHandle:my,useInsertionEffect:dy,useLayoutEffect:py,useMemo:yy,useReducer:cc,useRef:hy,useState:function(){return cc(Ms)},useDebugValue:wh,useDeferredValue:function(t){var e=Rt();return ke===null?e.memoizedState=t:vy(e,ke.memoizedState,t)},useTransition:function(){var t=cc(Ms)[0],e=Rt().memoizedState;return[t,e]},useMutableSource:sy,useSyncExternalStore:oy,useId:wy,unstable_isNewReconciler:!1};function Nt(t,e){if(t&&t.defaultProps){e=ye({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Mu(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ye({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var El={isMounted:function(t){return(t=t._reactInternals)?xr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Je(),i=Fn(t),s=cn(r,i);s.payload=e,n!=null&&(s.callback=n),e=Nn(t,s,i),e!==null&&(Lt(e,t,i,r),jo(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Je(),i=Fn(t),s=cn(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Nn(t,s,i),e!==null&&(Lt(e,t,i,r),jo(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Je(),r=Fn(t),i=cn(n,r);i.tag=2,e!=null&&(i.callback=e),e=Nn(t,i,r),e!==null&&(Lt(e,t,r,n),jo(e,t,r))}};function op(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Es(n,r)||!Es(i,s):!0}function Sy(t,e,n){var r=!1,i=Vn,s=e.contextType;return typeof s=="object"&&s!==null?s=At(s):(i=st(e)?hr:Ke.current,r=e.contextTypes,s=(r=r!=null)?ui(t,i):Vn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=El,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function ap(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&El.enqueueReplaceState(e,e.state,null)}function Ou(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},hh(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=At(s):(s=st(e)?hr:Ke.current,i.context=ui(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Mu(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&El.enqueueReplaceState(i,i.state,null),va(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function pi(t,e){try{var n="",r=e;do n+=r3(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function uc(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Nu(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Pb=typeof WeakMap=="function"?WeakMap:Map;function Ey(t,e,n){n=cn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Sa||(Sa=!0,Wu=r),Nu(t,e)},n}function Ay(t,e,n){n=cn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){Nu(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Nu(t,e),typeof r!="function"&&(Dn===null?Dn=new Set([this]):Dn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function lp(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new Pb;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=Wb.bind(null,t,e,n),e.then(t,t))}function cp(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function up(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=cn(-1,1),e.tag=2,Nn(n,e,1))),n.lanes|=1),t)}var kb=gn.ReactCurrentOwner,nt=!1;function Ze(t,e,n,r){e.child=t===null?ty(e,null,n,r):hi(e,t.child,n,r)}function fp(t,e,n,r,i){n=n.render;var s=e.ref;return ii(e,i),r=_h(t,e,n,r,s,i),n=yh(),t!==null&&!nt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,dn(t,e,i)):(he&&n&&sh(e),e.flags|=1,Ze(t,e,r,i),e.child)}function hp(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!Ch(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Ry(t,e,s,r,i)):(t=qo(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Es,n(o,r)&&t.ref===e.ref)return dn(t,e,i)}return e.flags|=1,t=Bn(s,r),t.ref=e.ref,t.return=e,e.child=t}function Ry(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Es(s,r)&&t.ref===e.ref)if(nt=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(nt=!0);else return e.lanes=t.lanes,dn(t,e,i)}return Du(t,e,n,r,i)}function Cy(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},le(Kr,lt),lt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,le(Kr,lt),lt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,le(Kr,lt),lt|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,le(Kr,lt),lt|=r;return Ze(t,e,i,n),e.child}function Iy(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Du(t,e,n,r,i){var s=st(n)?hr:Ke.current;return s=ui(e,s),ii(e,i),n=_h(t,e,n,r,s,i),r=yh(),t!==null&&!nt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,dn(t,e,i)):(he&&r&&sh(e),e.flags|=1,Ze(t,e,n,i),e.child)}function dp(t,e,n,r,i){if(st(n)){var s=!0;pa(e)}else s=!1;if(ii(e,i),e.stateNode===null)Xo(t,e),Sy(e,n,r),Ou(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=At(c):(c=st(n)?hr:Ke.current,c=ui(e,c));var u=n.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&ap(e,o,r,c),bn=!1;var h=e.memoizedState;o.state=h,va(e,r,o,i),l=e.memoizedState,a!==r||h!==l||it.current||bn?(typeof u=="function"&&(Mu(e,n,u,r),l=e.memoizedState),(a=bn||op(e,n,a,r,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,ry(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Nt(e.type,a),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=At(l):(l=st(n)?hr:Ke.current,l=ui(e,l));var d=n.getDerivedStateFromProps;(u=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&ap(e,o,r,l),bn=!1,h=e.memoizedState,o.state=h,va(e,r,o,i);var y=e.memoizedState;a!==f||h!==y||it.current||bn?(typeof d=="function"&&(Mu(e,n,d,r),y=e.memoizedState),(c=bn||op(e,n,c,r,h,y,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,y,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,y,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=y),o.props=r,o.state=y,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Fu(t,e,n,r,s,i)}function Fu(t,e,n,r,i,s){Iy(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Jd(e,n,!1),dn(t,e,s);r=e.stateNode,kb.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=hi(e,t.child,null,s),e.child=hi(e,null,a,s)):Ze(t,e,a,s),e.memoizedState=r.state,i&&Jd(e,n,!0),e.child}function Py(t){var e=t.stateNode;e.pendingContext?Qd(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Qd(t,e.context,!1),dh(t,e.containerInfo)}function pp(t,e,n,r,i){return fi(),ah(i),e.flags|=256,Ze(t,e,n,r),e.child}var Bu={dehydrated:null,treeContext:null,retryLane:0};function Uu(t){return{baseLanes:t,cachePool:null,transitions:null}}function ky(t,e,n){var r=e.pendingProps,i=me.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),le(me,i&1),t===null)return Pu(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Cl(o,r,0,null),t=sr(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Uu(n),e.memoizedState=Bu,t):bh(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return Mb(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Bn(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Bn(a,s):(s=sr(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?Uu(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Bu,r}return s=t.child,t=s.sibling,r=Bn(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function bh(t,e){return e=Cl({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function _o(t,e,n,r){return r!==null&&ah(r),hi(e,t.child,null,n),t=bh(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Mb(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=uc(Error(B(422))),_o(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Cl({mode:"visible",children:r.children},i,0,null),s=sr(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&hi(e,t.child,null,o),e.child.memoizedState=Uu(o),e.memoizedState=Bu,s);if(!(e.mode&1))return _o(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(B(419)),r=uc(s,r,void 0),_o(t,e,o,r)}if(a=(o&t.childLanes)!==0,nt||a){if(r=Fe,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,hn(t,i),Lt(r,t,i,-1))}return Rh(),r=uc(Error(B(421))),_o(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=Hb.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,ht=On(i.nextSibling),dt=e,he=!0,Ft=null,t!==null&&(_t[yt++]=an,_t[yt++]=ln,_t[yt++]=dr,an=t.id,ln=t.overflow,dr=e),e=bh(e,r.children),e.flags|=4096,e)}function gp(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),ku(t.return,e,n)}function fc(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function My(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Ze(t,e,r.children,n),r=me.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&gp(t,n,e);else if(t.tag===19)gp(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(le(me,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&wa(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),fc(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&wa(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}fc(e,!0,n,null,s);break;case"together":fc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Xo(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function dn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),gr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(B(153));if(e.child!==null){for(t=e.child,n=Bn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Bn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Ob(t,e,n){switch(e.tag){case 3:Py(e),fi();break;case 5:iy(e);break;case 1:st(e.type)&&pa(e);break;case 4:dh(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;le(_a,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(le(me,me.current&1),e.flags|=128,null):n&e.child.childLanes?ky(t,e,n):(le(me,me.current&1),t=dn(t,e,n),t!==null?t.sibling:null);le(me,me.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return My(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),le(me,me.current),r)break;return null;case 22:case 23:return e.lanes=0,Cy(t,e,n)}return dn(t,e,n)}var Oy,Lu,Ny,Dy;Oy=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Lu=function(){};Ny=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,nr(Jt.current);var s=null;switch(n){case"input":i=au(t,i),r=au(t,r),s=[];break;case"select":i=ye({},i,{value:void 0}),r=ye({},r,{value:void 0}),s=[];break;case"textarea":i=uu(t,i),r=uu(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=ha)}hu(n,r);var o;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(ys.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(ys.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ue("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};Dy=function(t,e,n,r){n!==r&&(e.flags|=4)};function Fi(t,e){if(!he)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function ze(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Nb(t,e,n){var r=e.pendingProps;switch(oh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ze(e),null;case 1:return st(e.type)&&da(),ze(e),null;case 3:return r=e.stateNode,di(),fe(it),fe(Ke),gh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(go(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ft!==null&&(Yu(Ft),Ft=null))),Lu(t,e),ze(e),null;case 5:ph(e);var i=nr(Ps.current);if(n=e.type,t!==null&&e.stateNode!=null)Ny(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(B(166));return ze(e),null}if(t=nr(Jt.current),go(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Kt]=e,r[Cs]=s,t=(e.mode&1)!==0,n){case"dialog":ue("cancel",r),ue("close",r);break;case"iframe":case"object":case"embed":ue("load",r);break;case"video":case"audio":for(i=0;i<Hi.length;i++)ue(Hi[i],r);break;case"source":ue("error",r);break;case"img":case"image":case"link":ue("error",r),ue("load",r);break;case"details":ue("toggle",r);break;case"input":Sd(r,s),ue("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ue("invalid",r);break;case"textarea":Ad(r,s),ue("invalid",r)}hu(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&po(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&po(r.textContent,a,t),i=["children",""+a]):ys.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ue("scroll",r)}switch(n){case"input":so(r),Ed(r,s,!0);break;case"textarea":so(r),Rd(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=ha)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=c_(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Kt]=e,t[Cs]=r,Oy(t,e,!1,!1),e.stateNode=t;e:{switch(o=du(n,r),n){case"dialog":ue("cancel",t),ue("close",t),i=r;break;case"iframe":case"object":case"embed":ue("load",t),i=r;break;case"video":case"audio":for(i=0;i<Hi.length;i++)ue(Hi[i],t);i=r;break;case"source":ue("error",t),i=r;break;case"img":case"image":case"link":ue("error",t),ue("load",t),i=r;break;case"details":ue("toggle",t),i=r;break;case"input":Sd(t,r),i=au(t,r),ue("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=ye({},r,{value:void 0}),ue("invalid",t);break;case"textarea":Ad(t,r),i=uu(t,r),ue("invalid",t);break;default:i=r}hu(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?h_(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&u_(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&vs(t,l):typeof l=="number"&&vs(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ys.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ue("scroll",t):l!=null&&Hf(t,s,l,o))}switch(n){case"input":so(t),Ed(t,r,!1);break;case"textarea":so(t),Rd(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ln(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?ei(t,!!r.multiple,s,!1):r.defaultValue!=null&&ei(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=ha)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ze(e),null;case 6:if(t&&e.stateNode!=null)Dy(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(B(166));if(n=nr(Ps.current),nr(Jt.current),go(e)){if(r=e.stateNode,n=e.memoizedProps,r[Kt]=e,(s=r.nodeValue!==n)&&(t=dt,t!==null))switch(t.tag){case 3:po(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&po(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Kt]=e,e.stateNode=r}return ze(e),null;case 13:if(fe(me),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(he&&ht!==null&&e.mode&1&&!(e.flags&128))G_(),fi(),e.flags|=98560,s=!1;else if(s=go(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(B(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(B(317));s[Kt]=e}else fi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ze(e),s=!1}else Ft!==null&&(Yu(Ft),Ft=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||me.current&1?Me===0&&(Me=3):Rh())),e.updateQueue!==null&&(e.flags|=4),ze(e),null);case 4:return di(),Lu(t,e),t===null&&As(e.stateNode.containerInfo),ze(e),null;case 10:return uh(e.type._context),ze(e),null;case 17:return st(e.type)&&da(),ze(e),null;case 19:if(fe(me),s=e.memoizedState,s===null)return ze(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)Fi(s,!1);else{if(Me!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=wa(t),o!==null){for(e.flags|=128,Fi(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return le(me,me.current&1|2),e.child}t=t.sibling}s.tail!==null&&Te()>gi&&(e.flags|=128,r=!0,Fi(s,!1),e.lanes=4194304)}else{if(!r)if(t=wa(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Fi(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!he)return ze(e),null}else 2*Te()-s.renderingStartTime>gi&&n!==1073741824&&(e.flags|=128,r=!0,Fi(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Te(),e.sibling=null,n=me.current,le(me,r?n&1|2:n&1),e):(ze(e),null);case 22:case 23:return Ah(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?lt&1073741824&&(ze(e),e.subtreeFlags&6&&(e.flags|=8192)):ze(e),null;case 24:return null;case 25:return null}throw Error(B(156,e.tag))}function Db(t,e){switch(oh(e),e.tag){case 1:return st(e.type)&&da(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return di(),fe(it),fe(Ke),gh(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ph(e),null;case 13:if(fe(me),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(B(340));fi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return fe(me),null;case 4:return di(),null;case 10:return uh(e.type._context),null;case 22:case 23:return Ah(),null;case 24:return null;default:return null}}var yo=!1,Xe=!1,Fb=typeof WeakSet=="function"?WeakSet:Set,$=null;function Yr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){be(t,e,r)}else n.current=null}function Vu(t,e,n){try{n()}catch(r){be(t,e,r)}}var mp=!1;function Bb(t,e){if(xu=ca,t=V_(),ih(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,f=t,h=null;t:for(;;){for(var d;f!==n||i!==0&&f.nodeType!==3||(a=o+i),f!==s||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(d=f.firstChild)!==null;)h=f,f=d;for(;;){if(f===t)break t;if(h===n&&++c===i&&(a=o),h===s&&++u===r&&(l=o),(d=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=d}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Su={focusedElem:t,selectionRange:n},ca=!1,$=e;$!==null;)if(e=$,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,$=t;else for(;$!==null;){e=$;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var w=y.memoizedProps,x=y.memoizedState,m=e.stateNode,_=m.getSnapshotBeforeUpdate(e.elementType===e.type?w:Nt(e.type,w),x);m.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var g=e.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(B(163))}}catch(T){be(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,$=t;break}$=e.return}return y=mp,mp=!1,y}function rs(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Vu(e,n,s)}i=i.next}while(i!==r)}}function Al(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function $u(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Fy(t){var e=t.alternate;e!==null&&(t.alternate=null,Fy(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Kt],delete e[Cs],delete e[Ru],delete e[vb],delete e[wb])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function By(t){return t.tag===5||t.tag===3||t.tag===4}function _p(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||By(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function zu(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ha));else if(r!==4&&(t=t.child,t!==null))for(zu(t,e,n),t=t.sibling;t!==null;)zu(t,e,n),t=t.sibling}function ju(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(ju(t,e,n),t=t.sibling;t!==null;)ju(t,e,n),t=t.sibling}var Ue=null,Dt=!1;function mn(t,e,n){for(n=n.child;n!==null;)Uy(t,e,n),n=n.sibling}function Uy(t,e,n){if(Qt&&typeof Qt.onCommitFiberUnmount=="function")try{Qt.onCommitFiberUnmount(yl,n)}catch{}switch(n.tag){case 5:Xe||Yr(n,e);case 6:var r=Ue,i=Dt;Ue=null,mn(t,e,n),Ue=r,Dt=i,Ue!==null&&(Dt?(t=Ue,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ue.removeChild(n.stateNode));break;case 18:Ue!==null&&(Dt?(t=Ue,n=n.stateNode,t.nodeType===8?ic(t.parentNode,n):t.nodeType===1&&ic(t,n),xs(t)):ic(Ue,n.stateNode));break;case 4:r=Ue,i=Dt,Ue=n.stateNode.containerInfo,Dt=!0,mn(t,e,n),Ue=r,Dt=i;break;case 0:case 11:case 14:case 15:if(!Xe&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Vu(n,e,o),i=i.next}while(i!==r)}mn(t,e,n);break;case 1:if(!Xe&&(Yr(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){be(n,e,a)}mn(t,e,n);break;case 21:mn(t,e,n);break;case 22:n.mode&1?(Xe=(r=Xe)||n.memoizedState!==null,mn(t,e,n),Xe=r):mn(t,e,n);break;default:mn(t,e,n)}}function yp(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Fb),e.forEach(function(r){var i=Xb.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Pt(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ue=a.stateNode,Dt=!1;break e;case 3:Ue=a.stateNode.containerInfo,Dt=!0;break e;case 4:Ue=a.stateNode.containerInfo,Dt=!0;break e}a=a.return}if(Ue===null)throw Error(B(160));Uy(s,o,i),Ue=null,Dt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){be(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Ly(e,t),e=e.sibling}function Ly(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Pt(e,t),jt(t),r&4){try{rs(3,t,t.return),Al(3,t)}catch(w){be(t,t.return,w)}try{rs(5,t,t.return)}catch(w){be(t,t.return,w)}}break;case 1:Pt(e,t),jt(t),r&512&&n!==null&&Yr(n,n.return);break;case 5:if(Pt(e,t),jt(t),r&512&&n!==null&&Yr(n,n.return),t.flags&32){var i=t.stateNode;try{vs(i,"")}catch(w){be(t,t.return,w)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&a_(i,s),du(a,o);var c=du(a,s);for(o=0;o<l.length;o+=2){var u=l[o],f=l[o+1];u==="style"?h_(i,f):u==="dangerouslySetInnerHTML"?u_(i,f):u==="children"?vs(i,f):Hf(i,u,f,c)}switch(a){case"input":lu(i,s);break;case"textarea":l_(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var d=s.value;d!=null?ei(i,!!s.multiple,d,!1):h!==!!s.multiple&&(s.defaultValue!=null?ei(i,!!s.multiple,s.defaultValue,!0):ei(i,!!s.multiple,s.multiple?[]:"",!1))}i[Cs]=s}catch(w){be(t,t.return,w)}}break;case 6:if(Pt(e,t),jt(t),r&4){if(t.stateNode===null)throw Error(B(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(w){be(t,t.return,w)}}break;case 3:if(Pt(e,t),jt(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{xs(e.containerInfo)}catch(w){be(t,t.return,w)}break;case 4:Pt(e,t),jt(t);break;case 13:Pt(e,t),jt(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Sh=Te())),r&4&&yp(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Xe=(c=Xe)||u,Pt(e,t),Xe=c):Pt(e,t),jt(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for($=t,u=t.child;u!==null;){for(f=$=u;$!==null;){switch(h=$,d=h.child,h.tag){case 0:case 11:case 14:case 15:rs(4,h,h.return);break;case 1:Yr(h,h.return);var y=h.stateNode;if(typeof y.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(w){be(r,n,w)}}break;case 5:Yr(h,h.return);break;case 22:if(h.memoizedState!==null){wp(f);continue}}d!==null?(d.return=h,$=d):wp(f)}u=u.sibling}e:for(u=null,f=t;;){if(f.tag===5){if(u===null){u=f;try{i=f.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=f_("display",o))}catch(w){be(t,t.return,w)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(w){be(t,t.return,w)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Pt(e,t),jt(t),r&4&&yp(t);break;case 21:break;default:Pt(e,t),jt(t)}}function jt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(By(n)){var r=n;break e}n=n.return}throw Error(B(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(vs(i,""),r.flags&=-33);var s=_p(t);ju(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=_p(t);zu(t,a,o);break;default:throw Error(B(161))}}catch(l){be(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ub(t,e,n){$=t,Vy(t)}function Vy(t,e,n){for(var r=(t.mode&1)!==0;$!==null;){var i=$,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||yo;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Xe;a=yo;var c=Xe;if(yo=o,(Xe=l)&&!c)for($=i;$!==null;)o=$,l=o.child,o.tag===22&&o.memoizedState!==null?bp(i):l!==null?(l.return=o,$=l):bp(i);for(;s!==null;)$=s,Vy(s),s=s.sibling;$=i,yo=a,Xe=c}vp(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,$=s):vp(t)}}function vp(t){for(;$!==null;){var e=$;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Xe||Al(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Xe)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Nt(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&rp(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}rp(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&xs(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(B(163))}Xe||e.flags&512&&$u(e)}catch(h){be(e,e.return,h)}}if(e===t){$=null;break}if(n=e.sibling,n!==null){n.return=e.return,$=n;break}$=e.return}}function wp(t){for(;$!==null;){var e=$;if(e===t){$=null;break}var n=e.sibling;if(n!==null){n.return=e.return,$=n;break}$=e.return}}function bp(t){for(;$!==null;){var e=$;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Al(4,e)}catch(l){be(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){be(e,i,l)}}var s=e.return;try{$u(e)}catch(l){be(e,s,l)}break;case 5:var o=e.return;try{$u(e)}catch(l){be(e,o,l)}}}catch(l){be(e,e.return,l)}if(e===t){$=null;break}var a=e.sibling;if(a!==null){a.return=e.return,$=a;break}$=e.return}}var Lb=Math.ceil,xa=gn.ReactCurrentDispatcher,Th=gn.ReactCurrentOwner,Tt=gn.ReactCurrentBatchConfig,G=0,Fe=null,Ae=null,Le=0,lt=0,Kr=jn(0),Me=0,Ns=null,gr=0,Rl=0,xh=0,is=null,tt=null,Sh=0,gi=1/0,tn=null,Sa=!1,Wu=null,Dn=null,vo=!1,Rn=null,Ea=0,ss=0,Hu=null,Yo=-1,Ko=0;function Je(){return G&6?Te():Yo!==-1?Yo:Yo=Te()}function Fn(t){return t.mode&1?G&2&&Le!==0?Le&-Le:Tb.transition!==null?(Ko===0&&(Ko=S_()),Ko):(t=ne,t!==0||(t=window.event,t=t===void 0?16:k_(t.type)),t):1}function Lt(t,e,n,r){if(50<ss)throw ss=0,Hu=null,Error(B(185));Ws(t,n,r),(!(G&2)||t!==Fe)&&(t===Fe&&(!(G&2)&&(Rl|=n),Me===4&&En(t,Le)),ot(t,r),n===1&&G===0&&!(e.mode&1)&&(gi=Te()+500,xl&&Wn()))}function ot(t,e){var n=t.callbackNode;T3(t,e);var r=la(t,t===Fe?Le:0);if(r===0)n!==null&&Pd(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Pd(n),e===1)t.tag===0?bb(Tp.bind(null,t)):Z_(Tp.bind(null,t)),_b(function(){!(G&6)&&Wn()}),n=null;else{switch(E_(r)){case 1:n=Zf;break;case 4:n=T_;break;case 16:n=aa;break;case 536870912:n=x_;break;default:n=aa}n=Ky(n,$y.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function $y(t,e){if(Yo=-1,Ko=0,G&6)throw Error(B(327));var n=t.callbackNode;if(si()&&t.callbackNode!==n)return null;var r=la(t,t===Fe?Le:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Aa(t,r);else{e=r;var i=G;G|=2;var s=jy();(Fe!==t||Le!==e)&&(tn=null,gi=Te()+500,ir(t,e));do try{zb();break}catch(a){zy(t,a)}while(!0);ch(),xa.current=s,G=i,Ae!==null?e=0:(Fe=null,Le=0,e=Me)}if(e!==0){if(e===2&&(i=yu(t),i!==0&&(r=i,e=Xu(t,i))),e===1)throw n=Ns,ir(t,0),En(t,r),ot(t,Te()),n;if(e===6)En(t,r);else{if(i=t.current.alternate,!(r&30)&&!Vb(i)&&(e=Aa(t,r),e===2&&(s=yu(t),s!==0&&(r=s,e=Xu(t,s))),e===1))throw n=Ns,ir(t,0),En(t,r),ot(t,Te()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(B(345));case 2:Qn(t,tt,tn);break;case 3:if(En(t,r),(r&130023424)===r&&(e=Sh+500-Te(),10<e)){if(la(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Je(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Au(Qn.bind(null,t,tt,tn),e);break}Qn(t,tt,tn);break;case 4:if(En(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Ut(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Te()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Lb(r/1960))-r,10<r){t.timeoutHandle=Au(Qn.bind(null,t,tt,tn),r);break}Qn(t,tt,tn);break;case 5:Qn(t,tt,tn);break;default:throw Error(B(329))}}}return ot(t,Te()),t.callbackNode===n?$y.bind(null,t):null}function Xu(t,e){var n=is;return t.current.memoizedState.isDehydrated&&(ir(t,e).flags|=256),t=Aa(t,e),t!==2&&(e=tt,tt=n,e!==null&&Yu(e)),t}function Yu(t){tt===null?tt=t:tt.push.apply(tt,t)}function Vb(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Vt(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function En(t,e){for(e&=~xh,e&=~Rl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ut(e),r=1<<n;t[n]=-1,e&=~r}}function Tp(t){if(G&6)throw Error(B(327));si();var e=la(t,0);if(!(e&1))return ot(t,Te()),null;var n=Aa(t,e);if(t.tag!==0&&n===2){var r=yu(t);r!==0&&(e=r,n=Xu(t,r))}if(n===1)throw n=Ns,ir(t,0),En(t,e),ot(t,Te()),n;if(n===6)throw Error(B(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Qn(t,tt,tn),ot(t,Te()),null}function Eh(t,e){var n=G;G|=1;try{return t(e)}finally{G=n,G===0&&(gi=Te()+500,xl&&Wn())}}function mr(t){Rn!==null&&Rn.tag===0&&!(G&6)&&si();var e=G;G|=1;var n=Tt.transition,r=ne;try{if(Tt.transition=null,ne=1,t)return t()}finally{ne=r,Tt.transition=n,G=e,!(G&6)&&Wn()}}function Ah(){lt=Kr.current,fe(Kr)}function ir(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,mb(n)),Ae!==null)for(n=Ae.return;n!==null;){var r=n;switch(oh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&da();break;case 3:di(),fe(it),fe(Ke),gh();break;case 5:ph(r);break;case 4:di();break;case 13:fe(me);break;case 19:fe(me);break;case 10:uh(r.type._context);break;case 22:case 23:Ah()}n=n.return}if(Fe=t,Ae=t=Bn(t.current,null),Le=lt=e,Me=0,Ns=null,xh=Rl=gr=0,tt=is=null,tr!==null){for(e=0;e<tr.length;e++)if(n=tr[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}tr=null}return t}function zy(t,e){do{var n=Ae;try{if(ch(),Wo.current=Ta,ba){for(var r=_e.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}ba=!1}if(pr=0,De=ke=_e=null,ns=!1,ks=0,Th.current=null,n===null||n.return===null){Me=1,Ns=e,Ae=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Le,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var d=cp(o);if(d!==null){d.flags&=-257,up(d,o,a,s,e),d.mode&1&&lp(s,c,e),e=d,l=c;var y=e.updateQueue;if(y===null){var w=new Set;w.add(l),e.updateQueue=w}else y.add(l);break e}else{if(!(e&1)){lp(s,c,e),Rh();break e}l=Error(B(426))}}else if(he&&a.mode&1){var x=cp(o);if(x!==null){!(x.flags&65536)&&(x.flags|=256),up(x,o,a,s,e),ah(pi(l,a));break e}}s=l=pi(l,a),Me!==4&&(Me=2),is===null?is=[s]:is.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=Ey(s,l,e);np(s,m);break e;case 1:a=l;var _=s.type,g=s.stateNode;if(!(s.flags&128)&&(typeof _.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Dn===null||!Dn.has(g)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=Ay(s,a,e);np(s,T);break e}}s=s.return}while(s!==null)}Hy(n)}catch(C){e=C,Ae===n&&n!==null&&(Ae=n=n.return);continue}break}while(!0)}function jy(){var t=xa.current;return xa.current=Ta,t===null?Ta:t}function Rh(){(Me===0||Me===3||Me===2)&&(Me=4),Fe===null||!(gr&268435455)&&!(Rl&268435455)||En(Fe,Le)}function Aa(t,e){var n=G;G|=2;var r=jy();(Fe!==t||Le!==e)&&(tn=null,ir(t,e));do try{$b();break}catch(i){zy(t,i)}while(!0);if(ch(),G=n,xa.current=r,Ae!==null)throw Error(B(261));return Fe=null,Le=0,Me}function $b(){for(;Ae!==null;)Wy(Ae)}function zb(){for(;Ae!==null&&!d3();)Wy(Ae)}function Wy(t){var e=Yy(t.alternate,t,lt);t.memoizedProps=t.pendingProps,e===null?Hy(t):Ae=e,Th.current=null}function Hy(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Db(n,e),n!==null){n.flags&=32767,Ae=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Me=6,Ae=null;return}}else if(n=Nb(n,e,lt),n!==null){Ae=n;return}if(e=e.sibling,e!==null){Ae=e;return}Ae=e=t}while(e!==null);Me===0&&(Me=5)}function Qn(t,e,n){var r=ne,i=Tt.transition;try{Tt.transition=null,ne=1,jb(t,e,n,r)}finally{Tt.transition=i,ne=r}return null}function jb(t,e,n,r){do si();while(Rn!==null);if(G&6)throw Error(B(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(B(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(x3(t,s),t===Fe&&(Ae=Fe=null,Le=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||vo||(vo=!0,Ky(aa,function(){return si(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Tt.transition,Tt.transition=null;var o=ne;ne=1;var a=G;G|=4,Th.current=null,Bb(t,n),Ly(n,t),cb(Su),ca=!!xu,Su=xu=null,t.current=n,Ub(n),p3(),G=a,ne=o,Tt.transition=s}else t.current=n;if(vo&&(vo=!1,Rn=t,Ea=i),s=t.pendingLanes,s===0&&(Dn=null),_3(n.stateNode),ot(t,Te()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Sa)throw Sa=!1,t=Wu,Wu=null,t;return Ea&1&&t.tag!==0&&si(),s=t.pendingLanes,s&1?t===Hu?ss++:(ss=0,Hu=t):ss=0,Wn(),null}function si(){if(Rn!==null){var t=E_(Ea),e=Tt.transition,n=ne;try{if(Tt.transition=null,ne=16>t?16:t,Rn===null)var r=!1;else{if(t=Rn,Rn=null,Ea=0,G&6)throw Error(B(331));var i=G;for(G|=4,$=t.current;$!==null;){var s=$,o=s.child;if($.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for($=c;$!==null;){var u=$;switch(u.tag){case 0:case 11:case 15:rs(8,u,s)}var f=u.child;if(f!==null)f.return=u,$=f;else for(;$!==null;){u=$;var h=u.sibling,d=u.return;if(Fy(u),u===c){$=null;break}if(h!==null){h.return=d,$=h;break}$=d}}}var y=s.alternate;if(y!==null){var w=y.child;if(w!==null){y.child=null;do{var x=w.sibling;w.sibling=null,w=x}while(w!==null)}}$=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,$=o;else e:for(;$!==null;){if(s=$,s.flags&2048)switch(s.tag){case 0:case 11:case 15:rs(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,$=m;break e}$=s.return}}var _=t.current;for($=_;$!==null;){o=$;var g=o.child;if(o.subtreeFlags&2064&&g!==null)g.return=o,$=g;else e:for(o=_;$!==null;){if(a=$,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Al(9,a)}}catch(C){be(a,a.return,C)}if(a===o){$=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,$=T;break e}$=a.return}}if(G=i,Wn(),Qt&&typeof Qt.onPostCommitFiberRoot=="function")try{Qt.onPostCommitFiberRoot(yl,t)}catch{}r=!0}return r}finally{ne=n,Tt.transition=e}}return!1}function xp(t,e,n){e=pi(n,e),e=Ey(t,e,1),t=Nn(t,e,1),e=Je(),t!==null&&(Ws(t,1,e),ot(t,e))}function be(t,e,n){if(t.tag===3)xp(t,t,n);else for(;e!==null;){if(e.tag===3){xp(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Dn===null||!Dn.has(r))){t=pi(n,t),t=Ay(e,t,1),e=Nn(e,t,1),t=Je(),e!==null&&(Ws(e,1,t),ot(e,t));break}}e=e.return}}function Wb(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Je(),t.pingedLanes|=t.suspendedLanes&n,Fe===t&&(Le&n)===n&&(Me===4||Me===3&&(Le&130023424)===Le&&500>Te()-Sh?ir(t,0):xh|=n),ot(t,e)}function Xy(t,e){e===0&&(t.mode&1?(e=lo,lo<<=1,!(lo&130023424)&&(lo=4194304)):e=1);var n=Je();t=hn(t,e),t!==null&&(Ws(t,e,n),ot(t,n))}function Hb(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Xy(t,n)}function Xb(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(B(314))}r!==null&&r.delete(e),Xy(t,n)}var Yy;Yy=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||it.current)nt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return nt=!1,Ob(t,e,n);nt=!!(t.flags&131072)}else nt=!1,he&&e.flags&1048576&&Q_(e,ma,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Xo(t,e),t=e.pendingProps;var i=ui(e,Ke.current);ii(e,n),i=_h(null,e,r,t,i,n);var s=yh();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,st(r)?(s=!0,pa(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,hh(e),i.updater=El,e.stateNode=i,i._reactInternals=e,Ou(e,r,t,n),e=Fu(null,e,r,!0,s,n)):(e.tag=0,he&&s&&sh(e),Ze(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Xo(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=Kb(r),t=Nt(r,t),i){case 0:e=Du(null,e,r,t,n);break e;case 1:e=dp(null,e,r,t,n);break e;case 11:e=fp(null,e,r,t,n);break e;case 14:e=hp(null,e,r,Nt(r.type,t),n);break e}throw Error(B(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),Du(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),dp(t,e,r,i,n);case 3:e:{if(Py(e),t===null)throw Error(B(387));r=e.pendingProps,s=e.memoizedState,i=s.element,ry(t,e),va(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=pi(Error(B(423)),e),e=pp(t,e,r,n,i);break e}else if(r!==i){i=pi(Error(B(424)),e),e=pp(t,e,r,n,i);break e}else for(ht=On(e.stateNode.containerInfo.firstChild),dt=e,he=!0,Ft=null,n=ty(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(fi(),r===i){e=dn(t,e,n);break e}Ze(t,e,r,n)}e=e.child}return e;case 5:return iy(e),t===null&&Pu(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,Eu(r,i)?o=null:s!==null&&Eu(r,s)&&(e.flags|=32),Iy(t,e),Ze(t,e,o,n),e.child;case 6:return t===null&&Pu(e),null;case 13:return ky(t,e,n);case 4:return dh(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=hi(e,null,r,n):Ze(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),fp(t,e,r,i,n);case 7:return Ze(t,e,e.pendingProps,n),e.child;case 8:return Ze(t,e,e.pendingProps.children,n),e.child;case 12:return Ze(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,le(_a,r._currentValue),r._currentValue=o,s!==null)if(Vt(s.value,o)){if(s.children===i.children&&!it.current){e=dn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=cn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),ku(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(B(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),ku(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ze(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ii(e,n),i=At(i),r=r(i),e.flags|=1,Ze(t,e,r,n),e.child;case 14:return r=e.type,i=Nt(r,e.pendingProps),i=Nt(r.type,i),hp(t,e,r,i,n);case 15:return Ry(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),Xo(t,e),e.tag=1,st(r)?(t=!0,pa(e)):t=!1,ii(e,n),Sy(e,r,i),Ou(e,r,i,n),Fu(null,e,r,!0,t,n);case 19:return My(t,e,n);case 22:return Cy(t,e,n)}throw Error(B(156,e.tag))};function Ky(t,e){return b_(t,e)}function Yb(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vt(t,e,n,r){return new Yb(t,e,n,r)}function Ch(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Kb(t){if(typeof t=="function")return Ch(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Yf)return 11;if(t===Kf)return 14}return 2}function Bn(t,e){var n=t.alternate;return n===null?(n=vt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function qo(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")Ch(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Ur:return sr(n.children,i,s,e);case Xf:o=8,i|=8;break;case ru:return t=vt(12,n,e,i|2),t.elementType=ru,t.lanes=s,t;case iu:return t=vt(13,n,e,i),t.elementType=iu,t.lanes=s,t;case su:return t=vt(19,n,e,i),t.elementType=su,t.lanes=s,t;case i_:return Cl(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case n_:o=10;break e;case r_:o=9;break e;case Yf:o=11;break e;case Kf:o=14;break e;case wn:o=16,r=null;break e}throw Error(B(130,t==null?t:typeof t,""))}return e=vt(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function sr(t,e,n,r){return t=vt(7,t,r,e),t.lanes=n,t}function Cl(t,e,n,r){return t=vt(22,t,r,e),t.elementType=i_,t.lanes=n,t.stateNode={isHidden:!1},t}function hc(t,e,n){return t=vt(6,t,null,e),t.lanes=n,t}function dc(t,e,n){return e=vt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function qb(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Yl(0),this.expirationTimes=Yl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yl(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Ih(t,e,n,r,i,s,o,a,l){return t=new qb(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=vt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},hh(s),t}function Zb(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Br,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function qy(t){if(!t)return Vn;t=t._reactInternals;e:{if(xr(t)!==t||t.tag!==1)throw Error(B(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(st(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(B(171))}if(t.tag===1){var n=t.type;if(st(n))return q_(t,n,e)}return e}function Zy(t,e,n,r,i,s,o,a,l){return t=Ih(n,r,!0,t,i,s,o,a,l),t.context=qy(null),n=t.current,r=Je(),i=Fn(n),s=cn(r,i),s.callback=e??null,Nn(n,s,i),t.current.lanes=i,Ws(t,i,r),ot(t,r),t}function Il(t,e,n,r){var i=e.current,s=Je(),o=Fn(i);return n=qy(n),e.context===null?e.context=n:e.pendingContext=n,e=cn(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Nn(i,e,o),t!==null&&(Lt(t,i,o,s),jo(t,i,o)),o}function Ra(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Sp(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ph(t,e){Sp(t,e),(t=t.alternate)&&Sp(t,e)}function Qb(){return null}var Qy=typeof reportError=="function"?reportError:function(t){console.error(t)};function kh(t){this._internalRoot=t}Pl.prototype.render=kh.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(B(409));Il(t,e,null,null)};Pl.prototype.unmount=kh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;mr(function(){Il(null,t,null,null)}),e[fn]=null}};function Pl(t){this._internalRoot=t}Pl.prototype.unstable_scheduleHydration=function(t){if(t){var e=C_();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Sn.length&&e!==0&&e<Sn[n].priority;n++);Sn.splice(n,0,t),n===0&&P_(t)}};function Mh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function kl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Ep(){}function Jb(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=Ra(o);s.call(c)}}var o=Zy(e,r,t,0,null,!1,!1,"",Ep);return t._reactRootContainer=o,t[fn]=o.current,As(t.nodeType===8?t.parentNode:t),mr(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=Ra(l);a.call(c)}}var l=Ih(t,0,!1,null,null,!1,!1,"",Ep);return t._reactRootContainer=l,t[fn]=l.current,As(t.nodeType===8?t.parentNode:t),mr(function(){Il(e,l,n,r)}),l}function Ml(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=Ra(o);a.call(l)}}Il(e,o,t,i)}else o=Jb(n,e,t,i,r);return Ra(o)}A_=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Wi(e.pendingLanes);n!==0&&(Qf(e,n|1),ot(e,Te()),!(G&6)&&(gi=Te()+500,Wn()))}break;case 13:mr(function(){var r=hn(t,1);if(r!==null){var i=Je();Lt(r,t,1,i)}}),Ph(t,1)}};Jf=function(t){if(t.tag===13){var e=hn(t,134217728);if(e!==null){var n=Je();Lt(e,t,134217728,n)}Ph(t,134217728)}};R_=function(t){if(t.tag===13){var e=Fn(t),n=hn(t,e);if(n!==null){var r=Je();Lt(n,t,e,r)}Ph(t,e)}};C_=function(){return ne};I_=function(t,e){var n=ne;try{return ne=t,e()}finally{ne=n}};gu=function(t,e,n){switch(e){case"input":if(lu(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Tl(r);if(!i)throw Error(B(90));o_(r),lu(r,i)}}}break;case"textarea":l_(t,n);break;case"select":e=n.value,e!=null&&ei(t,!!n.multiple,e,!1)}};g_=Eh;m_=mr;var Gb={usingClientEntryPoint:!1,Events:[Xs,zr,Tl,d_,p_,Eh]},Bi={findFiberByHostInstance:er,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},e1={bundleType:Bi.bundleType,version:Bi.version,rendererPackageName:Bi.rendererPackageName,rendererConfig:Bi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:gn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=v_(t),t===null?null:t.stateNode},findFiberByHostInstance:Bi.findFiberByHostInstance||Qb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wo.isDisabled&&wo.supportsFiber)try{yl=wo.inject(e1),Qt=wo}catch{}}gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gb;gt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Mh(e))throw Error(B(200));return Zb(t,e,null,n)};gt.createRoot=function(t,e){if(!Mh(t))throw Error(B(299));var n=!1,r="",i=Qy;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Ih(t,1,!1,null,null,n,!1,r,i),t[fn]=e.current,As(t.nodeType===8?t.parentNode:t),new kh(e)};gt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(B(188)):(t=Object.keys(t).join(","),Error(B(268,t)));return t=v_(e),t=t===null?null:t.stateNode,t};gt.flushSync=function(t){return mr(t)};gt.hydrate=function(t,e,n){if(!kl(e))throw Error(B(200));return Ml(null,t,e,!0,n)};gt.hydrateRoot=function(t,e,n){if(!Mh(t))throw Error(B(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=Qy;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Zy(e,null,t,1,n??null,i,!1,s,o),t[fn]=e.current,As(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Pl(e)};gt.render=function(t,e,n){if(!kl(e))throw Error(B(200));return Ml(null,t,e,!1,n)};gt.unmountComponentAtNode=function(t){if(!kl(t))throw Error(B(40));return t._reactRootContainer?(mr(function(){Ml(null,null,t,!1,function(){t._reactRootContainer=null,t[fn]=null})}),!0):!1};gt.unstable_batchedUpdates=Eh;gt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!kl(n))throw Error(B(200));if(t==null||t._reactInternals===void 0)throw Error(B(38));return Ml(t,e,n,!1,r)};gt.version="18.3.1-next-f1338f8080-20240426";function Jy(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Jy)}catch(t){console.error(t)}}Jy(),Jm.exports=gt;var t1=Jm.exports,Gy,Ap=t1;Gy=Ap.createRoot,Ap.hydrateRoot;function Ca(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Oh=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Rp=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Rp&&parseFloat(Rp[1]);const bo=globalThis,Cr=globalThis.process||{},n1=globalThis.navigator||{};function ev(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function Sr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||ev()}function r1(t){return Sr()?ev()?"Electron":(n1.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const tv="4.1.0";function i1(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class s1{constructor(e,n,r="sessionStorage"){this.storage=i1(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function o1(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function a1(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Ia;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ia||(Ia={}));const l1=10;function Cp(t){return typeof t!="string"?t:(t=t.toUpperCase(),Ia[t]||Ia.WHITE)}function c1(t,e,n){return!Sr&&typeof t=="string"&&(e&&(t=`\x1B[${Cp(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${Cp(n)+l1}m${t}\x1B[49m`)),t}function u1(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function Nh(t,e){if(!t)throw new Error("Assertion failed")}function Ir(){var e,n,r;let t;if(Sr()&&bo.performance)t=(n=(e=bo==null?void 0:bo.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Cr){const i=(r=Cr==null?void 0:Cr.hrtime)==null?void 0:r.call(Cr);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Pr={debug:Sr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},f1={enabled:!0,level:0};function kr(){}const Ip={},Pp={once:!0};class Ks{constructor({id:e}={id:""}){this.VERSION=tv,this._startTs=Ir(),this._deltaTs=Ir(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new s1(`__probe-${this.id}__`,f1),this.timeStamp(`${this.id} started`),u1(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ir()-this._startTs).toPrecision(10))}getDelta(){return Number((Ir()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Pr.warn,arguments,Pp)}error(e){return this._getLogFunction(0,e,Pr.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Pr.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Pr.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Pr.debug||Pr.info,arguments,Pp)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||kr,r&&[r],{tag:d1(n)}):kr}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||kr)}group(e,n,r={collapsed:!1}){const i=kp({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||kr)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=nv(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=kp({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,Nh(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Ir();const o=s.tag||s.message;if(s.once&&o)if(!Ip[o])Ip[o]=Ir();else return kr;return n=h1(this.id,s.message,s),r.bind(console,n,...s.args)}return kr}}Ks.VERSION=tv;function nv(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Nh(Number.isFinite(e)&&e>=0),e}function kp(t){const{logLevel:e,message:n}=t;t.logLevel=nv(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return Nh(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function h1(t,e,n){if(typeof e=="string"){const r=n.time?a1(o1(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=c1(e,n.color,n.background)}return e}function d1(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const pc="4.3.3",p1=pc[0]>="0"&&pc[0]<="9"?`v${pc}`:"";function g1(){const t=new Ks({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=p1,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const m1=g1();function _1(t,e){return rv(t||{},e)}function rv(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=rv(r[i]||{},e[i],n+1):r[i]=e[i];return r}const y1="latest";function v1(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const w1=v1();function $n(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const or=typeof process!="object"||String(process)!=="[object process]"||process.browser,b1=typeof window<"u"&&typeof window.orientation<"u",Mp=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Mp&&parseFloat(Mp[1]);class T1{constructor(e,n){p(this,"name");p(this,"workerThread");p(this,"isRunning",!0);p(this,"result");p(this,"_resolve",()=>{});p(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){$n(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){$n(this.isRunning),this.isRunning=!1,this._reject(e)}}class gc{terminate(){}}const mc=new Map;function x1(t){$n(t.source&&!t.url||!t.source&&t.url);let e=mc.get(t.source||t.url);return e||(t.url&&(e=S1(t.url),mc.set(t.url,e)),t.source&&(e=iv(t.source),mc.set(t.source,e))),$n(e),e}function S1(t){if(!t.startsWith("http"))return t;const e=E1(t);return iv(e)}function iv(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function E1(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function sv(t,e=!0,n){const r=n||new Set;if(t){if(Op(t))r.add(t);else if(Op(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)sv(t[i],e,r)}}return n===void 0?Array.from(r):[]}function Op(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const _c=()=>{};class Ku{constructor(e){p(this,"name");p(this,"source");p(this,"url");p(this,"terminated",!1);p(this,"worker");p(this,"onMessage");p(this,"onError");p(this,"_loadableURL","");const{name:n,source:r,url:i}=e;$n(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=_c,this.onError=s=>console.log(s),this.worker=or?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&or||typeof gc<"u"&&!or}destroy(){this.onMessage=_c,this.onError=_c,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||sv(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=x1({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new gc(r,{eval:!1})}else if(this.source)e=new gc(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class A1{constructor(e){p(this,"name","unnamed");p(this,"source");p(this,"url");p(this,"maxConcurrency",1);p(this,"maxMobileConcurrency",1);p(this,"onDebug",()=>{});p(this,"reuseWorkers",!0);p(this,"props",{});p(this,"jobQueue",[]);p(this,"idleQueue",[]);p(this,"count",0);p(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Ku.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new T1(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!or||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Ku({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return b1?this.maxMobileConcurrency:this.maxConcurrency}}const R1={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},xn=class xn{constructor(e){p(this,"props");p(this,"workerPools",new Map);this.props={...R1},this.setProps(e),this.workerPools=new Map}static isSupported(){return Ku.isSupported()}static getWorkerFarm(e={}){return xn._workerFarm=xn._workerFarm||new xn({}),xn._workerFarm.setProps(e),xn._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new A1({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};p(xn,"_workerFarm");let Pa=xn;function C1(t,e={}){const n=e[t.id]||{},r=or?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(or?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=y1);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return $n(i),i}function I1(t,e=w1){$n(t,"no worker provided");const n=t.version;return!(!e||!n)}function P1(t,e){return!Pa.isSupported()||!or&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function k1(t,e,n,r,i){const s=t.id,o=C1(t,n),l=Pa.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const c=await l.startJob("process-on-worker",M1.bind(null,i));return c.postMessage("process",{input:e,options:n,context:r}),await(await c.result).result}async function M1(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function O1(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function N1(...t){return D1(t)}function D1(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function*F1(t,e={}){const n=new TextDecoder(void 0,e);for await(const r of t)yield typeof r=="string"?r:n.decode(r,{stream:!0})}async function*B1(t){let e="";for await(const n of t){e+=n;let r;for(;(r=e.indexOf(`
`))>=0;){const i=e.slice(0,r+1);e=e.slice(r+1),yield i}}e.length>0&&(yield e)}async function U1(t,e){for(;;){const{done:n,value:r}=await t.next();if(n){t.return();return}if(e(r))return}}async function L1(t){const e=[];for await(const n of t)e.push(n);return N1(...e)}function Np(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Dp{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Np(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Np()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Ol{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof Dp?i=e:i=new Dp(n,r),this.stats[n]=i),i}}let V1="";const Fp={};function $1(t){for(const e in Fp)if(t.startsWith(e)){const n=Fp[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${V1}${t}`),t}function z1(t){return t&&typeof t=="object"&&t.isBuffer}function ov(t){if(z1(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function av(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function j1(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const W1=t=>typeof t=="boolean",os=t=>typeof t=="function",qs=t=>t!==null&&typeof t=="object",Bp=t=>qs(t)&&t.constructor==={}.constructor,H1=t=>!!t&&typeof t[Symbol.iterator]=="function",X1=t=>t&&typeof t[Symbol.asyncIterator]=="function",Er=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Ar=t=>typeof Blob<"u"&&t instanceof Blob,Y1=t=>t&&typeof t=="object"&&t.isBuffer,K1=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||qs(t)&&os(t.tee)&&os(t.cancel)&&os(t.getReader),q1=t=>qs(t)&&os(t.read)&&os(t.pipe)&&W1(t.readable),lv=t=>K1(t)||q1(t);class Z1 extends Error{constructor(n,r){super(n);p(this,"reason");p(this,"url");p(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const Q1=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,J1=/^([-\w.]+\/[-\w.+]+)/;function Up(t,e){return t.toLowerCase()===e.toLowerCase()}function G1(t){const e=J1.exec(t);return e?e[1]:t}function Lp(t){const e=Q1.exec(t);return e?e[1]:""}const cv=/\?.*/;function eT(t){const e=t.match(cv);return e&&e[0]}function Dh(t){return t.replace(cv,"")}function tT(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Nl(t){return Er(t)?t.url:Ar(t)?t.name||"":typeof t=="string"?t:""}function Fh(t){if(Er(t)){const e=t,n=e.headers.get("content-type")||"",r=Dh(e.url);return G1(n)||Lp(r)}return Ar(t)?t.type||"":typeof t=="string"?Lp(t):""}function nT(t){return Er(t)?t.headers["content-length"]||-1:Ar(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function uv(t){if(Er(t))return t;const e={},n=nT(t);n>=0&&(e["content-length"]=String(n));const r=Nl(t),i=Fh(t);i&&(e["content-type"]=i);const s=await sT(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function rT(t){if(!t.ok)throw await iT(t)}async function iT(t){const e=tT(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(i!=null&&i.includes("application/json"))?await t.json():await t.text()}catch{}return new Z1(n,r)}async function sT(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${oT(n)}`}return null}function oT(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function aT(t){return!lT(t)&&!cT(t)}function lT(t){return t.startsWith("http:")||t.startsWith("https:")}function cT(t){return t.startsWith("data:")}async function Vp(t,e){var n,r;if(typeof t=="string"){const i=$1(t);return aT(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await uv(t)}const $p=new Ks({id:"loaders.gl"});class uT{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class fT{constructor(){p(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const fv={fetch:null,mimeType:void 0,nothrow:!1,log:new fT,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Oh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},hT={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function hv(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function dv(){const t=hv();return t.globalOptions=t.globalOptions||{...fv},t.globalOptions}function dT(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],pT(t,n),mT(e,t,r)}function pT(t,e){zp(t,null,fv,hT,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};zp(r,n.id,i,s,e)}}function zp(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const l=!e&&qs(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in r)$p.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!l){const f=gT(a,i);$p.warn(`${s} loader option '${o}${a}' not recognized. ${f}`)()}}}}function gT(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function mT(t,e,n){const i={...t.options||{}};return _T(i,n),i.log===null&&(i.log=new uT),jp(i,dv()),jp(i,e),i}function jp(t,e){for(const n in e)if(n in e){const r=e[n];Bp(r)&&Bp(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function _T(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Bh(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function Uh(t){Ca(t,"null loader"),Ca(Bh(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const pv=()=>{const t=hv();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function yT(t){const e=pv();t=Array.isArray(t)?t:[t];for(const n of t){const r=Uh(n);e.find(i=>r===i)||e.unshift(r)}}function vT(){return pv()}const wT=/\.([^.]+)$/;async function bT(t,e=[],n,r){if(!gv(t))return null;let i=Wp(t,e,{...n,nothrow:!0},r);if(i)return i;if(Ar(t)&&(t=await t.slice(0,10).arrayBuffer(),i=Wp(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(mv(t));return i}function Wp(t,e=[],n,r){if(!gv(t))return null;if(e&&!Array.isArray(e))return Uh(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...vT()),xT(i);const s=TT(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(mv(t));return s}function TT(t,e,n,r){const i=Nl(t),s=Fh(t),o=Dh(i)||(r==null?void 0:r.url);let a=null,l="";return n!=null&&n.mimeType&&(a=yc(e,n==null?void 0:n.mimeType),l=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||ST(e,o),l=l||(a?`matched url ${o}`:""),a=a||yc(e,s),l=l||(a?`matched MIME type ${s}`:""),a=a||AT(e,t),l=l||(a?`matched initial data ${_v(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||yc(e,n==null?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:"")),l&&m1.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${l}.`),a}function gv(t){return!(t instanceof Response&&t.status===204)}function mv(t){const e=Nl(t),n=Fh(t);let r="No valid loader found (";r+=e?`${av(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?_v(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function xT(t){for(const e of t)Uh(e)}function ST(t,e){const n=e&&wT.exec(e),r=n&&n[1];return r?ET(t,r):null}function ET(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function yc(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>Up(e,i))||Up(e,`application/x.${r.id}`))return r;return null}function AT(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(RT(e,n))return n}else if(ArrayBuffer.isView(e)){if(Hp(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Hp(e,0,n))return n;return null}function RT(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function Hp(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>CT(t,e,n,i))}function CT(t,e,n,r){if(r instanceof ArrayBuffer)return O1(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=qu(t,e,r.length);return r===i;default:return!1}}function _v(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?qu(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?qu(t,0,e):""}function qu(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const IT=256*1024;function*PT(t,e){const n=(e==null?void 0:e.chunkSize)||IT;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const kT=256*1024;function*MT(t,e={}){const{chunkSize:n=kT}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const OT=1024*1024;async function*NT(t,e){const n=(e==null?void 0:e.chunkSize)||OT;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function Xp(t,e){return Oh?DT(t,e):FT(t)}async function*DT(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield ov(o)}}catch{n.releaseLock()}}async function*FT(t,e){for await(const n of t)yield ov(n)}function BT(t,e){if(typeof t=="string")return PT(t,e);if(t instanceof ArrayBuffer)return MT(t,e);if(Ar(t))return NT(t,e);if(lv(t))return Xp(t,e);if(Er(t))return Xp(t.body,e);throw new Error("makeIterator")}const yv="Cannot convert supplied data type";function UT(t,e,n){if(e.text&&typeof t=="string")return t;if(Y1(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(yv)}async function LT(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return UT(t,e);if(Ar(t)&&(t=await uv(t)),Er(t)){const i=t;return await rT(i),e.binary?await i.arrayBuffer():await i.text()}if(lv(t)&&(t=BT(t,n)),H1(t)||X1(t))return L1(t);throw new Error(yv)}function vv(t,e){const n=dv(),r=t||n;return typeof r.fetch=="function"?r.fetch:qs(r.fetch)?i=>Vp(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Vp}function VT(t,e,n){if(n)return n;const r={fetch:vv(e,t),...t};if(r.url){const i=Dh(r.url);r.baseUrl=i,r.queryString=eT(r.url),r.filename=av(i),r.baseUrl=j1(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function $T(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function ka(t,e,n,r){e&&!Array.isArray(e)&&!Bh(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=Nl(t),o=$T(e,r),a=await bT(t,o,n);return a?(n=dT(n,a,o,i),r=VT({url:i,_parse:ka,loaders:o},n,r||null),await zT(a,t,n,r)):null}async function zT(t,e,n,r){if(I1(t),n=_1(t.options,n),Er(e)){const s=e,{ok:o,redirected:a,status:l,statusText:c,type:u,url:f}=s,h=Object.fromEntries(s.headers.entries());r.response={headers:h,ok:o,redirected:a,status:l,statusText:c,type:u,url:f}}e=await LT(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(P1(t,n))return await k1(t,e,n,r,ka);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw $n(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function jT(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function wv(t){let e=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],l=a&&a.length;for(let c=0;c<l;c+=3){const u=a[c],f=a[c+1],h=a[c+2];e=u<e?u:e,n=f<n?f:n,r=h<r?h:r,i=u>i?u:i,s=f>s?f:s,o=h>o?h:o}return[[e,n,r],[i,s,o]]}function WT(t,e={}){return{fields:XT(t),metadata:e}}function HT(t,e,n){const r=jT(e.value),i=n||YT(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:r}]},nullable:!1,metadata:i}}function XT(t){const e=[];for(const n in t){const r=t[n];e.push(HT(n,r))}return e}function YT(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function Ds(t,e,n,r){let i,s;!Array.isArray(e)&&!Bh(e)?(i=[],s=e):(i=e,s=n);const o=vv(s);let a=t;return typeof t=="string"&&(a=await o(t)),Ar(t)&&(a=await o(t)),Array.isArray(i)?await ka(a,i,s):await ka(a,i,s)}const KT="4.3.3";var Vm;const qT=(Vm=globalThis.loaders)==null?void 0:Vm.parseImageNode,Zu=typeof Image<"u",Qu=typeof ImageBitmap<"u",ZT=!!qT,Ju=Oh?!0:ZT;function QT(t){switch(t){case"auto":return Qu||Zu||Ju;case"imagebitmap":return Qu;case"image":return Zu;case"data":return Ju;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function JT(){if(Qu)return"imagebitmap";if(Zu)return"image";if(Ju)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function GT(t){const e=t2(t);if(!e)throw new Error("Not an image");return e}function e2(t){switch(GT(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function t2(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const n2=/^data:image\/svg\+xml/,r2=/\.svg((\?|#).*)?$/;function Lh(t){return t&&(n2.test(t)||r2.test(t))}function i2(t,e){if(Lh(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return bv(t,e)}function bv(t,e){if(Lh(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Tv(t,e,n){const r=i2(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await s2(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function s2(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const o2={};let Yp=!0;async function a2(t,e,n){let r;Lh(n)?r=await Tv(t,e,n):r=bv(t,n);const i=e&&e.imagebitmap;return await l2(r,i)}async function l2(t,e=null){if((c2(e)||!Yp)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Yp=!1}return await createImageBitmap(t)}function c2(t){for(const e in t||o2)return!1;return!0}function u2(t){return!p2(t,"ftyp",4)||!(t[8]&96)?null:f2(t)}function f2(t){switch(h2(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function h2(t,e,n){return String.fromCharCode(...t.slice(e,n))}function d2(t){return[...t].map(e=>e.charCodeAt(0))}function p2(t,e,n=0){const r=d2(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const qt=!1,as=!0;function xv(t){const e=Zs(t);return m2(e)||v2(e)||_2(e)||y2(e)||g2(e)}function g2(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=u2(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function m2(t){const e=Zs(t);return e.byteLength>=24&&e.getUint32(0,qt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,qt),height:e.getUint32(20,qt)}:null}function _2(t){const e=Zs(t);return e.byteLength>=10&&e.getUint32(0,qt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,as),height:e.getUint16(8,as)}:null}function y2(t){const e=Zs(t);return e.byteLength>=14&&e.getUint16(0,qt)===16973&&e.getUint32(2,as)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,as),height:e.getUint32(22,as)}:null}function v2(t){const e=Zs(t);if(!(e.byteLength>=3&&e.getUint16(0,qt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=w2();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,qt);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,qt),width:e.getUint16(s+7,qt)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,qt)}return null}function w2(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Zs(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function b2(t,e){var i;const{mimeType:n}=xv(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Ca(r),await r(t,n)}async function T2(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=x2(i);let a;switch(o){case"imagebitmap":a=await a2(t,e,s);break;case"image":a=await Tv(t,e,s);break;case"data":a=await b2(t);break;default:Ca(!1)}return i==="data"&&(a=e2(a)),a}function x2(t){switch(t){case"auto":case"data":return JT();default:return QT(t),t}}const S2=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],E2=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],A2={image:{type:"auto",decode:!0}},R2={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:KT,mimeTypes:E2,extensions:S2,parse:T2,tests:[t=>!!xv(new DataView(t))],options:A2},se=new Ks({id:"deck"});let Gu={};function C2(t){Gu=t}function Qe(t,e,n,r){se.level>0&&Gu[t]&&Gu[t].call(null,e,n,r)}function I2(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const P2={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:I2,parseTextSync:JSON.parse};function k2(){const t="9.2.2",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(se.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:se,_registerLoggers:C2},yT([P2,[R2,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const M2=k2();function Vh(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const vc={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function O2(t){const e={};for(const[n,r]of Object.entries(t))e[n]=N2(r);return e}function N2(t){let e=Kp(t);if(e!=="object")return{value:t,...vc[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...vc[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Kp(t.value),{...t,...vc[e],type:e}):{type:"object",value:null};throw new Error("props")}function Kp(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const D2=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,F2=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,B2={vertex:D2,fragment:F2},qp=/void\s+main\s*\([^)]*\)\s*\{\n?/,Zp=/}\n?[^{}]*$/,wc=[],Zo="__LUMA_INJECT_DECLARATIONS__";function U2(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=L2(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function L2(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Ma(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),wc.length=o.length;for(let l=0,c=o.length;l<c;++l)wc[l]=o[l].injection;const a=`${wc.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(Zo,a));break;case"vs:#main-start":i&&(t=t.replace(qp,l=>l+a));break;case"vs:#main-end":i&&(t=t.replace(Zp,l=>a+l));break;case"fs:#decl":i||(t=t.replace(Zo,a));break;case"fs:#main-start":i||(t=t.replace(qp,l=>l+a));break;case"fs:#main-end":i||(t=t.replace(Zp,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Zo,""),r&&(t=t.replace(/\}\s*$/,s=>s+B2[e])),t}function Oa(t){t.map(e=>V2(e))}function V2(t){if(t.instance)return;Oa(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:r={}}=t,i={normalizedInjections:U2(r),parsedDeprecations:$2(n)};e&&(i.propValidators=O2(e)),t.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[a,l])=>{const c=l==null?void 0:l.value;return c&&(o[a]=c),o},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function Sv(t,e,n){var r;(r=t.deprecations)==null||r.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}function $2(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function $h(t){Oa(t);const e={},n={};Ev({modules:t,level:0,moduleMap:e,moduleDepth:n});const r=Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i]);return Oa(r),r}function Ev(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&Ev({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function z2(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function j2(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=Qp(t,W2),t;case"fragment":return t=Qp(t,H2),t;default:throw new Error(e)}}const Av=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],W2=[...Av,[ef("attribute"),"in $1"],[ef("varying"),"out $1"]],H2=[...Av,[ef("varying"),"in $1"]];function Qp(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function ef(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Rv(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function Cv(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(s)}}return e}function X2(t,e){return{name:Y2(t,e),language:"glsl",version:K2(t)}}function Y2(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function K2(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const Iv=`

${Zo}
`,q2=`precision highp float;
`;function Z2(t){const e=$h(t.modules||[]);return{source:J2(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:Pv(e)}}function Q2(t){const{vs:e,fs:n}=t,r=$h(t.modules||[]);return{vs:Jp(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:Jp(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:Pv(r)}}function J2(t,e){var w;const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;Vh(typeof n=="string","shader source must be a string");const l=n;let c="";const u=Cv(s),f={},h={},d={};for(const x in o){const m=typeof o[x]=="string"?{injection:o[x],order:0}:o[x],_=/^(v|f)s:(#)?([\w-]+)$/.exec(x);if(_){const g=_[2],T=_[3];g?T==="decl"?h[x]=[m]:d[x]=[m]:f[x]=[m]}else d[x]=[m]}const y=i;for(const x of y){a&&Sv(x,l,a);const m=kv(x,"wgsl");c+=m;const _=((w=x.injections)==null?void 0:w[r])||{};for(const g in _){const T=/^(v|f)s:#([\w-]+)$/.exec(g);if(T){const S=T[2]==="decl"?h:d;S[g]=S[g]||[],S[g].push(_[g])}else f[g]=f[g]||[],f[g].push(_[g])}}return c+=Iv,c=Ma(c,r,h),c+=Rv(u[r],f),c+=l,c=Ma(c,r,d),c}function Jp(t,e){var S;const{source:n,stage:r,language:i="glsl",modules:s,defines:o={},hookFunctions:a=[],inject:l={},prologue:c=!0,log:u}=e;Vh(typeof n=="string","shader source must be a string");const f=i==="glsl"?X2(n).version:-1,h=t.shaderLanguageVersion,d=f===100?"#version 100":"#version 300 es",w=n.split(`
`).slice(1).join(`
`),x={};s.forEach(M=>{Object.assign(x,M.defines)}),Object.assign(x,o);let m="";switch(i){case"wgsl":break;case"glsl":m=c?`${d}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${r.toUpperCase()}`}

${z2(t)}
${r==="fragment"?q2:""}

// ----- APPLICATION DEFINES -------------------------

${G2(x)}

`:`${d}
`;break}const _=Cv(a),g={},T={},C={};for(const M in l){const k=typeof l[M]=="string"?{injection:l[M],order:0}:l[M],F=/^(v|f)s:(#)?([\w-]+)$/.exec(M);if(F){const D=F[2],L=F[3];D?L==="decl"?T[M]=[k]:C[M]=[k]:g[M]=[k]}else C[M]=[k]}for(const M of s){u&&Sv(M,w,u);const k=kv(M,r);m+=k;const F=((S=M.instance)==null?void 0:S.normalizedInjections[r])||{};for(const D in F){const L=/^(v|f)s:#([\w-]+)$/.exec(D);if(L){const H=L[2]==="decl"?T:C;H[D]=H[D]||[],H[D].push(F[D])}else g[D]=g[D]||[],g[D].push(F[D])}}return m+="// ----- MAIN SHADER SOURCE -------------------------",m+=Iv,m=Ma(m,r,T),m+=Rv(_[r],g),m+=w,m=Ma(m,r,C),i==="glsl"&&f!==h&&(m=j2(m,r)),m.trim()}function Pv(t){return function(n){var i;const r={};for(const s of t){const o=(i=s.getUniforms)==null?void 0:i.call(s,n,r);Object.assign(r,o)}return r}}function G2(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function kv(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:Vh(!1)}if(!t.name)throw new Error("Shader module must have a name");const r=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${n}
`,i}const ex=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,tx=/^\s*\#\s*endif\s*$/;function nx(t,e){var o;const n=t.split(`
`),r=[];let i=!0,s=null;for(const a of n){const l=a.match(ex),c=a.match(tx);l?(s=l[1],i=!!((o=e==null?void 0:e.defines)!=null&&o[s])):c?i=!0:i&&r.push(a)}return r.join(`
`)}const Jn=class Jn{constructor(){p(this,"_hookFunctions",[]);p(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Jn.defaultShaderAssembler=Jn.defaultShaderAssembler||new Jn,Jn.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=Z2({...e,source:e.source,modules:n,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?nx(i):i,getUniforms:s,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),r=this._hookFunctions;return{...Q2({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:r}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[i++]=a,r[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;r[l]||(n[i++]=a,r[l]=!0)}return n.length=i,Oa(n),n}};p(Jn,"defaultShaderAssembler");let Na=Jn;const rx=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,ix=`#version 300 es
${rx}`;function sx(t){const{input:e,inputChannels:n,output:r}={};if(!e)return ix;if(!n)throw new Error("inputChannels");const i=ox(n),s=ax(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function ox(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function ax(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class lx{constructor(){p(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Ol({id:e})),this.stats.get(e)}}const Mv=new lx,N=new Ks({id:"luma.gl"}),bc={};function Dl(t="id"){bc[t]=bc[t]||1;const e=bc[t]++;return`${t}-${e}`}var tu;let oe=(tu=class{constructor(e,n,r){p(this,"id");p(this,"props");p(this,"userData",{});p(this,"_device");p(this,"destroyed",!1);p(this,"allocatedBytes",0);p(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=cx(n,r);const i=this.props.id!=="undefined"?this.props.id:Dl(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},p(tu,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),tu);function cx(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const Be=class Be extends oe{constructor(n,r){const i={...r};(r.usage||0)&Be.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(n,i,Be.defaultProps);p(this,"usage");p(this,"indexType");p(this,"updateTimestamp");p(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(n){return this.device.createBuffer({...this.props,...n})}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,Be.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):r===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};p(Be,"INDEX",16),p(Be,"VERTEX",32),p(Be,"UNIFORM",64),p(Be,"STORAGE",128),p(Be,"INDIRECT",256),p(Be,"QUERY_RESOLVE",512),p(Be,"MAP_READ",1),p(Be,"MAP_WRITE",2),p(Be,"COPY_SRC",4),p(Be,"COPY_DST",8),p(Be,"DEBUG_DATA_MAX_LENGTH",32),p(Be,"defaultProps",{...oe.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0});let de=Be;function Ov(t){const[e,n,r]=Wh[t],i=t.includes("norm"),s=!i&&!t.startsWith("float"),o=t.startsWith("s");return{signedType:e,primitiveType:n,byteLength:r,normalized:i,integer:s,signed:o}}function ux(t){const e=t;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function fx(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}function zh(t){const e=ArrayBuffer.isView(t)?t.constructor:t;if(e===Uint8ClampedArray)return"uint8";const n=Object.values(Wh).find(r=>e===r[4]);if(!n)throw new Error(e.name);return n[0]}function jh(t){const[,,,,e]=Wh[t];return e}const Wh={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Hh(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=Ov(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function hx(t,e,n){const r=n?ux(t):t;switch(r){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${r}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${r}x${e}`;default:return e===1?r:`${r}x${e}`}}function dx(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e,i=zh(t);return hx(i,r,n)}function px(t){let e;switch(t.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return t.components<=2?"float16x2":"float16x4"}return t.components===1?e:`${e}x${t.components}`}const je="texture-compression-bc",ie="texture-compression-astc",Wt="texture-compression-etc2",gx="texture-compression-etc1-webgl",To="texture-compression-pvrtc-webgl",Tc="texture-compression-atc-webgl",xo="float32-renderable-webgl",xc="float16-renderable-webgl",mx="rgb9e5ufloat-renderable-webgl",Sc="snorm8-renderable-webgl",Ui="norm16-renderable-webgl",Ec="snorm16-renderable-webgl",So="float32-filterable",Gp="float16-filterable-webgl";function Nv(t){const e=vx[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const _x={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:Sc},rg8snorm:{render:Sc},"rgb8snorm-webgl":{},rgba8snorm:{render:Sc},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:Ui},rg16unorm:{render:Ui},"rgb16unorm-webgl":{f:Ui},rgba16unorm:{render:Ui},r16snorm:{f:Ec},rg16snorm:{render:Ec},"rgb16snorm-webgl":{f:Ui},rgba16snorm:{render:Ec},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:xc,filter:"float16-filterable-webgl"},rg16float:{render:xc,filter:Gp},rgba16float:{render:xc,filter:Gp},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:xo,filter:So},rg32float:{render:!1,filter:So},"rgb32float-webgl":{render:xo,filter:So},rgba32float:{render:xo,filter:So},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:mx},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:xo},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},yx={"bc1-rgb-unorm-webgl":{f:je},"bc1-rgb-unorm-srgb-webgl":{f:je},"bc1-rgba-unorm":{f:je},"bc1-rgba-unorm-srgb":{f:je},"bc2-rgba-unorm":{f:je},"bc2-rgba-unorm-srgb":{f:je},"bc3-rgba-unorm":{f:je},"bc3-rgba-unorm-srgb":{f:je},"bc4-r-unorm":{f:je},"bc4-r-snorm":{f:je},"bc5-rg-unorm":{f:je},"bc5-rg-snorm":{f:je},"bc6h-rgb-ufloat":{f:je},"bc6h-rgb-float":{f:je},"bc7-rgba-unorm":{f:je},"bc7-rgba-unorm-srgb":{f:je},"etc2-rgb8unorm":{f:Wt},"etc2-rgb8unorm-srgb":{f:Wt},"etc2-rgb8a1unorm":{f:Wt},"etc2-rgb8a1unorm-srgb":{f:Wt},"etc2-rgba8unorm":{f:Wt},"etc2-rgba8unorm-srgb":{f:Wt},"eac-r11unorm":{f:Wt},"eac-r11snorm":{f:Wt},"eac-rg11unorm":{f:Wt},"eac-rg11snorm":{f:Wt},"astc-4x4-unorm":{f:ie},"astc-4x4-unorm-srgb":{f:ie},"astc-5x4-unorm":{f:ie},"astc-5x4-unorm-srgb":{f:ie},"astc-5x5-unorm":{f:ie},"astc-5x5-unorm-srgb":{f:ie},"astc-6x5-unorm":{f:ie},"astc-6x5-unorm-srgb":{f:ie},"astc-6x6-unorm":{f:ie},"astc-6x6-unorm-srgb":{f:ie},"astc-8x5-unorm":{f:ie},"astc-8x5-unorm-srgb":{f:ie},"astc-8x6-unorm":{f:ie},"astc-8x6-unorm-srgb":{f:ie},"astc-8x8-unorm":{f:ie},"astc-8x8-unorm-srgb":{f:ie},"astc-10x5-unorm":{f:ie},"astc-10x5-unorm-srgb":{f:ie},"astc-10x6-unorm":{f:ie},"astc-10x6-unorm-srgb":{f:ie},"astc-10x8-unorm":{f:ie},"astc-10x8-unorm-srgb":{f:ie},"astc-10x10-unorm":{f:ie},"astc-10x10-unorm-srgb":{f:ie},"astc-12x10-unorm":{f:ie},"astc-12x10-unorm-srgb":{f:ie},"astc-12x12-unorm":{f:ie},"astc-12x12-unorm-srgb":{f:ie},"pvrtc-rgb4unorm-webgl":{f:To},"pvrtc-rgba4unorm-webgl":{f:To},"pvrtc-rbg2unorm-webgl":{f:To},"pvrtc-rgba2unorm-webgl":{f:To},"etc1-rbg-unorm-webgl":{f:gx},"atc-rgb-unorm-webgl":{f:Tc},"atc-rgba-unorm-webgl":{f:Tc},"atc-rgbai-unorm-webgl":{f:Tc}},vx={..._x,...yx},wx=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],bx=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class Tx{getInfo(e){return eg(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return wx.some(n=>e.startsWith(n))}getCapabilities(e){const n=Nv(e),r={format:e,create:n.f??!0,render:n.render??!0,filter:n.filter??!0,blend:n.blend??!0,store:n.store??!0},i=eg(e),s=e.startsWith("depth")||e.startsWith("stencil"),o=i==null?void 0:i.signed,a=i==null?void 0:i.integer,l=i==null?void 0:i.webgl;return r.render&&(r.render=!o),r.filter&&(r.filter=!s&&!o&&!a&&!l),r}}const oi=new Tx;function eg(t){let e=xx(t);if(oi.isCompressed(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=Sx(t);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const n=bx.exec(t);if(n){const[,r,i,s,o,a]=n,l=`${s}${i}`,c=Ov(l),u=c.byteLength*8,f=r.length,h=[u,f>=2?u:0,f>=3?u:0,f>=4?u:0];e={format:t,attachment:e.attachment,dataType:c.signedType,components:f,channels:r,integer:c.integer,signed:c.signed,normalized:c.normalized,bitsPerChannel:h,bytesPerPixel:c.byteLength*r.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function xx(t){var s;const e=Nv(t),n=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:n,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function Sx(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,r,i]=n;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function Ex(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}function Ax(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}class Rx{}class Cx{constructor(e=[],n){p(this,"features");p(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){var n;return!((n=this.disabledFeatures)!=null&&n[e])&&this.features.has(e)}}const tl=class tl{constructor(e){p(this,"id");p(this,"props");p(this,"userData",{});p(this,"statsManager",Mv);p(this,"timestamp",0);p(this,"_reused",!1);p(this,"_lumaData",{});p(this,"_textureCaps",{});this.props={...tl.defaultProps,...e},this.id=this.props.id||Dl(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}getVertexFormatInfo(e){return Hh(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return oi.getInfo(e)}getTextureFormatCapabilities(e){let n=this._textureCaps[e];if(!n){const r=this._getDeviceTextureFormatCapabilities(e);n=this._getDeviceSpecificTextureFormatCapabilities(r),this._textureCaps[e]=n}return n}getMipLevelCount(e,n,r=1){const i=Math.max(e,n,r);return 1+Math.floor(Math.log2(i))}isExternalImage(e){return Ex(e)}getExternalImageSize(e){return Ax(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return oi.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){var e;(e=this.commandEncoder)==null||e.popDebugGroup()}insertDebugMarker(e){var n;(n=this.commandEncoder)==null||n.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,n,...r){return this.props.onError(e,n)?()=>{}:N.error(e.message,n,...r)}debug(){if(this.props.debug)debugger;else N.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const n=oi.getCapabilities(e),r=s=>(typeof s=="string"?this.features.has(s):s)??!0,i=r(n.create);return{format:e,create:i,render:i&&r(n.render),filter:i&&r(n.filter),blend:i&&r(n.blend),store:i&&r(n.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};if((e.usage||0)&de.INDEX&&(e.indexType||(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array&&(n.indexType="uint16")),!n.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return n}};p(tl,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,n)=>{},onResize:(e,n)=>{const[r,i]=e.getDevicePixelSize();N.log(1,`${e} resized => ${r}x${i}px`)()},onPositionChange:(e,n)=>{const[r,i]=e.getPosition();N.log(1,`${e} repositioned => ${r},${i}`)()},onVisibilityChange:e=>N.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,n)=>N.log(1,`${e} DPR changed ${n.oldRatio} => ${e.devicePixelRatio}`)(),debug:N.get("debug")||void 0,debugShaders:N.get("debug-shaders")||void 0,debugFramebuffers:!!N.get("debug-framebuffers"),debugFactories:!!N.get("debug-factories"),debugWebGL:!!N.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0});let _r=tl;const Ix="set luma.log.level=1 (or higher) to trace rendering",tg="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",gs=class gs{constructor(){p(this,"stats",Mv);p(this,"log",N);p(this,"VERSION","9.2.2");p(this,"spector");p(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw N.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),N.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");N.error("This version of luma.gl has already been initialized")()}N.log(1,`${this.VERSION} - ${Ix}`)(),globalThis.luma=this}async createDevice(e={}){const n={...gs.defaultProps,...e},r=this.selectAdapter(n.type,n.adapters);if(!r)throw new Error(tg);return n.waitForPageLoad&&await r.pageLoaded,await r.create(n)}async attachDevice(e,n){var s;const r=this._getTypeFromHandle(e,n.adapters),i=r&&this.selectAdapter(r,n.adapters);if(!i)throw new Error(tg);return await((s=i==null?void 0:i.attach)==null?void 0:s.call(i,e,n))}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this._getAdapterMap(e);return Array.from(n).map(([,r])=>r).filter(r=>{var i;return(i=r.isSupported)==null?void 0:i.call(r)}).map(r=>r.type)}getBestAvailableAdapterType(e=[]){var i,s;const n=["webgpu","webgl","null"],r=this._getAdapterMap(e);for(const o of n)if((s=(i=r.get(o))==null?void 0:i.isSupported)!=null&&s.call(i))return o;return null}selectAdapter(e,n=[]){let r=e;e==="best-available"&&(r=this.getBestAvailableAdapterType(n));const i=this._getAdapterMap(n);return r&&i.get(r)||null}enforceWebGL2(e=!0,n=[]){var s;const i=this._getAdapterMap(n).get("webgl");i||N.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}setDefaultDeviceProps(e){Object.assign(gs.defaultProps,e)}_getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const r of e)n.set(r.type,r);return n}_getTypeFromHandle(e,n=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e!=null&&e.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?N.warn("WebGL1 is not supported",e)():N.warn("Unknown handle type",e)(),null)}};p(gs,"defaultProps",{..._r.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0});let tf=gs;const nf=new tf;class Px{get pageLoaded(){return Ox()}}const kx=Sr()&&typeof document<"u",Mx=()=>kx&&document.readyState==="complete";let Eo=null;function Ox(){return Eo||(Mx()||typeof window>"u"?Eo=Promise.resolve():Eo=new Promise(t=>window.addEventListener("load",()=>t()))),Eo}function Nx(){let t,e;return{promise:new Promise((r,i)=>{t=r,e=i}),resolve:t,reject:e}}const Gn=class Gn{constructor(e){p(this,"id");p(this,"props");p(this,"canvas");p(this,"htmlCanvas");p(this,"offscreenCanvas");p(this,"type");p(this,"initialized");p(this,"isInitialized",!1);p(this,"isVisible",!0);p(this,"cssWidth");p(this,"cssHeight");p(this,"devicePixelRatio");p(this,"devicePixelWidth");p(this,"devicePixelHeight");p(this,"drawingBufferWidth");p(this,"drawingBufferHeight");p(this,"_initializedResolvers",Nx());p(this,"_resizeObserver");p(this,"_intersectionObserver");p(this,"_position");p(this,"destroyed",!1);var n,r;if(this.props={...Gn.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,Sr()?e.canvas?typeof e.canvas=="string"?this.canvas=Fx(e.canvas):this.canvas=e.canvas:this.canvas=Bx(e):this.canvas={width:e.width||1,height:e.height||1},Gn.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):Gn.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=((n=this.htmlCanvas)==null?void 0:n.clientWidth)||this.canvas.width,this.cssHeight=((r=this.htmlCanvas)==null?void 0:r.clientHeight)||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],Gn.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(i=>this._handleIntersection(i)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(i=>this._handleResize(i));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,n){this.canvas.width=e,this.canvas.height=n,this.drawingBufferWidth=e,this.drawingBufferHeight=n}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return Ux(e,r,i,s,n)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,n]=this.getDevicePixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[n]=this.getCSSSize();return n?e/n:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const n=e.find(i=>i.target===this.canvas);if(!n)return;const r=n.isIntersecting;this.isVisible!==r&&(this.isVisible=r,this.device.props.onVisibilityChange(this))}_handleResize(e){var l,c;const n=e.find(u=>u.target===this.canvas);if(!n)return;this.cssWidth=n.contentBoxSize[0].inlineSize,this.cssHeight=n.contentBoxSize[0].blockSize;const r=this.getDevicePixelSize(),i=((l=n.devicePixelContentBoxSize)==null?void 0:l[0].inlineSize)||n.contentBoxSize[0].inlineSize*devicePixelRatio,s=((c=n.devicePixelContentBoxSize)==null?void 0:c[0].blockSize)||n.contentBoxSize[0].blockSize*devicePixelRatio,[o,a]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(i,o)),this.devicePixelHeight=Math.max(1,Math.min(s,a)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:r})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const n=setInterval(()=>{this.destroyed?clearInterval(n):this.updatePosition()},e)}updatePosition(){var n,r,i;const e=(n=this.htmlCanvas)==null?void 0:n.getBoundingClientRect();if(e){const s=[e.left,e.top];if(this._position??(this._position=s),s[0]!==this._position[0]||s[1]!==this._position[1]){const a=this._position;this._position=s,(i=(r=this.device.props).onPositionChange)==null||i.call(r,this,{oldPosition:a})}}}};p(Gn,"defaultProps",{id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1});let Da=Gn;function Dx(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}return t||document.body}function Fx(t){const e=document.getElementById(t);if(!Da.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function Bx(t){const{width:e,height:n}=t,r=document.createElement("canvas");r.id=Dl("lumagl-auto-created-canvas"),r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",t!=null&&t.visible||(r.style.visibility="hidden");const i=Dx((t==null?void 0:t.container)||null);return i.insertBefore(r,i.firstChild),r}function Ux(t,e,n,r,i){const s=t,o=ng(s[0],e,n);let a=rg(s[1],e,r,i),l=ng(s[0]+1,e,n);const c=l===n-1?l:l-1;l=rg(s[1]+1,e,r,i);let u;return i?(l=l===0?l:l+1,u=a,a=l):u=l===r-1?l:l-1,{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}function ng(t,e,n){return Math.min(Math.round(t*e),n-1)}function rg(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const ms=class ms extends oe{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=ms.normalizeProps(e,n),super(e,n,ms.defaultProps)}static normalizeProps(e,n){return n}};p(ms,"defaultProps",{...oe.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let mi=ms;const Lx={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},Ce=class Ce extends oe{constructor(n,r){r=Ce.normalizeProps(n,r);super(n,r,Ce.defaultProps);p(this,"dimension");p(this,"baseDimension");p(this,"format");p(this,"width");p(this,"height");p(this,"depth");p(this,"mipLevels");p(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.baseDimension=Lx[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(n.isExternalImage(r.data)){const i=n.getExternalImageSize(r.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&N.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}setSampler(n){this.sampler=n instanceof mi?n:this.device.createSampler(n)}clone(n){return this.device.createTexture({...this.props,...n})}static normalizeProps(n,r){const i={...r},{width:s,height:o}=i;return typeof s=="number"&&(i.width=Math.max(1,Math.ceil(s))),typeof o=="number"&&(i.height=Math.max(1,Math.ceil(o))),i}_initializeData(n){this.device.isExternalImage(n)?this.copyExternalImage({image:n,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):n&&this.copyImageData({data:n,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(n){const{width:r,height:i,depth:s}=this,o={...Ce.defaultCopyDataOptions,width:r,height:i,depth:s,...n},a=this.device.getTextureFormatInfo(this.format);if(!n.bytesPerRow&&!a.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return o.bytesPerRow=n.bytesPerRow||r*(a.bytesPerPixel||4),o.rowsPerImage=n.rowsPerImage||i,o}_normalizeCopyExternalImageOptions(n){const r=this.device.getExternalImageSize(n.image),i={...Ce.defaultCopyExternalImageOptions,...r,...n};return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i}};p(Ce,"SAMPLE",4),p(Ce,"STORAGE",8),p(Ce,"RENDER",16),p(Ce,"COPY_SRC",1),p(Ce,"COPY_DST",2),p(Ce,"TEXTURE",4),p(Ce,"RENDER_ATTACHMENT",16),p(Ce,"defaultProps",{...oe.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Ce.TEXTURE|Ce.RENDER_ATTACHMENT|Ce.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0}),p(Ce,"defaultCopyDataOptions",{data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"}),p(Ce,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let rt=Ce;const nl=class nl extends oe{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,nl.defaultProps)}};p(nl,"defaultProps",{...oe.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Fa=nl;function Vx(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=Dv(i[a-1],a,n);s.length>o&&s[o].lineNum===a;){const l=s[o++];r+=Ac(l,i,l.lineNum,{...n,inlineSource:!1})}for(;s.length>o;){const a=s[o++];r+=Ac(a,[],0,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=Ac(a,i,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function Ac(t,e,n,r){if(r!=null&&r.inlineSource){const s=$x(e,n),o=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${o}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function $x(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=Dv(s,e,n))}return r}function Dv(t,e,n){const r=n!=null&&n.html?jx(t):t;return`${zx(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function zx(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function jx(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const rl=class rl extends oe{constructor(n,r){r={...r,debugShaders:r.debugShaders||n.props.debugShaders||"errors"};super(n,{id:Wx(r),...r},rl.defaultProps);p(this,"stage");p(this,"source");p(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const n=this.props.debugShaders;switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();n==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r,this.id)}_displayShaderLog(n,r){var u;if(typeof document>"u"||!(document!=null&&document.createElement))return;const i=r,s=`${this.stage} shader "${i}"`;let o=Vx(n,this.source,{showSourceCode:"all",html:!0});const a=this.getTranslatedSource();a&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${a}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Compilation error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),(u=document.getElementsByClassName("luma-compiler-log-error")[0])==null||u.scrollIntoView(),l.onclick=()=>{const f=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(f)}}};p(rl,"defaultProps",{...oe.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Ba=rl;function Wx(t){return Hx(t.source)||t.id||Dl(`unnamed ${t.stage}-shader`)}function Hx(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}const il=class il extends oe{constructor(n,r={}){super(n,r,il.defaultProps);p(this,"width");p(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(n){const r=this.colorAttachments.map(s=>s.texture.clone(n)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(n);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(N.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){const s=this.createColorTexture(r,i);return this.attachResource(s),s.view}return r instanceof rt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof rt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:rt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(n){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:rt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};p(il,"defaultProps",{...oe.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Ua=il;const sl=class sl extends oe{constructor(n,r){super(n,r,sl.defaultProps);p(this,"shaderLayout");p(this,"bufferLayout");p(this,"linkStatus","pending");p(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}};p(sl,"defaultProps",{...oe.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}});let ar=sl;const Ot=class Ot extends oe{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=Ot.normalizeProps(e,n),super(e,n,Ot.defaultProps)}static normalizeProps(e,n){return n}};p(Ot,"defaultClearColor",[0,0,0,1]),p(Ot,"defaultClearDepth",1),p(Ot,"defaultClearStencil",0),p(Ot,"defaultProps",{...oe.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ot.defaultClearColor,clearColors:void 0,clearDepth:Ot.defaultClearDepth,clearStencil:Ot.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let rf=Ot;const ol=class ol extends oe{constructor(n,r){super(n,r,ol.defaultProps);p(this,"hash","");p(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};p(ol,"defaultProps",{...oe.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let La=ol;const al=class al extends oe{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,al.defaultProps)}};p(al,"defaultProps",{...oe.defaultProps,measureExecutionTime:void 0});let sf=al;const ll=class ll extends oe{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,ll.defaultProps)}};p(ll,"defaultProps",{...oe.defaultProps});let of=ll;function Fv(t){return qx[t]}function Xx(t){const[e,n]=Kx[t],r=e==="i32"||e==="u32",i=e!=="u32",s=Yx[e]*n;return{primitiveType:e,components:n,byteLength:s,integer:r,signed:i}}const Yx={f32:4,f16:2,i32:4,u32:4},Kx={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},qx={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function Bv(t,e){const n={};for(const r of t.attributes){const i=Qx(t,e,r.name);i&&(n[r.name]=i)}return n}function Zx(t,e,n=16){const r=Bv(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function Qx(t,e,n){const r=Jx(t,n),i=Gx(e,n);if(!r)return null;const s=Xx(r.type),o=px(s),a=(i==null?void 0:i.vertexFormat)||o,l=Hh(a);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,primitiveType:s.primitiveType,shaderComponents:s.components,vertexFormat:a,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function Jx(t,e){const n=t.attributes.find(r=>r.name===e);return n||N.warn(`shader layout attribute "${e}" not present in shader`),n||null}function Gx(t,e){eS(t);let n=tS(t,e);return n||(n=nS(t,e),n)?n:(N.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function eS(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&N.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function tS(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function nS(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=Hh(o.format);i+=a.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const cl=class cl extends oe{constructor(n,r){super(n,r,cl.defaultProps);p(this,"maxVertexAttributes");p(this,"attributeInfos");p(this,"indexBuffer",null);p(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=Zx(r.shaderLayout,r.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){this.device.reportError(new Error("constant attributes not supported"),this)()}};p(cl,"defaultProps",{...oe.defaultProps,shaderLayout:void 0,bufferLayout:[]});let af=cl;const ul=class ul extends oe{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,ul.defaultProps)}};p(ul,"defaultProps",{...oe.defaultProps,layout:void 0,buffers:{}});let lf=ul;const fl=class fl extends oe{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,fl.defaultProps)}};p(fl,"defaultProps",{...oe.defaultProps,type:void 0,count:void 0});let cf=fl,Ao;function Uv(t){return(!Ao||Ao.byteLength<t)&&(Ao=new ArrayBuffer(t)),Ao}function rS(t,e){const n=Uv(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function iS(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Va(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":iS(t)}const sS=1024;class oS{constructor(e,n={}){p(this,"layout",{});p(this,"byteLength");let r=0;for(const[s,o]of Object.entries(e)){const a=Fv(o),{type:l,components:c}=a,u=c*((n==null?void 0:n[s])??1);r=fx(r,u);const f=r;r+=u,this.layout[s]={type:l,size:u,offset:f}}r+=(4-r%4)%4;const i=r*4;this.byteLength=Math.max(i,sS)}getData(e){const n=Uv(this.byteLength),r={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[i,s]of Object.entries(e)){const o=this.layout[i];if(!o){N.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:a,size:l,offset:c}=o,u=r[a];if(l===1){if(typeof s!="number"&&typeof s!="boolean"){N.warn(`Supplied value for single component uniform ${i} is not a number: ${s}`)();continue}u[c]=Number(s)}else{if(!Va(s)){N.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${s}`)();continue}u.set(s,c)}}return new Uint8Array(n,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function aS(t,e,n=16){if(t!==e)return!1;const r=t,i=e;if(!Va(r))return!1;if(Va(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function lS(t){return Va(t)?t.slice():t}class cS{constructor(e){p(this,"name");p(this,"uniforms",{});p(this,"modifiedUniforms",{});p(this,"modified",!0);p(this,"bindingLayout",{});p(this,"needsRedraw","initialized");var n;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){aS(this.uniforms[e],n)||(this.uniforms[e]=lS(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class uS{constructor(e){p(this,"uniformBlocks",new Map);p(this,"uniformBufferLayouts",new Map);p(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new oS(r.uniformTypes??{},r.uniformSizes??{});this.uniformBufferLayouts.set(i,s);const o=new cS({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var n;for(const[r,i]of Object.entries(e))(n=this.uniformBlocks.get(r))==null||n.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var n;return((n=this.uniformBufferLayouts.get(e))==null?void 0:n.byteLength)||0}getUniformBufferData(e){var r,i;const n=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:de.UNIFORM|de.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:de.UNIFORM|de.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&N.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const n=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&(n!=null&&n.needsRedraw)){i||(i=n.needsRedraw);const o=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(o);const a=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();N.log(4,`Writing to uniform buffer ${String(e)}`,o,a)()}return i}}class xt{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class ig{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Cn extends xt{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Un extends xt{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class uf extends xt{constructor(e,n,r){super(e,r),this.format=n}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class yr extends xt{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Tn;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Tn||(Tn={}));class Ro{constructor(e,n,r,i,s,o,a){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class fS{constructor(e,n){this.name=e,this.type=n}}class hS{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class sg{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class dS{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class pS{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r}}class gS{constructor(e,n=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n,this.attributes=r}}class mS{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function _S(t){var e=(32768&t)>>15,n=(31744&t)>>10,r=1023&t;return n==0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):n==31?r?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))}const Lv=new Float32Array(1),yS=new Int32Array(Lv.buffer),We=new Uint16Array(1);function vS(t){Lv[0]=t;const e=yS[0],n=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return We[0]=n<<15|31744|(i!==0?512:0),We[0];if(r===0){if(i===0)return We[0]=n<<15,We[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),We[0]=n<<15|r<<10|i>>13,We[0]):(We[0]=n<<15,We[0])}return r=r-127+15,r>=31?(We[0]=n<<15|31744,We[0]):r<=0?r<-10?(We[0]=n<<15,We[0]):(i=(8388608|i)>>1-r,We[0]=n<<15|i>>13,We[0]):(i>>=13,We[0]=n<<15|r<<10|i,We[0])}const Xh=new Uint32Array(1),Vv=new Float32Array(Xh.buffer,0,1);function og(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return Xh[0]=e,Vv[0]}function wS(t,e,n,r,i,s,o,a,l){const c=r*(o>>=i)*(s>>=i)+n*o+e*a;switch(l){case"r8unorm":return[ee(t,c,"8unorm",1)[0]];case"r8snorm":return[ee(t,c,"8snorm",1)[0]];case"r8uint":return[ee(t,c,"8uint",1)[0]];case"r8sint":return[ee(t,c,"8sint",1)[0]];case"rg8unorm":{const u=ee(t,c,"8unorm",2);return[u[0],u[1]]}case"rg8snorm":{const u=ee(t,c,"8snorm",2);return[u[0],u[1]]}case"rg8uint":{const u=ee(t,c,"8uint",2);return[u[0],u[1]]}case"rg8sint":{const u=ee(t,c,"8sint",2);return[u[0],u[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const u=ee(t,c,"8unorm",4);return[u[0],u[1],u[2],u[3]]}case"rgba8snorm":{const u=ee(t,c,"8snorm",4);return[u[0],u[1],u[2],u[3]]}case"rgba8uint":{const u=ee(t,c,"8uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba8sint":{const u=ee(t,c,"8sint",4);return[u[0],u[1],u[2],u[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const u=ee(t,c,"8unorm",4);return[u[2],u[1],u[0],u[3]]}case"r16uint":return[ee(t,c,"16uint",1)[0]];case"r16sint":return[ee(t,c,"16sint",1)[0]];case"r16float":return[ee(t,c,"16float",1)[0]];case"rg16uint":{const u=ee(t,c,"16uint",2);return[u[0],u[1]]}case"rg16sint":{const u=ee(t,c,"16sint",2);return[u[0],u[1]]}case"rg16float":{const u=ee(t,c,"16float",2);return[u[0],u[1]]}case"rgba16uint":{const u=ee(t,c,"16uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba16sint":{const u=ee(t,c,"16sint",4);return[u[0],u[1],u[2],u[3]]}case"rgba16float":{const u=ee(t,c,"16float",4);return[u[0],u[1],u[2],u[3]]}case"r32uint":return[ee(t,c,"32uint",1)[0]];case"r32sint":return[ee(t,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[ee(t,c,"32float",1)[0]];case"rg32uint":{const u=ee(t,c,"32uint",2);return[u[0],u[1]]}case"rg32sint":{const u=ee(t,c,"32sint",2);return[u[0],u[1]]}case"rg32float":{const u=ee(t,c,"32float",2);return[u[0],u[1]]}case"rgba32uint":{const u=ee(t,c,"32uint",4);return[u[0],u[1],u[2],u[3]]}case"rgba32sint":{const u=ee(t,c,"32sint",4);return[u[0],u[1],u[2],u[3]]}case"rgba32float":{const u=ee(t,c,"32float",4);return[u[0],u[1],u[2],u[3]]}case"rg11b10ufloat":{const u=new Uint32Array(t.buffer,c,1)[0],f=(4192256&u)>>11,h=(4290772992&u)>>22;return[og(2047&u),og(f),function(d){const y=112+(d>>5&31)<<23|(31&d)<<18;return Xh[0]=y,Vv[0]}(h),1]}}return null}function ee(t,e,n,r){const i=[0,0,0,0];for(let s=0;s<r;++s)switch(n){case"8unorm":i[s]=t[e]/255,e++;break;case"8snorm":i[s]=t[e]/255*2-1,e++;break;case"8uint":i[s]=t[e],e++;break;case"8sint":i[s]=t[e]-127,e++;break;case"16uint":i[s]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[s]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[s]=_S(t[e]|t[e+1]<<8),e+=2;break;case"32uint":case"32sint":i[s]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[s]=new Float32Array(t.buffer,e,1)[0],e+=4}return i}function te(t,e,n,r,i){for(let s=0;s<r;++s)switch(n){case"8unorm":t[e]=255*i[s],e++;break;case"8snorm":t[e]=.5*(i[s]+1)*255,e++;break;case"8uint":t[e]=i[s],e++;break;case"8sint":t[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const o=vS(i[s]);new Uint16Array(t.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[s],e+=4}return i}const Rc={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class It{constructor(){this.id=It._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,n){if(e){n($a.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(za.instance)}}constEvaluate(e,n){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}It._id=0;class $a extends It{}$a.instance=new $a;class za extends It{}za.instance=new za;const $v=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class pe extends It{constructor(){super()}}class Fs extends pe{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const n of this.attributes)e(n);e(this);for(const n of this.args)e(n);this.searchBlock(this.body,e)}}class bS extends pe{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class zv extends pe{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class ff extends pe{constructor(e,n){super(),this.body=e,this.loopId=n}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class jv extends pe{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class on extends pe{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Yh extends pe{constructor(e,n,r){super(),this.attributes=null,this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class ls extends pe{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Qo extends pe{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,n){return this.value.constEvaluate(e,n)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var qr,Xi,P,A;(t=>{t.increment="++",t.decrement="--"})(qr||(qr={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}})(qr||(qr={}));class Wv extends pe{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Xi||(Xi={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}})(Xi||(Xi={}));class Hv extends pe{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Kh extends pe{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}isBuiltin(){return $v.has(this.name)}search(e){for(const n of this.args)n.search(e);e(this)}}class Xv extends pe{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}search(e){var n;this.searchBlock(this.body,e),(n=this.continuing)===null||n===void 0||n.search(e)}}class Yv extends pe{constructor(e,n){super(),this.condition=e,this.cases=n}get astNodeType(){return"switch"}search(e){e(this);for(const n of this.cases)n.search(e)}}class Kv extends pe{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class qv extends pe{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class TS extends pe{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class xS extends pe{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Zv extends pe{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class qh extends pe{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class SS extends pe{constructor(){super()}get astNodeType(){return"discard"}}class Qv extends pe{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class Jv extends pe{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class O extends pe{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=O._priority.get(n.name);O._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?O.i32:n}getTypeName(){return this.name}}O.x32=new O("x32"),O.f32=new O("f32"),O.i32=new O("i32"),O.u32=new O("u32"),O.f16=new O("f16"),O.bool=new O("bool"),O.void=new O("void"),O._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class ag extends O{constructor(e){super(e)}}class rn extends O{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}search(e){for(const n of this.members)e(n)}}class I extends O{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}I.vec2f=new I("vec2",O.f32,null),I.vec3f=new I("vec3",O.f32,null),I.vec4f=new I("vec4",O.f32,null),I.vec2i=new I("vec2",O.i32,null),I.vec3i=new I("vec3",O.i32,null),I.vec4i=new I("vec4",O.i32,null),I.vec2u=new I("vec2",O.u32,null),I.vec3u=new I("vec3",O.u32,null),I.vec4u=new I("vec4",O.u32,null),I.vec2h=new I("vec2",O.f16,null),I.vec3h=new I("vec3",O.f16,null),I.vec4h=new I("vec4",O.f16,null),I.vec2b=new I("vec2",O.bool,null),I.vec3b=new I("vec3",O.bool,null),I.vec4b=new I("vec4",O.bool,null),I.mat2x2f=new I("mat2x2",O.f32,null),I.mat2x3f=new I("mat2x3",O.f32,null),I.mat2x4f=new I("mat2x4",O.f32,null),I.mat3x2f=new I("mat3x2",O.f32,null),I.mat3x3f=new I("mat3x3",O.f32,null),I.mat3x4f=new I("mat3x4",O.f32,null),I.mat4x2f=new I("mat4x2",O.f32,null),I.mat4x3f=new I("mat4x3",O.f32,null),I.mat4x4f=new I("mat4x4",O.f32,null),I.mat2x2h=new I("mat2x2",O.f16,null),I.mat2x3h=new I("mat2x3",O.f16,null),I.mat2x4h=new I("mat2x4",O.f16,null),I.mat3x2h=new I("mat3x2",O.f16,null),I.mat3x3h=new I("mat3x3",O.f16,null),I.mat3x4h=new I("mat3x4",O.f16,null),I.mat4x2h=new I("mat4x2",O.f16,null),I.mat4x3h=new I("mat4x3",O.f16,null),I.mat4x4h=new I("mat4x4",O.f16,null),I.mat2x2i=new I("mat2x2",O.i32,null),I.mat2x3i=new I("mat2x3",O.i32,null),I.mat2x4i=new I("mat2x4",O.i32,null),I.mat3x2i=new I("mat3x2",O.i32,null),I.mat3x3i=new I("mat3x3",O.i32,null),I.mat3x4i=new I("mat3x4",O.i32,null),I.mat4x2i=new I("mat4x2",O.i32,null),I.mat4x3i=new I("mat4x3",O.i32,null),I.mat4x4i=new I("mat4x4",O.i32,null),I.mat2x2u=new I("mat2x2",O.u32,null),I.mat2x3u=new I("mat2x3",O.u32,null),I.mat2x4u=new I("mat2x4",O.u32,null),I.mat3x2u=new I("mat3x2",O.u32,null),I.mat3x3u=new I("mat3x3",O.u32,null),I.mat3x4u=new I("mat3x4",O.u32,null),I.mat4x2u=new I("mat4x2",O.u32,null),I.mat4x3u=new I("mat4x3",O.u32,null),I.mat4x4u=new I("mat4x4",O.u32,null);class Jo extends O{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class cs extends O{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Yi extends O{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class zt extends It{constructor(){super(),this.postfix=null}}class vr extends zt{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Yt extends zt{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}constEvaluate(e,n){return n&&(n[0]=this.type),e.evalExpression(this,e.context)}}class Zh extends zt{constructor(e,n){super(),this.cachedReturnValue=null,this.name=e,this.args=n}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return $v.has(this.name)}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){for(const n of this.args)n.search(e);e(this)}}class ut extends zt{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,n){return e.evalExpression(this,e.context)}}class Gv extends zt{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}constEvaluate(e,n){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class Ie extends zt{constructor(e,n){super(),this.value=e,this.type=n}get astNodeType(){return"literalExpr"}constEvaluate(e,n){return n!==void 0&&(n[0]=this.type),this.value}get isScalar(){return this.value instanceof E}get isVector(){return this.value instanceof b||this.value instanceof j}get scalarValue(){return this.value instanceof E?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof b||this.value instanceof j?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class e0 extends zt{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class _i extends zt{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class t0 extends zt{constructor(){super()}}class Ee extends t0{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Mt extends t0{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,n){return e.name===n.name?e:e.name==="f32"||n.name==="f32"?O.f32:e.name==="u32"||n.name==="u32"?O.u32:O.i32}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class n0 extends It{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Go extends zt{constructor(){super()}get astNodeType(){return"default"}}class r0 extends n0{constructor(e,n){super(n),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class i0 extends n0{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class lg extends It{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class ES extends It{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class cg extends It{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}class s0 extends It{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}}class Ct{constructor(e,n){this.parent=null,this.typeInfo=e,this.parent=n,this.id=Ct._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,n,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,n,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Ct._id=0;class hf extends Ct{constructor(){super(new xt("void",null),null)}toString(){return"void"}}hf.void=new hf;class Mr extends Ct{constructor(e){super(new uf("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,n,r,i){this.reference.setDataValue(e,n,r,i)}getSubData(e,n,r){return n?this.reference.getSubData(e,n,r):this}toString(){return`&${this.reference.toString()}`}}class E extends Ct{constructor(e,n,r=null){super(n,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",n)}clone(){if(this.data instanceof Float32Array)return new E(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new E(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new E(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,n,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(n instanceof E))return void console.error("SetDataValue: Invalid value",n);let s=n.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,n,r){return n?(console.error("getSubData: Scalar data does not support postfix",n),null):this}toString(){return`${this.value}`}}function AS(t,e,n){const r=e.length;return r===2?n==="f32"?new b(new Float32Array(e),t.getTypeInfo("vec2f")):n==="i32"||n==="bool"?new b(new Int32Array(e),t.getTypeInfo("vec2i")):n==="u32"?new b(new Uint32Array(e),t.getTypeInfo("vec2u")):n==="f16"?new b(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):r===3?n==="f32"?new b(new Float32Array(e),t.getTypeInfo("vec3f")):n==="i32"||n==="bool"?new b(new Int32Array(e),t.getTypeInfo("vec3i")):n==="u32"?new b(new Uint32Array(e),t.getTypeInfo("vec3u")):n==="f16"?new b(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):r===4?n==="f32"?new b(new Float32Array(e),t.getTypeInfo("vec4f")):n==="i32"||n==="bool"?new b(new Int32Array(e),t.getTypeInfo("vec4i")):n==="u32"?new b(new Uint32Array(e),t.getTypeInfo("vec4u")):n==="f16"?new b(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class b extends Ct{constructor(e,n,r=null){if(super(n,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new b(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new b(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new b(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,n,r,i){r instanceof vr?console.error("TODO: Set vector postfix"):n instanceof b?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof yr)i=this.typeInfo.format||i;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?i=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?i=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?i=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?i=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;n!==null&&s!==null;){if(n instanceof _i){const o=n.index;let a=-1;if(o instanceof Ie){if(!(o.value instanceof E))return console.error(`GetSubData: Invalid array index ${o.value}`),null;a=o.value.value}else{const l=e.evalExpression(o,r);if(!(l instanceof E))return console.error("GetSubData: Unknown index type",o),null;a=l.value}if(a<0||a>=s.data.length)return console.error("GetSubData: Index out of range",a),null;if(s.data instanceof Float32Array){const l=new Float32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new E(l,i)}if(s.data instanceof Int32Array){const l=new Int32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new E(l,i)}if(s.data instanceof Uint32Array){const l=new Uint32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new E(l,i)}throw"GetSubData: Invalid data type"}if(!(n instanceof vr))return console.error("GetSubData: Unknown postfix",n),null;{const o=n.value.toLowerCase();if(o.length===1){let l=0;if(o==="x"||o==="r")l=0;else if(o==="y"||o==="g")l=1;else if(o==="z"||o==="b")l=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;l=3}if(this.data instanceof Float32Array){let c=new Float32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new E(c,i,this)}if(this.data instanceof Int32Array){let c=new Int32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new E(c,i,this)}if(this.data instanceof Uint32Array){let c=new Uint32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new E(c,i,this)}}const a=[];for(const l of o)l==="x"||l==="r"?a.push(this.data[0]):l==="y"||l==="g"?a.push(this.data[1]):l==="z"||l==="b"?a.push(this.data[2]):l==="w"||l==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${l}`);s=AS(e,a,i.name)}n=n.postfix}return s}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class j extends Ct{constructor(e,n,r=null){super(n,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new j(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,n,r,i){r instanceof vr?console.error("TODO: Set matrix postfix"):n instanceof j?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof yr)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(n instanceof _i){const s=n.index;let o=-1;if(s instanceof Ie){if(!(s.value instanceof E))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const c=e.evalExpression(s,r);if(!(c instanceof E))return console.error("GetDataValue: Unknown index type",s),null;o=c.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const a=i.endsWith("h")?"h":"f";let l;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")l=new b(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${a}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")l=new b(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${a}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;l=new b(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${a}`))}return n.postfix?l.getSubData(e,n.postfix,r):l}return console.error("GetDataValue: Invalid postfix",n),null}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class we extends Ct{constructor(e,n,r=0,i=null){super(n,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new we(e.buffer,this.typeInfo,0,null)}setDataValue(e,n,r,i){if(n===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;r;){if(r instanceof _i)if(o instanceof Un){const a=r.index;if(a instanceof Ie){if(!(a.value instanceof E))return void console.error(`SetDataValue: Invalid index type ${a.value}`);s+=a.value.value*o.stride}else{const l=e.evalExpression(a,i);if(!(l instanceof E))return void console.error("SetDataValue: Unknown index type",a);s+=l.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof vr))return void console.error("SetDataValue: Unknown postfix type",r);{const a=r.value;if(o instanceof Cn){let l=!1;for(const c of o.members)if(c.name===a){s+=c.offset,o=c.type,l=!0;break}if(!l)return void console.error(`SetDataValue: Member ${a} not found`)}else if(o instanceof xt){const l=o.getTypeName();let c=0;if(a==="x"||a==="r")c=0;else if(a==="y"||a==="g")c=1;else if(a==="z"||a==="b")c=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);c=3}if(!(n instanceof E))return void console.error("SetDataValue: Invalid value",n);const u=n.value;return l==="vec2f"?void(new Float32Array(this.buffer,s,2)[c]=u):l==="vec3f"?void(new Float32Array(this.buffer,s,3)[c]=u):l==="vec4f"?void(new Float32Array(this.buffer,s,4)[c]=u):l==="vec2i"?void(new Int32Array(this.buffer,s,2)[c]=u):l==="vec3i"?void(new Int32Array(this.buffer,s,3)[c]=u):l==="vec4i"?void(new Int32Array(this.buffer,s,4)[c]=u):l==="vec2u"?void(new Uint32Array(this.buffer,s,2)[c]=u):l==="vec3u"?void(new Uint32Array(this.buffer,s,3)[c]=u):l==="vec4u"?void(new Uint32Array(this.buffer,s,4)[c]=u):void console.error(`SetDataValue: Type ${l} is not a struct`)}}}r=r.postfix}this.setData(e,n,o,s,i)}setData(e,n,r,i,s){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool"){if(o==="vec2f"||o==="vec2h"){const a=new Float32Array(this.buffer,i,2);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(o==="vec3f"||o==="vec3h"){const a=new Float32Array(this.buffer,i,3);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(o==="vec4f"||o==="vec4h"){const a=new Float32Array(this.buffer,i,4);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(o==="vec2i"){const a=new Int32Array(this.buffer,i,2);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(o==="vec3i"){const a=new Int32Array(this.buffer,i,3);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(o==="vec4i"){const a=new Int32Array(this.buffer,i,4);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(o==="vec2u"){const a=new Uint32Array(this.buffer,i,2);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(o==="vec3u"){const a=new Uint32Array(this.buffer,i,3);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(o==="vec4u"){const a=new Uint32Array(this.buffer,i,4);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(o==="vec2b"){const a=new Uint32Array(this.buffer,i,2);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(o==="vec3b"){const a=new Uint32Array(this.buffer,i,3);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(o==="vec4b"){const a=new Uint32Array(this.buffer,i,4);return void(n instanceof b?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(o==="mat2x2f"||o==="mat2x2h"){const a=new Float32Array(this.buffer,i,4);return void(n instanceof j?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(o==="mat2x3f"||o==="mat2x3h"){const a=new Float32Array(this.buffer,i,6);return void(n instanceof j?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5]))}if(o==="mat2x4f"||o==="mat2x4h"){const a=new Float32Array(this.buffer,i,8);return void(n instanceof j?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7]))}if(o==="mat3x2f"||o==="mat3x2h"){const a=new Float32Array(this.buffer,i,6);return void(n instanceof j?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5]))}if(o==="mat3x3f"||o==="mat3x3h"){const a=new Float32Array(this.buffer,i,9);return void(n instanceof j?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8]))}if(o==="mat3x4f"||o==="mat3x4h"){const a=new Float32Array(this.buffer,i,12);return void(n instanceof j?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11]))}if(o==="mat4x2f"||o==="mat4x2h"){const a=new Float32Array(this.buffer,i,8);return void(n instanceof j?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7]))}if(o==="mat4x3f"||o==="mat4x3h"){const a=new Float32Array(this.buffer,i,12);return void(n instanceof j?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11]))}if(o==="mat4x4f"||o==="mat4x4h"){const a=new Float32Array(this.buffer,i,16);return void(n instanceof j?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11],a[12]=n.data[12],a[13]=n.data[13],a[14]=n.data[14],a[15]=n.data[15]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]))}if(n instanceof we){if(r===n.typeInfo)return void new Uint8Array(this.buffer,i,n.buffer.byteLength).set(new Uint8Array(n.buffer));console.error("SetDataValue: Type mismatch",o,n.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`)}else n instanceof E&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof E&&(new Uint32Array(this.buffer,i,1)[0]=n.value);else n instanceof E&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof E&&(new Float32Array(this.buffer,i,1)[0]=n.value)}getSubData(e,n,r){var i,s,o;if(n===null)return this;let a=this.offset,l=this.typeInfo;for(;n;){if(n instanceof _i){const u=n.index,f=u instanceof zt?e.evalExpression(u,r):u;let h=0;if(f instanceof E?h=f.value:typeof f=="number"?h=f:console.error("GetDataValue: Invalid index type",u),l instanceof Un)a+=h*l.stride,l=l.format;else{const d=l.getTypeName();d==="mat4x4"||d==="mat4x4f"||d==="mat4x4h"?(a+=16*h,l=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${l.getTypeName()} is not an array`)}}else{if(!(n instanceof vr))return console.error("GetDataValue: Unknown postfix type",n),null;{const u=n.value;if(l instanceof Cn){let f=!1;for(const h of l.members)if(h.name===u){a+=h.offset,l=h.type,f=!0;break}if(!f)return console.error(`GetDataValue: Member ${u} not found`),null}else if(l instanceof xt){const f=l.getTypeName();if(f==="vec2f"||f==="vec3f"||f==="vec4f"||f==="vec2i"||f==="vec3i"||f==="vec4i"||f==="vec2u"||f==="vec3u"||f==="vec4u"||f==="vec2b"||f==="vec3b"||f==="vec4b"||f==="vec2h"||f==="vec3h"||f==="vec4h"||f==="vec2"||f==="vec3"||f==="vec4"){if(u.length>0&&u.length<5){let h="f";const d=[];for(let y=0;y<u.length;++y){const w=u[y].toLowerCase();let x=0;if(w==="x"||w==="r")x=0;else if(w==="y"||w==="g")x=1;else if(w==="z"||w==="b")x=2;else{if(w!=="w"&&w!=="a")return console.error(`Unknown member ${u}`),null;x=3}if(u.length===1){if(f.endsWith("f"))return this.buffer.byteLength<a+4*x+4?(console.log("Insufficient buffer data"),null):new E(new Float32Array(this.buffer,a+4*x,1),e.getTypeInfo("f32"),this);if(f.endsWith("h"))return new E(new Float32Array(this.buffer,a+4*x,1),e.getTypeInfo("f16"),this);if(f.endsWith("i"))return new E(new Int32Array(this.buffer,a+4*x,1),e.getTypeInfo("i32"),this);if(f.endsWith("b"))return new E(new Int32Array(this.buffer,a+4*x,1),e.getTypeInfo("bool"),this);if(f.endsWith("u"))return new E(new Uint32Array(this.buffer,a+4*x,1),e.getTypeInfo("i32"),this)}if(f==="vec2f")d.push(new Float32Array(this.buffer,a,2)[x]);else if(f==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const m=new Float32Array(this.buffer,a,3);d.push(m[x])}else if(f==="vec4f")d.push(new Float32Array(this.buffer,a,4)[x]);else if(f==="vec2i")h="i",d.push(new Int32Array(this.buffer,a,2)[x]);else if(f==="vec3i")h="i",d.push(new Int32Array(this.buffer,a,3)[x]);else if(f==="vec4i")h="i",d.push(new Int32Array(this.buffer,a,4)[x]);else if(f==="vec2u"){h="u";const m=new Uint32Array(this.buffer,a,2);d.push(m[x])}else f==="vec3u"?(h="u",d.push(new Uint32Array(this.buffer,a,3)[x])):f==="vec4u"&&(h="u",d.push(new Uint32Array(this.buffer,a,4)[x]))}return d.length===2?l=e.getTypeInfo(`vec2${h}`):d.length===3?l=e.getTypeInfo(`vec3${h}`):d.length===4?l=e.getTypeInfo(`vec4${h}`):console.error(`GetDataValue: Invalid vector length ${d.length}`),new b(d,l,null)}return console.error(`GetDataValue: Unknown member ${u}`),null}return console.error(`GetDataValue: Type ${f} is not a struct`),null}}}n=n.postfix}const c=l.getTypeName();return c==="f32"?new E(new Float32Array(this.buffer,a,1),l,this):c==="i32"?new E(new Int32Array(this.buffer,a,1),l,this):c==="u32"?new E(new Uint32Array(this.buffer,a,1),l,this):c==="vec2f"?new b(new Float32Array(this.buffer,a,2),l,this):c==="vec3f"?new b(new Float32Array(this.buffer,a,3),l,this):c==="vec4f"?new b(new Float32Array(this.buffer,a,4),l,this):c==="vec2i"?new b(new Int32Array(this.buffer,a,2),l,this):c==="vec3i"?new b(new Int32Array(this.buffer,a,3),l,this):c==="vec4i"?new b(new Int32Array(this.buffer,a,4),l,this):c==="vec2u"?new b(new Uint32Array(this.buffer,a,2),l,this):c==="vec3u"?new b(new Uint32Array(this.buffer,a,3),l,this):c==="vec4u"?new b(new Uint32Array(this.buffer,a,4),l,this):l instanceof yr&&l.name==="atomic"?((i=l.format)===null||i===void 0?void 0:i.name)==="u32"?new E(new Uint32Array(this.buffer,a,1)[0],l.format,this):((s=l.format)===null||s===void 0?void 0:s.name)==="i32"?new E(new Int32Array(this.buffer,a,1)[0],l.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=l.format)===null||o===void 0?void 0:o.name}`),null):new we(this.buffer,l,a,this)}toString(){let e="";if(this.typeInfo instanceof Un)if(this.typeInfo.format.name==="f32"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="i32"){const n=new Int32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="u32"){const n=new Uint32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="vec2f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}]`;for(let r=1;r<n.length/2;++r)e+=`, [${n[2*r]}, ${n[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}, ${n[3]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}, ${n[r+3]}]`}else e="[...]";else this.typeInfo instanceof Cn?e+="{...}":e="[...]";return e}}class sn extends Ct{constructor(e,n,r,i){super(n,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new sn(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.width)!==null&&n!==void 0?n:0}get height(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.height)!==null&&n!==void 0?n:0}get depthOrArrayLayers(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.depthOrArrayLayers)!==null&&n!==void 0?n:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const n=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<n.length;++r)n[r]=Math.max(1,n[r]>>e);return n}get texelByteSize(){const e=this.format,n=Rc[e];return n?n.isDepthStencil?4:n.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,n=Rc[e];return!!n&&n.isDepthStencil}getGpuSize(){const e=this.format,n=Rc[e],r=this.width;if(!e||r<=0||!n)return-1;const i=this.height,s=this.depthOrArrayLayers,o=this.dimension;return r/n.blockWidth*(o==="1d"?1:i/n.blockHeight)*n.bytesPerBlock*s}getPixel(e,n,r=0,i=0){const s=this.texelByteSize,o=this.bytesPerRow,a=this.height,l=this.data[i];return wS(new Uint8Array(l),e,n,r,i,a,o,s,this.format)}setPixel(e,n,r,i,s){const o=this.texelByteSize,a=this.bytesPerRow,l=this.height,c=this.data[i];(function(u,f,h,d,y,w,x,m,_,g){const T=d*(x>>=y)*(w>>=y)+h*x+f*m;switch(_){case"r8unorm":return void te(u,T,"8unorm",1,g);case"r8snorm":return void te(u,T,"8snorm",1,g);case"r8uint":return void te(u,T,"8uint",1,g);case"r8sint":return void te(u,T,"8sint",1,g);case"rg8unorm":return void te(u,T,"8unorm",2,g);case"rg8snorm":return void te(u,T,"8snorm",2,g);case"rg8uint":return void te(u,T,"8uint",2,g);case"rg8sint":return void te(u,T,"8sint",2,g);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void te(u,T,"8unorm",4,g);case"rgba8snorm":return void te(u,T,"8snorm",4,g);case"rgba8uint":return void te(u,T,"8uint",4,g);case"rgba8sint":return void te(u,T,"8sint",4,g);case"r16uint":return void te(u,T,"16uint",1,g);case"r16sint":return void te(u,T,"16sint",1,g);case"r16float":return void te(u,T,"16float",1,g);case"rg16uint":return void te(u,T,"16uint",2,g);case"rg16sint":return void te(u,T,"16sint",2,g);case"rg16float":return void te(u,T,"16float",2,g);case"rgba16uint":return void te(u,T,"16uint",4,g);case"rgba16sint":return void te(u,T,"16sint",4,g);case"rgba16float":return void te(u,T,"16float",4,g);case"r32uint":return void te(u,T,"32uint",1,g);case"r32sint":return void te(u,T,"32sint",1,g);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void te(u,T,"32float",1,g);case"rg32uint":return void te(u,T,"32uint",2,g);case"rg32sint":return void te(u,T,"32sint",2,g);case"rg32float":return void te(u,T,"32float",2,g);case"rgba32uint":return void te(u,T,"32uint",4,g);case"rgba32sint":return void te(u,T,"32sint",4,g);case"rgba32float":return void te(u,T,"32float",4,g);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(c),e,n,r,i,l,a,o,this.format,s)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(A||(A={}));class R{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class v{}P=v,v.none=new R("",A.reserved,""),v.eof=new R("EOF",A.token,""),v.reserved={asm:new R("asm",A.reserved,"asm"),bf16:new R("bf16",A.reserved,"bf16"),do:new R("do",A.reserved,"do"),enum:new R("enum",A.reserved,"enum"),f16:new R("f16",A.reserved,"f16"),f64:new R("f64",A.reserved,"f64"),handle:new R("handle",A.reserved,"handle"),i8:new R("i8",A.reserved,"i8"),i16:new R("i16",A.reserved,"i16"),i64:new R("i64",A.reserved,"i64"),mat:new R("mat",A.reserved,"mat"),premerge:new R("premerge",A.reserved,"premerge"),regardless:new R("regardless",A.reserved,"regardless"),typedef:new R("typedef",A.reserved,"typedef"),u8:new R("u8",A.reserved,"u8"),u16:new R("u16",A.reserved,"u16"),u64:new R("u64",A.reserved,"u64"),unless:new R("unless",A.reserved,"unless"),using:new R("using",A.reserved,"using"),vec:new R("vec",A.reserved,"vec"),void:new R("void",A.reserved,"void")},v.keywords={array:new R("array",A.keyword,"array"),atomic:new R("atomic",A.keyword,"atomic"),bool:new R("bool",A.keyword,"bool"),f32:new R("f32",A.keyword,"f32"),i32:new R("i32",A.keyword,"i32"),mat2x2:new R("mat2x2",A.keyword,"mat2x2"),mat2x3:new R("mat2x3",A.keyword,"mat2x3"),mat2x4:new R("mat2x4",A.keyword,"mat2x4"),mat3x2:new R("mat3x2",A.keyword,"mat3x2"),mat3x3:new R("mat3x3",A.keyword,"mat3x3"),mat3x4:new R("mat3x4",A.keyword,"mat3x4"),mat4x2:new R("mat4x2",A.keyword,"mat4x2"),mat4x3:new R("mat4x3",A.keyword,"mat4x3"),mat4x4:new R("mat4x4",A.keyword,"mat4x4"),ptr:new R("ptr",A.keyword,"ptr"),sampler:new R("sampler",A.keyword,"sampler"),sampler_comparison:new R("sampler_comparison",A.keyword,"sampler_comparison"),struct:new R("struct",A.keyword,"struct"),texture_1d:new R("texture_1d",A.keyword,"texture_1d"),texture_2d:new R("texture_2d",A.keyword,"texture_2d"),texture_2d_array:new R("texture_2d_array",A.keyword,"texture_2d_array"),texture_3d:new R("texture_3d",A.keyword,"texture_3d"),texture_cube:new R("texture_cube",A.keyword,"texture_cube"),texture_cube_array:new R("texture_cube_array",A.keyword,"texture_cube_array"),texture_multisampled_2d:new R("texture_multisampled_2d",A.keyword,"texture_multisampled_2d"),texture_storage_1d:new R("texture_storage_1d",A.keyword,"texture_storage_1d"),texture_storage_2d:new R("texture_storage_2d",A.keyword,"texture_storage_2d"),texture_storage_2d_array:new R("texture_storage_2d_array",A.keyword,"texture_storage_2d_array"),texture_storage_3d:new R("texture_storage_3d",A.keyword,"texture_storage_3d"),texture_depth_2d:new R("texture_depth_2d",A.keyword,"texture_depth_2d"),texture_depth_2d_array:new R("texture_depth_2d_array",A.keyword,"texture_depth_2d_array"),texture_depth_cube:new R("texture_depth_cube",A.keyword,"texture_depth_cube"),texture_depth_cube_array:new R("texture_depth_cube_array",A.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new R("texture_depth_multisampled_2d",A.keyword,"texture_depth_multisampled_2d"),texture_external:new R("texture_external",A.keyword,"texture_external"),u32:new R("u32",A.keyword,"u32"),vec2:new R("vec2",A.keyword,"vec2"),vec3:new R("vec3",A.keyword,"vec3"),vec4:new R("vec4",A.keyword,"vec4"),bitcast:new R("bitcast",A.keyword,"bitcast"),block:new R("block",A.keyword,"block"),break:new R("break",A.keyword,"break"),case:new R("case",A.keyword,"case"),continue:new R("continue",A.keyword,"continue"),continuing:new R("continuing",A.keyword,"continuing"),default:new R("default",A.keyword,"default"),diagnostic:new R("diagnostic",A.keyword,"diagnostic"),discard:new R("discard",A.keyword,"discard"),else:new R("else",A.keyword,"else"),enable:new R("enable",A.keyword,"enable"),fallthrough:new R("fallthrough",A.keyword,"fallthrough"),false:new R("false",A.keyword,"false"),fn:new R("fn",A.keyword,"fn"),for:new R("for",A.keyword,"for"),function:new R("function",A.keyword,"function"),if:new R("if",A.keyword,"if"),let:new R("let",A.keyword,"let"),const:new R("const",A.keyword,"const"),loop:new R("loop",A.keyword,"loop"),while:new R("while",A.keyword,"while"),private:new R("private",A.keyword,"private"),read:new R("read",A.keyword,"read"),read_write:new R("read_write",A.keyword,"read_write"),return:new R("return",A.keyword,"return"),requires:new R("requires",A.keyword,"requires"),storage:new R("storage",A.keyword,"storage"),switch:new R("switch",A.keyword,"switch"),true:new R("true",A.keyword,"true"),alias:new R("alias",A.keyword,"alias"),type:new R("type",A.keyword,"type"),uniform:new R("uniform",A.keyword,"uniform"),var:new R("var",A.keyword,"var"),override:new R("override",A.keyword,"override"),workgroup:new R("workgroup",A.keyword,"workgroup"),write:new R("write",A.keyword,"write"),r8unorm:new R("r8unorm",A.keyword,"r8unorm"),r8snorm:new R("r8snorm",A.keyword,"r8snorm"),r8uint:new R("r8uint",A.keyword,"r8uint"),r8sint:new R("r8sint",A.keyword,"r8sint"),r16uint:new R("r16uint",A.keyword,"r16uint"),r16sint:new R("r16sint",A.keyword,"r16sint"),r16float:new R("r16float",A.keyword,"r16float"),rg8unorm:new R("rg8unorm",A.keyword,"rg8unorm"),rg8snorm:new R("rg8snorm",A.keyword,"rg8snorm"),rg8uint:new R("rg8uint",A.keyword,"rg8uint"),rg8sint:new R("rg8sint",A.keyword,"rg8sint"),r32uint:new R("r32uint",A.keyword,"r32uint"),r32sint:new R("r32sint",A.keyword,"r32sint"),r32float:new R("r32float",A.keyword,"r32float"),rg16uint:new R("rg16uint",A.keyword,"rg16uint"),rg16sint:new R("rg16sint",A.keyword,"rg16sint"),rg16float:new R("rg16float",A.keyword,"rg16float"),rgba8unorm:new R("rgba8unorm",A.keyword,"rgba8unorm"),rgba8unorm_srgb:new R("rgba8unorm_srgb",A.keyword,"rgba8unorm_srgb"),rgba8snorm:new R("rgba8snorm",A.keyword,"rgba8snorm"),rgba8uint:new R("rgba8uint",A.keyword,"rgba8uint"),rgba8sint:new R("rgba8sint",A.keyword,"rgba8sint"),bgra8unorm:new R("bgra8unorm",A.keyword,"bgra8unorm"),bgra8unorm_srgb:new R("bgra8unorm_srgb",A.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new R("rgb10a2unorm",A.keyword,"rgb10a2unorm"),rg11b10float:new R("rg11b10float",A.keyword,"rg11b10float"),rg32uint:new R("rg32uint",A.keyword,"rg32uint"),rg32sint:new R("rg32sint",A.keyword,"rg32sint"),rg32float:new R("rg32float",A.keyword,"rg32float"),rgba16uint:new R("rgba16uint",A.keyword,"rgba16uint"),rgba16sint:new R("rgba16sint",A.keyword,"rgba16sint"),rgba16float:new R("rgba16float",A.keyword,"rgba16float"),rgba32uint:new R("rgba32uint",A.keyword,"rgba32uint"),rgba32sint:new R("rgba32sint",A.keyword,"rgba32sint"),rgba32float:new R("rgba32float",A.keyword,"rgba32float"),static_assert:new R("static_assert",A.keyword,"static_assert")},v.tokens={decimal_float_literal:new R("decimal_float_literal",A.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new R("hex_float_literal",A.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new R("int_literal",A.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new R("uint_literal",A.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new R("name",A.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new R("ident",A.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new R("and",A.token,"&"),and_and:new R("and_and",A.token,"&&"),arrow:new R("arrow ",A.token,"->"),attr:new R("attr",A.token,"@"),forward_slash:new R("forward_slash",A.token,"/"),bang:new R("bang",A.token,"!"),bracket_left:new R("bracket_left",A.token,"["),bracket_right:new R("bracket_right",A.token,"]"),brace_left:new R("brace_left",A.token,"{"),brace_right:new R("brace_right",A.token,"}"),colon:new R("colon",A.token,":"),comma:new R("comma",A.token,","),equal:new R("equal",A.token,"="),equal_equal:new R("equal_equal",A.token,"=="),not_equal:new R("not_equal",A.token,"!="),greater_than:new R("greater_than",A.token,">"),greater_than_equal:new R("greater_than_equal",A.token,">="),shift_right:new R("shift_right",A.token,">>"),less_than:new R("less_than",A.token,"<"),less_than_equal:new R("less_than_equal",A.token,"<="),shift_left:new R("shift_left",A.token,"<<"),modulo:new R("modulo",A.token,"%"),minus:new R("minus",A.token,"-"),minus_minus:new R("minus_minus",A.token,"--"),period:new R("period",A.token,"."),plus:new R("plus",A.token,"+"),plus_plus:new R("plus_plus",A.token,"++"),or:new R("or",A.token,"|"),or_or:new R("or_or",A.token,"||"),paren_left:new R("paren_left",A.token,"("),paren_right:new R("paren_right",A.token,")"),semicolon:new R("semicolon",A.token,";"),star:new R("star",A.token,"*"),tilde:new R("tilde",A.token,"~"),underscore:new R("underscore",A.token,"_"),xor:new R("xor",A.token,"^"),plus_equal:new R("plus_equal",A.token,"+="),minus_equal:new R("minus_equal",A.token,"-="),times_equal:new R("times_equal",A.token,"*="),division_equal:new R("division_equal",A.token,"/="),modulo_equal:new R("modulo_equal",A.token,"%="),and_equal:new R("and_equal",A.token,"&="),or_equal:new R("or_equal",A.token,"|="),xor_equal:new R("xor_equal",A.token,"^="),shift_right_equal:new R("shift_right_equal",A.token,">>="),shift_left_equal:new R("shift_left_equal",A.token,"<<=")},v.simpleTokens={"@":P.tokens.attr,"{":P.tokens.brace_left,"}":P.tokens.brace_right,":":P.tokens.colon,",":P.tokens.comma,"(":P.tokens.paren_left,")":P.tokens.paren_right,";":P.tokens.semicolon},v.literalTokens={"&":P.tokens.and,"&&":P.tokens.and_and,"->":P.tokens.arrow,"/":P.tokens.forward_slash,"!":P.tokens.bang,"[":P.tokens.bracket_left,"]":P.tokens.bracket_right,"=":P.tokens.equal,"==":P.tokens.equal_equal,"!=":P.tokens.not_equal,">":P.tokens.greater_than,">=":P.tokens.greater_than_equal,">>":P.tokens.shift_right,"<":P.tokens.less_than,"<=":P.tokens.less_than_equal,"<<":P.tokens.shift_left,"%":P.tokens.modulo,"-":P.tokens.minus,"--":P.tokens.minus_minus,".":P.tokens.period,"+":P.tokens.plus,"++":P.tokens.plus_plus,"|":P.tokens.or,"||":P.tokens.or_or,"*":P.tokens.star,"~":P.tokens.tilde,_:P.tokens.underscore,"^":P.tokens.xor,"+=":P.tokens.plus_equal,"-=":P.tokens.minus_equal,"*=":P.tokens.times_equal,"/=":P.tokens.division_equal,"%=":P.tokens.modulo_equal,"&=":P.tokens.and_equal,"|=":P.tokens.or_equal,"^=":P.tokens.xor_equal,">>=":P.tokens.shift_right_equal,"<<=":P.tokens.shift_left_equal},v.regexTokens={decimal_float_literal:P.tokens.decimal_float_literal,hex_float_literal:P.tokens.hex_float_literal,int_literal:P.tokens.int_literal,uint_literal:P.tokens.uint_literal,ident:P.tokens.ident},v.storage_class=[P.keywords.function,P.keywords.private,P.keywords.workgroup,P.keywords.uniform,P.keywords.storage],v.access_mode=[P.keywords.read,P.keywords.write,P.keywords.read_write],v.sampler_type=[P.keywords.sampler,P.keywords.sampler_comparison],v.sampled_texture_type=[P.keywords.texture_1d,P.keywords.texture_2d,P.keywords.texture_2d_array,P.keywords.texture_3d,P.keywords.texture_cube,P.keywords.texture_cube_array],v.multisampled_texture_type=[P.keywords.texture_multisampled_2d],v.storage_texture_type=[P.keywords.texture_storage_1d,P.keywords.texture_storage_2d,P.keywords.texture_storage_2d_array,P.keywords.texture_storage_3d],v.depth_texture_type=[P.keywords.texture_depth_2d,P.keywords.texture_depth_2d_array,P.keywords.texture_depth_cube,P.keywords.texture_depth_cube_array,P.keywords.texture_depth_multisampled_2d],v.texture_external_type=[P.keywords.texture_external],v.any_texture_type=[...P.sampled_texture_type,...P.multisampled_texture_type,...P.storage_texture_type,...P.depth_texture_type,...P.texture_external_type],v.texel_format=[P.keywords.r8unorm,P.keywords.r8snorm,P.keywords.r8uint,P.keywords.r8sint,P.keywords.r16uint,P.keywords.r16sint,P.keywords.r16float,P.keywords.rg8unorm,P.keywords.rg8snorm,P.keywords.rg8uint,P.keywords.rg8sint,P.keywords.r32uint,P.keywords.r32sint,P.keywords.r32float,P.keywords.rg16uint,P.keywords.rg16sint,P.keywords.rg16float,P.keywords.rgba8unorm,P.keywords.rgba8unorm_srgb,P.keywords.rgba8snorm,P.keywords.rgba8uint,P.keywords.rgba8sint,P.keywords.bgra8unorm,P.keywords.bgra8unorm_srgb,P.keywords.rgb10a2unorm,P.keywords.rg11b10float,P.keywords.rg32uint,P.keywords.rg32sint,P.keywords.rg32float,P.keywords.rgba16uint,P.keywords.rgba16sint,P.keywords.rgba16float,P.keywords.rgba32uint,P.keywords.rgba32sint,P.keywords.rgba32float],v.const_literal=[P.tokens.int_literal,P.tokens.uint_literal,P.tokens.decimal_float_literal,P.tokens.hex_float_literal,P.keywords.true,P.keywords.false],v.literal_or_ident=[P.tokens.ident,P.tokens.int_literal,P.tokens.uint_literal,P.tokens.decimal_float_literal,P.tokens.hex_float_literal,P.tokens.name],v.element_count_expression=[P.tokens.int_literal,P.tokens.uint_literal,P.tokens.ident],v.template_types=[P.keywords.vec2,P.keywords.vec3,P.keywords.vec4,P.keywords.mat2x2,P.keywords.mat2x3,P.keywords.mat2x4,P.keywords.mat3x2,P.keywords.mat3x3,P.keywords.mat3x4,P.keywords.mat4x2,P.keywords.mat4x3,P.keywords.mat4x4,P.keywords.atomic,P.keywords.bitcast,...P.any_texture_type],v.attribute_name=[P.tokens.ident,P.keywords.block,P.keywords.diagnostic],v.assignment_operators=[P.tokens.equal,P.tokens.plus_equal,P.tokens.minus_equal,P.tokens.times_equal,P.tokens.division_equal,P.tokens.modulo_equal,P.tokens.and_equal,P.tokens.or_equal,P.tokens.xor_equal,P.tokens.shift_right_equal,P.tokens.shift_left_equal],v.increment_operators=[P.tokens.plus_plus,P.tokens.minus_minus];class ug{constructor(e,n,r,i,s){this.type=e,this.lexeme=n,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return v.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==v.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class RS{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ug(v.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=v.simpleTokens[e];if(n)return this._addToken(n),!0;let r=v.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=v.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(v.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(v.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(v.tokens.minus_minus),!0;const l=this._tokens.length-1;if((v.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==v.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let l=!1,c=this._tokens.length-1;for(let u=0;u<5&&c>=0&&v.assignment_operators.indexOf(this._tokens[c].type)===-1;++u,--c)if(this._tokens[c].type===v.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(o),!0}if(o===v.none){let l=e,c=0;const u=2;for(let f=0;f<u;++f)if(l+=this._peekAhead(f),o=this._findType(l),o!==v.none){c=f;break}if(o===v.none)return r!==v.none&&(this._current--,this._addToken(r),!0);e=l,this._current+=c+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==v.none&&(this._addToken(r),!0)}_findType(e){for(const r in v.regexTokens){const i=v.regexTokens[r];if(this._match(e,i.rule))return i}return v.literalTokens[e]||v.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new ug(e,n,this._line,this._start,this._current))}}function U(t){return Array.isArray(t)||(t==null?void 0:t.buffer)instanceof ArrayBuffer}const ja=new Float32Array(1),CS=new Uint32Array(ja.buffer),IS=new Uint32Array(ja.buffer),Wa=new Int32Array(1),PS=new Float32Array(Wa.buffer),kS=new Uint32Array(Wa.buffer),Ha=new Uint32Array(1),MS=new Float32Array(Ha.buffer),OS=new Int32Array(Ha.buffer);function fg(t,e,n){if(e===n)return t;if(e==="f32"){if(n==="i32"||n==="x32")return ja[0]=t,CS[0];if(n==="u32")return ja[0]=t,IS[0]}else if(e==="i32"||e==="x32"){if(n==="f32")return Wa[0]=t,PS[0];if(n==="u32")return Wa[0]=t,kS[0]}else if(e==="u32"){if(n==="f32")return Ha[0]=t,MS[0];if(n==="i32"||n==="x32")return Ha[0]=t,OS[0]}return console.error(`Unsupported cast from ${e} to ${n}`),t}class NS{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Co{constructor(e,n){this.align=e,this.size=n}}class Zt{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new mS,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const n of e)n instanceof Fs&&this._functions.set(n.name,new NS(n));for(const n of e)if(n instanceof rn){const r=this.getTypeInfo(n,null);r instanceof Cn&&this.structs.push(r)}for(const n of e)if(n instanceof qh)this.aliases.push(this._getAliasInfo(n));else{if(n instanceof Yh){const r=n,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new dS(r.name,s,r.attributes,i));continue}if(this._isUniformVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new Ro(r.name,o,i,s,r.attributes,Tn.Uniform,r.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),l=new Ro(r.name,o,i,s,r.attributes,a?Tn.StorageTexture:Tn.Storage,r.access);l.access||(l.access="read"),this.storage.push(l);continue}if(this._isTextureVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),l=new Ro(r.name,o,i,s,r.attributes,a?Tn.StorageTexture:Tn.Texture,r.access);l.access||(l.access="read"),a?this.storage.push(l):this.textures.push(l);continue}if(this._isSamplerVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new Ro(r.name,o,i,s,r.attributes,Tn.Sampler,r.access);this.samplers.push(a);continue}}for(const n of e)if(n instanceof Fs){const r=this._getAttribute(n,"vertex"),i=this._getAttribute(n,"fragment"),s=this._getAttribute(n,"compute"),o=r||i||s,a=new gS(n.name,o==null?void 0:o.name,n.attributes);a.attributes=n.attributes,a.startLine=n.startLine,a.endLine=n.endLine,this.functions.push(a),this._functions.get(n.name).info=a,o&&(this._functions.get(n.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(n,!!o),a.inputs=this._getInputs(n.args),a.outputs=this._getOutputs(n.returnType),this.entry[o.name].push(a)),a.arguments=n.args.map(l=>new pS(l.name,this.getTypeInfo(l.type,l.attributes),l.attributes)),a.returnType=n.returnType?this.getTypeInfo(n.returnType,n.attributes):null;continue}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(r=>{var i,s,o;if(r instanceof s0){if(r.value)if(U(r.value))for(const a of r.value)for(const l of this.overrides)a===l.name&&((i=n.info)===null||i===void 0||i.overrides.push(l));else for(const a of this.overrides)r.value===a.name&&((s=n.info)===null||s===void 0||s.overrides.push(a))}else if(r instanceof ut)for(const a of this.overrides)r.name===a.name&&((o=n.info)===null||o===void 0||o.overrides.push(a))});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}getFunctionInfo(e){for(const n of this.functions)if(n.name==e)return n;return null}getStructInfo(e){for(const n of this.structs)if(n.name==e)return n;return null}getOverrideInfo(e){for(const n of this.overrides)if(n.name==e)return n;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==n)return i;for(const i of this.storage)if(i.group==e&&i.binding==n)return i;for(const i of this.textures)if(i.group==e&&i.binding==n)return i;for(const i of this.samplers)if(i.group==e&&i.binding==n)return i;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this.getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof $a)s.push({});else if(o instanceof za)s.pop();else if(o instanceof on){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Yt){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof ls){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof ut){const a=o;if(s.length>0&&s[s.length-1][a.name])return;const l=i._findResource(a.name);l&&r.push(l)}else if(o instanceof Zh){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}else if(o instanceof Kh){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)n(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof rn)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof rn)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new sg(r.name,s,i.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new sg("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof rn)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof rn)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new hS(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new fS(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const n of this.structs)if(n.name==e)return n;for(const n of this.aliases)if(n.name==e)return n.type;return null}getTypeInfo(e,n=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Jo){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new uf(e.name,i,n);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof cs){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,o=new Un(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof rn){const i=e,s=new Cn(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const a=this.getTypeInfo(o.type,o.attributes);s.members.push(new ig(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Yi){const i=e,s=i.format instanceof O,o=i.format?s?this.getTypeInfo(i.format,null):new xt(i.format,null):null,a=new yr(i.name,o,n,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof I){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,o=new yr(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new xt(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r,i;const s=this._getTypeSize(e);if(e.size=(n=s==null?void 0:s.size)!==null&&n!==void 0?n:0,e instanceof Un&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,(i=o==null?void 0:o.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof uf&&this._updateTypeInfo(e.format),e instanceof Cn&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let a=0,l=e.members.length;a<l;++a){const c=e.members[a],u=this._getTypeSize(c);if(!u)continue;(n=this._getAlias(c.type.name))!==null&&n!==void 0||c.type;const f=u.align,h=u.size;r=this._roundUp(f,r+i),i=h,s=r,o=Math.max(o,f),c.offset=r,c.size=h,this._updateTypeInfo(c.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof ig&&(e=e.type),e instanceof xt){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Zt._typeInfo[e.name];if(o!==void 0){const a=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new Co(Math.max(s,o.align/a),Math.max(i,o.size/a))}}{const o=Zt._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new Co(Math.max(s,o.align/a),Math.max(i,o.size/a))}}if(e instanceof Un){let o=e,a=8,l=8;const c=this._getTypeSize(o.format);return c!==null&&(l=c.size,a=c.align),l=o.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,l)),i&&(l=i),new Co(Math.max(s,a),Math.max(i,l))}if(e instanceof Cn){let o=0,a=0,l=0,c=0,u=0;for(const f of e.members){const h=this._getTypeSize(f.type);h!==null&&(o=Math.max(h.align,o),l=this._roundUp(h.align,l+c),c=h.size,u=l)}return a=this._roundUp(o,u+c),new Co(Math.max(s,o),Math.max(i,a))}return null}_isUniformVar(e){return e instanceof on&&e.storage=="uniform"}_isStorageVar(e){return e instanceof on&&e.storage=="storage"}_isTextureVar(e){return e instanceof on&&e.type!==null&&Zt._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof on&&e.type!==null&&Zt._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}Zt._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Zt._textureTypes=v.any_texture_type.map(t=>t.name),Zt._samplerTypes=v.sampler_type.map(t=>t.name);let Qh=0;class Jh{constructor(e,n,r){this.id=Qh++,this.name=e,this.value=n,this.node=r}clone(){return new Jh(this.name,this.value,this.node)}}class Gh{constructor(e){this.id=Qh++,this.name=e.name,this.node=e}clone(){return new Gh(this.node)}}class ed{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Qh++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var n;return this.variables.has(e)?(n=this.variables.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var n;return this.functions.has(e)?(n=this.functions.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getFunction(e):null}createVariable(e,n,r){this.variables.set(e,new Jh(e,n,r??null))}setVariable(e,n,r){const i=this.getVariable(e);i!==null?i.value=n:this.createVariable(e,n,r)}getVariableValue(e){var n;const r=this.getVariable(e);return(n=r==null?void 0:r.value)!==null&&n!==void 0?n:null}clone(){return new ed(this)}}class DS{evalExpression(e,n){return null}getTypeInfo(e){return null}getVariableName(e,n){return""}}class FS{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,n){const r=this.exec.evalExpression(e.args[0],n);let i=!0;if(r instanceof b)return r.data.forEach(s=>{s||(i=!1)}),new E(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b){const i=r.data.some(s=>s);return new E(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,n){const r=this.exec.evalExpression(e.args[2],n);if(!(r instanceof E))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],n):this.exec.evalExpression(e.args[0],n)}ArrayLength(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.evalExpression(r,n);if(i instanceof we&&i.typeInfo.size===0){const s=i.typeInfo,o=i.buffer.byteLength/s.stride;return new E(o,this.getTypeInfo("u32"))}return new E(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new E(Math.abs(i.value),i.typeInfo)}Acos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new E(Math.acos(i.value),r.typeInfo)}Acosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new E(Math.acosh(i.value),r.typeInfo)}Asin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new E(Math.asin(i.value),r.typeInfo)}Asinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new E(Math.asinh(i.value),r.typeInfo)}Atan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new E(Math.atan(i.value),r.typeInfo)}Atanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new E(Math.atanh(i.value),r.typeInfo)}Atan2(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof b&&i instanceof b)return new b(r.data.map((a,l)=>Math.atan2(a,i.data[l])),r.typeInfo);const s=r,o=i;return new E(Math.atan2(s.value,o.value),r.typeInfo)}Ceil(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new E(Math.ceil(i.value),r.typeInfo)}_clamp(e,n,r){return Math.min(Math.max(e,n),r)}Clamp(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof b&&i instanceof b&&s instanceof b)return new b(r.data.map((c,u)=>this._clamp(c,i.data[u],s.data[u])),r.typeInfo);const o=r,a=i,l=s;return new E(this._clamp(o.value,a.value,l.value),r.typeInfo)}Cos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new E(Math.cos(i.value),r.typeInfo)}Cosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new E(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new E(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let n=0;for(;e!==0;)1&e&&n++,e>>=1;return n}CountOneBits(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new E(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let n=0;for(;!(1&e);)e>>=1,n++;return n}CountTrailingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new E(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof b&&i instanceof b){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,o=i.data;return new b([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,n){const r=this.exec.evalExpression(e.args[0],n),i=180/Math.PI;return r instanceof b?new b(r.data.map(s=>s*i),r.typeInfo):new E(r.value*i,this.getTypeInfo("f32"))}Determinant(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof j){const i=r.data,s=r.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new E(i[0]*i[3]-i[1]*i[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new E(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new E(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof b&&i instanceof b){let a=0;for(let l=0;l<r.data.length;++l)a+=(r.data[l]-i.data[l])*(r.data[l]-i.data[l]);return new E(Math.sqrt(a),this.getTypeInfo("f32"))}const s=r,o=i;return new E(Math.abs(s.value-o.value),r.typeInfo)}_dot(e,n){let r=0;for(let i=0;i<e.length;++i)r+=n[i]*e[i];return r}Dot(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);return r instanceof b&&i instanceof b?new E(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,n){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,n){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new E(Math.exp(i.value),r.typeInfo)}Exp2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new E(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,a=s.value;if(r instanceof b)return new b(r.data.map(c=>c>>o&(1<<a)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const l=r.value;return new E(l>>o&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof b&&i instanceof b&&s instanceof b){const o=this._dot(i.data,s.data);return new b(o<0?Array.from(r.data):r.data.map(a=>-a),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new E(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new E(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new E(Math.floor(i.value),r.typeInfo)}Fma(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof b&&i instanceof b&&s instanceof b)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new b(r.data.map((c,u)=>c*i.data[u]+s.data[u]),r.typeInfo);const o=r,a=i,l=s;return new E(o.value*a.value+l.value,o.typeInfo)}Fract(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new E(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,n){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n),o=this.exec.evalExpression(e.args[3],n);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=s.value,l=(1<<o.value)-1<<a,c=~l;if(r instanceof b&&i instanceof b)return new b(r.data.map((h,d)=>h&c|i.data[d]<<a&l),r.typeInfo);const u=r.value,f=i.value;return new E(u&c|f<<a&l,r.typeInfo)}InverseSqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new E(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,n){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b){let s=0;return r.data.forEach(o=>{s+=o*o}),new E(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new E(Math.abs(i.value),r.typeInfo)}Log(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new E(Math.log(i.value),r.typeInfo)}Log2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new E(Math.log2(i.value),r.typeInfo)}Max(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof b&&i instanceof b)return new b(r.data.map((a,l)=>Math.max(a,i.data[l])),r.typeInfo);const s=r,o=i;return new E(Math.max(s.value,o.value),r.typeInfo)}Min(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof b&&i instanceof b)return new b(r.data.map((a,l)=>Math.min(a,i.data[l])),r.typeInfo);const s=r,o=i;return new E(Math.min(s.value,o.value),r.typeInfo)}Mix(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof b&&i instanceof b&&s instanceof b)return new b(r.data.map((l,c)=>r.data[c]*(1-s.data[c])+i.data[c]*s.data[c]),r.typeInfo);const o=i,a=s;return new E(r.value*(1-a.value)+o.value*a.value,r.typeInfo)}Modf(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof b&&i instanceof b)return new b(r.data.map((o,a)=>o%i.data[a]),r.typeInfo);const s=i;return new E(r.value%s.value,r.typeInfo)}Normalize(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b){const i=this.Length(e,n).value;return new b(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof b&&i instanceof b)return new b(r.data.map((a,l)=>Math.pow(a,i.data[l])),r.typeInfo);const s=r,o=i;return new E(Math.pow(s.value,o.value),r.typeInfo)}QuantizeToF16(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof b?new b(r.data.map(i=>i),r.typeInfo):new E(r.value,r.typeInfo)}Radians(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof b?new b(r.data.map(i=>i*Math.PI/180),r.typeInfo):new E(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof b&&i instanceof b){const s=this._dot(r.data,i.data);return new b(r.data.map((o,a)=>o-2*s*i.data[a]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof b&&i instanceof b&&s instanceof E){const o=this._dot(i.data,r.data);return new b(r.data.map((a,l)=>{const c=1-s.value*s.value*(1-o*o);if(c<0)return 0;const u=Math.sqrt(c);return s.value*a-(s.value*o+u)*i.data[l]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,n){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new E(Math.round(i.value),r.typeInfo)}Saturate(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new E(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new E(Math.sign(i.value),r.typeInfo)}Sin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new E(Math.sin(i.value),r.typeInfo)}Sinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new E(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,n,r){const i=Math.min(Math.max((r-e)/(n-e),0),1);return i*i*(3-2*i)}SmoothStep(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(s instanceof b&&r instanceof b&&i instanceof b)return new b(s.data.map((c,u)=>this._smoothstep(r.data[u],i.data[u],c)),s.typeInfo);const o=r,a=i,l=s;return new E(this._smoothstep(o.value,a.value,l.value),s.typeInfo)}Sqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new E(Math.sqrt(i.value),r.typeInfo)}Step(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(i instanceof b&&r instanceof b)return new b(i.data.map((o,a)=>o<r.data[a]?0:1),i.typeInfo);const s=r;return new E(i.value<s.value?0:1,s.typeInfo)}Tan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new E(Math.tan(i.value),r.typeInfo)}Tanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new E(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const n=e.getTypeName();return n==="mat2x2f"||n==="mat2x2h"?e:n==="mat2x3f"?this.getTypeInfo("mat3x2f"):n==="mat2x3h"?this.getTypeInfo("mat3x2h"):n==="mat2x4f"?this.getTypeInfo("mat4x2f"):n==="mat2x4h"?this.getTypeInfo("mat4x2h"):n==="mat3x2f"?this.getTypeInfo("mat2x3f"):n==="mat3x2h"?this.getTypeInfo("mat2x3h"):n==="mat3x3f"||n==="mat3x3h"?e:n==="mat3x4f"?this.getTypeInfo("mat4x3f"):n==="mat3x4h"?this.getTypeInfo("mat4x3h"):n==="mat4x2f"?this.getTypeInfo("mat2x4f"):n==="mat4x2h"?this.getTypeInfo("mat2x4h"):n==="mat4x3f"?this.getTypeInfo("mat3x4f"):n==="mat4x3h"?this.getTypeInfo("mat3x4h"):(n==="mat4x4f"||n==="mat4x4h"||console.error(`Invalid matrix type ${n}`),e)}Transpose(e,n){const r=this.exec.evalExpression(e.args[0],n);if(!(r instanceof j))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new j([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new j([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new j([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new j([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new j([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new j([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new j([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new j([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new j([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof b)return new b(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new E(Math.trunc(i.value),r.typeInfo)}Dpdx(e,n){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,n){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,n){return console.error("TODO: dpdxFine"),null}Dpdy(e,n){return console.error("TODO: dpdy"),null}DpdyCoarse(e,n){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,n){return console.error("TODO: dpdyFine"),null}Fwidth(e,n){return console.error("TODO: fwidth"),null}FwidthCoarse(e,n){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,n){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,n){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],n).value:0;if(r instanceof ut){const s=r.name,o=n.getVariableValue(s);if(o instanceof sn){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=o.getMipLevelSize(i),l=o.dimension;return l==="1d"?new E(a[0],this.getTypeInfo("u32")):l==="3d"?new b(a,this.getTypeInfo("vec3u")):l==="2d"?new b(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${l} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,n){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,n){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length>2?this.exec.evalExpression(e.args[2],n).value:0;if(!(i instanceof b)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof ut){const o=r.name,a=n.getVariableValue(o);if(a instanceof sn){const l=Math.floor(i.data[0]),c=Math.floor(i.data[1]);if(l<0||l>=a.width||c<0||c>=a.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const u=a.getPixel(l,c,0,s);return u===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new b(u,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,n){const r=e.args[0];if(r instanceof ut){const i=r.name,s=n.getVariableValue(i);return s instanceof sn?new E(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,n){const r=e.args[0];if(r instanceof ut){const i=r.name,s=n.getVariableValue(i);return s instanceof sn?new E(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,n){const r=e.args[0];if(r instanceof ut){const i=r.name,s=n.getVariableValue(i);return s instanceof sn?new E(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,n){return console.error("TODO: textureSample"),null}TextureSampleBias(e,n){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,n){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,n){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,n){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,n){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,n){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length===4?this.exec.evalExpression(e.args[2],n).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],n).data:this.exec.evalExpression(e.args[2],n).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof b)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof ut){const a=r.name,l=n.getVariableValue(a);if(l instanceof sn){const c=l.getMipLevelSize(0),u=Math.floor(i.data[0]),f=Math.floor(i.data[1]);return u<0||u>=c[0]||f<0||f>=c[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(l.setPixel(u,f,0,s,Array.from(o)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.getVariableName(r,n);return n.getVariable(i).value.getSubData(this.exec,r.postfix,n)}AtomicStore(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),l=s.value.getSubData(this.exec,r.postfix,n);return l instanceof E&&a instanceof E&&(l.value=a.value),s.value instanceof we&&s.value.setDataValue(this.exec,l,r.postfix,n),null}AtomicAdd(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),l=s.value.getSubData(this.exec,r.postfix,n),c=new E(l.value,l.typeInfo);return l instanceof E&&a instanceof E&&(l.value+=a.value),s.value instanceof we&&s.value.setDataValue(this.exec,l,r.postfix,n),c}AtomicSub(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),l=s.value.getSubData(this.exec,r.postfix,n),c=new E(l.value,l.typeInfo);return l instanceof E&&a instanceof E&&(l.value-=a.value),s.value instanceof we&&s.value.setDataValue(this.exec,l,r.postfix,n),c}AtomicMax(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),l=s.value.getSubData(this.exec,r.postfix,n),c=new E(l.value,l.typeInfo);return l instanceof E&&a instanceof E&&(l.value=Math.max(l.value,a.value)),s.value instanceof we&&s.value.setDataValue(this.exec,l,r.postfix,n),c}AtomicMin(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),l=s.value.getSubData(this.exec,r.postfix,n),c=new E(l.value,l.typeInfo);return l instanceof E&&a instanceof E&&(l.value=Math.min(l.value,a.value)),s.value instanceof we&&s.value.setDataValue(this.exec,l,r.postfix,n),c}AtomicAnd(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),l=s.value.getSubData(this.exec,r.postfix,n),c=new E(l.value,l.typeInfo);return l instanceof E&&a instanceof E&&(l.value=l.value&a.value),s.value instanceof we&&s.value.setDataValue(this.exec,l,r.postfix,n),c}AtomicOr(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),l=s.value.getSubData(this.exec,r.postfix,n),c=new E(l.value,l.typeInfo);return l instanceof E&&a instanceof E&&(l.value=l.value|a.value),s.value instanceof we&&s.value.setDataValue(this.exec,l,r.postfix,n),c}AtomicXor(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),l=s.value.getSubData(this.exec,r.postfix,n),c=new E(l.value,l.typeInfo);return l instanceof E&&a instanceof E&&(l.value=l.value^a.value),s.value instanceof we&&s.value.setDataValue(this.exec,l,r.postfix,n),c}AtomicExchange(e,n){let r=e.args[0];r instanceof Ee&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),l=s.value.getSubData(this.exec,r.postfix,n),c=new E(l.value,l.typeInfo);return l instanceof E&&a instanceof E&&(l.value=a.value),s.value instanceof we&&s.value.setDataValue(this.exec,l,r.postfix,n),c}AtomicCompareExchangeWeak(e,n){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,n){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,n){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,n){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,n){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,n){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,n){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,n){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,n){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,n){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,n){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,n){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,n){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,n){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,n){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,n){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,n){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,n){return null}TextureBarrier(e,n){return null}WorkgroupBarrier(e,n){return null}WorkgroupUniformLoad(e,n){return null}SubgroupAdd(e,n){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,n){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,n){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,n){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,n){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,n){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,n){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,n){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,n){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,n){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,n){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,n){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,n){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,n){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,n){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,n){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,n){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,n){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,n){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,n){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,n){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,n){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,n){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,n){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,n){return console.error("TODO: quadSwapY"),null}}const Cc={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},qe={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class He extends DS{constructor(e,n){var r;super(),this.ast=e??[],this.reflection=new Zt,this.reflection.updateAST(this.ast),this.context=(r=n==null?void 0:n.clone())!==null&&r!==void 0?r:new ed,this.builtins=new FS(this),this.typeInfo={bool:this.getTypeInfo(O.bool),i32:this.getTypeInfo(O.i32),u32:this.getTypeInfo(O.u32),f32:this.getTypeInfo(O.f32),f16:this.getTypeInfo(O.f16),vec2f:this.getTypeInfo(I.vec2f),vec2u:this.getTypeInfo(I.vec2u),vec2i:this.getTypeInfo(I.vec2i),vec2h:this.getTypeInfo(I.vec2h),vec3f:this.getTypeInfo(I.vec3f),vec3u:this.getTypeInfo(I.vec3u),vec3i:this.getTypeInfo(I.vec3i),vec3h:this.getTypeInfo(I.vec3h),vec4f:this.getTypeInfo(I.vec4f),vec4u:this.getTypeInfo(I.vec4u),vec4i:this.getTypeInfo(I.vec4i),vec4h:this.getTypeInfo(I.vec4h),mat2x2f:this.getTypeInfo(I.mat2x2f),mat2x3f:this.getTypeInfo(I.mat2x3f),mat2x4f:this.getTypeInfo(I.mat2x4f),mat3x2f:this.getTypeInfo(I.mat3x2f),mat3x3f:this.getTypeInfo(I.mat3x3f),mat3x4f:this.getTypeInfo(I.mat3x4f),mat4x2f:this.getTypeInfo(I.mat4x2f),mat4x3f:this.getTypeInfo(I.mat4x3f),mat4x4f:this.getTypeInfo(I.mat4x4f)}}getVariableValue(e){var n,r;const i=(r=(n=this.context.getVariable(e))===null||n===void 0?void 0:n.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof E)return i.value;if(i instanceof b||i instanceof j)return Array.from(i.data);if(i instanceof we&&i.typeInfo instanceof Un){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,n,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof n=="number")n=[n,1,1];else{if(n.length===0)return void console.error("Invalid dispatch count");n.length===1?n=[n[0],1,1]:n.length===2?n=[n[0],n[1],1]:n.length>3&&(n=[n[0],n[1],n[2]])}const a=n[0],l=n[1],c=n[2],u=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new b(n,u));const f=this.reflection.getFunctionInfo(e);f===null&&console.error(`Function ${e} not found in reflection data`);for(const h in r)for(const d in r[h]){const y=r[h][d];s.variables.forEach(w=>{var x;const m=w.node;if(m!=null&&m.attributes){let _=null,g=null;for(const T of m.attributes)T.name==="binding"?_=T.value:T.name==="group"&&(g=T.value);if(d==_&&h==g){let T=!1;for(const C of f.resources)if(C.name===w.name&&C.group===parseInt(h)&&C.binding===parseInt(d)){T=!0;break}if(T)if(y.texture!==void 0&&y.descriptor!==void 0){const C=new sn(y.texture,this.getTypeInfo(m.type),y.descriptor,(x=y.texture.view)!==null&&x!==void 0?x:null);w.value=C}else y.uniform!==void 0?w.value=new we(y.uniform,this.getTypeInfo(m.type)):w.value=new we(y,this.getTypeInfo(m.type))}}})}for(let h=0;h<c;++h)for(let d=0;d<l;++d)for(let y=0;y<a;++y)s.setVariable("@workgroup_id",new b([y,d,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[y,d,h],s)}execStatement(e,n){if(e instanceof qv)return this.evalExpression(e.value,n);if(e instanceof Qv){if(e.condition){const r=this.evalExpression(e.condition,n);if(!(r instanceof E))throw new Error("Invalid break-if condition");if(!r.value)return null}return He._breakObj}if(e instanceof Jv)return He._continueObj;if(e instanceof ls)this._let(e,n);else if(e instanceof on)this._var(e,n);else if(e instanceof Qo)this._const(e,n);else if(e instanceof Fs)this._function(e,n);else{if(e instanceof Kv)return this._if(e,n);if(e instanceof Yv)return this._switch(e,n);if(e instanceof jv)return this._for(e,n);if(e instanceof zv)return this._while(e,n);if(e instanceof Xv)return this._loop(e,n);if(e instanceof ff){const r=n.clone();return r.currentFunctionName=n.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof Hv)this._assign(e,n);else if(e instanceof Wv)this._increment(e,n);else{if(e instanceof rn)return null;if(e instanceof Yh){const r=e.name;n.getVariable(r)===null&&n.setVariable(r,new E(0,this.getTypeInfo("u32")))}else if(e instanceof Kh)this._call(e,n);else{if(e instanceof Zv||e instanceof qh)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,n){return e instanceof Mt?this._evalBinaryOp(e,n):e instanceof Ie?this._evalLiteral(e,n):e instanceof ut?this._evalVariable(e,n):e instanceof Zh?this._evalCall(e,n):e instanceof Yt?this._evalCreate(e,n):e instanceof Gv?this._evalConst(e,n):e instanceof e0?this._evalBitcast(e,n):e instanceof Ee?this._evalUnaryOp(e,n):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var n;if(e instanceof O){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(n=this.typeInfo[e])!==null&&n!==void 0?n:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,n){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?n.setVariable(r,new E(i,s.type)):s.type.name==="bool"?n.setVariable(r,new E(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?n.setVariable(r,new b(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,n,r){const i=[1,1,1];for(const u of e.node.attributes)if(u.name==="workgroup_size"){if(u.value.length>0){const f=r.getVariableValue(u.value[0]);i[0]=f instanceof E?f.value:parseInt(u.value[0])}if(u.value.length>1){const f=r.getVariableValue(u.value[1]);i[1]=f instanceof E?f.value:parseInt(u.value[1])}if(u.value.length>2){const f=r.getVariableValue(u.value[2]);i[2]=f instanceof E?f.value:parseInt(u.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new b(i,s));const a=i[0],l=i[1],c=i[2];for(let u=0,f=0;u<c;++u)for(let h=0;h<l;++h)for(let d=0;d<a;++d,++f){const y=[d,h,u],w=[d+n[0]*i[0],h+n[1]*i[1],u+n[2]*i[2]];r.setVariable("@local_invocation_id",new b(y,s)),r.setVariable("@global_invocation_id",new b(w,s)),r.setVariable("@local_invocation_index",new E(f,o)),this._dispatchExec(e,r)}}_dispatchExec(e,n){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,o=n.getVariable(s);o!==void 0&&n.variables.set(r.name,o)}this._execStatements(e.node.body,n)}getVariableName(e,n){for(;e instanceof Ee;)e=e.right;return e instanceof ut?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,n){for(const r of e){if(r instanceof Array){const s=n.clone(),o=this._execStatements(r,s);if(o)return o;continue}const i=this.execStatement(r,n);if(i)return i}return null}_call(e,n){const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],a=this.evalExpression(e.args[s],r);r.setVariable(o.name,a,o)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,n)}_increment(e,n){const r=this.getVariableName(e.variable,n),i=n.getVariable(r);i?e.operator==="++"?i.value instanceof E?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof E?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,n){if(e instanceof ut){const r=this.getVariableName(e,n),i=n.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,n)}if(e instanceof Ee){if(e.operator==="*"){const r=this._getVariableData(e.right,n);return r instanceof Mr?r.reference.getSubData(this,e.postfix,n):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,n);return new Mr(r)}}return null}_assign(e,n){let r=null,i="<var>",s=null;if(e.variable instanceof Ee){const l=this._getVariableData(e.variable,n),c=this.evalExpression(e.value,n),u=e.operator;if(u==="="){if(l instanceof E||l instanceof b||l instanceof j){if(c instanceof E||c instanceof b||c instanceof j&&l.data.length===c.data.length)return void l.data.set(c.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(l instanceof we&&c instanceof we&&l.buffer.byteLength-l.offset>=c.buffer.byteLength-c.offset)return void(l.buffer.byteLength%4==0?new Uint32Array(l.buffer,l.offset,l.typeInfo.size/4).set(new Uint32Array(c.buffer,c.offset,c.typeInfo.size/4)):new Uint8Array(l.buffer,l.offset,l.typeInfo.size).set(new Uint8Array(c.buffer,c.offset,c.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(u==="+=")return l instanceof E||l instanceof b||l instanceof j?c instanceof E||c instanceof b||c instanceof j?void l.data.set(c.data.map((f,h)=>l.data[h]+f)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(u==="-=")return(l instanceof E||l instanceof b||l instanceof j)&&(c instanceof E||c instanceof b||c instanceof j)?void l.data.set(c.data.map((f,h)=>l.data[h]-f)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Ee){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,n);const l=n.getVariable(i);if(!(l&&l.value instanceof Mr))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=l.value.reference;let c=e.variable.postfix;if(!c){let u=e.variable.right;for(;u instanceof Ee;){if(u.postfix){c=u.postfix;break}u=u.right}}c&&(r=r.getSubData(this,c,n))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,n);const l=n.getVariable(i);if(l===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=l.value}if(r instanceof Mr&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,n),a=e.operator;if(a!=="="){const l=r.getSubData(this,s,n);if(l instanceof b&&o instanceof E){const c=l.data,u=o.value;if(a==="+=")for(let f=0;f<c.length;++f)c[f]+=u;else if(a==="-=")for(let f=0;f<c.length;++f)c[f]-=u;else if(a==="*=")for(let f=0;f<c.length;++f)c[f]*=u;else if(a==="/=")for(let f=0;f<c.length;++f)c[f]/=u;else if(a==="%=")for(let f=0;f<c.length;++f)c[f]%=u;else if(a==="&=")for(let f=0;f<c.length;++f)c[f]&=u;else if(a==="|=")for(let f=0;f<c.length;++f)c[f]|=u;else if(a==="^=")for(let f=0;f<c.length;++f)c[f]^=u;else if(a==="<<=")for(let f=0;f<c.length;++f)c[f]<<=u;else if(a===">>=")for(let f=0;f<c.length;++f)c[f]>>=u;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(l instanceof b&&o instanceof b){const c=l.data,u=o.data;if(c.length!==u.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let f=0;f<c.length;++f)c[f]+=u[f];else if(a==="-=")for(let f=0;f<c.length;++f)c[f]-=u[f];else if(a==="*=")for(let f=0;f<c.length;++f)c[f]*=u[f];else if(a==="/=")for(let f=0;f<c.length;++f)c[f]/=u[f];else if(a==="%=")for(let f=0;f<c.length;++f)c[f]%=u[f];else if(a==="&=")for(let f=0;f<c.length;++f)c[f]&=u[f];else if(a==="|=")for(let f=0;f<c.length;++f)c[f]|=u[f];else if(a==="^=")for(let f=0;f<c.length;++f)c[f]^=u[f];else if(a==="<<=")for(let f=0;f<c.length;++f)c[f]<<=u[f];else if(a===">>=")for(let f=0;f<c.length;++f)c[f]>>=u[f];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(l instanceof E&&o instanceof E))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?l.value+=o.value:a==="-="?l.value-=o.value:a==="*="?l.value*=o.value:a==="/="?l.value/=o.value:a==="%="?l.value%=o.value:a==="&="?l.value&=o.value:a==="|="?l.value|=o.value:a==="^="?l.value^=o.value:a==="<<="?l.value<<=o.value:a===">>="?l.value>>=o.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(r instanceof we&&r.setDataValue(this,l,s,n))}if(r instanceof we)r.setDataValue(this,o,s,n);else if(s){if(!(r instanceof b||r instanceof j))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof _i){const l=this.evalExpression(s.index,n).value;if(r instanceof b){if(!(o instanceof E))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[l]=o.value}else{if(!(r instanceof j))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const c=this.evalExpression(s.index,n).value;if(c<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof b))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const u=r.typeInfo.getTypeName();if(u==="mat2x2"||u==="mat2x2f"||u==="mat2x2h"){if(!(c<2&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*c]=o.data[0],r.data[2*c+1]=o.data[1]}else if(u==="mat2x3"||u==="mat2x3f"||u==="mat2x3h"){if(!(c<2&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*c]=o.data[0],r.data[3*c+1]=o.data[1],r.data[3*c+2]=o.data[2]}else if(u==="mat2x4"||u==="mat2x4f"||u==="mat2x4h"){if(!(c<2&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*c]=o.data[0],r.data[4*c+1]=o.data[1],r.data[4*c+2]=o.data[2],r.data[4*c+3]=o.data[3]}else if(u==="mat3x2"||u==="mat3x2f"||u==="mat3x2h"){if(!(c<3&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*c]=o.data[0],r.data[2*c+1]=o.data[1]}else if(u==="mat3x3"||u==="mat3x3f"||u==="mat3x3h"){if(!(c<3&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*c]=o.data[0],r.data[3*c+1]=o.data[1],r.data[3*c+2]=o.data[2]}else if(u==="mat3x4"||u==="mat3x4f"||u==="mat3x4h"){if(!(c<3&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*c]=o.data[0],r.data[4*c+1]=o.data[1],r.data[4*c+2]=o.data[2],r.data[4*c+3]=o.data[3]}else if(u==="mat4x2"||u==="mat4x2f"||u==="mat4x2h"){if(!(c<4&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*c]=o.data[0],r.data[2*c+1]=o.data[1]}else if(u==="mat4x3"||u==="mat4x3f"||u==="mat4x3h"){if(!(c<4&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*c]=o.data[0],r.data[3*c+1]=o.data[1],r.data[3*c+2]=o.data[2]}else{if(u!=="mat4x4"&&u!=="mat4x4f"&&u!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(c<4&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*c]=o.data[0],r.data[4*c+1]=o.data[1],r.data[4*c+2]=o.data[2],r.data[4*c+3]=o.data[3]}}}}}else if(s instanceof vr){const l=s.value;if(!(r instanceof b))return void console.error(`Invalid assignment to ${l}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof E){if(l.length>1)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${e.line}`);if(l==="x")r.data[0]=o.value;else if(l==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${e.line}`);r.data[1]=o.value}else if(l==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${e.line}`);r.data[2]=o.value}else if(l==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof b))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(l.length!==o.data.length)return void console.error(`Invalid assignment to ${l} for variable ${i}. Line ${e.line}`);for(let c=0;c<l.length;++c){const u=l[c];if(u==="x"||u==="r")r.data[0]=o.data[c];else if(u==="y"||u==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[1]=o.data[c]}else if(u==="z"||u==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[2]=o.data[c]}else{if(u!=="w"&&u!=="a")return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[3]=o.data[c]}}}}}else r instanceof E&&o instanceof E?r.value=o.value:r instanceof b&&o instanceof b||r instanceof j&&o instanceof j?r.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`)}_function(e,n){const r=new Gh(e);n.functions.set(e.name,r)}_const(e,n){let r=null;e.value!==null&&(r=this.evalExpression(e.value,n)),n.createVariable(e.name,r,e)}_let(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Ee||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new Yt(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_var(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Ee||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof cs||e.type instanceof rn||e.type instanceof I){const s=new Yt(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_switch(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof E))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof r0)for(const o of s.selectors){if(o instanceof Go){i=s;continue}const a=this.evalExpression(o,n);if(!(a instanceof E))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(s.body,n)}else s instanceof i0&&(i=s);return i?this._execStatements(i.body,n):null}_if(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof E))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,n);for(const i of e.elseif){const s=this.evalExpression(i.condition,n);if(!(s instanceof E))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,n)}return e.else?this._execStatements(e.else,n):null}_getScalarValue(e){return e instanceof E?e.value:(console.error("Expected scalar value.",e),0)}_for(e,n){for(n=n.clone(),this.execStatement(e.init,n);this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===He._breakObj)break;if(r!==null&&r!==He._continueObj)return r;this.execStatement(e.increment,n)}return null}_loop(e,n){for(n=n.clone();;){const r=this._execStatements(e.body,n);if(r===He._breakObj)break;if(r===He._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,n)===He._breakObj)break}else if(r!==null)return r}return null}_while(e,n){for(n=n.clone();this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===He._breakObj)break;if(r!==He._continueObj&&r!==null)return r}return null}_evalBitcast(e,n){const r=this.evalExpression(e.value,n),i=e.type;if(r instanceof E){const s=fg(r.value,r.typeInfo.name,i.name);return new E(s,this.getTypeInfo(i))}if(r instanceof b){const s=r.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;o="f16"}const a=i.getTypeName();let l="";if(a.endsWith("f"))l="f32";else if(a.endsWith("i"))l="i32";else if(a.endsWith("u"))l="u32";else if(a.endsWith("b"))l="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${l}. Line ${e.line}`),null;l="f16"}const c=function(u,f,h){if(f===h)return u;const d=new Array(u.length);for(let y=0;y<u.length;y++)d[y]=fg(u[y],f,h);return d}(Array.from(r.data),o,l);return new b(c,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,n){return n.getVariableValue(e.name).clone().getSubData(this,e.postfix,n)}_evalCreate(e,n){var r;if(e instanceof Yt){if(e.type===null)return hf.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,n);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,n);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,n)}}const i=e instanceof Yt?e.type.name:e.name,s=e instanceof Yt?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const o=new we(new ArrayBuffer(s.size),s,0);if(s instanceof Cn){if(e.args)for(let a=0;a<e.args.length;++a){const l=s.members[a],c=e.args[a],u=this.evalExpression(c,n);o.setData(this,u,l.type,l.offset,n)}}else if(s instanceof Un){let a=0;if(e.args)for(let l=0;l<e.args.length;++l){const c=e.args[l],u=this.evalExpression(c,n);s.format===null&&(((r=u.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=u.typeInfo),o.setData(this,u,s.format,a,n),a+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Yt?o.getSubData(this,e.postfix,n):o}_evalLiteral(e,n){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new E(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,n):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,n):e.value}_evalVariable(e,n){const r=n.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,n)}_maxFormatTypeInfo(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=He._priority.get(n.name);He._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?this.getTypeInfo("i32"):n}_evalUnaryOp(e,n){const r=this.evalExpression(e.right,n);if(e.operator==="&")return new Mr(r);if(e.operator==="*")return r instanceof Mr?r.reference.getSubData(this,e.postfix,n):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof E?r.value:r instanceof b?Array.from(r.data):null;switch(e.operator){case"+":{if(U(i)){const a=i.map((l,c)=>+l);return new b(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new E(+s,o)}case"-":{if(U(i)){const a=i.map((l,c)=>-l);return new b(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new E(-s,o)}case"!":{if(U(i)){const a=i.map((l,c)=>l?0:1);return new b(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new E(s?0:1,o)}case"~":{if(U(i)){const a=i.map((l,c)=>~l);return new b(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new E(~s,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,n){const r=this.evalExpression(e.left,n),i=this.evalExpression(e.right,n),s=r instanceof E?r.value:r instanceof b||r instanceof j?Array.from(r.data):null,o=i instanceof E?i.value:i instanceof b||i instanceof j?Array.from(i.data):null;switch(e.operator){case"+":{if(U(s)&&U(o)){const u=s,f=o;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=u.map((d,y)=>d+f[y]);return new b(h,r.typeInfo)}if(U(s)){const u=o,f=s.map((h,d)=>h+u);return new b(f,r.typeInfo)}if(U(o)){const u=s,f=o.map((h,d)=>u+h);return new b(f,i.typeInfo)}const a=s,l=o,c=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new E(a+l,c)}case"-":{if(U(s)&&U(o)){const u=s,f=o;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=u.map((d,y)=>d-f[y]);return new b(h,r.typeInfo)}if(U(s)){const u=o,f=s.map((h,d)=>h-u);return new b(f,r.typeInfo)}if(U(o)){const u=s,f=o.map((h,d)=>u-h);return new b(f,i.typeInfo)}const a=s,l=o,c=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new E(a-l,c)}case"*":{if(U(s)&&U(o)){const u=s,f=o;if(r instanceof j&&i instanceof j){const h=function(x,m,_,g){if(qe[m.name]===void 0||qe[g.name]===void 0)return null;const T=qe[m.name][0],C=qe[m.name][1],S=qe[g.name][0];if(T!==qe[g.name][1])return null;const M=new Array(S*C);for(let k=0;k<C;k++)for(let F=0;F<S;F++){let D=0;for(let L=0;L<T;L++)D+=x[L*C+k]*_[F*T+L];M[k*S+F]=D}return M}(u,r.typeInfo,f,i.typeInfo);if(h===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const d=qe[i.typeInfo.name][0],y=qe[r.typeInfo.name][1],w=this.getTypeInfo(`mat${d}x${y}f`);return new j(h,w)}if(r instanceof j&&i instanceof b){const h=function(d,y,w,x){if(qe[y.name]===void 0||Cc[x.name]===void 0)return null;const m=qe[y.name][0],_=qe[y.name][1];if(m!==w.length)return null;const g=new Array(_);for(let T=0;T<_;T++){let C=0;for(let S=0;S<m;S++)C+=d[S*_+T]*w[S];g[T]=C}return g}(u,r.typeInfo,f,i.typeInfo);return h===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new b(h,i.typeInfo)}if(r instanceof b&&i instanceof j){const h=function(d,y,w,x){if(Cc[y.name]===void 0||qe[x.name]===void 0)return null;const m=qe[x.name][0],_=qe[x.name][1];if(_!==d.length)return null;const g=[];for(let T=0;T<m;T++){let C=0;for(let S=0;S<_;S++)C+=d[S]*w[S*m+T];g[T]=C}return g}(u,r.typeInfo,f,i.typeInfo);return h===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new b(h,r.typeInfo)}{if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=u.map((d,y)=>d*f[y]);return new b(h,r.typeInfo)}}if(U(s)){const u=o,f=s.map((h,d)=>h*u);return r instanceof j?new j(f,r.typeInfo):new b(f,r.typeInfo)}if(U(o)){const u=s,f=o.map((h,d)=>u*h);return i instanceof j?new j(f,i.typeInfo):new b(f,i.typeInfo)}const a=s,l=o,c=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new E(a*l,c)}case"%":{if(U(s)&&U(o)){const u=s,f=o;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=u.map((d,y)=>d%f[y]);return new b(h,r.typeInfo)}if(U(s)){const u=o,f=s.map((h,d)=>h%u);return new b(f,r.typeInfo)}if(U(o)){const u=s,f=o.map((h,d)=>u%h);return new b(f,i.typeInfo)}const a=s,l=o,c=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new E(a%l,c)}case"/":{if(U(s)&&U(o)){const u=s,f=o;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=u.map((d,y)=>d/f[y]);return new b(h,r.typeInfo)}if(U(s)){const u=o,f=s.map((h,d)=>h/u);return new b(f,r.typeInfo)}if(U(o)){const u=s,f=o.map((h,d)=>u/h);return new b(f,i.typeInfo)}const a=s,l=o,c=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new E(a/l,c)}case"&":{if(U(s)&&U(o)){const u=s,f=o;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=u.map((d,y)=>d&f[y]);return new b(h,r.typeInfo)}if(U(s)){const u=o,f=s.map((h,d)=>h&u);return new b(f,r.typeInfo)}if(U(o)){const u=s,f=o.map((h,d)=>u&h);return new b(f,i.typeInfo)}const a=s,l=o,c=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new E(a&l,c)}case"|":{if(U(s)&&U(o)){const u=s,f=o;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=u.map((d,y)=>d|f[y]);return new b(h,r.typeInfo)}if(U(s)){const u=o,f=s.map((h,d)=>h|u);return new b(f,r.typeInfo)}if(U(o)){const u=s,f=o.map((h,d)=>u|h);return new b(f,i.typeInfo)}const a=s,l=o,c=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new E(a|l,c)}case"^":{if(U(s)&&U(o)){const u=s,f=o;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=u.map((d,y)=>d^f[y]);return new b(h,r.typeInfo)}if(U(s)){const u=o,f=s.map((h,d)=>h^u);return new b(f,r.typeInfo)}if(U(o)){const u=s,f=o.map((h,d)=>u^h);return new b(f,i.typeInfo)}const a=s,l=o,c=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new E(a^l,c)}case"<<":{if(U(s)&&U(o)){const u=s,f=o;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=u.map((d,y)=>d<<f[y]);return new b(h,r.typeInfo)}if(U(s)){const u=o,f=s.map((h,d)=>h<<u);return new b(f,r.typeInfo)}if(U(o)){const u=s,f=o.map((h,d)=>u<<h);return new b(f,i.typeInfo)}const a=s,l=o,c=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new E(a<<l,c)}case">>":{if(U(s)&&U(o)){const u=s,f=o;if(u.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=u.map((d,y)=>d>>f[y]);return new b(h,r.typeInfo)}if(U(s)){const u=o,f=s.map((h,d)=>h>>u);return new b(f,r.typeInfo)}if(U(o)){const u=s,f=o.map((h,d)=>u>>h);return new b(f,i.typeInfo)}const a=s,l=o,c=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new E(a>>l,c)}case">":if(U(s)&&U(o)){const a=s,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,f)=>u>l[f]?1:0);return new b(c,r.typeInfo)}if(U(s)){const a=o,l=s.map((c,u)=>c>a?1:0);return new b(l,r.typeInfo)}if(U(o)){const a=s,l=o.map((c,u)=>a>c?1:0);return new b(l,i.typeInfo)}return new E(s>o?1:0,this.getTypeInfo("bool"));case"<":if(U(s)&&U(o)){const a=s,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,f)=>u<l[f]?1:0);return new b(c,r.typeInfo)}if(U(s)){const a=o,l=s.map((c,u)=>c<a?1:0);return new b(l,r.typeInfo)}if(U(o)){const a=s,l=o.map((c,u)=>a<c?1:0);return new b(l,i.typeInfo)}return new E(s<o?1:0,this.getTypeInfo("bool"));case"==":if(U(s)&&U(o)){const a=s,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,f)=>u===l[f]?1:0);return new b(c,r.typeInfo)}if(U(s)){const a=o,l=s.map((c,u)=>c==a?1:0);return new b(l,r.typeInfo)}if(U(o)){const a=s,l=o.map((c,u)=>a==c?1:0);return new b(l,i.typeInfo)}return new E(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(U(s)&&U(o)){const a=s,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,f)=>u!==l[f]?1:0);return new b(c,r.typeInfo)}if(U(s)){const a=o,l=s.map((c,u)=>c!==a?1:0);return new b(l,r.typeInfo)}if(U(o)){const a=s,l=o.map((c,u)=>a!==c?1:0);return new b(l,i.typeInfo)}return new E(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(U(s)&&U(o)){const a=s,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,f)=>u>=l[f]?1:0);return new b(c,r.typeInfo)}if(U(s)){const a=o,l=s.map((c,u)=>c>=a?1:0);return new b(l,r.typeInfo)}if(U(o)){const a=s,l=o.map((c,u)=>a>=c?1:0);return new b(l,i.typeInfo)}return new E(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(U(s)&&U(o)){const a=s,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,f)=>u<=l[f]?1:0);return new b(c,r.typeInfo)}if(U(s)){const a=o,l=s.map((c,u)=>c<=a?1:0);return new b(l,r.typeInfo)}if(U(o)){const a=s,l=o.map((c,u)=>a<=c?1:0);return new b(l,i.typeInfo)}return new E(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(U(s)&&U(o)){const a=s,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,f)=>u&&l[f]?1:0);return new b(c,r.typeInfo)}if(U(s)){const a=o,l=s.map((c,u)=>c&&a?1:0);return new b(l,r.typeInfo)}if(U(o)){const a=s,l=o.map((c,u)=>a&&c?1:0);return new b(l,i.typeInfo)}return new E(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(U(s)&&U(o)){const a=s,l=o;if(a.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=a.map((u,f)=>u||l[f]?1:0);return new b(c,r.typeInfo)}if(U(s)){const a=o,l=s.map((c,u)=>c||a?1:0);return new b(l,r.typeInfo)}if(U(o)){const a=s,l=o.map((c,u)=>a||c?1:0);return new b(l,i.typeInfo)}return new E(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,n){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,n):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],a=this.evalExpression(e.args[s],r);r.createVariable(o.name,a,o)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,n){switch(e.name){case"all":return this.builtins.All(e,n);case"any":return this.builtins.Any(e,n);case"select":return this.builtins.Select(e,n);case"arrayLength":return this.builtins.ArrayLength(e,n);case"abs":return this.builtins.Abs(e,n);case"acos":return this.builtins.Acos(e,n);case"acosh":return this.builtins.Acosh(e,n);case"asin":return this.builtins.Asin(e,n);case"asinh":return this.builtins.Asinh(e,n);case"atan":return this.builtins.Atan(e,n);case"atanh":return this.builtins.Atanh(e,n);case"atan2":return this.builtins.Atan2(e,n);case"ceil":return this.builtins.Ceil(e,n);case"clamp":return this.builtins.Clamp(e,n);case"cos":return this.builtins.Cos(e,n);case"cosh":return this.builtins.Cosh(e,n);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,n);case"countOneBits":return this.builtins.CountOneBits(e,n);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,n);case"cross":return this.builtins.Cross(e,n);case"degrees":return this.builtins.Degrees(e,n);case"determinant":return this.builtins.Determinant(e,n);case"distance":return this.builtins.Distance(e,n);case"dot":return this.builtins.Dot(e,n);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,n);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,n);case"exp":return this.builtins.Exp(e,n);case"exp2":return this.builtins.Exp2(e,n);case"extractBits":return this.builtins.ExtractBits(e,n);case"faceForward":return this.builtins.FaceForward(e,n);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,n);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,n);case"floor":return this.builtins.Floor(e,n);case"fma":return this.builtins.Fma(e,n);case"fract":return this.builtins.Fract(e,n);case"frexp":return this.builtins.Frexp(e,n);case"insertBits":return this.builtins.InsertBits(e,n);case"inverseSqrt":return this.builtins.InverseSqrt(e,n);case"ldexp":return this.builtins.Ldexp(e,n);case"length":return this.builtins.Length(e,n);case"log":return this.builtins.Log(e,n);case"log2":return this.builtins.Log2(e,n);case"max":return this.builtins.Max(e,n);case"min":return this.builtins.Min(e,n);case"mix":return this.builtins.Mix(e,n);case"modf":return this.builtins.Modf(e,n);case"normalize":return this.builtins.Normalize(e,n);case"pow":return this.builtins.Pow(e,n);case"quantizeToF16":return this.builtins.QuantizeToF16(e,n);case"radians":return this.builtins.Radians(e,n);case"reflect":return this.builtins.Reflect(e,n);case"refract":return this.builtins.Refract(e,n);case"reverseBits":return this.builtins.ReverseBits(e,n);case"round":return this.builtins.Round(e,n);case"saturate":return this.builtins.Saturate(e,n);case"sign":return this.builtins.Sign(e,n);case"sin":return this.builtins.Sin(e,n);case"sinh":return this.builtins.Sinh(e,n);case"smoothstep":return this.builtins.SmoothStep(e,n);case"sqrt":return this.builtins.Sqrt(e,n);case"step":return this.builtins.Step(e,n);case"tan":return this.builtins.Tan(e,n);case"tanh":return this.builtins.Tanh(e,n);case"transpose":return this.builtins.Transpose(e,n);case"trunc":return this.builtins.Trunc(e,n);case"dpdx":return this.builtins.Dpdx(e,n);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,n);case"dpdxFine":return this.builtins.DpdxFine(e,n);case"dpdy":return this.builtins.Dpdy(e,n);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,n);case"dpdyFine":return this.builtins.DpdyFine(e,n);case"fwidth":return this.builtins.Fwidth(e,n);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,n);case"fwidthFine":return this.builtins.FwidthFine(e,n);case"textureDimensions":return this.builtins.TextureDimensions(e,n);case"textureGather":return this.builtins.TextureGather(e,n);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,n);case"textureLoad":return this.builtins.TextureLoad(e,n);case"textureNumLayers":return this.builtins.TextureNumLayers(e,n);case"textureNumLevels":return this.builtins.TextureNumLevels(e,n);case"textureNumSamples":return this.builtins.TextureNumSamples(e,n);case"textureSample":return this.builtins.TextureSample(e,n);case"textureSampleBias":return this.builtins.TextureSampleBias(e,n);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,n);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,n);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,n);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,n);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,n);case"textureStore":return this.builtins.TextureStore(e,n);case"atomicLoad":return this.builtins.AtomicLoad(e,n);case"atomicStore":return this.builtins.AtomicStore(e,n);case"atomicAdd":return this.builtins.AtomicAdd(e,n);case"atomicSub":return this.builtins.AtomicSub(e,n);case"atomicMax":return this.builtins.AtomicMax(e,n);case"atomicMin":return this.builtins.AtomicMin(e,n);case"atomicAnd":return this.builtins.AtomicAnd(e,n);case"atomicOr":return this.builtins.AtomicOr(e,n);case"atomicXor":return this.builtins.AtomicXor(e,n);case"atomicExchange":return this.builtins.AtomicExchange(e,n);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,n);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,n);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,n);case"pack4xI8":return this.builtins.Pack4xI8(e,n);case"pack4xU8":return this.builtins.Pack4xU8(e,n);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,n);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,n);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,n);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,n);case"pack2x16float":return this.builtins.Pack2x16float(e,n);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,n);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,n);case"unpack4xI8":return this.builtins.Unpack4xI8(e,n);case"unpack4xU8":return this.builtins.Unpack4xU8(e,n);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,n);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,n);case"unpack2x16float":return this.builtins.Unpack2x16float(e,n);case"storageBarrier":return this.builtins.StorageBarrier(e,n);case"textureBarrier":return this.builtins.TextureBarrier(e,n);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,n);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,n);case"subgroupAdd":return this.builtins.SubgroupAdd(e,n);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,n);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,n);case"subgroupAll":return this.builtins.SubgroupAll(e,n);case"subgroupAnd":return this.builtins.SubgroupAnd(e,n);case"subgroupAny":return this.builtins.SubgroupAny(e,n);case"subgroupBallot":return this.builtins.SubgroupBallot(e,n);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,n);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,n);case"subgroupElect":return this.builtins.SubgroupElect(e,n);case"subgroupMax":return this.builtins.SubgroupMax(e,n);case"subgroupMin":return this.builtins.SubgroupMin(e,n);case"subgroupMul":return this.builtins.SubgroupMul(e,n);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,n);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,n);case"subgroupOr":return this.builtins.SubgroupOr(e,n);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,n);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,n);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,n);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,n);case"subgroupXor":return this.builtins.SubgroupXor(e,n);case"quadBroadcast":return this.builtins.QuadBroadcast(e,n);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,n);case"quadSwapX":return this.builtins.QuadSwapX(e,n);case"quadSwapY":return this.builtins.QuadSwapY(e,n)}const r=n.getFunction(e.name);if(r){const i=n.clone();for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],a=this.evalExpression(e.args[s],i);i.setVariable(o.name,a,o)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,n){if(!e.args||e.args.length===0)return new E(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],n);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,n).clone()}_callConstructorVec(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=Cc[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Ie)if(e.isVector){const a=e.vectorValue;for(const l of a)o.push(l)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const l=this.evalExpression(a,n);if(l instanceof b){const c=l.data;for(let u=0;u<c.length;++u){let f=c[u];o.push(f)}}else if(l instanceof E){let c=l.value;o.push(c)}}if(e.type instanceof I&&e.type.format===null&&(e.type.format=I.f32),o.length===0){const a=new Array(s).fill(0);return new b(a,r).getSubData(this,e.postfix,n)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new b(o.length>s?o.slice(0,s):o,r).getSubData(this,e.postfix,n)}_callConstructorMatrix(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=qe[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Ie)if(e.isVector){const a=e.vectorValue;for(const l of a)o.push(l)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const l=this.evalExpression(a,n);l instanceof b?o.push(...l.data):l instanceof E?o.push(l.value):l instanceof j&&o.push(...l.data)}if(r instanceof yr&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const a=new Array(s[2]).fill(0);return new j(a,r).getSubData(this,e.postfix,n)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new j(o,r).getSubData(this,e.postfix,n)}}He._breakObj=new Ct(new xt("BREAK",null),null),He._continueObj=new Ct(new xt("CONTINUE",null),null),He._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class BS{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class US{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new BS,this._exec=new He,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof ut){const o=s.name,a=this._context.constants.get(o);if(a)try{const l=a.constEvaluate(this._exec);i.count=l}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of n)r.search(i=>{i instanceof cg||i instanceof Jo?i.type=this._forwardType(i.type):i instanceof cs?i.format=this._forwardType(i.format):i instanceof on||i instanceof ls||i instanceof Qo?i.type=this._forwardType(i.type):i instanceof Fs?i.returnType=this._forwardType(i.returnType):i instanceof lg&&(i.type=this._forwardType(i.type))});return n}_forwardType(e){if(e instanceof ag){const n=this._getType(e.name);if(n)return n}else e instanceof Jo?e.type=this._forwardType(e.type):e instanceof cs&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const n=new RS(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,n){return e.line=n??this._currentLine,e}_error(e,n){return{token:e,message:n,toString:()=>`${n}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==v.eof}_match(e){if(e instanceof R)return!!this._check(e)&&(this._advance(),!0);for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),`${n}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;let i=!1;for(const s of e){if(r===s)return!0;s===v.tokens.name&&(i=!0)}if(i){const s=v.tokens.name.rule.exec(n.lexeme);if(s&&s.index==0&&s[0]==n.lexeme)return!0}return!1}if(n.type===e)return!0;if(e===v.tokens.name){const r=v.tokens.name.rule.exec(n.lexeme);return r&&r.index==0&&r[0]==n.lexeme}return!1}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(v.tokens.semicolon)&&!this._isAtEnd(););if(this._match(v.keywords.alias)){const n=this._type_alias();return this._consume(v.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(v.keywords.diagnostic)){const n=this._diagnostic();return this._consume(v.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(v.keywords.requires)){const n=this._requires_directive();return this._consume(v.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(v.keywords.enable)){const n=this._enable_directive();return this._consume(v.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}const e=this._attribute();if(this._check(v.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(v.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(v.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(v.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(v.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(v.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}if(this._check(v.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}return null}_function_decl(){if(!this._match(v.keywords.fn))return null;const e=this._currentLine,n=this._consume(v.tokens.ident,"Expected function name.").toString();this._consume(v.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(v.tokens.paren_right))do{if(this._check(v.tokens.paren_right))break;const a=this._attribute(),l=this._consume(v.tokens.name,"Expected argument name.").toString();this._consume(v.tokens.colon,"Expected ':' for argument type.");const c=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=c,r.push(this._updateNode(new lg(l,u,a))))}while(this._match(v.tokens.comma));this._consume(v.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(v.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new Fs(n,r,i,s,e,o),e)}_compound_statement(){const e=[];for(this._consume(v.tokens.brace_left,"Expected '{' for block.");!this._check(v.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(v.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(v.tokens.semicolon)&&!this._isAtEnd(););if(this._check(v.tokens.attr)&&this._attribute(),this._check(v.keywords.if))return this._if_statement();if(this._check(v.keywords.switch))return this._switch_statement();if(this._check(v.keywords.loop))return this._loop_statement();if(this._check(v.keywords.for))return this._for_statement();if(this._check(v.keywords.while))return this._while_statement();if(this._check(v.keywords.continuing))return this._continuing_statement();if(this._check(v.keywords.static_assert))return this._static_assert_statement();if(this._check(v.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(v.keywords.return))e=this._return_statement();else if(this._check([v.keywords.var,v.keywords.let,v.keywords.const]))e=this._variable_statement();else if(this._match(v.keywords.discard))e=this._updateNode(new SS);else if(this._match(v.keywords.break)){const n=this._updateNode(new Qv);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n,this._check(v.keywords.if)&&(this._advance(),n.condition=this._optional_paren_expression())}else if(this._match(v.keywords.continue)){const n=this._updateNode(new Jv);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${n.line}`);{const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(v.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(v.keywords.static_assert))return null;const e=this._currentLine,n=this._optional_paren_expression();return this._updateNode(new bS(n),e)}_while_statement(){if(!this._match(v.keywords.while))return null;const e=this._updateNode(new zv(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(v.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(v.keywords.continuing))return null;const n=this._currentLine,r=this._compound_statement();return this._updateNode(new ff(r,e),n)}_for_statement(){if(!this._match(v.keywords.for))return null;this._consume(v.tokens.paren_left,"Expected '('.");const e=this._updateNode(new jv(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(v.tokens.semicolon)?null:this._for_init(),this._consume(v.tokens.semicolon,"Expected ';'."),e.condition=this._check(v.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(v.tokens.semicolon,"Expected ';'."),e.increment=this._check(v.tokens.paren_right)?null:this._for_increment(),this._consume(v.tokens.paren_right,"Expected ')'."),this._check(v.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(v.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(v.tokens.equal)&&(n=this._short_circuit_or_expression()),this._updateNode(new on(e.name,e.type,e.storage,e.access,n),e.line)}if(this._match(v.keywords.let)){const e=this._currentLine,n=this._consume(v.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(v.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(v.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new ls(n,r,null,null,i),e)}if(this._match(v.keywords.const)){const e=this._currentLine,n=this._consume(v.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(v.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(v.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof Ie&&(r=i.type),this._updateNode(new Qo(n,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(v.increment_operators))return this._current=e,null;const r=this._consume(v.increment_operators,"Expected increment operator");return this._updateNode(new Wv(r.type===v.tokens.plus_plus?qr.increment:qr.decrement,n))}_assignment_statement(){let e=null;const n=this._currentLine;if(this._check(v.tokens.brace_right))return null;let r=this._match(v.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(v.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new Hv(Xi.parse(i.lexeme),e,s),n)}_func_call_statement(){if(!this._check(v.tokens.ident))return null;const e=this._currentLine,n=this._current,r=this._consume(v.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=n,null):this._updateNode(new Kh(r.lexeme,i),e)}_loop_statement(){if(!this._match(v.keywords.loop))return null;this._check(v.tokens.attr)&&this._attribute(),this._consume(v.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new Xv([],null));this._currentLoop.push(e);let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let r of n)e.body.push(r);else e.body.push(n);if(n instanceof ff){e.continuing=n;break}n=this._statement()}return this._currentLoop.pop(),this._consume(v.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(v.keywords.switch))return null;const e=this._updateNode(new Yv(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(v.tokens.attr)&&this._attribute(),this._consume(v.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(v.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let n=!1;for(;this._check([v.keywords.default,v.keywords.case]);){if(this._match(v.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof Go){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");n=!0;break}this._match(v.tokens.colon),this._check(v.tokens.attr)&&this._attribute(),this._consume(v.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(v.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new r0(r,i)))}if(this._match(v.keywords.default)){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(v.tokens.colon),this._check(v.tokens.attr)&&this._attribute(),this._consume(v.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(v.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new i0(r)))}}return e}_case_selectors(){const e=[];for(this._match(v.keywords.default)?e.push(this._updateNode(new Go)):e.push(this._shift_expression());this._match(v.tokens.comma);)this._match(v.keywords.default)?e.push(this._updateNode(new Go)):e.push(this._shift_expression());return e}_case_body(){if(this._match(v.keywords.fallthrough))return this._consume(v.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(v.keywords.if))return null;const e=this._currentLine,n=this._optional_paren_expression();this._check(v.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(v.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(v.keywords.else)&&(this._check(v.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new Kv(n,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===v.keywords.else&&this._tokens[this._current+1].type===v.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new ES(n,r))),this._match_elseif()&&(this._check(v.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(v.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new qv(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(v.tokens.or_or);)e=this._updateNode(new Mt(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(v.tokens.and_and);)e=this._updateNode(new Mt(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(v.tokens.or);)e=this._updateNode(new Mt(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(v.tokens.xor);)e=this._updateNode(new Mt(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(v.tokens.and);)e=this._updateNode(new Mt(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([v.tokens.equal_equal,v.tokens.not_equal])?this._updateNode(new Mt(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([v.tokens.less_than,v.tokens.greater_than,v.tokens.less_than_equal,v.tokens.greater_than_equal]);)e=this._updateNode(new Mt(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([v.tokens.shift_left,v.tokens.shift_right]);)e=this._updateNode(new Mt(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([v.tokens.plus,v.tokens.minus]);)e=this._updateNode(new Mt(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([v.tokens.star,v.tokens.forward_slash,v.tokens.modulo]);)e=this._updateNode(new Mt(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([v.tokens.minus,v.tokens.bang,v.tokens.tilde,v.tokens.star,v.tokens.and])?this._updateNode(new Ee(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(v.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(v.tokens.bracket_right,"Expected ']'.");const n=this._updateNode(new _i(e)),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(v.tokens.period)){const e=this._consume(v.tokens.name,"Expected member name."),n=this._postfix_expression(),r=this._updateNode(new vr(e.lexeme));return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const n=this._getStruct(e);if(n!==null)return n;switch(e){case"void":return O.void;case"bool":return O.bool;case"i32":return O.i32;case"u32":return O.u32;case"f32":return O.f32;case"f16":return O.f16;case"vec2f":return I.vec2f;case"vec3f":return I.vec3f;case"vec4f":return I.vec4f;case"vec2i":return I.vec2i;case"vec3i":return I.vec3i;case"vec4i":return I.vec4i;case"vec2u":return I.vec2u;case"vec3u":return I.vec3u;case"vec4u":return I.vec4u;case"vec2h":return I.vec2h;case"vec3h":return I.vec3h;case"vec4h":return I.vec4h;case"mat2x2f":return I.mat2x2f;case"mat2x3f":return I.mat2x3f;case"mat2x4f":return I.mat2x4f;case"mat3x2f":return I.mat3x2f;case"mat3x3f":return I.mat3x3f;case"mat3x4f":return I.mat3x4f;case"mat4x2f":return I.mat4x2f;case"mat4x3f":return I.mat4x3f;case"mat4x4f":return I.mat4x4f;case"mat2x2h":return I.mat2x2h;case"mat2x3h":return I.mat2x3h;case"mat2x4h":return I.mat2x4h;case"mat3x2h":return I.mat3x2h;case"mat3x3h":return I.mat3x3h;case"mat3x4h":return I.mat3x4h;case"mat4x2h":return I.mat4x2h;case"mat4x3h":return I.mat4x3h;case"mat4x4h":return I.mat4x4h;case"mat2x2i":return I.mat2x2i;case"mat2x3i":return I.mat2x3i;case"mat2x4i":return I.mat2x4i;case"mat3x2i":return I.mat3x2i;case"mat3x3i":return I.mat3x3i;case"mat3x4i":return I.mat3x4i;case"mat4x2i":return I.mat4x2i;case"mat4x3i":return I.mat4x3i;case"mat4x4i":return I.mat4x4i;case"mat2x2u":return I.mat2x2u;case"mat2x3u":return I.mat2x3u;case"mat2x4u":return I.mat2x4u;case"mat3x2u":return I.mat3x2u;case"mat3x3u":return I.mat3x3u;case"mat3x4u":return I.mat3x4u;case"mat4x2u":return I.mat4x2u;case"mat4x3u":return I.mat4x3u;case"mat4x4u":return I.mat4x4u}return null}_validateTypeRange(e,n){if(n.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(n.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(v.tokens.ident)){const r=this._previous().toString();if(this._check(v.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new Yt(s,i)):this._updateNode(new Zh(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new Gv(r,i.value))}return this._updateNode(new ut(r))}if(this._match(v.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?O.i32:r.endsWith("u")||r.endsWith("U")?O.u32:O.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new Ie(new E(s,this._exec.getTypeInfo(i)),i))}if(this._match(v.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,O.u32),this._updateNode(new Ie(new E(r,this._exec.getTypeInfo(O.u32)),O.u32))}if(this._match([v.tokens.decimal_float_literal,v.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?O.f16:O.f32);const o=i?O.f16:O.f32;return this._updateNode(new Ie(new E(s,this._exec.getTypeInfo(o)),o))}if(this._match([v.keywords.true,v.keywords.false])){let r=this._previous().toString()===v.keywords.true.rule;return this._updateNode(new Ie(new E(r?1:0,this._exec.getTypeInfo(O.bool)),O.bool))}if(this._check(v.tokens.paren_left))return this._paren_expression();if(this._match(v.keywords.bitcast)){this._consume(v.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(v.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new e0(r,i))}const e=this._type_decl(),n=this._argument_expression_list();return this._updateNode(new Yt(e,n))}_argument_expression_list(){if(!this._match(v.tokens.paren_left))return null;const e=[];do{if(this._check(v.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(v.tokens.comma));return this._consume(v.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(v.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(v.tokens.paren_right),e}_paren_expression(){this._consume(v.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(v.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(v.keywords.struct))return null;const e=this._currentLine,n=this._consume(v.tokens.ident,"Expected name for struct.").toString();this._consume(v.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(v.tokens.brace_right);){const o=this._attribute(),a=this._consume(v.tokens.name,"Expected variable name.").toString();this._consume(v.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=l),this._check(v.tokens.brace_right)?this._match(v.tokens.comma):this._consume(v.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new cg(a,c,o)))}this._consume(v.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new rn(n,r,e,i),e);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(v.tokens.equal)){const n=this._const_expression();e.value=n}if(e.type!==null&&e.value instanceof Ie){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Ie&&(e.type=e.value.type.name==="x32"?O.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(v.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(v.keywords.const))return null;const n=this._consume(v.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(v.tokens.colon)){const l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}let s=null;this._consume(v.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let l=[O.f32],c=o.constEvaluate(this._exec,l);c instanceof E&&this._validateTypeRange(c.value,l[0]),l[0]instanceof I&&l[0].format===null&&c.typeInfo instanceof yr&&c.typeInfo.format!==null&&(c.typeInfo.format.name==="f16"?l[0].format=O.f16:c.typeInfo.format.name==="f32"?l[0].format=O.f32:c.typeInfo.format.name==="i32"?l[0].format=O.i32:c.typeInfo.format.name==="u32"?l[0].format=O.u32:c.typeInfo.format.name==="bool"?l[0].format=O.bool:console.error(`TODO: impelement template format type ${c.typeInfo.format.name}`)),s=this._updateNode(new Ie(c,l[0])),this._exec.context.setVariable(n.toString(),c)}catch{s=o}if(i!==null&&s instanceof Ie){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof Ie&&(i=(e=s==null?void 0:s.type)!==null&&e!==void 0?e:O.f32,i===O.x32&&(i=O.i32));const a=this._updateNode(new Qo(n.toString(),i,"","",s),r);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(v.keywords.let))return null;const e=this._currentLine,n=this._consume(v.tokens.name,"Expected variable name");let r=null;if(this._match(v.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(v.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof Ie){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof Ie&&(r=i.type.name==="x32"?O.i32:i.type);return i instanceof Ie&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new ls(n.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(v.keywords.var))return null;const e=this._currentLine;let n="",r="";this._match(v.tokens.less_than)&&(n=this._consume(v.storage_class,"Expected storage_class.").toString(),this._match(v.tokens.comma)&&(r=this._consume(v.access_mode,"Expected access_mode.").toString()),this._consume(v.tokens.greater_than,"Expected '>'."));const i=this._consume(v.tokens.name,"Expected variable name");let s=null;if(this._match(v.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new on(i.toString(),s,n,r,null),e)}_override_decl(){if(!this._match(v.keywords.override))return null;const e=this._consume(v.tokens.name,"Expected variable name");let n=null;if(this._match(v.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return this._updateNode(new Yh(e.toString(),n,null))}_diagnostic(){this._consume(v.tokens.paren_left,"Expected '('");const e=this._consume(v.tokens.ident,"Expected severity control name.");this._consume(v.tokens.comma,"Expected ','");let n=this._consume(v.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(v.tokens.period)&&(n+=`.${this._consume(v.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(v.tokens.paren_right,"Expected ')'"),this._updateNode(new Zv(e.toString(),n))}_enable_directive(){const e=this._consume(v.tokens.ident,"identity expected.");return this._updateNode(new TS(e.toString()))}_requires_directive(){const e=[this._consume(v.tokens.ident,"identity expected.").toString()];for(;this._match(v.tokens.comma);){const n=this._consume(v.tokens.ident,"identity expected.");e.push(n.toString())}return this._updateNode(new xS(e))}_type_alias(){const e=this._consume(v.tokens.ident,"identity expected.");this._consume(v.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=this._updateNode(new qh(e.toString(),n));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([v.tokens.ident,...v.texel_format,v.keywords.bool,v.keywords.f32,v.keywords.i32,v.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new ag(r));return this._forwardTypeCount++,i}return this._updateNode(new O(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(v.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(v.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(v.tokens.comma)&&(s=this._consume(v.access_mode,"Expected access_mode for pointer").toString()),this._consume(v.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new I(r,i,s))}if(this._match(v.keywords.ptr)){let r=this._previous().toString();this._consume(v.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(v.storage_class,"Expected storage_class for pointer");this._consume(v.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(v.tokens.comma)&&(o=this._consume(v.access_mode,"Expected access_mode for pointer").toString()),this._consume(v.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Jo(r,i.toString(),s,o))}const n=this._attribute();if(this._match(v.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(v.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let l="";if(this._match(v.tokens.comma)){o=this._shift_expression();try{l=o.constEvaluate(this._exec).toString(),o=null}catch{l="1"}}this._consume(v.tokens.greater_than,"Expected '>' for array."),i=l?parseInt(l):0}const a=this._updateNode(new cs(s.toString(),n,r,i));return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(v.sampler_type))return this._updateNode(new Yi(this._previous().toString(),null,null));if(this._match(v.depth_texture_type))return this._updateNode(new Yi(this._previous().toString(),null,null));if(this._match(v.sampled_texture_type)||this._match(v.multisampled_texture_type)){const e=this._previous();this._consume(v.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(v.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Yi(e.toString(),n,null))}if(this._match(v.storage_texture_type)){const e=this._previous();this._consume(v.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(v.texel_format,"Invalid texel format.").toString();this._consume(v.tokens.comma,"Expected ',' after texel format.");const r=this._consume(v.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(v.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Yi(e.toString(),n,r))}return null}_attribute(){let e=[];for(;this._match(v.tokens.attr);){const n=this._consume(v.attribute_name,"Expected attribute name"),r=this._updateNode(new s0(n.toString(),null));if(this._match(v.tokens.paren_left)){if(r.value=this._consume(v.literal_or_ident,"Expected attribute value").toString(),this._check(v.tokens.comma)){this._advance();do{const i=this._consume(v.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(v.tokens.comma))}this._consume(v.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class LS extends Zt{constructor(e){super(),e&&this.update(e)}update(e){const n=new US().parse(e);this.updateAST(n)}}function VS(t){var s;const e={attributes:[],bindings:[]};let n;try{n=$S(t)}catch(o){return N.error(o.message)(),e}for(const o of n.uniforms){const a=[];for(const l of((s=o.type)==null?void 0:s.members)||[])a.push({name:l.name,type:hg(l.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:a})}for(const o of n.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of n.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const a=r.inputs[o];if(a.locationType==="location"){const l=hg(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:l})}}return e}function hg(t){return t!=null&&t.format?`${t.name}<${t.format.name}>`:t.name}function $S(t){try{return new LS(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const zS={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...zS}};const St=globalThis.mathgl.config;function jS(t,{precision:e=St.precision}={}){return t=WS(t),`${parseFloat(t.toPrecision(e))}`}function yi(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ft(t,e,n){return XS(t,r=>Math.max(e,Math.min(n,r)))}function Xa(t,e,n){return yi(t)?t.map((r,i)=>Xa(r,e[i],n)):n*e+(1-n)*t}function Bs(t,e,n){const r=St.EPSILON;try{if(t===e)return!0;if(yi(t)&&yi(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Bs(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=St.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{St.EPSILON=r}}function WS(t){return Math.round(t/St.EPSILON)*St.EPSILON}function HS(t){return t.clone?t.clone():new Array(t.length)}function XS(t,e,n){if(yi(t)){const r=t;n=n||HS(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class o0 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:yi(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(St)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+jS(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Bs(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(St.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function YS(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function ct(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Ic(t,e,n=""){if(St.debug&&!YS(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function dg(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class KS extends o0{get x(){return this[0]}set x(e){this[0]=ct(e)}get y(){return this[1]}set y(e){this[1]=ct(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return ct(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return ct(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return dg(e>=0&&e<this.ELEMENTS,"index is out of range"),ct(this[e])}setComponent(e,n){return dg(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const ea=1e-6;let vi=typeof Float32Array<"u"?Float32Array:Array;function qS(){const t=new vi(2);return vi!=Float32Array&&(t[0]=0,t[1]=0),t}function pg(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function ZS(t,e){return t[0]=-e[0],t[1]=-e[1],t}function a0(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function QS(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=qS();return function(e,n,r,i,s,o){let a,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function JS(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function l0(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function GS(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function eE(){const t=new vi(3);return vi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function tE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function nE(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function rE(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function iE(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=i*l-s*a,t[1]=s*o-r*l,t[2]=r*a-i*o,t}function c0(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function sE(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function oE(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2];let u=i*c-s*l,f=s*a-r*c,h=r*l-i*a,d=i*h-s*f,y=s*u-r*h,w=r*f-i*u;const x=o*2;return u*=x,f*=x,h*=x,d*=2,y*=2,w*=2,t[0]=a+u+d,t[1]=l+f+y,t[2]=c+h+w,t}function aE(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function lE(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function cE(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function uE(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+a*a)),c=l&&rE(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}const fE=tE;(function(){const t=eE();return function(e,n,r,i,s,o){let a,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Pc=[0,0,0];let Io;class Gt extends KS{static get ZERO(){return Io||(Io=new Gt(0,0,0),Object.freeze(Io)),Io}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&yi(e)?this.copy(e):(St.debug&&(ct(e),ct(n),ct(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return St.debug&&(ct(e.x),ct(e.y),ct(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ct(e)}angle(e){return uE(this,e)}cross(e){return iE(this,this,e),this.check()}rotateX({radians:e,origin:n=Pc}){return aE(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Pc}){return lE(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Pc}){return cE(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return c0(this,this,e),this.check()}transformAsVector(e){return l0(this,this,e),this.check()}transformByMatrix3(e){return sE(this,this,e),this.check()}transformByMatrix2(e){return GS(this,this,e),this.check()}transformByQuaternion(e){return oE(this,this,e),this.check()}}class hE extends o0{toString(){let e="[";if(St.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=ct(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function dE(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pE(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function df(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],d=e[11],y=e[12],w=e[13],x=e[14],m=e[15],_=n*a-r*o,g=n*l-i*o,T=n*c-s*o,C=r*l-i*a,S=r*c-s*a,M=i*c-s*l,k=u*w-f*y,F=u*x-h*y,D=u*m-d*y,L=f*x-h*w,z=f*m-d*w,H=h*m-d*x;let W=_*H-g*z+T*L+C*D-S*F+M*k;return W?(W=1/W,t[0]=(a*H-l*z+c*L)*W,t[1]=(i*z-r*H-s*L)*W,t[2]=(w*M-x*S+m*C)*W,t[3]=(h*S-f*M-d*C)*W,t[4]=(l*D-o*H-c*F)*W,t[5]=(n*H-i*D+s*F)*W,t[6]=(x*T-y*M-m*g)*W,t[7]=(u*M-h*T+d*g)*W,t[8]=(o*z-a*D+c*k)*W,t[9]=(r*D-n*z-s*k)*W,t[10]=(y*S-w*T+m*_)*W,t[11]=(f*T-u*S-d*_)*W,t[12]=(a*F-o*L-l*k)*W,t[13]=(n*L-r*F+i*k)*W,t[14]=(w*g-y*C-x*_)*W,t[15]=(u*C-f*g+h*_)*W,t):null}function gE(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11],d=t[12],y=t[13],w=t[14],x=t[15],m=e*o-n*s,_=e*a-r*s,g=n*a-r*o,T=c*y-u*d,C=c*w-f*d,S=u*w-f*y,M=e*S-n*C+r*T,k=s*S-o*C+a*T,F=c*g-u*_+f*m,D=d*g-y*_+w*m;return l*M-i*k+x*F-h*D}function lr(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=e[9],d=e[10],y=e[11],w=e[12],x=e[13],m=e[14],_=e[15];let g=n[0],T=n[1],C=n[2],S=n[3];return t[0]=g*r+T*a+C*f+S*w,t[1]=g*i+T*l+C*h+S*x,t[2]=g*s+T*c+C*d+S*m,t[3]=g*o+T*u+C*y+S*_,g=n[4],T=n[5],C=n[6],S=n[7],t[4]=g*r+T*a+C*f+S*w,t[5]=g*i+T*l+C*h+S*x,t[6]=g*s+T*c+C*d+S*m,t[7]=g*o+T*u+C*y+S*_,g=n[8],T=n[9],C=n[10],S=n[11],t[8]=g*r+T*a+C*f+S*w,t[9]=g*i+T*l+C*h+S*x,t[10]=g*s+T*c+C*d+S*m,t[11]=g*o+T*u+C*y+S*_,g=n[12],T=n[13],C=n[14],S=n[15],t[12]=g*r+T*a+C*f+S*w,t[13]=g*i+T*l+C*h+S*x,t[14]=g*s+T*c+C*d+S*m,t[15]=g*o+T*u+C*y+S*_,t}function Ya(t,e,n){const r=n[0],i=n[1],s=n[2];let o,a,l,c,u,f,h,d,y,w,x,m;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],f=e[5],h=e[6],d=e[7],y=e[8],w=e[9],x=e[10],m=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=f,t[6]=h,t[7]=d,t[8]=y,t[9]=w,t[10]=x,t[11]=m,t[12]=o*r+u*i+y*s+e[12],t[13]=a*r+f*i+w*s+e[13],t[14]=l*r+h*i+x*s+e[14],t[15]=c*r+d*i+m*s+e[15]),t}function td(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function mE(t,e,n,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),l,c,u,f,h,d,y,w,x,m,_,g,T,C,S,M,k,F,D,L,z,H,W,re;return a<ea?null:(a=1/a,i*=a,s*=a,o*=a,c=Math.sin(n),l=Math.cos(n),u=1-l,f=e[0],h=e[1],d=e[2],y=e[3],w=e[4],x=e[5],m=e[6],_=e[7],g=e[8],T=e[9],C=e[10],S=e[11],M=i*i*u+l,k=s*i*u+o*c,F=o*i*u-s*c,D=i*s*u-o*c,L=s*s*u+l,z=o*s*u+i*c,H=i*o*u+s*c,W=s*o*u-i*c,re=o*o*u+l,t[0]=f*M+w*k+g*F,t[1]=h*M+x*k+T*F,t[2]=d*M+m*k+C*F,t[3]=y*M+_*k+S*F,t[4]=f*D+w*L+g*z,t[5]=h*D+x*L+T*z,t[6]=d*D+m*L+C*z,t[7]=y*D+_*L+S*z,t[8]=f*H+w*W+g*re,t[9]=h*H+x*W+T*re,t[10]=d*H+m*W+C*re,t[11]=y*H+_*W+S*re,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function u0(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=o*i+u*r,t[6]=a*i+f*r,t[7]=l*i+h*r,t[8]=c*i-s*r,t[9]=u*i-o*r,t[10]=f*i-a*r,t[11]=h*i-l*r,t}function _E(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=o*i-u*r,t[2]=a*i-f*r,t[3]=l*i-h*r,t[8]=s*r+c*i,t[9]=o*r+u*i,t[10]=a*r+f*i,t[11]=l*r+h*i,t}function f0(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=o*i+u*r,t[2]=a*i+f*r,t[3]=l*i+h*r,t[4]=c*i-s*r,t[5]=u*i-o*r,t[6]=f*i-a*r,t[7]=h*i-l*r,t}function yE(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,c=n*o,u=r*o,f=r*a,h=i*o,d=i*a,y=i*l,w=s*o,x=s*a,m=s*l;return t[0]=1-f-y,t[1]=u+m,t[2]=h-x,t[3]=0,t[4]=u-m,t[5]=1-c-y,t[6]=d+w,t[7]=0,t[8]=h+x,t[9]=d-w,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vE(t,e,n,r,i,s,o){const a=1/(n-e),l=1/(i-r),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function wE(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const bE=wE;function TE(t,e,n,r,i,s,o){const a=1/(e-n),l=1/(r-i),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(o+s)*c,t[15]=1,t}const xE=TE;function SE(t,e,n,r){let i,s,o,a,l,c,u,f,h,d;const y=e[0],w=e[1],x=e[2],m=r[0],_=r[1],g=r[2],T=n[0],C=n[1],S=n[2];return Math.abs(y-T)<ea&&Math.abs(w-C)<ea&&Math.abs(x-S)<ea?dE(t):(f=y-T,h=w-C,d=x-S,i=1/Math.sqrt(f*f+h*h+d*d),f*=i,h*=i,d*=i,s=_*d-g*h,o=g*f-m*d,a=m*h-_*f,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),l=h*a-d*o,c=d*s-f*a,u=f*o-h*s,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),t[0]=s,t[1]=l,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=h,t[7]=0,t[8]=a,t[9]=u,t[10]=d,t[11]=0,t[12]=-(s*y+o*w+a*x),t[13]=-(l*y+c*w+u*x),t[14]=-(f*y+h*w+d*x),t[15]=1,t)}function EE(){const t=new vi(4);return vi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function AE(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Qs(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=EE();return function(e,n,r,i,s,o){let a,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var pf;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(pf||(pf={}));const RE=45*Math.PI/180,CE=1,kc=.1,Mc=500,IE=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class $t extends hE{static get IDENTITY(){return kE()}static get ZERO(){return PE()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return pf}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,l,c,u,f,h,d,y,w,x){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=d,this[13]=y,this[14]=w,this[15]=x,this.check()}setRowMajor(e,n,r,i,s,o,a,l,c,u,f,h,d,y,w,x){return this[0]=e,this[1]=s,this[2]=c,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=y,this[8]=r,this[9]=a,this[10]=f,this[11]=w,this[12]=i,this[13]=l,this[14]=h,this[15]=x,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(IE)}fromObject(e){return this.check()}fromQuaternion(e){return yE(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=kc,far:a=Mc}=e;return a===1/0?ME(this,n,r,i,s,o):vE(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return SE(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=kc,far:a=Mc}=e;return xE(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=RE,aspect:r=CE,focalDistance:i=1,near:s=kc,far:o=Mc}=e;gg(n);const a=n/2,l=i*Math.tan(a),c=l*r;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return gg(n),bE(this,n,r,i,s),this.check()}determinant(){return gE(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return pE(this,this),this.check()}invert(){return df(this,this),this.check()}multiplyLeft(e){return lr(this,e,this),this.check()}multiplyRight(e){return lr(this,this,e),this.check()}rotateX(e){return u0(this,this,e),this.check()}rotateY(e){return _E(this,this,e),this.check()}rotateZ(e){return f0(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return mE(this,this,e,n),this.check()}scale(e){return td(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Ya(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Qs(n||[-0,-0,-0,-0],e,this),Ic(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=QS(n||[-0,-0],e,this);break;case 3:i=c0(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ic(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=JS(n||[-0,-0],e,this);break;case 3:r=l0(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ic(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let Po,ko;function PE(){return Po||(Po=new $t([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Po)),Po}function kE(){return ko||(ko=new $t,Object.freeze(ko)),ko}function gg(t){if(t>Math.PI*2)throw Error("expected radians")}function ME(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),l=(n+e)/(n-e),c=(i+r)/(i-r),u=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}function h0(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function OE(t){return t-Math.fround(t)}function NE(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;h0(t[r*4+n],e,i*2)}return e}const DE=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,FE={name:"fp32",vs:DE},BE=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,UE={ONE:1},LE={name:"fp64arithmetic",vs:BE,defaultUniforms:UE,uniformTypes:{ONE:"f32"},fp64ify:h0,fp64LowPart:OE,fp64ifyMatrix4:NE},VE=[0,1,1,1],$E=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,zE=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,mg={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:VE},vs:$E,fs:zE,getUniforms:jE};function jE(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const _g=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,WE=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,HE=5,XE=255;var Us;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(Us||(Us={}));const us={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Us.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:WE,vs:_g,fs:_g,getUniforms:YE};function YE(t,e={}){if(t=t&&{...t},!t)return{...us.defaultUniforms};t.lights&&(t={...t,...qE(t.lights),lights:void 0});const{ambientLight:n,pointLights:r,directionalLights:i}=t||{};if(!(n||r&&r.length>0||i&&i.length>0))return{...us.defaultUniforms,enabled:0};const o={...us.defaultUniforms,...e,...KE({ambientLight:n,pointLights:r,directionalLights:i})};return t.enabled!==void 0&&(o.enabled=t.enabled?1:0),o}function KE({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const r={};r.ambientColor=Oc(t);let i=0;for(const s of e){r.lightType=Us.POINT;const o=i;r[`lightColor${o}`]=Oc(s),r[`lightPosition${o}`]=s.position,r[`lightAttenuation${o}`]=s.attenuation||[1,0,0],i++}for(const s of n){r.lightType=Us.DIRECTIONAL;const o=i;r[`lightColor${o}`]=Oc(s),r[`lightDirection${o}`]=s.direction,i++}return i>HE&&N.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=n.length,r.pointLightCount=e.length,r}function qE(t){var n,r;const e={pointLights:[],directionalLights:[]};for(const i of t||[])switch(i.type){case"ambient":e.ambientLight=i;break;case"directional":(n=e.directionalLights)==null||n.push(i);break;case"point":(r=e.pointLights)==null||r.push(i);break}return e}function Oc(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(r=>r*n/XE)}const d0=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,p0=`#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,g0=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,m0={props:{},name:"gouraudMaterial",vs:p0.replace("phongMaterial","gouraudMaterial"),fs:d0.replace("phongMaterial","gouraudMaterial"),source:g0.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[us],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(n=>n/255)),{...m0.defaultUniforms,...e}}},_0={name:"phongMaterial",dependencies:[us],source:g0,vs:d0,fs:p0,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(n=>n/255)),{..._0.defaultUniforms,...e}}},yg=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,ZE={name:"layer",vs:yg,fs:yg,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},QE=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,JE={name:"color",dependencies:[],source:QE,getUniforms:t=>({}),uniformTypes:{opacity:"f32"}},GE=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,y0="#define SMOOTH_EDGE_RADIUS 0.5",eA=`${y0}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,tA=`${y0}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,v0={name:"geometry",source:GE,vs:eA,fs:tA},nA=25;var Re;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(Re||(Re={}));var Pe;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(Pe||(Pe={}));var K;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(K||(K={}));const rA="compute",iA="auto",gf="manipulation",ta="none",mf="pan-x",_f="pan-y";function sA(t){if(t.includes(ta))return ta;const e=t.includes(mf),n=t.includes(_f);return e&&n?ta:e||n?e?mf:_f:t.includes(gf)?gf:iA}class oA{constructor(e,n){this.actions="",this.manager=e,this.set(n)}set(e){e===rA&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const n of this.manager.recognizers)n.options.enable&&(e=e.concat(n.getTouchAction()));return sA(e.join(" "))}}function Ka(t){return t.trim().split(/\s+/g)}function Nc(t,e,n){if(t)for(const r of Ka(e))t.addEventListener(r,n,!1)}function Dc(t,e,n){if(t)for(const r of Ka(e))t.removeEventListener(r,n,!1)}function vg(t){return(t.ownerDocument||t).defaultView}function aA(t,e){let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function w0(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let n=0,r=0,i=0;for(;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:Math.round(n/e),y:Math.round(r/e)}}function wg(t){const e=[];let n=0;for(;n<t.pointers.length;)e[n]={clientX:Math.round(t.pointers[n].clientX),clientY:Math.round(t.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:e,center:w0(e),deltaX:t.deltaX,deltaY:t.deltaY}}function b0(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function bg(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(n*n+r*r)}function lA(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)*180/Math.PI}function Tg(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.atan2(r,n)*180/Math.PI}function T0(t,e){return t===e?Pe.None:Math.abs(t)>=Math.abs(e)?t<0?Pe.Left:Pe.Right:e<0?Pe.Up:Pe.Down}function cA(t,e){const n=e.center;let r=t.offsetDelta,i=t.prevDelta;const s=t.prevInput;return(e.eventType===Re.Start||(s==null?void 0:s.eventType)===Re.End)&&(i=t.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},r=t.offsetDelta={x:n.x,y:n.y}),{deltaX:i.x+(n.x-r.x),deltaY:i.y+(n.y-r.y)}}function x0(t,e,n){return{x:e/t||0,y:n/t||0}}function uA(t,e){return bg(e[0],e[1])/bg(t[0],t[1])}function fA(t,e){return Tg(e[1],e[0])-Tg(t[1],t[0])}function hA(t,e){const n=t.lastInterval||e,r=e.timeStamp-n.timeStamp;let i,s,o,a;if(e.eventType!==Re.Cancel&&(r>nA||n.velocity===void 0)){const l=e.deltaX-n.deltaX,c=e.deltaY-n.deltaY,u=x0(r,l,c);s=u.x,o=u.y,i=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=T0(l,c),t.lastInterval=e}else i=n.velocity,s=n.velocityX,o=n.velocityY,a=n.direction;e.velocity=i,e.velocityX=s,e.velocityY=o,e.direction=a}function dA(t,e){const{session:n}=t,{pointers:r}=e,{length:i}=r;n.firstInput||(n.firstInput=wg(e)),i>1&&!n.firstMultiple?n.firstMultiple=wg(e):i===1&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=n,a=o?o.center:s.center,l=e.center=w0(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=lA(a,l),e.distance=b0(a,l);const{deltaX:c,deltaY:u}=cA(n,e);e.deltaX=c,e.deltaY=u,e.offsetDirection=T0(e.deltaX,e.deltaY);const f=x0(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=f.x,e.overallVelocityY=f.y,e.overallVelocity=Math.abs(f.x)>Math.abs(f.y)?f.x:f.y,e.scale=o?uA(o.pointers,r):1,e.rotation=o?fA(o.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length;let h=t.element;return aA(e.srcEvent.target,h)&&(h=e.srcEvent.target),e.target=h,hA(n,e),e}function pA(t,e,n){const r=n.pointers.length,i=n.changedPointers.length,s=e&Re.Start&&r-i===0,o=e&(Re.End|Re.Cancel)&&r-i===0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e;const a=dA(t,n);t.emit("hammer.input",a),t.recognize(a),t.session.prevInput=a}let gA=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=n=>{this.manager.options.enable&&this.handler(n)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,n){pA(this.manager,e,n)}init(){Nc(this.element,this.evEl,this.domHandler),Nc(this.target,this.evTarget,this.domHandler),Nc(vg(this.element),this.evWin,this.domHandler)}destroy(){Dc(this.element,this.evEl,this.domHandler),Dc(this.target,this.evTarget,this.domHandler),Dc(vg(this.element),this.evWin,this.domHandler)}};const mA={pointerdown:Re.Start,pointermove:Re.Move,pointerup:Re.End,pointercancel:Re.Cancel,pointerout:Re.Cancel},_A="pointerdown",yA="pointermove pointerup pointercancel";class vA extends gA{constructor(e){super(e),this.evEl=_A,this.evWin=yA,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:n}=this;let r=!1;const i=mA[e.type],s=e.pointerType,o=s==="touch";let a=n.findIndex(l=>l.pointerId===e.pointerId);i&Re.Start&&(e.buttons||o)?a<0&&(n.push(e),a=n.length-1):i&(Re.End|Re.Cancel)&&(r=!0),!(a<0)&&(n[a]=e,this.callback(i,{pointers:n,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&n.splice(a,1))}}const wA=["","webkit","Moz","MS","ms","o"];function bA(t,e){const n=e[0].toUpperCase()+e.slice(1);for(const r of wA){const i=r?r+n:e;if(i in t)return i}}const TA=1,xg=2,Sg={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class xA{constructor(e,n){this.options={...Sg,...n,cssProps:{...Sg.cssProps,...n.cssProps},inputTarget:n.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new vA(this),this.touchAction=new oA(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?xg:TA}recognize(e){const{session:n}=this;if(n.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=n;(!s||s&&s.state&K.Recognized)&&(s=n.curRecognizer=null);let o=0;for(;o<i.length;)r=i[o],n.stopped!==xg&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(K.Began|K.Changed|K.Ended)&&(s=n.curRecognizer=r),o++}get(e){const{recognizers:n}=this;for(let r=0;r<n.length;r++)if(n[r].options.event===e)return n[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const n=this.get(e.options.event);return n&&this.remove(n),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const n=typeof e=="string"?this.get(e):e;if(n){const{recognizers:r}=this,i=r.indexOf(n);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,n){if(!e||!n)return;const{handlers:r}=this;for(const i of Ka(e))r[i]=r[i]||[],r[i].push(n)}off(e,n){if(!e)return;const{handlers:r}=this;for(const i of Ka(e))n?r[i]&&r[i].splice(r[i].indexOf(n),1):delete r[i]}emit(e,n){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=n;i.type=e,i.preventDefault=function(){n.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:n}=this;if(n){for(const[r,i]of Object.entries(this.options.cssProps)){const s=bA(n.style,r);e?(this.oldCssProps[s]=n.style[s],n.style[s]=i):n.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let SA=1;function EA(){return SA++}function Eg(t){return t&K.Cancelled?"cancel":t&K.Ended?"end":t&K.Changed?"move":t&K.Began?"start":""}class S0{constructor(e){this.options=e,this.id=EA(),this.state=K.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{simultaneous:r}=this;return r[n.id]||(r[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let n;return typeof e=="string"?n=this.manager.get(e):n=e,n&&delete this.simultaneous[n.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{requireFail:r}=this;return r.indexOf(n)===-1&&(r.push(n),n.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let n;if(typeof e=="string"?n=this.manager.get(e):n=e,n){const r=this.requireFail.indexOf(n);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:n}=this;n<K.Ended&&this.manager.emit(this.options.event+Eg(n),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),n>=K.Ended&&this.manager.emit(this.options.event+Eg(n),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=K.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(K.Failed|K.Possible)))return!1;e++}return!0}recognize(e){const n={...e};if(!this.options.enable){this.reset(),this.state=K.Failed;return}this.state&(K.Recognized|K.Cancelled|K.Failed)&&(this.state=K.Possible),this.state=this.process(n),this.state&(K.Began|K.Changed|K.Ended|K.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class E0 extends S0{attrTest(e){const n=this.options.pointers;return n===0||e.pointers.length===n}process(e){const{state:n}=this,{eventType:r}=e,i=n&(K.Began|K.Changed),s=this.attrTest(e);return i&&(r&Re.Cancel||!s)?n|K.Cancelled:i||s?r&Re.End?n|K.Ended:n&K.Began?n|K.Changed:K.Began:K.Failed}}class Ag extends S0{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[gf]}process(e){const{options:n}=this,r=e.pointers.length===n.pointers,i=e.distance<n.threshold,s=e.deltaTime<n.time;if(this.reset(),e.eventType&Re.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==Re.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<n.interval:!0,a=!this.pCenter||b0(this.pCenter,e.center)<n.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!o?this.count=1:this.count+=1,this._input=e,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=K.Recognized,this.tryEmit(this._input)},n.interval),K.Began):K.Recognized}return K.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=K.Failed},this.options.interval),K.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===K.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const AA=["","start","move","end","cancel","up","down","left","right"];class Rg extends E0{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Pe.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,n=[];return e&Pe.Horizontal&&n.push(_f),e&Pe.Vertical&&n.push(mf),n}getEventNames(){return AA.map(e=>this.options.event+e)}directionTest(e){const{options:n}=this;let r=!0,{distance:i}=e,{direction:s}=e;const o=e.deltaX,a=e.deltaY;return s&n.direction||(n.direction&Pe.Horizontal?(s=o===0?Pe.None:o<0?Pe.Left:Pe.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(s=a===0?Pe.None:a<0?Pe.Up:Pe.Down,r=a!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>n.threshold&&!!(s&n.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&K.Began)||!(this.state&K.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const n=Pe[e.direction].toLowerCase();n&&(e.additionalEvent=this.options.event+n),super.emit(e)}}const RA=["","start","move","end","cancel","in","out"];class CA extends E0{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[ta]}getEventNames(){return RA.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&K.Began))}emit(e){if(e.scale!==1){const n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}super.emit(e)}}class Fl{constructor(e,n,r){this.element=e,this.callback=n,this.options=r}}const IA=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",PA=IA.indexOf("firefox")!==-1,Cg=4.000244140625,kA=40,MA=.25;class OA extends Fl{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(PA&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=kA)),s!==0&&s%Cg===0&&(s=Math.floor(s/Cg)),i.shiftKey&&s&&(s=s*MA),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,n){e==="wheel"&&(this.options.enable=n)}}const Ig=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class NA extends Fl{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,Ig.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){Ig.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){switch(e){case"pointermove":this.enableMoveEvent=n;break;case"pointerover":this.enableOverEvent=n;break;case"pointerout":this.enableOutEvent=n;break;case"pointerenter":this.enableEnterEvent=n;break;case"pointerleave":this.enableLeaveEvent=n;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const Pg=["keydown","keyup"];class DA extends Fl{constructor(e,n,r){super(e,n,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Pg.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){Pg.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e==="keydown"&&(this.enableDownEvent=n),e==="keyup"&&(this.enableUpEvent=n)}}class FA extends Fl{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e==="contextmenu"&&(this.options.enable=n)}}const kg=1,yf=2,Mg=4,BA={pointerdown:kg,pointermove:yf,pointerup:Mg,mousedown:kg,mousemove:yf,mouseup:Mg},UA=0,LA=1,VA=2,$A=1,zA=2,jA=4;function WA(t){const e=BA[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===yf?(i=!!(n&$A),s=!!(n&jA),o=!!(n&zA)):(i=r===UA,s=r===LA,o=r===VA),{leftButton:i,middleButton:s,rightButton:o}}function HA(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const XA={srcElement:"root",priority:0};class YA{constructor(e,n){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=n,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this,l={...XA,...r};let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let l=0;l<r.length;l++){const{type:c,handler:u,once:f}=r[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(r[l]),i)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...WA(e),...HA(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}function KA(t){if("recognizer"in t)return t;let e;const n=Array.isArray(t)?[...t]:[t];if(typeof n[0]=="function"){const r=n.shift(),i=n.shift()||{};e=new r(i)}else e=n.shift();return{recognizer:e,recognizeWith:typeof n[0]=="string"?[n[0]]:n[0],requireFailure:typeof n[1]=="string"?[n[1]]:n[1]}}class qA{constructor(e=null,n={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...n},this.events=new Map,this.element=e,!!e){this.manager=new xA(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:o}=KA(r);this.manager.add(i),s&&i.recognizeWith(s),o&&i.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new OA(e,this._onOtherEvent,{enable:!1}),this.moveInput=new NA(e,this._onOtherEvent,{enable:!1}),this.keyInput=new DA(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new FA(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){var s,o,a,l;const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:n}),r.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,n),(o=this.moveInput)==null||o.enableEventType(e,n),(a=this.keyInput)==null||a.enableEventType(e,n),(l=this.contextmenuInput)==null||l.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const[c,u]of Object.entries(e))this._addEventHandler(c,u,r,i,s);return}const{manager:o,events:a}=this;if(!o)return;let l=a.get(e);if(!l){const c=this._getRecognizerName(e)||e;l=new YA(this,c),a.set(e,l),o&&o.on(e,l.handleEvent)}l.add(e,n,r,i,s),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,n),i.isEmpty())){const{recognizerName:s}=i;let o=!1;for(const a of r.values())if(a.recognizerName===s&&!a.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var n;return(n=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:n.options.event}}const J={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(J,"IDENTITY",{get:()=>(se.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const wt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ls={common:0,meters:1,pixels:2},vf={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Og={multipan:[Rg,{threshold:10,direction:Pe.Vertical,pointers:2}],pinch:[CA,{},null,["multipan"]],pan:[Rg,{threshold:1},["pinch"],["multipan"]],dblclick:[Ag,{event:"dblclick",taps:2}],click:[Ag,{event:"click"},null,["dblclick"]]};function ZA(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Js(t){let e={},n;return r=>{for(const i in r)if(!ZA(r[i],e[i])){n=t(r),e=r;break}return n}}const Ng=[0,0,0,0],QA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],A0=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],JA=[0,0,0],R0=[0,0,0],GA=Js(nR);function C0(t,e,n=R0){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===J.LNGLAT_OFFSETS||e===J.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case wt.WEB_MERCATOR:(e===J.LNGLAT||e===J.CARTESIAN)&&(i=[0,0,0],s=!1);break;case wt.WEB_MERCATOR_AUTO_OFFSET:e===J.LNGLAT?r=i:e===J.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case wt.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case wt.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function eR(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=Ng,l=Ng,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=C0(t,e,n);return h&&(l=t.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Qs([],l,o),s=r||s,o=lr([],i,s),o=lr([],o,QA)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function tR({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=J.DEFAULT,coordinateOrigin:i=R0,autoWrapLongitude:s=!1}){r===J.DEFAULT&&(r=t.isGeospatial?J.LNGLAT:J.CARTESIAN);const o=GA({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=n||A0,o}function nR({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=eR(t,n,r),u=t.getDistanceScales(),f=[t.width*e,t.height*e],h=Qs([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:l,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:f,devicePixelRatio:e,focalDistance:h,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:JA,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:A0,cameraPosition:a};if(c){const y=t.getDistanceScales(c);switch(n){case J.METER_OFFSETS:d.commonUnitsPerWorldUnit=y.unitsPerMeter,d.commonUnitsPerWorldUnit2=y.unitsPerMeter2;break;case J.LNGLAT:case J.LNGLAT_OFFSETS:t._pseudoMeters||(d.commonUnitsPerMeter=y.unitsPerMeter),d.commonUnitsPerWorldUnit=y.unitsPerDegree,d.commonUnitsPerWorldUnit2=y.unitsPerDegree2;break;case J.CARTESIAN:d.commonUnitsPerWorldUnit=[1,1,y.unitsPerMeter[2]],d.commonUnitsPerWorldUnit2=[0,0,y.unitsPerMeter2[2]];break}}return d}const rR=Object.keys(J).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${J[t]};`).join(""),iR=Object.keys(wt).map(t=>`const PROJECTION_MODE_${t}: i32 = ${wt[t]};`).join(""),sR=Object.keys(Ls).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${Ls[t]};`).join(""),oR=`${rR}
${iR}
${sR}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,aR=`${oR}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,lR=Object.keys(J).map(t=>`const int COORDINATE_SYSTEM_${t} = ${J[t]};`).join(""),cR=Object.keys(wt).map(t=>`const int PROJECTION_MODE_${t} = ${wt[t]};`).join(""),uR=Object.keys(Ls).map(t=>`const int UNIT_${t.toUpperCase()} = ${Ls[t]};`).join(""),fR=`${lR}
${cR}
${uR}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,hR={};function dR(t=hR){return"viewport"in t?tR(t):{}}const nd={name:"project",dependencies:[FE,v0],source:aR,vs:fR,getUniforms:dR,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},pR=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,gR=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,I0={name:"project32",dependencies:[nd],source:pR,vs:gR};function mR(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ai(t,e){const n=Qs([],e,t);return AE(n,n,1/n[3]),n}function Dg(t,e){const n=t%e;return n<0?e+n:n}function wf(t,e,n){return t<e?e:t>n?n:t}function _R(t){return Math.log(t)*Math.LOG2E}const rd=Math.log2||_R;function pn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Bt=Math.PI,P0=Bt/4,Et=Bt/180,bf=180/Bt,wi=512,qa=4003e4,Mo=85.051129,yR=1.5;function vR(t){return rd(t)}function Za(t){const[e,n]=t;pn(Number.isFinite(e)),pn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*Et,i=n*Et,s=wi*(r+Bt)/(2*Bt),o=wi*(Bt+Math.log(Math.tan(P0+i*.5)))/(2*Bt);return[s,o]}function bi(t){const[e,n]=t,r=e/wi*(2*Bt)-Bt,i=2*(Math.atan(Math.exp(n/wi*(2*Bt)-Bt))-P0);return[r*bf,i*bf]}function wR(t){const{latitude:e}=t;pn(Number.isFinite(e));const n=Math.cos(e*Et);return vR(qa*n)-9}function Fc(t){const e=Math.cos(t*Et);return wi/qa/e}function Tf(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;pn(Number.isFinite(e)&&Number.isFinite(n));const i=wi,s=Math.cos(e*Et),o=i/360,a=o/s,l=i/qa/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){const u=Et*Math.tan(e*Et)/s,f=o*u/2,h=i/qa*u,d=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[d,0,d]}return c}function k0(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Tf({longitude:n,latitude:r,highPrecision:!0}),u=Za(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const f=bi(u),h=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[f[0],f[1],h]:f}function bR(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=mR();Ya(a,a,[0,0,-i]),u0(a,a,-n*Et),f0(a,a,r*Et);const l=s/e;return td(a,a,[l,l,l]),o&&Ya(a,a,nE([],o)),a}function TR(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=Qa(yR)}=t;r!==void 0&&(u=Qa(r));const f=u*Et,h=i*Et,d=id(u);let y=d;o&&(y+=o[2]*a/Math.cos(h)/n);const w=f*(.5+(s?s[1]:0)/n),x=Math.sin(w)*y/Math.sin(wf(Math.PI/2-h-w,.01,Math.PI-.01)),m=Math.sin(h)*x+y,_=y*10,g=Math.min(m*c,_);return{fov:f,aspect:e/n,focalDistance:d,near:l,far:g}}function Qa(t){return 2*Math.atan(.5/t)*bf}function id(t){return .5/Math.tan(.5*t*Et)}function M0(t,e){const[n,r,i=0]=t;return pn(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),ai(e,[n,r,i,1])}function Bl(t,e,n=0){const[r,i,s]=t;if(pn(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return ai(e,[r,i,s,1]);const o=ai(e,[r,i,0,1]),a=ai(e,[r,i,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return a0([],o,a,u)}function xR(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=r,f=SR(t.padding),h=Za([a,wf(u,-Mo,Mo)]),d=Za([c,wf(l,-Mo,Mo)]),y=[Math.max(Math.abs(d[0]-h[0]),i),Math.max(Math.abs(d[1]-h[1]),i)],w=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];pn(w[0]>0&&w[1]>0);const x=w[0]/y[0],m=w[1]/y[1],_=(f.right-f.left)/2/x,g=(f.top-f.bottom)/2/m,T=[(d[0]+h[0])/2+_,(d[1]+h[1])/2+g],C=bi(T),S=Math.min(s,rd(Math.abs(Math.min(x,m))));return pn(Number.isFinite(S)),{longitude:C[0],latitude:C[1],zoom:S}}function SR(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(pn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Fg=Math.PI/180;function ER(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let l,c;const u=t.fovy?.5*t.fovy*Fg:Math.atan(.5/t.altitude),f=(90-t.pitch)*Fg;return u>f-.01?(l=Bg(t,0,e),c=Bg(t,n,e)):(l=i([0,0],s),c=i([n,0],s)),[o,a,c,l]}function Bg(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=ai(r,[e,0,1,1]),s=ai(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),l=a0([],i,s,a),c=bi(l);return c.push(n),c}const Ug=512;function AR(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=Dg(i+180,360)-180),(a<-180||a>180)&&(a=Dg(a+180,360)-180);const l=rd(n/Ug);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=bi([0,c])[1];if(s<u)s=u;else{const f=bi([0,Ug-c])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const O0=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,RR=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,CR=`
${O0}
${RR}
`,IR=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,PR=`
${O0}
${IR}
`,kR=Js(FR),MR=Js(BR),OR=[0,0,0,1],NR=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function DR(t,e){const[n,r,i]=t,s=Bl([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function FR({viewport:t,center:e}){return new $t(t.viewProjectionMatrix).invert().transform(e)}function BR({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>DR(o,r));for(const o of e){const a=o.clone().translate(new Gt(t.center).negate()),l=s.map(u=>a.transform(u)),c=new $t().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function UR(t){const{shadowEnabled:e=!0,project:n}=t;if(!e||!n||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r=nd.getUniforms(n),i=kR({viewport:n.viewport,center:r.center}),s=[],o=MR({shadowMatrices:t.shadowMatrices,viewport:n.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const c=o[l],u=c.clone().translate(new Gt(n.viewport.center).negate());r.coordinateSystem===J.LNGLAT&&r.projectionMode===wt.WEB_MERCATOR?(o[l]=u,s[l]=i):(o[l]=c.clone().multiplyRight(NR),s[l]=u.transform(i))}const a={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||OR,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let l=0;l<o.length;l++)a[`viewProjectionMatrix${l}`]=o[l],a[`projectCenter${l}`]=s[l];for(let l=0;l<2;l++)a[`shadow_uShadowMap${l}`]=t.shadowMaps&&t.shadowMaps[l]||t.dummyShadowMap;return a}const Lg={name:"shadow",dependencies:[nd],vs:CR,fs:PR,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:UR,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},N0={...mg,defaultUniforms:{...mg.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},LR=[v0],VR=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],$R=[];function zR(t){const e=Na.getDefaultShaderAssembler();for(const r of LR)e.addDefaultModule(r);e._hookFunctions.length=0;const n=t==="glsl"?VR:$R;for(const r of n)e.addShaderHook(r);return e}const jR=[255,255,255],WR=1;let HR=0;class XR{constructor(e={}){this.type="ambient";const{color:n=jR}=e,{intensity:r=WR}=e;this.id=e.id||`ambient-${HR++}`,this.color=n,this.intensity=r}}const YR=[255,255,255],KR=1,qR=[0,0,-1];let ZR=0;class Vg{constructor(e={}){this.type="directional";const{color:n=YR}=e,{intensity:r=KR}=e,{direction:i=qR}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${ZR++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new Gt(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class QR{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class sd extends QR{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=i?0:!1,l=e.colorMask??15,c={viewport:[0,0,n,r]};e.colorMask&&(c.colorMask=l),e.scissorRect&&(c.scissorRect=e.scissorRect);const u=this.device.beginRenderPass({framebuffer:e.target,parameters:c,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(u,e)}finally{u.end(),this.device.submit()}}_drawLayers(e,n){const{target:r,shaderModuleProps:i,viewports:s,views:o,onViewportActive:a,clearStack:l=!0}=n;n.pass=n.pass||"unknown",l&&(this._lastRenderIndex=-1);const c=[];for(const u of s){const f=o&&o[u.id];a==null||a(u);const h=this._getDrawLayerParams(u,n),d=u.subViewports||[u];for(const y of d){const w=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:y,view:f,pass:n.pass,layers:n.layers},h);c.push(w)}}return c}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,shaderModuleProps:l},c=!1){var y;const u=[],f=D0(this._lastRenderIndex+1),h={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},d={};for(let w=0;w<n.length;w++){const x=n[w],m=this._shouldDrawLayer(x,h,s,d),_={shouldDrawLayer:m};m&&!c&&(_.shouldDrawLayer=!0,_.layerRenderIndex=f(x,m),_.shaderModuleProps=this._getShaderModuleProps(x,a,r,l),_.layerParameters={...(y=x.context.deck)==null?void 0:y.props.parameters,...this.getLayerParameters(x,w,e)}),u[w]=_}return u}_drawLayersInViewport(e,{layers:n,shaderModuleProps:r,pass:i,target:s,viewport:o,view:a},l){const c=JR(this.device,{shaderModuleProps:r,target:s,viewport:o});if(a){const{clear:f,clearColor:h,clearDepth:d,clearStencil:y}=a.props;if(f){let w=[0,0,0,0],x=1,m=0;Array.isArray(h)?w=[...h.slice(0,3),h[3]||255].map(g=>g/255):h===!1&&(w=!1),d!==void 0&&(x=d),y!==void 0&&(m=y),this.device.beginRenderPass({framebuffer:s,parameters:{viewport:c,scissorRect:c},clearColor:w,clearDepth:x,clearStencil:m}).end()}}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let f=0;f<n.length;f++){const h=n[f],d=l[f],{shouldDrawLayer:y}=d;if(y&&h.props.pickable&&u.pickableCount++,h.isComposite&&u.compositeCount++,h.isDrawable&&d.shouldDrawLayer){const{layerRenderIndex:w,shaderModuleProps:x,layerParameters:m}=d;u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,w),x.project&&(x.project.viewport=o),h.context.renderPass=e;try{h._drawLayer({renderPass:e,shaderModuleProps:x,uniforms:{layerIndex:w},parameters:m})}catch(_){h.raiseError(_,`drawing ${h} to ${i}`)}}}return u}shouldDrawLayer(e){return!0}getShaderModuleProps(e,n,r){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getShaderModuleProps(e,n,r,i){var l,c;const s=this.device.canvasContext.cssToDeviceRatio(),o=((l=e.internalState)==null?void 0:l.propsInTransition)||e.props,a={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(n)for(const u of n)$g(a,(c=u.getShaderModuleProps)==null?void 0:c.call(u,e,a));return $g(a,this.getShaderModuleProps(e,n,a),i)}}function D0(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let c;if(l&&!(l in e)&&r(i.parent,!1),l in n){const u=n[l]=n[l]||D0(e[l],e);c=u(i,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return r}function JR(t,{shaderModuleProps:e,target:n,viewport:r}){var l;const i=((l=e==null?void 0:e.project)==null?void 0:l.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i]}function $g(t,...e){for(const n of e)if(n)for(const r in n)t[r]?Object.assign(t[r],n[r]):t[r]=n[r];return t}class GR extends sd{constructor(e,n){super(e,n);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),i=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,n,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const eC={color:[255,255,255],intensity:1},zg=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],tC=[0,0,0,200/255];class F0{constructor(e={}){this.id="lighting-effect",this.shadowColor=tC,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(Lg),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,n){const r=this.shadow?{project:n.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Lg))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new $t().lookAt({eye:new Gt(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new GR(e);this.shadowPasses[n]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new XR(eC),this.directionalLights.push(new Vg(zg[0]),new Vg(zg[1])))}}class nC{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=i||e&&e.constructor||Float32Array,u=n*r+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let f=1/0;l&&(f=l*r+s);const h=this._allocate(c,u,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return r&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const Vs=new nC;function Ki(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function rC(t,e){const n=t%e;return n<0?e+n:n}function iC(t){return[t[12],t[13],t[14]]}function sC(t){return{left:Or(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Or(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Or(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Or(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Or(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Or(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const jg=new Gt;function Or(t,e,n,r){jg.set(t,e,n);const i=jg.len();return{distance:r/i,normal:new Gt(-t/i,-e/i,-n/i)}}function oC(t){return t-Math.fround(t)}let Li;function Bc(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;Li=Vs.allocate(Li,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let l=0;l<n;l++){const c=t[o++];Li[a+l]=c,Li[a+l+n]=oC(c)}a+=n*2}return Li.subarray(0,s*n*2)}function aC(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const lC=Math.PI/180,cC=Ki(),Wg=[0,0,0],uC={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function fC({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const l=t/e,c=n?new $t().orthographic({fovy:r,aspect:l,focalDistance:i,near:o,far:a}):new $t().perspective({fovy:r,aspect:l,near:o,far:a});if(s){const{left:u=0,right:f=0,top:h=0,bottom:d=0}=s,y=ft((u+t-f)/2,0,t)-t/2,w=ft((h+e-d)/2,0,e)-e/2;c[8]-=y*2/t,c[9]+=w*2/e}return c}class Ci{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||uC,this.focalDistance=e.focalDistance||1,this.position=e.position||Wg,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?wt.WEB_MERCATOR:wt.WEB_MERCATOR_AUTO_OFFSET:wt.IDENTITY}equals(e){return e instanceof Ci?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Bs(e.projectionMatrix,this.projectionMatrix)&&Bs(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=M0(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,l=r&&r*this.distanceScales.unitsPerMeter[2],c=Bl([i,a,o],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(r)?[u,f,r]:[u,f]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=Za(e);return n[1]=ft(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?bi(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?Tf({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,sC(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=wR({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Tf({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=Wg;if(s&&(a=o?new $t(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,r,0]);this.center=new Gt(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=cC,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new $t().multiplyRight(n).translate(new Gt(this.center).negate()),this.projectionMatrix=r||fC({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*lC,focalDistance:u,padding:c,near:a,far:l});const f=Ki();lr(f,f,this.projectionMatrix),lr(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=df([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=iC(this.viewMatrixInverse);const h=Ki(),d=Ki();td(h,h,[this.width/2,-this.height/2,1]),Ya(h,h,[1,-1,0]),lr(d,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=df(Ki(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||se.warn("Pixel project matrix not invertible")()}}Ci.displayName="Viewport";class Ti extends Ci{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:f=!1,projectionMatrix:h,repeat:d=!1,worldOffset:y=0,position:w,padding:x,legacyMeterSizes:m=!1}=e;let{width:_,height:g,altitude:T=1.5}=e;const C=Math.pow(2,i);_=_||1,g=g||1;let S,M=null;if(h)T=h[5]/2,S=Qa(T);else{e.fovy?(S=e.fovy,T=id(S)):S=Qa(T);let F;if(x){const{top:D=0,bottom:L=0}=x;F=[0,ft((D+g-L)/2,0,g)-g/2]}M=TR({width:_,height:g,scale:C,center:w&&[0,0,w[2]*Fc(n)],offset:F,pitch:s,fovy:S,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(M.near=c),Number.isFinite(u)&&(M.far=u)}let k=bR({height:g,pitch:s,bearing:o,scale:C,altitude:T});y&&(k=new $t().translate([512*y,0,0]).multiplyLeft(k)),super({...e,width:_,height:g,viewMatrix:k,longitude:r,latitude:n,zoom:i,...M,fovy:S,focalDistance:T}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=T,this.fovy=S,this.orthographic=f,this._subViewports=d?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new Ti({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*Fc(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/Fc(r);return[n,r,i]}addMetersToLngLat(e,n){return k0(e,n)}panByPosition(e,n){const r=Bl(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=pg([],i,ZS([],r)),o=pg([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=ER(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=xR({width:r,height:i,bounds:e,...n});return new Ti({width:r,height:i,longitude:s,latitude:o,zoom:a})}}Ti.displayName="WebMercatorViewport";const Hg=[0,0,0];function Uc(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof Ti){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function hC(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===J.DEFAULT&&(i=e.isGeospatial?J.LNGLAT:J.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function B0(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=Qs([],[o,a,l,1],n)),r){case J.LNGLAT:return Uc([o,a,l],e,s);case J.LNGLAT_OFFSETS:return Uc([o+i[0],a+i[1],l+(i[2]||0)],e,s);case J.METER_OFFSETS:return Uc(k0(i,[o,a,l]),e,s);case J.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],l+i[2]]:e.projectPosition([o,a,l])}}function dC(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=hC(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=Hg,shaderCoordinateOrigin:u=Hg,offsetMode:f=!1}=l?C0(n,r,i):{},h=B0(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:f});if(f){const d=n.projectPosition(c||u);fE(h,h,d)}return h}let pC=1,gC=1;class U0{constructor(){p(this,"time",0);p(this,"channels",new Map);p(this,"animations",new Map);p(this,"playing",!1);p(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=pC++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=gC++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function mC(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function _C(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let yC=0;const hl=class hl{constructor(e){p(this,"device",null);p(this,"canvas",null);p(this,"props");p(this,"animationProps",null);p(this,"timeline",null);p(this,"stats");p(this,"cpuTime");p(this,"gpuTime");p(this,"frameRate");p(this,"display");p(this,"needsRedraw","initialized");p(this,"_initialized",!1);p(this,"_running",!1);p(this,"_animationFrameId",null);p(this,"_nextFramePromise",null);p(this,"_resolveNextFrame",null);p(this,"_cpuStartTime",0);p(this,"_error",null);if(this.props={...hl.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new Ol({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=mC(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(_C(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var n;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(n=this.device)==null||n.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){var i;const e=(i=this.device)==null?void 0:i.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const n=e==null?void 0:e.canvas,r=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:n,useDevicePixels:r,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((s=this.device)==null?void 0:s.getDefaultCanvasContext().getDevicePixelSize())||[1,1];let r=1;const i=(o=this.device)==null?void 0:o.getDefaultCanvasContext().canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}};p(hl,"defaultAnimationLoopProps",{device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:nf.stats.get(`animation-loop-${yC++}`),autoResizeViewport:!1});let xf=hl;const Lc={};function Gs(t="id"){Lc[t]=Lc[t]||1;const e=Lc[t]++;return`${t}-${e}`}class Xg{constructor(e){p(this,"id");p(this,"userData",{});p(this,"topology");p(this,"bufferLayout",[]);p(this,"vertexCount");p(this,"indices");p(this,"attributes");if(this.id=e.id||Gs("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&de.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function vC(t,e){if(e instanceof Xg)return e;const n=wC(t,e),{attributes:r,bufferLayout:i}=bC(t,e);return new Xg({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function wC(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:de.INDEX,data:n})}function bC(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(o){r[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:l,size:c,normalized:u}=o;n.push({name:a,format:dx(l,c,u)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}const dl=class dl{constructor(e){p(this,"device");p(this,"cachingEnabled");p(this,"destroyPolicy");p(this,"debug");p(this,"_hashCounter",0);p(this,"_hashes",{});p(this,"_renderPipelineCache",{});p(this,"_computePipelineCache",{});this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new dl(e),e._lumaData.defaultPipelineFactory}get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}createRenderPipeline(e){var o;if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const n={...ar.defaultProps,...e},r=this._renderPipelineCache,i=this._hashRenderPipeline(n);let s=(o=r[i])==null?void 0:o.pipeline;return s?(r[i].useCount++,this.debug&&N.warn(`${this}: ${r[i].pipeline} reused, count=${r[i].useCount}, (id=${e.id})`)()):(s=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:Gs("unnamed-cached")}),s.hash=i,r[i]={pipeline:s,useCount:1},this.debug&&N.warn(`${this}: ${s} created, count=${r[i].useCount}`)()),s}createComputePipeline(e){var o;if(!this.cachingEnabled)return this.device.createComputePipeline(e);const n={...La.defaultProps,...e},r=this._computePipelineCache,i=this._hashComputePipeline(n);let s=(o=r[i])==null?void 0:o.pipeline;return s?(r[i].useCount++,this.debug&&N.warn(`${this}: ${r[i].pipeline} reused, count=${r[i].useCount}, (id=${e.id})`)()):(s=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0}),s.hash=i,r[i]={pipeline:s,useCount:1},this.debug&&N.warn(`${this}: ${s} created, count=${r[i].useCount}`)()),s}release(e){if(!this.cachingEnabled){e.destroy();return}const n=this._getCache(e),r=e.hash;n[r].useCount--,n[r].useCount===0?(this._destroyPipeline(e),this.debug&&N.warn(`${this}: ${e} released and destroyed`)()):n[r].useCount<0?(N.error(`${this}: ${e} released, useCount < 0, resetting`)(),n[r].useCount=0):this.debug&&N.warn(`${this}: ${e} released, count=${n[r].useCount}`)()}_destroyPipeline(e){const n=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete n[e.hash],e.destroy(),!0}}_getCache(e){let n;if(e instanceof La&&(n=this._computePipelineCache),e instanceof ar&&(n=this._renderPipelineCache),!n)throw new Error(`${this}`);if(!n[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return n}_hashComputePipeline(e){const{type:n}=this.device,r=this._getHash(e.shader.source);return`${n}/C/${r}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout)),{type:o}=this.device;switch(o){case"webgl":return`${o}/R/${n}/${r}V${i}BL${s}`;case"webgpu":default:const a=this._getHash(JSON.stringify(e.parameters));return`${o}/R/${n}/${r}V${i}T${e.topology}P${a}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};p(dl,"defaultProps",{...ar.defaultProps});let Sf=dl;const pl=class pl{constructor(e){p(this,"device");p(this,"cachingEnabled");p(this,"destroyPolicy");p(this,"debug");p(this,"_cache",{});this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new pl(e)),e._lumaData.defaultShaderFactory}get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const n=this._hashShader(e);let r=this._cache[n];if(r)r.useCount++,this.debug&&N.warn(`${this}: Reusing shader ${r.shader.id} count=${r.useCount}`)();else{const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:1},this.debug&&N.warn(`${this}: Created new shader ${i.id}`)()}return r.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const n=this._hashShader(e),r=this._cache[n];if(r)if(r.useCount--,r.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[n],r.shader.destroy(),this.debug&&N.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else{if(r.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&N.warn(`${this}: Releasing shader ${e.id} count=${r.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}};p(pl,"defaultProps",{...Ba.defaultProps});let Ef=pl;function TC(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s)}}return n}let Ne=null,Yn=null;function xC(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){Ne||(Ne=document.createElement("canvas"),Ne.id=e,Ne.title=e,Ne.style.zIndex="100",Ne.style.position="absolute",Ne.style.top=i,Ne.style.left=s,Ne.style.border="blue 5px solid",Ne.style.transform="scaleY(-1)",document.body.appendChild(Ne),Yn=Ne.getContext("2d")),(Ne.width!==t.width||Ne.height!==t.height)&&(Ne.width=t.width/2,Ne.height=t.height/2,Ne.style.width="400px",Ne.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),l=Yn==null?void 0:Yn.createImageData(t.width,t.height);if(l){for(let u=0;u<a.length;u+=4)l.data[0+u+0]=a[u+0]*o,l.data[0+u+1]=a[u+1]*o,l.data[0+u+2]=a[u+2]*o,l.data[0+u+3]=r?255:a[u+3]*o;Yn==null||Yn.putImageData(l,0,0)}}function Af(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Af(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Af(t[s],e[s],n-1))return!1;return!0}return!1}class Vc{constructor(e){p(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){var n;return e.attributes?(n=e.attributes)==null?void 0:n.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,n){const r=[...e];for(const i of n){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}getBufferIndex(e){const n=this.bufferLayouts.findIndex(r=>r.name===e);return n===-1&&N.warn(`BufferLayout: Missing buffer for "${e}".`)(),n}}function SC(t,e){const n=Object.fromEntries(t.attributes.map(i=>[i.name,i.location])),r=e.slice();return r.sort((i,s)=>{const o=i.attributes?i.attributes.map(u=>u.attribute):[i.name],a=s.attributes?s.attributes.map(u=>u.attribute):[s.name],l=Math.min(...o.map(u=>n[u])),c=Math.min(...a.map(u=>n[u]));return l-c}),r}function EC(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function AC(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function RC(t){return EC(t)||AC(t)}function CC(t){return RC(t)||typeof t=="number"||typeof t=="boolean"}function IC(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];CC(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}class PC{constructor(e,n){p(this,"options",{disableWarnings:!1});p(this,"modules");p(this,"moduleUniforms");p(this,"moduleBindings");Object.assign(this.options,n);const r=$h(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;N.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&N.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||N.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[i],l=this.moduleBindings[i],c=((n=o.getUniforms)==null?void 0:n.call(o,s,a))||s,{uniforms:u,bindings:f}=IC(c);this.moduleUniforms[i]={...a,...u},this.moduleBindings[i]={...l,...f}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let kC="";async function MC(t,e){const n=new Image;return n.crossOrigin="anonymous",n.src=t.startsWith("http")?t:kC+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}const OC=["+X","-X","+Y","-Y","+Z","-Z"],NC=["+X","-X","+Y","-Y","+Z","-Z"],gl=class gl{constructor(e,n){p(this,"device");p(this,"id");p(this,"props");p(this,"texture");p(this,"sampler");p(this,"view");p(this,"ready");p(this,"isReady",!1);p(this,"destroyed",!1);p(this,"resolveReady",()=>{});p(this,"rejectReady",()=>{});this.device=e;const r=Gs("async-texture");this.props={...gl.defaultProps,id:r,...n},this.id=this.props.id,n={...n},typeof(n==null?void 0:n.data)=="string"&&n.dimension==="2d"&&(n.data=MC(n.data)),n.mipmaps&&(n.mipLevels="auto"),this.ready=new Promise((i,s)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=s}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const n=e.data,r=await L0(n).then(void 0,this.rejectReady);if(this.destroyed)return;const i=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(r);if(!i)throw new Error("Texture size could not be determined");const s={...i,...e,data:void 0,mipLevels:1},o=this.device.getMipLevelCount(s.width,s.height);if(s.mipLevels=this.props.mipLevels==="auto"?o:Math.min(o,this.props.mipLevels),this.texture=this.device.createTexture(s),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,r);break;case"2d":this._setTexture2DData(r);break;case"3d":this._setTexture3DData(this.texture,r);break;case"2d-array":this._setTextureArrayData(this.texture,r);break;case"cube":this._setTextureCubeData(this.texture,r);break;case"cube-array":this._setTextureCubeArrayData(this.texture,r);break}this.props.mipmaps&&this.generateMipmaps(),N.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof mi?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}isTextureLevelData(e){const n=e==null?void 0:e.data;return ArrayBuffer.isView(n)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const r=Object.values(e)[0];return{width:r.width,height:r.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,n){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,n=0){if(!this.texture)throw new Error("Texture not initialized");const r=this._normalizeTextureData(e);r.length>1&&this.props.mipmaps!==!1&&N.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<r.length;i++){const s=r[i];this.device.isExternalImage(s)?this.texture.copyExternalImage({image:s,depth:n,mipLevel:i,flipY:!0}):this.texture.copyImageData({data:s.data,mipLevel:i})}}_setTexture3DData(e,n){var r;if(((r=this.texture)==null?void 0:r.props.dimension)!=="3d")throw new Error(this.id);for(let i=0;i<n.length;i++)this._setTexture2DData(n[i],i)}_setTextureCubeData(e,n){var r;if(((r=this.texture)==null?void 0:r.props.dimension)!=="cube")throw new Error(this.id);for(const[i,s]of Object.entries(n)){const o=NC.indexOf(i);this._setTexture2DData(s,o)}}_setTextureArrayData(e,n){var r;if(((r=this.texture)==null?void 0:r.props.dimension)!=="2d-array")throw new Error(this.id);for(let i=0;i<n.length;i++)this._setTexture2DData(n[i],i)}_setTextureCubeArrayData(e,n){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,n,r,i=0){Array.isArray(n)&&n.length>1&&this.props.mipmaps!==!1&&N.warn(`${this.id} has mipmap and multiple LODs.`)();const s=OC.indexOf(r);this._setTexture2DData(n,s)}_normalizeTextureData(e){const n=this.texture;let r;return ArrayBuffer.isView(e)?r=[{data:e,width:n.width,height:n.height}]:Array.isArray(e)?r=e:r=[e],r}};p(gl,"defaultProps",{...rt.defaultProps,data:null,mipmaps:!1});let fs=gl;async function L0(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(L0));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=n[s];return i}return t}const Kn=2,DC=1e4,ml=class ml{constructor(e,n){p(this,"device");p(this,"id");p(this,"source");p(this,"vs");p(this,"fs");p(this,"pipelineFactory");p(this,"shaderFactory");p(this,"userData",{});p(this,"parameters");p(this,"topology");p(this,"bufferLayout");p(this,"isInstanced");p(this,"instanceCount",0);p(this,"vertexCount");p(this,"indexBuffer",null);p(this,"bufferAttributes",{});p(this,"constantAttributes",{});p(this,"bindings",{});p(this,"vertexArray");p(this,"transformFeedback",null);p(this,"pipeline");p(this,"shaderInputs");p(this,"_uniformStore");p(this,"_attributeInfos",{});p(this,"_gpuGeometry",null);p(this,"props");p(this,"_pipelineNeedsUpdate","newly created");p(this,"_needsRedraw","initializing");p(this,"_destroyed",!1);p(this,"_lastDrawTimestamp",-1);p(this,"_lastLogTime",0);p(this,"_logOpen",!1);p(this,"_drawCount",0);var l,c,u,f;this.props={...ml.defaultProps,...n},n=this.props,this.id=n.id||Gs("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((l=this.props.modules)==null?void 0:l.map(h=>[h.name,h]))||[]),i=n.shaderInputs||new PC(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=BC(e),o=(((c=this.props.modules)==null?void 0:c.length)>0?this.props.modules:(u=this.shaderInputs)==null?void 0:u.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:h,getUniforms:d}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=h,this._getModuleUniforms=d,(f=this.props).shaderLayout||(f.shaderLayout=VS(this.source))}else{const{vs:h,fs:d,getUniforms:y}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=h,this.fs=d,this._getModuleUniforms=y}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Sf.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Ef.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const n=this._areBindingsLoading();if(n)return N.info(Kn,`>>> DRAWING ABORTED ${this.id}: ${n} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings});const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&vC(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const i=new Vc(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new Vc(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Af(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new uS(this.shaderInputs.modules);for(const[n,r]of Object.entries(this.shaderInputs.modules))if(FC(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const r=(n==null?void 0:n.disableWarnings)??this.props.disableWarnings;e.indices&&N.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=SC(this.pipeline.shaderLayout,this.bufferLayout);const i=new Vc(this.bufferLayout);for(const[s,o]of Object.entries(e)){const a=i.getBufferLayout(s);if(!a){r||N.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const l=i.getAttributeNamesForBuffer(a);let c=!1;for(const u of l){const f=this._attributeInfos[u];if(f){const h=this.device.type==="webgpu"?i.getBufferIndex(f.bufferName):f.location;this.vertexArray.setBuffer(h,o),c=!0}}!c&&!r&&N.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||N.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof fs&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[n,r]of Object.entries(this.bindings))r instanceof fs?r.isReady&&(e[n]=r.texture):e[n]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof Fa?e=Math.max(e,n.texture.updateTimestamp):n instanceof de||n instanceof rt?e=Math.max(e,n.updateTimestamp):n instanceof fs?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof mi||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(N.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=Bv(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=N.level>3?0:DC;N.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,N.group(Kn,`>>> DRAWING MODEL ${this.id}`,{collapsed:N.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=TC(this.pipeline.shaderLayout,this.id);N.table(Kn,e)();const n=this.shaderInputs.getDebugTable();N.table(Kn,n)();const r=this._getAttributeDebugTable();N.table(Kn,this._attributeInfos)(),N.table(Kn,r)(),N.groupEnd(Kn)(),this._logOpen=!1}}_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const r=e.props.framebuffer;r&&xC(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:n,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=jh(n);return(e instanceof de?new r(e.debugData):e).toString()}};p(ml,"defaultProps",{...ar.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Na.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let xi=ml;function FC(t){return!!(t.uniformTypes&&!UC(t.uniformTypes))}function BC(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function UC(t){for(const e in t)return!1;return!0}const _s=class _s{constructor(e,n=_s.defaultProps){p(this,"device");p(this,"model");p(this,"transformFeedback");if(!_s.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new xi(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||sx(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof de)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}};p(_s,"defaultProps",{...xi.defaultProps,outputs:void 0,feedbackBuffers:void 0});let $s=_s;class na{constructor(e){p(this,"id");p(this,"topology");p(this,"vertexCount");p(this,"indices");p(this,"attributes");p(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||Gs("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const LC={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class V0 extends sd{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:d="picking",pickZ:y,shaderModuleProps:w}){this.pickZ=y;const x=this._resetColorEncoder(y),m=[a,l,c,u],_=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(T=>T.useInPicking),pass:d,isPicking:!0,shaderModuleProps:w,clearColor:[0,0,0,0],colorMask:15,scissorRect:m});return this._colorEncoderState=null,{decodePickingColor:x&&$C.bind(null,x),stats:_}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,n,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,LC),i.blend=!0,i.blendColor=VC(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function VC(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(se.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function $C(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Fr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Ja=Symbol.for("component"),cr=Symbol.for("propTypes"),$c=Symbol.for("deprecatedProps"),li=Symbol.for("asyncPropDefaults"),wr=Symbol.for("asyncPropOriginal"),In=Symbol.for("asyncPropResolved");function $0(t,e=()=>!0){return Array.isArray(t)?z0(t,e,[]):e(t)?[t]:[]}function z0(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?z0(i,e,n):e(i)&&n.push(i)}return n}function zC({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class jC{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Ds(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class WC{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new jC(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const HC="layerManager.setLayers",XC="layerManager.activateViewport";class YC{constructor(e,n){var a;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=l=>{Qe(XC,this,l),l&&(this.context.viewport=l)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new WC({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:zR(((a=e==null?void 0:e.info)==null?void 0:a.shadingLanguage)||"glsl"),defaultShaderModules:[ZE],renderPass:void 0,stats:i||new Ol({id:"deck.gl"}),viewport:s||new Ci({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new U0,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Qe(HC,this,n,e),this._lastRenderedLayers=e;const r=$0(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?se.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&se.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Fr.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Fr.MATCHED,n!==e&&(e.lifecycle=Fr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Fr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Fr.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function bt(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!bt(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!bt(t[s],e[s],n-1))return!1;return!0}return!1}class KC{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=$0(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!bt(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):se.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(r=!0),(r||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const qC=/([0-9]+\.?[0-9]*)(%|px)/;function _n(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=qC.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function yn(t,e){return t.relative?Math.round(t.position*e):t.position}class br{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=_n(r),this._y=_n(i),this._width=_n(s),this._height=_n(o),this._padding=a&&{left:_n(a.left||0),right:_n(a.right||0),top:_n(a.top||0),bottom:_n(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&bt(this.props,e.props,2)}clone(e){const n=this.constructor;return new n({...this.props,...e})}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:yn(this._x,e),y:yn(this._y,n),width:yn(this._width,e),height:yn(this._height,n)};return this._padding&&(r.padding={left:yn(this._padding.left,e),top:yn(this._padding.top,n),right:yn(this._padding.right,e),bottom:yn(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Ul{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Yg=()=>{},Rf={BREAK:1,SNAP_TO_END:2,IGNORE:3},ZC=t=>t,QC=Rf.BREAK;class JC{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(r/a),u=i.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Ul(e.timeline),this.onViewStateChange=e.onViewStateChange||Yg,this.onStateChange=e.onStateChange||Yg}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===Rf.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Rf.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||ZC,interpolator:s,interruption:n.transitionInterruption||QC,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function Ye(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class GC{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Bs(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Ye(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const eI=["longitude","latitude","zoom","bearing","pitch"],tI=["longitude","latitude","zoom"];class od extends GC{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:eI,required:tI},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),l=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=Xa(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,Xa(e.around,n.around,r)))}return i}}const en={transitionDuration:0},nI=300,Oo=t=>1-(1-t)*(1-t),Nr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},qn={};class j0{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new JC({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return n?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?nI:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(Nr.WHEEL,u&&r),this.toggleEvents(Nr.PAN,u),this.toggleEvents(Nr.PINCH,u&&(a||l)),this.toggleEvents(Nr.MULTI_PAN,u&&l),this.toggleEvents(Nr.DOUBLE_CLICK,u&&o),this.toggleEvents(Nr.KEYBOARD,u&&c),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,en,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,en,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Oo},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,en,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Oo},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=i?{...this._getTransitionProps({around:n}),transitionDuration:250}:en,l=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(l,a,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,en,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,en,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Oo},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return qn._startPinchRotation=e.rotation,qn._lastPinchEvent=e,this.updateViewport(r,en,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:qn._startPinchRotation-r})}return this.updateViewport(n,en,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),qn._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=qn;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:Oo},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return qn._startPinchRotation=null,qn._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?en:e?{...n,transitionInterpolator:new od({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class W0{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Kg=5,rI=1.2;class iI extends W0{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:d=60,minPitch:y=0,startPanLngLat:w,startZoomLngLat:x,startRotatePos:m,startBearing:_,startPitch:g,startZoom:T,normalize:C=!0}=e;Ye(Number.isFinite(s)),Ye(Number.isFinite(i)),Ye(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:d,minPitch:y,normalize:C,position:u},{startPanLngLat:w,startZoomLngLat:x,startRotatePos:m,startBearing:_,startPitch:g,startZoom:T}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=ft(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=ft(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=ft(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,AR(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),f=s/c;let h=0;o>0?Math.abs(u-l)>Kg&&(h=o/(l-u)*rI):o<0&&l>Kg&&(h=1-a/l),h=ft(h,-1,1);const{minPitch:d,maxPitch:y}=this.getViewportProps(),w=i+180*f;let x=r;return h>0?x=r+h*(y-r):h<0&&(x=r-h*(d-r)),{pitch:x,bearing:w}}}class sI extends j0{constructor(){super(...arguments),this.ControllerState=iI,this.transition={transitionDuration:300,transitionInterpolator:new od({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class H0 extends br{constructor(e={}){super(e)}getViewportType(){return Ti}get ControllerType(){return sI}}H0.displayName="MapView";const oI=new F0;function aI(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class lI{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>aI(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(bt(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof F0)||this._resolvedEffects.push(oI),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class cI extends sd{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const uI="deckRenderer.renderLayers";class fI{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new cI(e),this.pickLayersPass=new V0(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&(this.lastPostProcessEffect&&(r.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(r.effects,r)),this.renderCount++,Qe(uI,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize(),[r,i]=n;e.length===0&&[0,1].map(s=>{const o=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:r,height:i});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${s}`,colorAttachments:[o]}))});for(const s of e)s.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const hI={pickedColor:null,pickedObjectIndex:-1};function qg({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=i*i,f=-1,h=0;for(let d=0;d<c;d++){const y=d+a-r,w=y*y;if(w>u)h+=4*l;else for(let x=0;x<l;x++){if(t[h+3]-1>=0){const _=x+o-n,g=_*_+w;g<=u&&(u=g,f=h)}h+=4}}if(f>=0){const d=t.slice(f,f+4),y=e(d);if(y){const w=Math.floor(f/4/l),x=f/4-w*l;return{...y,pickedColor:d,pickedX:o+x,pickedY:a+w}}se.error("Picked non-existent layer. Is picking buffer corrupt?")()}return hI}function Zg({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):se.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function Cf({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=dI((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const l=[r-o.x,i-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function Qg(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(r==="hover"){const f=n.index,h=n.layerId,d=o?o.props.id:null;if(d!==h||a!==f){if(d!==h){const y=i.find(w=>w.props.id===h);y&&l.unshift(y)}n.layerId=d,n.index=a,n.info=null}}const c=Cf(t),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===o&&(h.color=s,h.index=a,h.picked=!0),h=If({layer:f,info:h,mode:r});const d=h.layer;f===o&&r==="hover"&&(n.info=h),u.set(d.id,h),r==="hover"&&d.updateAutoHighlight(h)}),u}function If({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function dI(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class pI{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new V0(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?r.find(h=>h.id===o):null,c=a&&i.find(h=>h.id===a)||i[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}async _pickClosestObjectAsync({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||r.length===0)return{result:[],emptyInfo:Cf({viewports:r,x:i,y:s,pixelRatio:h})};this._resizeBuffer();const y=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=[y.x+Math.floor(y.width/2),y.y+Math.floor(y.height/2)],x=Math.round(o*h),{width:m,height:_}=this.pickingFBO,g=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceWidth:m,deviceHeight:_}),T={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let C;const S=[],M=new Set;for(let k=0;k<a;k++){let F;if(g){const L=this._drawAndSample({layers:d,views:n,viewports:r,onViewportActive:u,deviceRect:g,cullRect:T,effects:f,pass:`picking:${l}`});F=qg({...L,deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceRect:g})}else F={pickedColor:null,pickedObjectIndex:-1};let D;if(F.pickedLayer&&c&&this.depthFBO){const{pickedColors:L}=this._drawAndSample({layers:[F.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:F.pickedX,y:F.pickedY,width:1,height:1},cullRect:T,effects:f,pass:`picking:${l}:z`},!0);L[3]&&(D=L[0])}F.pickedLayer&&k+1<a&&(M.add(F.pickedLayer),F.pickedLayer.disablePickingIndex(F.pickedObjectIndex)),C=Qg({pickInfo:F,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:r,x:i,y:s,z:D,pixelRatio:h});for(const L of C.values())L.layer&&S.push(L);if(!F.pickedColor)break}for(const k of M)k.restorePickingColors();return{result:S,emptyInfo:C.get(null)}}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||r.length===0)return{result:[],emptyInfo:Cf({viewports:r,x:i,y:s,pixelRatio:h})};this._resizeBuffer();const y=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=[y.x+Math.floor(y.width/2),y.y+Math.floor(y.height/2)],x=Math.round(o*h),{width:m,height:_}=this.pickingFBO,g=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceWidth:m,deviceHeight:_}),T={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let C;const S=[],M=new Set;for(let k=0;k<a;k++){let F;if(g){const L=this._drawAndSample({layers:d,views:n,viewports:r,onViewportActive:u,deviceRect:g,cullRect:T,effects:f,pass:`picking:${l}`});F=qg({...L,deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceRect:g})}else F={pickedColor:null,pickedObjectIndex:-1};let D;if(F.pickedLayer&&c&&this.depthFBO){const{pickedColors:L}=this._drawAndSample({layers:[F.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:F.pickedX,y:F.pickedY,width:1,height:1},cullRect:T,effects:f,pass:`picking:${l}:z`},!0);L[3]&&(D=L[0])}F.pickedLayer&&k+1<a&&(M.add(F.pickedLayer),F.pickedLayer.disablePickingIndex(F.pickedObjectIndex)),C=Qg({pickInfo:F,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:r,x:i,y:s,z:D,pixelRatio:h});for(const L of C.values())L.layer&&S.push(L);if(!F.pickedColor)break}for(const k of M)k.restorePickingColors();return{result:S,emptyInfo:C.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h||r.length===0)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),y=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=y.x,x=y.y+y.height,m=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),_=m.x+m.width,g=m.y,T={x:w,y:g,width:_-w,height:x-g},C=this._drawAndSample({layers:h,views:n,viewports:r,onViewportActive:u,deviceRect:T,cullRect:{x:i,y:s,width:o,height:a},effects:f,pass:`picking:${l}`}),S=Zg(C),M=new Map,k=[],F=Number.isFinite(c);for(let D=0;D<S.length&&!(F&&k.length>=c);D++){const L=S[D];let z={color:L.pickedColor,layer:null,index:L.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:d};z=If({layer:L.pickedLayer,info:z,mode:l});const H=z.layer.id;M.has(H)||M.set(H,new Set);const W=M.get(H),re=z.object??z.index;W.has(re)||(W.add(re),k.push(z))}return k}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h||r.length===0)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),y=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=y.x,x=y.y+y.height,m=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),_=m.x+m.width,g=m.y,T={x:w,y:g,width:_-w,height:x-g},C=this._drawAndSample({layers:h,views:n,viewports:r,onViewportActive:u,deviceRect:T,cullRect:{x:i,y:s,width:o,height:a},effects:f,pass:`picking:${l}`}),S=Zg(C),M=new Map,k=[],F=Number.isFinite(c);for(let D=0;D<S.length&&!(F&&k.length>=c);D++){const L=S[D];let z={color:L.pickedColor,layer:null,index:L.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:d};z=If({layer:L.pickedLayer,info:z,mode:l});const H=z.layer.id;M.has(H)||M.set(H,new Set);const W=M.get(H),re=z.object??z.index;W.has(re)||(W.add(re),k.push(z))}return k}async _drawAndSampleAsync({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,f={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{},isPicking:!0};for(const _ of a)_.useInPicking&&(f.preRenderStats[_.id]=_.preRender(f));const{decodePickingColor:h}=this.pickLayersPass.render(f),{x:d,y,width:w,height:x}=s,m=new(c?Float32Array:Uint8Array)(w*x*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:y,sourceWidth:w,sourceHeight:x,target:m}),{pickedColors:m,decodePickingColor:h}}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,f={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{},isPicking:!0};for(const _ of a)_.useInPicking&&(f.preRenderStats[_.id]=_.preRender(f));const{decodePickingColor:h}=this.pickLayersPass.render(f),{x:d,y,width:w,height:x}=s,m=new(c?Float32Array:Uint8Array)(w*x*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:y,sourceWidth:w,sourceHeight:x,target:m}),{pickedColors:m,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),l=Math.min(i,e+r+1)-o,c=Math.min(s,n+r+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const gI={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},mI="top-left",Jg="__root";class _I{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,n==null||n.classList.add("deck-widget-container"),this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!bt(e.widgets,this.widgets,1)){const n=e.widgets.filter(Boolean);this._setWidgets(n)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:n}){var i,s;const r=e.reduce((o,a)=>(o[a.id]=a,o),{});for(const o of this.getWidgets()){const{viewId:a}=o;if(a){const l=r[a];l&&(o.onViewportChange&&o.onViewportChange(l),(i=o.onRedraw)==null||i.call(o,{viewports:[l],layers:n}))}else{if(o.onViewportChange)for(const l of e)o.onViewportChange(l);(s=o.onRedraw)==null||s.call(o,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=vf[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((s=o[r])==null||s.call(o,e,n))}}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._removeWidget(i),this._addWidget(r)):r!==i&&(i.setProps(r.props),r=i):this._addWidget(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._removeWidget(i)}this.widgets=e}_addWidget(e){const{viewId:n=null,placement:r=mI}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:n}),e.rootElement&&this._getContainer(n,r).append(e.rootElement),e.updateHTML()}_removeWidget(e){var n;(n=e.onRemove)==null||n.call(e),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,n){var o;const r=e||Jg;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=globalThis.document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,gI[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===Jg||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}}function Gg(t,e){e&&Object.entries(e).map(([n,r])=>{n.startsWith("--")?t.style.setProperty(n,r):t.style[n]=r})}function yI(t,e){e&&Object.keys(e).map(n=>{n.startsWith("--")?t.style.removeProperty(n):t.style[n]=""})}class ad{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const n=this.props,r=this.rootElement;r&&n.className!==e.className&&(n.className&&r.classList.remove(n.className),e.className&&r.classList.add(e.className)),r&&!bt(n.style,e.style,1)&&(yI(r,n.style),Gg(r,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],n=document.createElement("div");return e.filter(r=>typeof r=="string"&&r.length>0).forEach(r=>n.classList.add(r)),Gg(n,this.props.style),n}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,n){}onClick(e,n){}onDrag(e,n){}onDragStart(e,n){}onDragEnd(e,n){}}ad.defaultProps={id:"widget",style:{},className:""};const vI={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class X0 extends ad{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,vI),e}onRenderHTML(e){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.rootElement;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}X0.defaultProps={...ad.defaultProps};const wI="modulepreload",bI=function(t){return"/"+t},em={},tm=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(n.map(l=>{if(l=bI(l),l in em)return;em[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":wI,c||(f.as="script"),f.crossOrigin="",f.href=l,a&&f.setAttribute("nonce",a),document.head.appendChild(f),c)return new Promise((h,d)=>{f.addEventListener("load",h),f.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};var Zr;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Zr||(Zr={}));const TI={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},xI=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),SI=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),EI=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function AI(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,r){if(n==="webgl"||n==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&RI(i),i}return this.originalGetContext(n,r)}}function RI(t){t.getExtension("EXT_color_buffer_float");const e={...TI,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:xI(t),OES_vertex_array_object:SI(t),ANGLE_instanced_arrays:EI(t)},n=t.getExtension;t.getExtension=function(i){const s=n.call(t,i);return s||(i in e?e[i]:null)};const r=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=r.apply(t)||[];return i==null?void 0:i.concat(Object.keys(e))}}async function Y0(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}const CI=1;let ae=null,nm=!1;const ld={debugSpectorJS:N.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function II(t){if(!globalThis.SPECTOR)try{await Y0(t.debugSpectorJSUrl||ld.debugSpectorJSUrl)}catch(e){N.warn(String(e))}}function PI(t){var e;if(t={...ld,...t},!t.debugSpectorJS)return null;if(!ae&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){N.probe(CI,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:n}=globalThis.SPECTOR;ae=new n,globalThis.luma&&(globalThis.luma.spector=ae)}if(!ae)return null;if(nm||(nm=!0,ae.spyCanvases(),ae==null||ae.onCaptureStarted.add(n=>N.info("Spector capture started:",n)()),ae==null||ae.onCapture.add(n=>{N.info("Spector capture complete:",n)(),ae==null||ae.getResultUI(),ae==null||ae.resultView.display(),ae==null||ae.resultView.addCapture(n)})),t.gl){const n=t.gl,r=n.device;ae==null||ae.startCapture(t.gl,500),n.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{N.info("Spector capture stopped after 2 seconds")(),ae==null||ae.stopCapture()})}return ae}const kI="https://unpkg.com/webgl-debug@2.0.1/index.js";function K0(t){return t.luma=t.luma||{},t.luma}async function MI(){Sr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Y0(kI))}function OI(t,e={}){return e.debugWebGL||e.traceWebGL?DI(t,e):NI(t)}function NI(t){const e=K0(t);return e.realContext?e.realContext:t}function DI(t,e){if(!globalThis.WebGLDebugUtils)return N.warn("webgl-debug not loaded")(),t;const n=K0(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...Zr,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,FI.bind(null,e),BI.bind(null,e));for(const o in Zr)!(o in r)&&typeof Zr[o]=="number"&&(r[o]=Zr[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function rm(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function FI(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;N.error(o)();debugger}function BI(t,e,n){let r="";N.level>=1&&(r=rm(e,n),t.traceWebGL&&N.log(1,r)());for(const i of n)if(i===void 0){r=r||rm(e,n);debugger}}const No=1;class UI extends Px{constructor(){super();p(this,"type","webgl");_r.defaultProps={..._r.defaultProps,...ld}}enforceWebGL2(n){AI(n)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext&&N.warn("WebGL1 is not supported",n)(),!1)}async attach(n,r={}){const{WebGLDevice:i}=await tm(async()=>{const{WebGLDevice:o}=await Promise.resolve().then(()=>vm);return{WebGLDevice:o}},void 0);if(n instanceof i)return n;if((n==null?void 0:n.device)instanceof i)return n.device;if(!LI(n))throw new Error("Invalid WebGL2RenderingContext");const s=r.createCanvasContext===!0?{}:r.createCanvasContext;return new i({...r,_handle:n,createCanvasContext:{canvas:n.canvas,autoResize:!1,...s}})}async create(n={}){const{WebGLDevice:r}=await tm(async()=>{const{WebGLDevice:i}=await Promise.resolve().then(()=>vm);return{WebGLDevice:i}},void 0);N.groupCollapsed(No,"WebGLDevice created")();try{const i=[];(n.debugWebGL||n.debug)&&i.push(MI()),n.debugSpectorJS&&i.push(II(n));const s=await Promise.allSettled(i);for(const l of s)l.status==="rejected"&&N.error(`Failed to initialize debug libraries ${l.reason}`)();const o=new r(n),a=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.props.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return N.probe(No,a)(),N.table(No,o.info)(),o}finally{N.groupEnd(No)()}}}function LI(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const zc=new UI,cd={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Se=(t,e,n)=>e?t.enable(n):t.disable(n),im=(t,e,n)=>t.hint(n,e),at=(t,e,n)=>t.pixelStorei(n,e),sm=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},Vi=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function jc(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const VI={3042:Se,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Se,2885:(t,e)=>t.cullFace(e),2929:Se,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Se,35723:im,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:sm,36010:sm,34964:Vi,36662:Vi,36663:Vi,35053:Vi,35055:Vi,2886:(t,e)=>t.frontFace(e),33170:im,2849:(t,e)=>t.lineWidth(e),32823:Se,32824:"polygonOffset",10752:"polygonOffset",35977:Se,32926:Se,32928:Se,32938:"sampleCoverage",32939:"sampleCoverage",3089:Se,3088:(t,e)=>t.scissor(...e),2960:Se,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Se,10754:Se,12288:Se,12289:Se,12290:Se,12291:Se,12292:Se,12293:Se,12294:Se,12295:Se,3333:at,3317:at,37440:at,37441:at,37443:at,3330:at,3332:at,3331:at,3314:at,32878:at,3316:at,3315:at,32877:at,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=jc(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=jc(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=jc(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function ve(t,e,n){return e[t]!==void 0?e[t]:n[t]}const $I={blendEquation:(t,e,n)=>t.blendEquationSeparate(ve(32777,e,n),ve(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ve(32969,e,n),ve(32968,e,n),ve(32971,e,n),ve(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ve(32824,e,n),ve(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ve(32938,e,n),ve(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ve(2962,e,n),ve(2967,e,n),ve(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ve(34816,e,n),ve(36003,e,n),ve(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ve(2964,e,n),ve(2965,e,n),ve(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ve(34817,e,n),ve(34818,e,n),ve(34819,e,n))},om={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Ht=(t,e)=>t.isEnabled(e),am={3042:Ht,2884:Ht,2929:Ht,3024:Ht,32823:Ht,32926:Ht,32928:Ht,3089:Ht,2960:Ht,35977:Ht},zI=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Ii(t,e){if(WI(e))return;const n={};for(const i in e){const s=Number(i),o=VI[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=$I[i];s(t,e,r)}}function q0(t,e=cd){if(typeof e=="number"){const i=e,s=am[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=am[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function jI(t){Ii(t,cd)}function WI(t){for(const e in t)return!1;return!0}function HI(t,e){if(t===e)return!0;if(lm(t)&&lm(e)&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}function lm(t){return Array.isArray(t)||ArrayBuffer.isView(t)}class ur{constructor(e,n){p(this,"gl");p(this,"program",null);p(this,"stateStack",[]);p(this,"enable",!0);p(this,"cache",null);p(this,"log");p(this,"initialized",!1);this.gl=e,this.log=(n==null?void 0:n.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Ii(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n!=null&&n.copyState?q0(e):Object.assign({},cd),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,YI(e);for(const r in om){const i=om[r];XI(e,r,i)}cm(e,"getParameter"),cm(e,"isEnabled")}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],a=this.cache[s];HI(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function cm(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||zI.has(i))return n(i);const s=ur.get(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function XI(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=ur.get(t),{valueChanged:a,oldValue:l}=n(o._updateCache,...s);return a&&r(...s),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function YI(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=ur.get(t);i.program!==r&&(e(r),i.program=r)}}function KI(t,e,n){let r="";const i={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=t.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!n.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:a}=e;return t.addEventListener("webglcontextlost",l=>o(l),!1),t.addEventListener("webglcontextrestored",l=>a(l),!1),s.luma||(s.luma={}),s}function Si(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function qI(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);Si(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||n,l=o||r,c=t.getParameter(7938),u=Z0(a,l),f=ZI(a,l),h=QI(a,l);return{type:"webgl",gpu:u,gpuType:h,gpuBackend:f,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Z0(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function ZI(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function QI(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(Z0(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Q0(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const qi="WEBGL_compressed_texture_s3tc",Zi="WEBGL_compressed_texture_s3tc_srgb",Qr="EXT_texture_compression_rgtc",Jr="EXT_texture_compression_bptc",JI="WEBGL_compressed_texture_etc",GI="WEBGL_compressed_texture_astc",eP="WEBGL_compressed_texture_etc1",tP="WEBGL_compressed_texture_pvrtc",nP="WEBGL_compressed_texture_atc",um="EXT_texture_norm16",fm="EXT_render_snorm",rP="EXT_color_buffer_float",ud={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[fm],"norm16-renderable-webgl":[um],"snorm16-renderable-webgl":[um,fm],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[qi,Zi,Qr,Jr],"texture-compression-bc5-webgl":[Qr],"texture-compression-bc7-webgl":[Jr],"texture-compression-etc2":[JI],"texture-compression-astc":[GI],"texture-compression-etc1-webgl":[eP],"texture-compression-pvrtc-webgl":[tP],"texture-compression-atc-webgl":[nP]};function iP(t){return t in ud}function sP(t,e,n){return(ud[e]||[]).every(i=>Si(t,i,n))}const fd={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:rP,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:qi},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Zi},"bc1-rgba-unorm":{gl:33777,x:qi},"bc1-rgba-unorm-srgb":{gl:35916,x:Zi},"bc2-rgba-unorm":{gl:33778,x:qi},"bc2-rgba-unorm-srgb":{gl:35918,x:Zi},"bc3-rgba-unorm":{gl:33779,x:qi},"bc3-rgba-unorm-srgb":{gl:35919,x:Zi},"bc4-r-unorm":{gl:36283,x:Qr},"bc4-r-snorm":{gl:36284,x:Qr},"bc5-rg-unorm":{gl:36285,x:Qr},"bc5-rg-snorm":{gl:36286,x:Qr},"bc6h-rgb-ufloat":{gl:36495,x:Jr},"bc6h-rgb-float":{gl:36494,x:Jr},"bc7-rgba-unorm":{gl:36492,x:Jr},"bc7-rgba-unorm-srgb":{gl:36493,x:Jr},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function oP(t,e,n){let r=e.create;const i=fd[e.format];return(i==null?void 0:i.gl)===void 0&&(r=!1),i!=null&&i.x&&(r=r&&!!Si(t,i.x,n)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function J0(t){var i;const e=fd[t],n=cP(t),r=oi.getInfo(t);return r.compressed&&(e.dataFormat=n),{internalFormat:n,format:(e==null?void 0:e.dataFormat)||lP(r.channels,r.integer,r.normalized,n),type:r.dataType?Q0(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed||!1}}function aP(t){switch(oi.getInfo(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function lP(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function cP(t){const e=fd[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const hm={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class uP extends Cx{constructor(n,r,i){super([],i);p(this,"gl");p(this,"extensions");p(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,Si(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){var r;return(r=this.disabledFeatures)!=null&&r[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),iP(n)&&sP(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(hm),...Object.keys(ud)]}getWebGLFeature(n){const r=hm[n];return typeof r=="string"?!!Si(this.gl,r,this.extensions):!!r}}class fP extends Rx{constructor(n){super();p(this,"gl");p(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]||0}}class hs extends Ua{constructor(n,r){super(n,r);p(this,"device");p(this,"gl");p(this,"handle");p(this,"colorAttachments",[]);p(this,"depthStencilAttachment",null);const i=r.handle===null;this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(n._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const n=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const i=this.colorAttachments[r];if(i){const s=36064+r;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const r=aP(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${dP(r)}`)}this.gl.bindFramebuffer(36160,n)}_attachTextureView(n,r){const{gl:i}=this.device,{texture:s}=r,o=r.props.baseMipLevel,a=r.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,n,s.handle,o,a);break;case 34067:const l=hP(a);i.framebufferTexture2D(36160,n,l,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,n,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function hP(t){return t<34069?t+34069:t}function dP(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class pP extends Da{constructor(n,r){super(r);p(this,"device");p(this,"handle",null);p(this,"_framebuffer",null);this.device=n,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new hs(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const Wc={};function gP(t="id"){Wc[t]=Wc[t]||1;const e=Wc[t]++;return`${t}-${e}`}class ds extends de{constructor(n,r={}){super(n,r);p(this,"device");p(this,"gl");p(this,"handle");p(this,"glTarget");p(this,"glUsage");p(this,"glIndexType",5123);p(this,"byteLength",0);p(this,"bytesUsed",0);this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=mP(this.props.usage),this.glUsage=_P(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}write(n,r=0){const i=ArrayBuffer.isView(n)?n:new Uint8Array(n),s=36663;this.gl.bindBuffer(s,this.handle),this.gl.bufferSubData(s,r,i),this.gl.bindBuffer(s,null),this._setDebugData(n,r,n.byteLength)}async mapAndWriteAsync(n,r=0,i=this.byteLength-r){const s=new ArrayBuffer(i);await n(s,"copied"),this.write(s,r)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}async mapAndReadAsync(n,r=0,i){const s=await this.readAsync(r,i);return await n(s.buffer,"copied")}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function mP(t){return t&de.INDEX?34963:t&de.VERTEX?34962:t&de.UNIFORM?35345:34962}function _P(t){return t&de.INDEX||t&de.VERTEX?35044:t&de.UNIFORM?35048:35044}function yP(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[f,h]=i;n.push({message:h.trim(),type:dm(f),lineNum:0,linePos:0});continue}const[s,o,a,...l]=i;let c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(o,10);isNaN(u)&&(u=0),n.push({message:l.join(":").trim(),type:dm(s),lineNum:c,linePos:u})}return n}function dm(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class vP extends Ba{constructor(n,r){super(n,r);p(this,"device");p(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}n._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return n?yP(n):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(n){n=n.startsWith("#version ")?n:`#version 300 es
${n}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,n),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}N.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),N.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function wP(t,e,n,r){if(SP(e))return r(t);const i=t;i.pushState();try{return bP(t,e),Ii(i.gl,n),r(t)}finally{i.popState()}}function bP(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(fr("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=fr("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=fr("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(xP("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Pf("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&N.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Pf("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=Hc("stencilPassOperation",e.stencilPassOperation),s=Hc("stencilFailOperation",e.stencilFailOperation),o=Hc("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=pm("blendColorOperation",e.blendColorOperation||"add"),s=pm("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=Do("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=Do("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=Do("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),c=Do("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,l,c)}}function Pf(t,e){return fr(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Hc(t,e){return fr(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function pm(t,e){return fr(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Do(t,e,n="color"){return fr(t,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:n==="color"?32769:32771,"one-minus-constant":n==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function TP(t,e){return`Illegal parameter ${e} for ${t}`}function fr(t,e,n){if(!(e in n))throw new Error(TP(t,e));return n[e]}function xP(t,e){return e}function SP(t){let e=!0;for(const n in t){e=!1;break}return e}function G0(t){const e={};return t.addressModeU&&(e[10242]=Xc(t.addressModeU)),t.addressModeV&&(e[10243]=Xc(t.addressModeV)),t.addressModeW&&(e[32882]=Xc(t.addressModeW)),t.magFilter&&(e[10240]=kf(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=EP(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Pf("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Xc(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function kf(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function EP(t,e="none"){if(!e)return kf(t);switch(e){case"none":return kf(t);case"nearest":switch(t){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(t){case"nearest":return 9986;case"linear":return 9987}}}class AP extends mi{constructor(n,r){super(n,r);p(this,"device");p(this,"handle");p(this,"parameters");this.device=n,this.parameters=G0(r),this.handle=r.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}function zs(t,e,n){if(RP(e))return n(t);const{nocatch:r=!0}=e,i=ur.get(t);i.push(),Ii(t,e);let s;if(r)s=n(t),i.pop();else try{s=n(t)}finally{i.pop()}return s}function RP(t){for(const e in t)return!1;return!0}class Gr extends Fa{constructor(n,r){super(n,{...rt.defaultProps,...r});p(this,"device");p(this,"gl");p(this,"handle");p(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}class ps extends rt{constructor(n,r){super(n,r);p(this,"device");p(this,"gl");p(this,"handle");p(this,"sampler");p(this,"view");p(this,"glTarget");p(this,"glFormat");p(this,"glType");p(this,"glInternalFormat");p(this,"compressed");p(this,"_textureUnit",0);this.device=n,this.gl=this.device.gl;const i=J0(this.props.format);this.glTarget=CP(this.props.dimension),this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:s,width:o,height:a,depth:l,mipLevels:c,glTarget:u,glInternalFormat:f}=this;switch(s){case"2d":case"cube":this.gl.texStorage2D(u,c,f,o,a);break;case"2d-array":case"3d":this.gl.texStorage3D(u,c,f,o,a,l);break;default:throw new Error(s)}this.gl.bindTexture(this.glTarget,null),this._initializeData(r.data),this.setSampler(this.props.sampler),this.view=new Gr(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(n){return new Gr(this.device,{...n,texture:this})}setSampler(n={}){super.setSampler(n);const r=G0(this.sampler.props);this._setSamplerParameters(r)}copyImageData(n){const r=this._normalizeCopyImageDataOptions(n),i=r.data,{width:s,height:o,depth:a}=this,{mipLevel:l=0,byteOffset:c=0,x:u=0,y:f=0,z:h=0}=r,{glFormat:d,glType:y,compressed:w}=this,x=gm(this.glTarget,this.dimension,a),m=this.compressed?{}:{3314:r.bytesPerRow,32878:r.rowsPerImage};this.gl.bindTexture(x,this.handle),zs(this.gl,m,()=>{switch(this.dimension){case"2d":case"cube":w?this.gl.compressedTexSubImage2D(x,l,u,f,s,o,d,i,c):this.gl.texSubImage2D(x,l,u,f,s,o,d,y,i,c);break;case"2d-array":case"3d":w?this.gl.compressedTexSubImage3D(x,l,u,f,h,s,o,a,d,i,c):this.gl.texSubImage3D(x,l,u,f,h,s,o,a,d,y,i,c);break;default:}}),this.gl.bindTexture(x,null)}copyExternalImage(n){const r=this._normalizeCopyExternalImageOptions(n);if(r.sourceX||r.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:i,glType:s}=this,{image:o,depth:a,mipLevel:l,x:c,y:u,z:f,width:h,height:d}=r,y=gm(this.glTarget,this.dimension,a),w=r.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),zs(this.gl,w,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(y,l,c,u,h,d,i,s,o);break;case"2d-array":case"3d":this.gl.texSubImage3D(y,l,c,u,f,h,d,a,i,s,o);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:r.width,height:r.height}}generateMipmapsWebGL(n){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(N.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(n!=null&&n.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){N.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(n){N.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(n))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(n){const{gl:r}=this;return n!==void 0&&(this._textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,this.handle),n}_unbind(n){const{gl:r}=this;return n!==void 0&&(this._textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,null),n}}function CP(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function gm(t,e,n){return e==="cube"?34069+n:t}function IP(t){return OP[t]}function hd(t){return MP[t]}function PP(t){return!!ew[t]}function kP(t){return ew[t]}const MP={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},ew={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},OP={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function NP(t,e){const n={attributes:[],bindings:[]};n.attributes=DP(t,e);const r=UP(t,e);for(const a of r){const l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));n.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}const i=BP(t,e);let s=0;for(const a of i)if(PP(a.type)){const{viewDimension:l,sampleType:c}=kP(a.type);n.bindings.push({type:"texture",name:a.name,group:0,location:s,viewDimension:l,sampleType:c}),a.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=FP(t,e);return o!=null&&o.length&&(n.varyings=o),n}function DP(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,l=t.getAttribLocation(e,o);if(l>=0){const c=hd(a),u=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:l,stepMode:u,type:c})}}return n.sort((i,s)=>i.location-s.location),n}function FP(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:l}=s,c=hd(a),{type:u,components:f}=Fv(c);n.push({location:i,name:o,type:u,size:l*f})}return n.sort((i,s)=>i.location-s.location),n}function BP(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:l}=s,{name:c,isArray:u}=LP(o);let f=t.getUniformLocation(e,c);const h={location:f,name:c,size:a,type:l,isArray:u};if(n.push(h),h.size>1)for(let d=0;d<h.size;d++){const y=`${c}[${d}]`;f=t.getUniformLocation(e,y);const w={...h,name:y,location:f};n.push(w)}}return n}function UP(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],l=t.getActiveUniforms(e,a,35383),c=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),f=t.getActiveUniforms(e,a,35388);for(let h=0;h<o.uniformCount;++h){const d=t.getActiveUniform(e,a[h]);if(!d)throw new Error("activeInfo");const y=hd(l[h]);o.uniforms.push({name:d.name,format:y,type:l[h],arrayLength:c[h],byteOffset:u[h],byteStride:f[h]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}function LP(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function VP(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function $P(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function zP(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const mm=4;class jP extends ar{constructor(n,r){super(n,r);p(this,"device");p(this,"handle");p(this,"vs");p(this,"fs");p(this,"introspectedLayout");p(this,"uniforms",{});p(this,"bindings",{});p(this,"varyings",null);p(this,"_uniformCount",0);p(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),N.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=NP(this.device.gl,this.handle),N.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=r.shaderLayout?WP(this.introspectedLayout,r.shaderLayout):this.introspectedLayout}get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");r!=null&&r.disableWarnings||N.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${a}`,s)();continue}switch(s||N.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof ds)&&!(s.buffer instanceof ds))throw new Error("buffer value");break;case"texture":if(!(s instanceof Gr||s instanceof ps||s instanceof hs))throw new Error(`${this} Bad texture binding for ${i}`);break;case"sampler":N.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var x;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:l,isInstanced:c=!1,firstVertex:u=0,transformFeedback:f}=n,h=$P(s),d=!!o.indexBuffer,y=(x=o.indexBuffer)==null?void 0:x.glIndexType;if(this.linkStatus!=="success")return N.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return N.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),f&&f.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const w=r;return wP(this.device,i,w.glParameters,()=>{d&&c?this.device.gl.drawElementsInstanced(h,a||0,y,u,l||0):d?this.device.gl.drawElements(h,a||0,y,u):c?this.device.gl.drawArraysInstanced(h,u,a||0,l||0):this.device.gl.drawArrays(h,u,a||0),f&&f.end()}),o.unbindAfterRender(r),!0}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),N.time(mm,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),N.timeEnd(mm,`linkProgram for ${this.id}`)(),N.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}N.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),N.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(n){var r;switch(n){case"success":return;default:const i=n==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${i} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${i} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const s=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${i} during ${n}: ${s}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(N.warn(`Binding ${r.name} not found in ${this.id}`)(),n=!1);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,l=n.getUniformBlockIndex(this.handle,a);if(l===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,i,l),o instanceof ds?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof Gr||o instanceof ps||o instanceof hs))throw new Error("texture");let c;if(o instanceof Gr)c=o.texture;else if(o instanceof ps)c=o;else if(o instanceof hs&&o.colorAttachments[0]instanceof Gr)N.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(c.glTarget,c.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&VP(this.device.gl,i,s,a)}}}function WP(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):N.warn(`shader layout attribute ${r.name} not present in shader`)}return n}class HP extends of{constructor(n){super(n,{});p(this,"device");p(this,"handle",null);p(this,"commands",[]);this.device=n}_executeCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":XP(this.device,r.options);break;case"copy-buffer-to-texture":YP(this.device,r.options);break;case"copy-texture-to-buffer":KP(this.device,r.options);break;case"copy-texture-to-texture":qP(this.device,r.options);break;default:throw new Error(r.name)}}}function XP(t,e){const n=e.sourceBuffer,r=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function YP(t,e){throw new Error("Not implemented")}function KP(t,e){const{sourceTexture:n,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:c,byteOffset:u=0,bytesPerRow:f,rowsPerImage:h}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||a!==0||f||h)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:y}=tw(n);let w;try{const x=c,m=s||d.width,_=o||d.height,g=J0(d.colorAttachments[0].texture.props.format),T=g.format,C=g.type;t.gl.bindBuffer(35051,x.handle),w=t.gl.bindFramebuffer(36160,d.handle),t.gl.readPixels(l[0],l[1],m,_,T,C,u)}finally{t.gl.bindBuffer(35051,null),w!==void 0&&t.gl.bindFramebuffer(36160,w),y&&d.destroy()}}function qP(t,e){const{sourceTexture:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:a=e.destinationTexture.width,height:l=e.destinationTexture.height}=e;const{framebuffer:c,destroyFramebuffer:u}=tw(n),[f,h]=i,[d,y,w]=s,x=t.gl.bindFramebuffer(36160,c.handle);let m,_;if(o instanceof ps)m=o,a=Number.isFinite(a)?a:m.width,l=Number.isFinite(l)?l:m.height,m._bind(0),_=m.glTarget;else throw new Error("invalid destination");switch(_){case 3553:case 34067:t.gl.copyTexSubImage2D(_,r,d,y,f,h,a,l);break;case 35866:case 32879:t.gl.copyTexSubImage3D(_,r,d,y,w,f,h,a,l);break}m&&m._unbind(),t.gl.bindFramebuffer(36160,x),u&&c.destroy()}function tw(t){if(t instanceof rt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}const ZP=[1,2,4,8];class QP extends rf{constructor(n,r){var o;super(n,r);p(this,"device");p(this,"handle",null);p(this,"glParameters",{});this.device=n;let i;if(!((o=r==null?void 0:r.parameters)!=null&&o.viewport))if(r!=null&&r.framebuffer){const{width:a,height:l}=r.framebuffer;i=[0,0,a,l]}else{const[a,l]=n.getDefaultCanvasContext().getDrawingBufferSize();i=[0,0,a,l]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(this.props.framebuffer&&(s!=null&&s.handle)){const a=this.props.framebuffer.colorAttachments.map((l,c)=>36064+c);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),r[2967]=n.stencilReference),"colorMask"in n&&(r.colorMask=ZP.map(i=>!!(i&n.colorMask))),this.glParameters=r,Ii(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,n.clearStencil=this.props.clearStencil),r!==0&&zs(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){zs(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,n,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,n,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,n,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class _m extends sf{constructor(n,r){super(n,r);p(this,"device");p(this,"handle",null);p(this,"commandBuffer");this.device=n,this.commandBuffer=new HP(n)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(n){return new QP(this.device,n)}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}function JP(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}class dd extends af{constructor(n,r){super(n,r);p(this,"device");p(this,"handle");p(this,"buffer",null);p(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return r1()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:l,normalized:c,integer:u,divisor:f}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),u?this.device.gl.vertexAttribIPointer(n,s,o,a,l):this.device.gl.vertexAttribPointer(n,s,o,c,a,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,f||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=Q0(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=dd.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=GP(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a||(a=!ek(i,this.bufferValue)),a){const l=rS(r.constructor,o);JP({target:l,source:i,start:0,count:o}),this.buffer.write(l),this.bufferValue=r}return this.buffer}}function GP(t){return Array.isArray(t)?new Float32Array(t):t}function ek(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class tk extends lf{constructor(n,r){super(n,r);p(this,"device");p(this,"gl");p(this,"handle");p(this,"layout");p(this,"buffers",{});p(this,"unusedBuffers",{});p(this,"bindOnUse",!0);p(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(zP(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,N.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,s,a,o)}getBuffer(n){if(ym(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof ds)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(ym(n))return Number(n);for(const r of this.layout.varyings||[])if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function ym(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class nk extends cf{constructor(n,r){super(n,r);p(this,"device");p(this,"handle");p(this,"target",null);p(this,"_queryPending",!1);p(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");const i=this.device.gl.createQuery();if(!i)throw new Error("WebGL query not supported");this.handle=i,Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function nw(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function rk(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function ik(t){return sk[t]}const sk={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function ok(t,e){var _;const{sourceX:n=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:a,sourceDepth:l,sourceFormat:c,sourceType:u}=e||{};const{framebuffer:f,deleteFramebuffer:h}=rw(t),{gl:d,handle:y}=f;o||(o=f.width),a||(a=f.height);const w=(_=f.colorAttachments[i])==null?void 0:_.texture;if(!w)throw new Error(`Invalid framebuffer attachment ${i}`);l=(w==null?void 0:w.depth)||1,c||(c=(w==null?void 0:w.glFormat)||6408),u||(u=(w==null?void 0:w.glType)||5121),s=ck(s,u,c,o,a);const x=zh(s);u=u||IP(x);const m=d.bindFramebuffer(36160,y);return d.readBuffer(36064+i),d.readPixels(n,r,o,a,c,u,s),d.readBuffer(36064),d.bindFramebuffer(36160,m||null),h&&f.destroy(),s}function ak(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:f}=rw(t);a=a||u.width,l=l||u.height;const h=u;c=c||5121;let d=n;if(!d){const w=nw(s),x=rk(c),m=o+a*l*w*x;d=h.device.createBuffer({byteLength:m})}const y=t.device.createCommandEncoder();return y.copyTextureToBuffer({sourceTexture:t,width:a,height:l,origin:[r,i],destinationBuffer:d,byteOffset:o}),y.destroy(),f&&u.destroy(),d}function rw(t){return t instanceof Ua?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:lk(t),deleteFramebuffer:!0}}function lk(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function ck(t,e,n,r,i,s){if(t)return t;e||(e=5121);const o=ik(e),a=jh(o),l=nw(n);return new a(r*i*l)}class Mf extends _r{constructor(n){var f,h;super({...n,id:n.id||gP("webgl-device")});p(this,"type","webgl");p(this,"handle");p(this,"features");p(this,"limits");p(this,"info");p(this,"canvasContext");p(this,"preferredColorFormat","rgba8unorm");p(this,"preferredDepthFormat","depth24plus");p(this,"commandEncoder");p(this,"lost");p(this,"_resolveContextLost");p(this,"gl");p(this,"_constants");p(this,"_extensions",{});p(this,"_polyfilled",!1);p(this,"spectorJS");const r=_r._getCanvasContextProps(n);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(h=(f=r.canvas)==null?void 0:f.gl)==null?void 0:h.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new pP(this,r),this.lost=new Promise(d=>{this._resolveContextLost=d});const s={...n.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),n.powerPreference!==void 0&&(s.powerPreference=n.powerPreference);const a=this.props._handle||KI(this.canvasContext.canvas,{onContextLost:d=>{var y;return(y=this._resolveContextLost)==null?void 0:y.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:d=>console.log("WebGL context restored")},s);if(!a)throw new Error("WebGL context creation failed");if(i=a.device,i){if(n._reuseDevices)return N.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=a,this.gl=a,this.spectorJS=PI({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=qI(this.gl,this._extensions),this.limits=new fP(this.gl),this.features=new uP(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new ur(this.gl,{log:(...d)=>N.log(1,...d)()}).trackState(this.gl,{copyState:!1});const c=n.debugWebGL||n.debug,u=n.debugWebGL;c&&(this.gl=OI(this.gl,{debugWebGL:c,traceWebGL:u}),N.warn("WebGL debug mode activated. Performance reduced.")(),n.debugWebGL&&(N.level=Math.max(N.level,1))),this.commandEncoder=new _m(this,{id:`${this}-command-encoder`})}get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(n){switch(n){case"unorm8x4-bgra":return!1;default:return!0}}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._normalizeBufferProps(n);return new ds(this,r)}createTexture(n){return new ps(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new AP(this,n)}createShader(n){return new vP(this,n)}createFramebuffer(n){return new hs(this,n)}createVertexArray(n){return new dd(this,n)}createTransformFeedback(n){return new tk(this,n)}createQuerySet(n){return new nk(this,n)}createRenderPipeline(n){return new jP(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(n={}){return new _m(this,n)}submit(n){n||(n=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),n._executeCommands()}readPixelsToArrayWebGL(n,r){return ok(n,r)}readPixelsToBufferWebGL(n,r){return ak(n,r)}setParametersWebGL(n){Ii(this.gl,n)}getParametersWebGL(n){return q0(this.gl,n)}withParametersWebGL(n,r){return zs(this.gl,n,r)}resetWebGL(){N.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),jI(this.gl)}_getDeviceSpecificTextureFormatCapabilities(n){return oP(this.gl,n,this._extensions)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){ur.get(this.gl).push()}popState(){ur.get(this.gl).pop()}getGLKey(n,r){const i=Number(n);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return r!=null&&r.emptyIfUnknown?"":String(n)}getGLKeys(n){const r={emptyIfUnknown:!0};return Object.entries(n).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,r)}`]=`${o}:${this.getGLKey(o,r)}`,i),{})}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&dk(s,r)&&N.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:uk(this,n,r);break;case Int32Array:fk(this,n,r);break;case Uint32Array:hk(this,n,r);break;default:throw new Error("constant")}}getExtension(n){return Si(this.gl,n,this._extensions),this._extensions}_setWebGLDebugMetadata(n,r,i){n.luma=r;const s={props:i.spector,id:i.spector.id};n.__SPECTOR_Metadata=s}}function uk(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function fk(t,e,n){t.gl.vertexAttribI4iv(e,n)}function hk(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function dk(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const vm=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:Mf},Symbol.toStringTag,{value:"Module"}));function vn(){}const pk=({isDragging:t})=>t?"grabbing":"grab",iw={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:vn,onWebGLInitialized:vn,onResize:vn,onViewStateChange:vn,onInteractionStateChange:vn,onBeforeRender:vn,onAfterRender:vn,onLoad:vn,onError:t=>se.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:pk,getTooltip:null,debug:!1,drawPickingColors:!1};class pd{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Ol({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=vf[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[i]||l.props[i]),u=this.props[i];let f=!1;c&&(f=c.call(l,a,r)),f||(u==null||u(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{var o;if(((o=this.device)==null?void 0:o.type)==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...iw,...e},e=this.props,e.viewState&&e.initialViewState&&se.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&se.error("WebGL1 context not supported.")(),n=zc.attach(e.gl,this.props.deviceProps)),n||(n=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&Vs.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,l,c,u;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(c=this.widgetManager)==null||c.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var r,i,s,o,a,l,c,u;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&se.removed("onLayerHover","onHover")(),"onLayerClick"in e&&se.removed("onLayerClick","onClick")(),e.initialViewState&&!bt(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);if(Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==((r=this.device)==null?void 0:r.id)&&((i=this.animationLoop)==null||i.stop(),this.canvas!==((s=e.device.canvasContext)==null?void 0:s.canvas)&&((o=this.canvas)==null||o.remove(),(a=this.eventManager)==null||a.destroy(),this.canvas=null),se.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),(l=this.animationLoop)==null||l.setProps(n),e.useDevicePixels!==void 0&&((u=(c=this.device)==null?void 0:c.canvasContext)==null?void 0:u.canvas)instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=e.useDevicePixels;const f=this.device.canvasContext.canvas,h={target:f,contentBoxSize:[{inlineSize:f.clientWidth,blockSize:f.clientHeight}],devicePixelContentBoxSize:[{inlineSize:f.clientWidth,blockSize:f.clientHeight}],borderBoxSize:[{inlineSize:f.clientWidth,blockSize:f.clientHeight}]};this.device.canvasContext._handleResize([h])}this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ye(this.viewManager),this.viewManager.views}getViewports(e){return Ye(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){Ye(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ye(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(n.width=e.width),e.height&&typeof e.height=="number"&&(n.height=e.height),(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i}=n;return new xf({device:e,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:i})}_createDevice(e){var o,a;const n=(o=this.props.deviceProps)==null?void 0:o.createCanvasContext,r=typeof n=="object"?n:void 0,i={adapters:[],...e.deviceProps};i.adapters.includes(zc)||i.adapters.push(zc);const s={alphaMode:((a=this.props.deviceProps)==null?void 0:a.type)==="webgpu"?"premultiplied":void 0};return nf.createDevice({_reuseDevices:!0,type:"webgl",...i,createCanvasContext:{...s,...r,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new H0({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i,s;if(((n=this.device)==null?void 0:n.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:a}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let l=a,c=!1;for(const u of o)l=u,c=((r=u.layer)==null?void 0:r.onHover(u,e.event))||c;c||((s=(i=this.props).onHover)==null||s.call(i,l,e.event),this.widgetManager.onHover(l,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const n=new U0;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new qA(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Og).map(o=>{var d;const[a,l,c,u]=Og[o],f=(d=this.props.eventRecognizerOptions)==null?void 0:d[o],h={...l,...f,event:o};return{recognizer:new a(h),recognizeWith:c,requestFailure:u}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in vf)this.eventManager.on(o,this._onEvent);this.viewManager=new KC({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new YC(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new lI({deck:this,device:this.device}),this.deckRenderer=new fI(this.device),this.deckPicker=new pI(this.device),this.widgetManager=new _I({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new X0),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),se.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=nf.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}pd.defaultProps=iw;pd.VERSION=M2;function gk(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return jh(t)}}const mk=zh;function Fo(t,e,n){const r=n==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function rr(t){return t.stride||t.size*t.bytesPerElement}function _k(t,e){return t.type===e.type&&t.size===e.size&&rr(t)===rr(e)&&(t.offset||0)===(e.offset||0)}function Of(t,e){e.offset&&se.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=rr(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function yk(t,e){const n=Of(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class vk{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&n.isIndexed?a="uint32":a=i||"float32";let l=gk(i||a);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*rr(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Vs.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=Of(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:rr(r),attributes:i};if(this.doublePrecision){const o=yk(r,n||{});i.push(Fo(e,{...r,...o.high},this.device.type),Fo(`${e}64Low`,{...r,...o.low},this.device.type))}else if(n){const o=Of(r,n);i.push(Fo(e,{...r,...o},this.device.type))}else i.push(Fo(e,r,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<i;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof de?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=mk(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=rr(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=rr(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=Bc(s,i)),this.settings.isIndexed){const u=this.settings.defaultType;s.constructor!==u&&(s=new u(s))}const c=s.byteLength+l+a*2;(!o||o.byteLength<c)&&(o=this._createBuffer(c)),o.write(s,l)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?Bc(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=Vs.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&i&&a.write(i instanceof Float64Array?Bc(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&se.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(n?de.INDEX:de.VERTEX)|de.COPY_DST,indexType:n?r:void 0,byteLength:e}),this._buffer}}const wm=[],bm=[];function sw(t,e=0,n=1/0){let r=wm;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(bm.length=t.length,r=bm):r=wm,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function ow(t){return t&&t[Symbol.asyncIterator]}function wk(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=r?r/a:n,c=i?i/a:0,u=Math.floor((t.length-c)/l);return(f,{index:h,target:d})=>{if(!s){const m=h*l+c;for(let _=0;_<n;_++)d[_]=t[m+_];return d}const y=s[h],w=s[h+1]||u;let x;if(o){x=new Array(w-y);for(let m=y;m<w;m++){const _=m*l+c;d=new Array(n);for(let g=0;g<n;g++)d[g]=t[_+g];x[m-y]=d}}else if(l===n)x=t.subarray(y*n+c,w*n+c);else{x=new t.constructor((w-y)*n);let m=0;for(let _=y;_<w;_++){const g=_*l+c;for(let T=0;T<n;T++)x[m++]=t[g+T]}}return x}}const bk=[],ra=[[0,1/0]];function Tk(t,e){if(t===ra||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const xk={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function aw(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...xk[n],...e,...t,type:n}}class lw extends vk{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:ra}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!_k(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return aw(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=Tk(this.state.updateRanges,[r,i])}else this.state.updateRanges=ra}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=bk}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==ra),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(i,this,{data:n,startRow:c,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e,n){const r=this.device.type==="webgpu";if(r||n===void 0||typeof n=="function"){if(r&&typeof n!="function"){const o=this._normalizeValue(n,[],0);this._areValuesEqual(o,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const i=this.settings.transform&&e?this.settings.transform.call(e,n):n;return this.setData({constant:!0,value:i})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Ye(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=wk(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:l,value:c,size:u,startIndices:f}=e,{accessor:h,transform:d}=a;let y=l.binaryAccessor||(typeof h=="function"?h:s[h]);typeof y!="function"&&typeof h=="string"&&(y=()=>s[h]),Ye(typeof y=="function",`accessor "${h}" is not a function`);let w=e.getVertexOffset(r);const{iterable:x,objectInfo:m}=sw(n,r,i);for(const _ of x){m.index++;let g=y(_,m);if(d&&(g=d.call(this,g)),f){const T=(m.index<f.length-1?f[m.index+1]:o)-f[m.index];if(g&&Array.isArray(g[0])){let C=w;for(const S of g)e._normalizeValue(S,c,C),C+=u}else g&&g.length>u?c.set(g,w):(e._normalizeValue(g,m.target,0),zC({target:c,source:m.target,start:w,count:T}));w+=T*u}else e._normalizeValue(g,c,w),w+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Yc(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,l=o-r;if(a>l){n.set(e.subarray(0,l),r);return}if(n.set(e,r),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let f=0;f<i;f++)n[r+c]=u[f]||0,c++}}function Sk({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return Yc({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const l=r&&((u,f)=>r(u+a,f)),c=Math.min(i.length,s.length);for(let u=1;u<c;u++){const f=i[u]*n,h=s[u]*n;Yc({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&Yc({source:[],target:e,start:a,size:n,getData:l}),e}function Ek(t){const{device:e,settings:n,value:r}=t,i=new lw(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function cw(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function uw(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function fw(t){t.push(t.shift())}function Ak(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=t.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function hw({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function dw({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,f=n.startIndices,h=s&&f,d=n.isConstant;if(!h&&e&&r>=i)return e;const y=n.value instanceof Float64Array?Float32Array:n.value.constructor,w=d?n.value:new y(n.getBuffer().readSyncWebGL(c,i*y.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!d){const g=o;o=(T,C)=>n.normalizeConstant(g(T,C))}const x=d?(g,T)=>o(w,T):(g,T)=>o(w.subarray(g+c,g+c+l),T),m=e?new Float32Array(e.readSyncWebGL(u,r*4).buffer):new Float32Array(0),_=new Float32Array(i);return Sk({source:m,target:_,sourceStartIndices:s,targetStartIndices:f,size:l,getData:x}),(!e||e.byteLength<_.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:_.byteLength+u,usage:35050})),e.write(_,u),e}class pw{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Ul(r),this.attribute=n,this.attributeInTransition=Ek(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Ak(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class Rk extends pw{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=kk(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;fw(s),s[0]=dw({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=hw({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,l=a.model;let c=Math.floor(this.currentLength/o.size);gw(o)&&(c/=2),l.setVertexCount(c),o.isConstant?(l.setAttributes({aFrom:s[0]}),l.setConstantAttributes({aTo:o.value})):l.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Ck=`uniform interpolationUniforms {
  float time;
} interpolation;
`,Tm={name:"interpolation",vs:Ck,uniformTypes:{time:"f32"}},Ik=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,Pk=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function gw(t){return t.doublePrecision&&t.value instanceof Float64Array}function kk(t,e){const n=e.size,r=cw(n),i=uw(n),s=e.getBufferLayout();return gw(e)?new $s(t,{vs:Pk,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[LE,Tm],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new $s(t,{vs:Ik,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[Tm],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class Mk extends pw{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=Uk(e),this.framebuffer=Lk(e,this.texture),this.transform=Bk(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let l=0;l<2;l++)s[l]=dw({device:this.device,buffer:s[l],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=hw({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};n.model.shaderInputs.setProps({spring:o}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),fw(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Ok=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,Nk={name:"spring",vs:Ok,uniformTypes:{damping:"f32",stiffness:"f32"}},Dk=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Fk=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Bk(t,e){const n=cw(e.size),r=uw(e.size);return new $s(t,{vs:Dk,fs:Fk,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Nk],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Uk(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function Lk(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const Vk={interpolation:Rk,spring:Mk};class $k{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=Vk[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(se.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const xm="attributeManager.invalidate",zk="attributeManager.updateStart",jk="attributeManager.updateEnd",Wk="attribute.updateStart",Hk="attribute.allocate",Xk="attribute.updateEnd";class Yk{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Js(aC),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new $k(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);Qe(xm,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Qe(xm,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let l=!1;Qe(zk,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],f=u.settings.accessor;u.startIndices=r,u.numInstances=n,s[c]&&se.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&u.setConstantValue(a,s[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&Qe(jk,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new lw(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(Qe(Wk,n),n.constant){n.setConstantValue(e.context,n.value);return}n.allocate(r)&&Qe(Hk,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,Qe(Xk,n,r))}}class Kk extends Ul{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=Xa(n,r,o)}}const Sm=1e-5;function Em(t,e,n,r,i){const s=e-t,a=(n-e)*i,l=-s*r;return a+l+s+e}function qk(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Em(t[o],e[o],n[o],r,i);return s}return Em(t,e,n,r,i)}function Am(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class Zk extends Ul{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=qk(s,o,n,r,i);const l=Am(a,n),c=Am(a,o);l<Sm&&c<Sm&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const Qk={interpolation:Kk,spring:Zk};class Jk{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(i=aw(i),!i)return;const o=Qk[i.type];if(!o){se.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Gk(t){const e=t[cr];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function eM(t,e){const n=mw({newProps:t,oldProps:e,propTypes:t[cr],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=nM(t,e);let i=!1;return r||(i=rM(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:iM(t,e),transitionsChanged:tM(t,e)}}function tM(t,e){if(!t.transitions)return!1;const n={},r=t[cr];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Nf(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function mw({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=Nf(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=Nf(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function Nf(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function nM(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function rM(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Rm(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&Rm(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function iM(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function Rm(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},mw({oldProps:i,newProps:r,triggerName:n})}const sM="count(): argument not an object",oM="count(): argument not a container";function aM(t){if(!cM(t))throw new Error(sM);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(lM(t))return Object.keys(t).length;throw new Error(oM)}function lM(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function cM(t){return t!==null&&typeof t=="object"}function Cm(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const uM={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Df={};function fM(t,e,n,r){if(n instanceof rt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const{width:s,height:o}=n.data,a=e.createTexture({...n,sampler:{...uM,...i,...r},mipLevels:e.getMipLevelCount(s,o)});return a.generateMipmapsWebGL(),Df[a.id]=t,a}function hM(t,e){!e||!(e instanceof rt)||Df[e.id]===t&&(e.delete(),delete Df[e.id])}const dM={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Ff(t)&&(t.length===3||t.length===4)},equal(t,e,n){return bt(t,e,1)}},accessor:{validate(t,e){const n=Ga(t);return n==="function"||n===Ga(e.value)},equal(t,e,n){return typeof e=="function"?!0:bt(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Ff(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?bt(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?bt(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:fM(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{hM(n.id,t)}}};function pM(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=gM(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function gM(t,e){switch(Ga(e)){case"object":return $i(t,e);case"array":return $i(t,{type:"array",value:e,compare:!1});case"boolean":return $i(t,{type:"boolean",value:e});case"number":return $i(t,{type:"number",value:e});case"function":return $i(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function $i(t,e){return"type"in e?{name:t,...dM[e.type],...e}:"value"in e?{name:t,type:Ga(e.value),...e}:{name:t,type:"object",value:e}}function Ff(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Ga(t){return Ff(t)?"array":t===null?"null":typeof t}function mM(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=Bf(t.constructor,n),i=Object.create(r);i[Ja]=t,i[wr]={},i[In]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const _M="_mergedDefaultProps";function Bf(t,e){if(!(t instanceof Ll.constructor))return{};let n=_M;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=_w(t,n);return r||(t[n]=yM(t,e||[]))}function yM(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=Bf(r),s=_w(t,"defaultProps")||{},o=pM(s),a=Object.assign(Object.create(null),i,o.defaultProps),l=Object.assign(Object.create(null),i==null?void 0:i[cr],o.propTypes),c=Object.assign(Object.create(null),i==null?void 0:i[$c],o.deprecatedProps);for(const u of e){const f=Bf(u.constructor);f&&(Object.assign(a,f),Object.assign(l,f[cr]),Object.assign(c,f[$c]))}return vM(a,t),bM(a,l),wM(a,c),a[cr]=l,a[$c]=c,e.length===0&&!gd(t,"_propTypes")&&(t._propTypes=l),a}function vM(t,e){const n=xM(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function wM(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])gd(this,s)||(this[s]=r);se.deprecated(i,e[n].join("/"))()}})}function bM(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=TM(o))}t[li]=n,t[wr]={},Object.defineProperties(t,r)}function TM(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||ow(e)?this[wr][t]=e:this[In][t]=e},get(){if(this[In]){if(t in this[In])return this[In][t]||this[li][t];if(t in this[wr]){const e=this[Ja]&&this[Ja].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[li][t]}}return this[li][t]}}}function gd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _w(t,e){return gd(t,e)&&t[e]}function xM(t){const e=t.componentName;return e||se.warn(`${t.name}.componentName not specified`)(),e||t.name}let SM=0;class Ll{constructor(...e){this.props=mM(this,e),this.id=this.props.id,this.count=SM++}clone(e){const{props:n}=this,r={};for(const i in n[li])i in n[In]?r[i]=n[In][i]:i in n[wr]&&(r[i]=n[wr][i]);return new this.constructor({...n,...r,...e})}}Ll.componentName="Component";Ll.defaultProps={};const EM=Object.freeze({});class AM{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||EM}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Ja]||this.component;const n=e[In]||{},r=e[wr]||e,i=e[li]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(ow(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[cr];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class RM extends AM{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const CM="layer.changeFlag",IM="layer.initialize",PM="layer.update",kM="layer.finalize",MM="layer.matched",Im=2**24-1,OM=Object.freeze([]),NM=Js(({oldViewport:t,viewport:e})=>t.equals(e));let kt=new Uint8ClampedArray(0);const DM={data:{type:"data",value:OM,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let a=o.contains(t);return!a&&!i&&(o.add({resourceId:t,data:Ds(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:l=>{var c;return(c=n.internalState)==null?void 0:c.reloadAsyncProp(e,l)},consumerId:n.id,requestId:e}):Ds(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:J.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class eo extends Ll{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Fr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ye(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=B0(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=M0(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return Ye(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ye(this.internalState);const r=this.internalState.viewport||this.context.viewport;return dC(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===J.DEFAULT||e===J.LNGLAT||e===J.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ye(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:aM(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Cm(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=Cm(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e.renderPass)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!NM({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(kt.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>Im&&se.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),kt=Vs.allocate(kt,n,{size:4,copy:!0,maxCount:Math.max(n,Im)});const i=Math.floor(kt.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),kt[o*4+0]=s[0],kt[o*4+1]=s[1],kt[o*4+2]=s[2],kt[o*4+3]=0}e.value=kt.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts(e)),n=l.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const l in n){if(i[l])continue;const c=n[l].getValue();for(const u in c){const f=c[u];f instanceof de?n[l].settings.isIndexed?e.setIndexBuffer(f):s[u]=f:f&&(o[u]=f)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let c=0;c<n.length;c++){const u=s.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==kt.buffer&&(r.value=kt.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Ye(!this.internalState),Ye(Number.isFinite(this.props.coordinateSystem)),Qe(IM,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new RM({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(se.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Jk(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Qe(MM,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Qe(PM,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);this.setNeedsRedraw(),this._updateAttributes();const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Qe(kM,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:a}=this.props,l=a&&a(r)||[0,0];o.device instanceof Mf&&o.device.setParametersWebGL({polygonOffset:l});for(const c of this.getModels())c.device.type==="webgpu"?c.setParameters({...c.parameters,...i}):c.setParameters(i);if(o.device instanceof Mf)o.device.withParametersWebGL(i,()=>{const c={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)});else{const c={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)}}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&Qe(CM,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=eM(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){Gk(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Yk(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==l){const c={};Array.isArray(l)&&(c.highlightColor=l),(n||i.autoHighlight!==o||a!==i.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}eo.defaultProps=DM;eo.layerName="Layer";const Kc=Math.PI/180;function FM({height:t,focalDistance:e,orbitAxis:n,rotationX:r,rotationOrbit:i,zoom:s}){const o=n==="Z"?[0,0,1]:[0,1,0],a=n==="Z"?[0,-e,0]:[0,0,e],l=new $t().lookAt({eye:a,up:o});l.rotateX(r*Kc),n==="Z"?l.rotateZ(i*Kc):l.rotateY(i*Kc);const c=Math.pow(2,s)/t;return l.scale(c),l}class BM extends Ci{constructor(e){const{height:n,projectionMatrix:r,fovy:i=50,orbitAxis:s="Z",target:o=[0,0,0],rotationX:a=0,rotationOrbit:l=0,zoom:c=0}=e,u=r?r[5]/2:id(i);super({...e,longitude:void 0,viewMatrix:FM({height:n||1,focalDistance:u,orbitAxis:s,rotationX:a,rotationOrbit:l,zoom:c}),fovy:i,focalDistance:u,position:o,zoom:c}),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:n=!0}={}){const[r,i,s=this.projectedCenter[2]]=e,o=n?i:this.height-i,[a,l,c]=Bl([r,o,s],this.pixelUnprojectionMatrix);return[a,l,c]}panByPosition(e,n){const r=this.project(e),i=[this.width/2+r[0]-n[0],this.height/2+r[1]-n[1],this.projectedCenter[2]];return{target:this.unproject(i)}}}class UM extends W0{constructor(e){const{width:n,height:r,rotationX:i=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:a=0,minRotationX:l=-90,maxRotationX:c=90,minZoom:u=-1/0,maxZoom:f=1/0,startPanPosition:h,startRotatePos:d,startRotationX:y,startRotationOrbit:w,startZoomPosition:x,startZoom:m}=e;super({width:n,height:r,rotationX:i,rotationOrbit:s,target:o,zoom:a,minRotationX:l,maxRotationX:c,minZoom:u,maxZoom:f},{startPanPosition:h,startRotatePos:d,startRotationX:y,startRotationOrbit:w,startZoomPosition:x,startZoom:m}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const r=this.getState().startPanPosition||n;if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!i||s===void 0||o===void 0)return this;let c;if(e){let u=(e[0]-i[0])/a;const f=(e[1]-i[1])/l;(s<-90||s>90)&&(u*=-1),c={rotationX:s+f*180,rotationOrbit:o+u*180}}else c={rotationX:s+r,rotationOrbit:o+n};return this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:i}=r;return Math.abs(i-n.rotationOrbit)>180&&(r.rotationOrbit=i<0?i+360:i-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomPosition:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:r,startZoom:i}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:i}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return ft(s,i,r)}_panFromCenter(e){const{width:n,height:r,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i,maxRotationX:s,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(i)?[ft(i[0],r,n),ft(i[1],r,n)]:ft(i,r,n),e.rotationX=ft(e.rotationX,o,s),(a<-180||a>180)&&(e.rotationOrbit=rC(a+180,360)-180),e}}class LM extends j0{constructor(){super(...arguments),this.ControllerState=UM,this.transition={transitionDuration:300,transitionInterpolator:new od({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}}class yw extends br{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}getViewportType(){return BM}get ControllerType(){return LM}}yw.displayName="OrbitView";const VM=typeof window<"u"?Z.useLayoutEffect:Z.useEffect;function el(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const $M={position:"absolute",zIndex:-1};function vw(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>vw(n,e));if(Vl(t)){if(zM(t))return e.style=$M,Z.cloneElement(t,e);if(jM(t))return Z.cloneElement(t,e)}return t}function Vl(t){return t&&typeof t=="object"&&"type"in t||!1}function zM(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function jM(t){const e=t.type;return e&&e.deckGLViewProps}function Uf(t){if(typeof t=="function")return Z.createElement(br,{},t);if(Array.isArray(t))return t.map(Uf);if(Vl(t)){if(t.type===Z.Fragment)return Uf(t.props.children);if(el(t.type,br))return t}return t}function WM({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return Z.Children.forEach(Uf(t),o=>{if(Vl(o)){const a=o.type;if(el(a,eo)){const l=HM(a,o.props);i.push(l)}else r.push(o);if(el(a,br)&&a!==br&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function HM(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}const XM=Z.createContext();function YM({children:t,deck:e,ContextProvider:n=XM.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let a=s,l=o;Vl(o)&&el(o.type,br)&&(a=o.props.id||s,l=o.props.children);const c=r.getViewport(a),u=r.getViewState(a);if(c){u.padding=c.padding;const{x:f,y:h,width:d,height:y}=c;l=vw(l,{x:f,y:h,width:d,height:y,viewport:c,viewState:u}),i[a]||(i[a]={viewport:c,children:[]}),i[a].children.push(l)}}return Object.keys(i).map(o=>{const{viewport:a,children:l}=i[o],{x:c,y:u,width:f,height:h}=a,d={position:"absolute",left:c,top:u,width:f,height:h},y=`view-${o}`,w=Z.createElement("div",{key:y,id:y,style:d},...l),x={deck:e,viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:_=>{_.viewId=o,e._onViewStateChange(_)},widgets:[]},m=`view-${o}-context`;return Z.createElement(n,{key:m,value:x},w)})}const KM={mixBlendMode:null};function qM({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in KM?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function ZM(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function ww(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function QM(t,e,n){var i,s,o;const r=new e({...n,_customRender:((o=(s=(i=n.deviceProps)==null?void 0:i.adapters)==null?void 0:s[0])==null?void 0:o.type)==="webgpu"?void 0:a=>{t.redrawReason=a;const l=r.getViewports();t.lastRenderedViewports!==l?t.forceUpdate():ww(t)}});return r}function JM(t,e){const[n,r]=Z.useState(0),s=Z.useRef({control:null,version:n,forceUpdate:()=>r(C=>C+1)}).current,o=Z.useRef(null),a=Z.useRef(null),l=Z.useMemo(()=>WM(t),[t.layers,t.views,t.children]);let c=!0;const u=C=>{var S;return c&&t.viewState?(s.viewStateUpdateRequested=C,null):(s.viewStateUpdateRequested=null,(S=t.onViewStateChange)==null?void 0:S.call(t,C))},f=C=>{var S;c?s.interactionStateUpdateRequested=C:(s.interactionStateUpdateRequested=null,(S=t.onInteractionStateChange)==null||S.call(t,C))},h=Z.useMemo(()=>{const C={widgets:[],...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:f};return delete C._customRender,s.deck&&s.deck.setProps(C),C},[t]);Z.useEffect(()=>{const C=t.Deck||pd;return s.deck=QM(s,C,{...h,parent:o.current,canvas:a.current}),()=>{var S;return(S=s.deck)==null?void 0:S.finalize()}},[]),VM(()=>{var M;ww(s);const{viewStateUpdateRequested:C,interactionStateUpdateRequested:S}=s;C&&u(C),S&&f(S),(M=s.deck)!=null&&M.isInitialized&&s.deck.redraw("Initial render")}),Z.useImperativeHandle(e,()=>ZM(s),[]);const d=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:y,width:w="100%",height:x="100%",id:m,style:_}=t,{containerStyle:g,canvasStyle:T}=Z.useMemo(()=>qM({width:w,height:x,style:_}),[w,x,_]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===d||s.version!==n){s.lastRenderedViewports=d,s.version=n;const C=YM({children:l.children,deck:s.deck,ContextProvider:y}),S=Z.createElement("canvas",{key:"canvas",id:m||"deckgl-overlay",ref:a,style:T});s.control=Z.createElement("div",{id:`${m||"deckgl"}-wrapper`,ref:o,style:g},[S,C])}return c=!1,s.control}const GM=Z.forwardRef(JM),eO=`struct PointCloudUniforms {
  radiusPixels: f32,
  sizeUnits: i32,
};

@group(0) @binding(3)
var<uniform> pointCloud: PointCloudUniforms;
`,Pm=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,tO={name:"pointCloud",source:eO,vs:Pm,fs:Pm,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},nO=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,rO=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,iO=`struct ConstantAttributes {
  instanceNormals: vec3<f32>,
  instanceColors: vec4<f32>,
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(1.0, 0.0, 0.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceNormals: vec3<f32>,
  @location(4) instanceColors: vec4<f32>,
  @location(5) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) unitPosition: vec2<f32>,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;
  
  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;
  // geometry.normal = project_normal(instanceNormals);

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  // Find the center of the point and add the current vertex
  let offset = vec3<f32>(attributes.positions.xy * project_unit_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
  // DECKGL_FILTER_SIZE(offset, geometry);

  varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
  // DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  let clipPixels = project_pixel_size_to_clipspace(offset.xy);
  varyings.position.x += clipPixels.x;
  varyings.position.y += clipPixels.y;

  // Apply lighting
  let lightColor = lighting_getLightColor2(attributes.instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);

  // Apply opacity to instance color, or return instance picking color
  varyings.vColor = vec4(lightColor, attributes.instanceColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(vColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition.xy;

  let distToCenter = length(varyings.unitPosition);
  if (distToCenter > 1.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  fragColor = varyings.vColor;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
}
`,bw=[0,0,0,255],Tw=[0,0,1],sO={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:Tw},getColor:{type:"accessor",value:bw},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function oO(t){const{header:e,attributes:n}=t;if(!(!e||!n)&&(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0)){const{size:r,value:i}=n.COLOR_0;n.instanceColors={size:r,type:"unorm8",value:i}}}class md extends eo{getShaders(){return super.getShaders({vs:nO,fs:rO,source:iO,modules:[I0,JE,m0,N0,tO]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:Tw},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:bw}})}updateState(e){var i;const{changeFlags:n,props:r}=e;super.updateState(e),n.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),n.dataChanged&&oO(r.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:r}=this.props,i=this.state.model,s={sizeUnits:Ls[r],radiusPixels:n};i.shaderInputs.setProps({pointCloud:s}),this.context.device.type==="webgpu"&&(i.instanceCount=this.props.data.length),i.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,n=[];for(let r=0;r<3;r++){const i=r/3*Math.PI*2;n.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new xi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new na({topology:"triangle-list",attributes:{positions:new Float32Array(n)}}),parameters:e,isInstanced:!0})}}md.layerName="PointCloudLayer";md.defaultProps=sO;const qc=Math.PI/180,Bo=new Float32Array(16),km=new Float32Array(12);function Mm(t,e,n){const r=e[0]*qc,i=e[1]*qc,s=e[2]*qc,o=Math.sin(s),a=Math.sin(r),l=Math.sin(i),c=Math.cos(s),u=Math.cos(r),f=Math.cos(i),h=n[0],d=n[1],y=n[2];t[0]=h*f*u,t[1]=h*l*u,t[2]=h*-a,t[3]=d*(-l*c+f*a*o),t[4]=d*(f*c+l*a*o),t[5]=d*u*o,t[6]=y*(l*o+f*a*c),t[7]=y*(-f*o+l*a*c),t[8]=y*u*c}function Om(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const aO={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:r,getOrientation:i,getScale:s,getTranslation:o,getTransformMatrix:a}=this.props,l=Array.isArray(a),c=l&&a.length===16,u=Array.isArray(s),f=Array.isArray(i),h=Array.isArray(o),d=c||!l&&!!a(r[0]);d?t.constant=c:t.constant=f&&u&&h;const y=t.value;if(t.constant){let w;d?(Bo.set(a),w=Om(Bo)):(w=km,Mm(w,i,s),w.set(o,9)),t.value=new Float32Array(w)}else{let w=e*t.size;const{iterable:x,objectInfo:m}=sw(r,e,n);for(const _ of x){m.index++;let g;if(d)Bo.set(c?a:a(_,m)),g=Om(Bo);else{g=km;const T=f?i:i(_,m),C=u?s:s(_,m);Mm(g,T,C),g.set(h?o:o(_,m),9)}y[w++]=g[0],y[w++]=g[1],y[w++]=g[2],y[w++]=g[3],y[w++]=g[4],y[w++]=g[5],y[w++]=g[6],y[w++]=g[7],y[w++]=g[8],y[w++]=g[9],y[w++]=g[10],y[w++]=g[11]}}}};function lO(t,e){return e===J.CARTESIAN||e===J.METER_OFFSETS||e===J.DEFAULT&&!t.isGeospatial}const Nm=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,cO={name:"simpleMesh",vs:Nm,fs:Nm,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},uO=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,fO=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function Zc(t){const e=t.positions||t.POSITION;se.assert(e,'no "postions" or "POSITION" attribute in mesh');const n=e.value.length/e.size;let r=t.COLOR_0||t.colors;r||(r={size:3,value:new Float32Array(n*3).fill(1)});let i=t.NORMAL||t.normals;i||(i={size:3,value:new Float32Array(n*3).fill(0)});let s=t.TEXCOORD_0||t.texCoords;return s||(s={size:2,value:new Float32Array(n*2).fill(0)}),{positions:e,colors:r,normals:i,texCoords:s}}function Dm(t){return t instanceof na?(t.attributes=Zc(t.attributes),t):t.attributes?new na({...t,topology:"triangle-list",attributes:Zc(t.attributes)}):new na({topology:"triangle-list",attributes:Zc(t)})}const hO=[0,0,0,255],dO={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:hO},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class _d extends eo{getShaders(){return super.getShaders({vs:uO,fs:fO,modules:[I0,_0,N0,cO]})}getBounds(){var r;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:n}=this.props;if(!n)return null;if(e=(r=n.header)==null?void 0:r.boundingBox,!e){const{attributes:i}=Dm(n);i.POSITION=i.POSITION||i.positions,e=wv(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:aO}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var s;super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e;if(n.mesh!==r.mesh||i.extensionsChanged){if(this.state.positionBounds=null,(s=this.state.model)==null||s.destroy(),n.mesh){this.state.model=this.getModel(n.mesh);const o=n.mesh.attributes||n.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==r.texture&&n.texture instanceof rt&&this.setTexture(n.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:n}=this.state;if(!n)return;const{viewport:r,renderPass:i}=this.context,{sizeScale:s,coordinateSystem:o,_instanced:a}=this.props,l={sizeScale:s,composeModelMatrix:!a||lO(r,o),flatShading:!this.state.hasNormals};n.shaderInputs.setProps({simpleMesh:l}),n.draw(i)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const n=new xi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:Dm(e),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:i}=this.state,s={sampler:r||i,hasTexture:!!r};return n.shaderInputs.setProps({simpleMesh:s}),n}setTexture(e){const{emptyTexture:n,model:r}=this.state;if(r){const i={sampler:e||n,hasTexture:!!e};r.shaderInputs.setProps({simpleMesh:i})}}}_d.defaultProps=dO;_d.layerName="SimpleMeshLayer";const pO="4.3.3",gO={dataType:null,batchType:null,name:"PLY",id:"ply",module:"ply",version:pO,worker:!0,extensions:["ply"],mimeTypes:["text/plain","application/octet-stream"],text:!0,binary:!0,tests:["ply"],options:{ply:{}}};function mO(t,e){const n=_O(t);return WT(e,n)}function _O(t){const e={};return e.ply_comments=JSON.stringify(t.comments),e.ply_elements=JSON.stringify(t.elements),t.format!==void 0&&(e.ply_format=t.format),t.version!==void 0&&(e.ply_version=t.version),t.headerLength!==void 0&&(e.ply_headerLength=t.headerLength.toString(10)),e}function xw(t,e,n){const r=yO(e),i=wv(r),s=e.indices.length||e.vertices.length/3,o=e.indices&&e.indices.length>0,a=o?4:0,l=o?"triangle-list":"point-list",c=mO(t,r),u={loader:"ply",loaderData:t,header:{vertexCount:s,boundingBox:i},schema:c,attributes:r,indices:{value:new Uint32Array(0),size:0},mode:a,topology:l};return e.indices.length>0&&(u.indices={value:new Uint32Array(e.indices),size:1}),u}function yO(t){const e={};for(const n of Object.keys(t))switch(n){case"vertices":t.vertices.length>0&&(e.POSITION={value:new Float32Array(t.vertices),size:3});break;case"normals":t.normals.length>0&&(e.NORMAL={value:new Float32Array(t.normals),size:3});break;case"uvs":t.uvs.length>0&&(e.TEXCOORD_0={value:new Float32Array(t.uvs),size:2});break;case"colors":t.colors.length>0&&(e.COLOR_0={value:new Uint8Array(t.colors),size:3,normalized:!0});break;case"indices":break;default:t[n].length>0&&(e[n]={value:new Float32Array(t[n]),size:1});break}return e}function Qc(t,e={}){let n,r;if(t instanceof ArrayBuffer){const i=new TextDecoder().decode(t);n=Fm(i,e),r=n.format==="ascii"?Bm(i,n):xO(t,n)}else n=Fm(t,e),r=Bm(t,n);return xw(n,r)}function Fm(t,e){const n=/ply([\s\S]*)end_header\s/;let r="",i=0;const s=n.exec(t);s!==null&&(r=s[1],i=s[0].length);const o=r.split(`
`);return vO(o,i,e)}function vO(t,e,n){const r={comments:[],elements:[],headerLength:e};let i,s,o=null;for(let a=0;a<t.length;a++){let l=t[a];if(l=l.trim(),l!=="")switch(s=l.split(/\s+/),i=s.shift(),l=s.join(" "),i){case"format":r.format=s[0],r.version=s[1];break;case"comment":r.comments.push(l);break;case"element":o&&r.elements.push(o),o={name:s[0],count:parseInt(s[1],10),properties:[]};break;case"property":if(o){const c=wO(s);n!=null&&n.propertyNameMapping&&c.name in(n==null?void 0:n.propertyNameMapping)&&(c.name=n==null?void 0:n.propertyNameMapping[c.name]),o.properties.push(c)}break;default:console.log("unhandled",i,s)}}return o&&r.elements.push(o),r}function Sw(t){const e={indices:[],vertices:[],normals:[],uvs:[],colors:[]};for(const n of t.elements)if(n.name==="vertex")for(const r of n.properties)switch(r.name){case"x":case"y":case"z":case"nx":case"ny":case"nz":case"s":case"t":case"red":case"green":case"blue":break;default:e[r.name]=[];break}return e}function wO(t){const e=t[0];switch(e){case"list":return{type:e,name:t[3],countType:t[1],itemType:t[2]};default:return{type:e,name:t[1]}}}function Jc(t,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(t,10);case"float":case"double":case"float32":case"float64":return parseFloat(t);default:throw new Error(e)}}function bO(t,e){const n=e.split(/\s+/),r={};for(let i=0;i<t.length;i++)if(t[i].type==="list"){const s=[],o=Jc(n.shift(),t[i].countType);for(let a=0;a<o;a++)s.push(Jc(n.shift(),t[i].itemType));r[t[i].name]=s}else r[t[i].name]=Jc(n.shift(),t[i].type);return r}function Bm(t,e){const n=Sw(e);let r;const i=/end_header\s([\s\S]*)$/;let s="";(r=i.exec(t))!==null&&(s=r[1]);const o=s.split(`
`);let a=0,l=0;for(let c=0;c<o.length;c++){let u=o[c];if(u=u.trim(),u!==""){l>=e.elements[a].count&&(a++,l=0);const f=bO(e.elements[a].properties,u);Ew(n,e.elements[a].name,f),l++}}return n}function Ew(t,e,n={}){if(e==="vertex")for(const r of Object.keys(n))switch(r){case"x":t.vertices.push(n.x,n.y,n.z);break;case"y":case"z":break;case"nx":"nx"in n&&"ny"in n&&"nz"in n&&t.normals.push(n.nx,n.ny,n.nz);break;case"ny":case"nz":break;case"s":"s"in n&&"t"in n&&t.uvs.push(n.s,n.t);break;case"t":break;case"red":"red"in n&&"green"in n&&"blue"in n&&t.colors.push(n.red,n.green,n.blue);break;case"green":case"blue":break;default:t[r].push(n[r])}else if(e==="face"){const r=n.vertex_indices||n.vertex_index;r.length===3?t.indices.push(r[0],r[1],r[2]):r.length===4&&(t.indices.push(r[0],r[1],r[3]),t.indices.push(r[1],r[2],r[3]))}}function Gc(t,e,n,r){switch(n){case"int8":case"char":return[t.getInt8(e),1];case"uint8":case"uchar":return[t.getUint8(e),1];case"int16":case"short":return[t.getInt16(e,r),2];case"uint16":case"ushort":return[t.getUint16(e,r),2];case"int32":case"int":return[t.getInt32(e,r),4];case"uint32":case"uint":return[t.getUint32(e,r),4];case"float32":case"float":return[t.getFloat32(e,r),4];case"float64":case"double":return[t.getFloat64(e,r),8];default:throw new Error(n)}}function TO(t,e,n,r){const i={};let s,o=0;for(let a=0;a<n.length;a++)if(n[a].type==="list"){const l=[];s=Gc(t,e+o,n[a].countType,r);const c=s[0];o+=s[1];for(let u=0;u<c;u++)s=Gc(t,e+o,n[a].itemType,r),l.push(s[0]),o+=s[1];i[n[a].name]=l}else s=Gc(t,e+o,n[a].type,r),i[n[a].name]=s[0],o+=s[1];return[i,o]}function xO(t,e){const n=Sw(e),r=e.format==="binary_little_endian",i=new DataView(t,e.headerLength);let s,o=0;for(let a=0;a<e.elements.length;a++){const l=e.elements[a].count;for(let c=0;c<l;c++){s=TO(i,o,e.elements[a].properties,r),o+=s[1];const u=s[0];Ew(n,e.elements[a].name,u)}}return n}let Dr;async function*SO(t,e){const n=B1(F1(t)),r=await EO(n,e);let i;switch(r.format){case"ascii":i=await RO(n,r);break;default:throw new Error("Binary PLY can not yet be parsed in streaming mode")}yield xw(r,i)}async function EO(t,e){const n={comments:[],elements:[]};return await U1(t,r=>{if(r=r.trim(),r==="end_header")return!0;if(r==="")return!1;const i=r.split(/\s+/),s=i.shift();switch(r=i.join(" "),s){case"ply":break;case"format":n.format=i[0],n.version=i[1];break;case"comment":n.comments.push(r);break;case"element":Dr&&n.elements.push(Dr),Dr={name:i[0],count:parseInt(i[1],10),properties:[]};break;case"property":const o=AO(i,e.propertyNameMapping);Dr.properties.push(o);break;default:console.log("unhandled",s,i)}return!1}),Dr&&n.elements.push(Dr),n}function AO(t,e){const n=t[0];switch(n){case"list":return{type:n,name:t[3],countType:t[1],itemType:t[2]};default:return{type:n,name:t[1]}}}async function RO(t,e){const n={indices:[],vertices:[],normals:[],uvs:[],colors:[]};let r=0,i=0;for await(let s of t)if(s=s.trim(),s!==""){i>=e.elements[r].count&&(r++,i=0);const o=CO(e.elements[r].properties,s);IO(n,e.elements[r].name,o),i++}return n}function eu(t,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(t,10);case"float":case"double":case"float32":case"float64":return parseFloat(t);default:throw new Error(e)}}function CO(t,e){const n=e.split(/\s+/),r={};for(let i=0;i<t.length;i++)if(t[i].type==="list"){const s=[],o=eu(n.shift(),t[i].countType);for(let a=0;a<o;a++)s.push(eu(n.shift(),t[i].itemType));r[t[i].name]=s}else r[t[i].name]=eu(n.shift(),t[i].type);return r}function IO(t,e,n={}){switch(e){case"vertex":t.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&t.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n&&t.uvs.push(n.s,n.t),"red"in n&&"green"in n&&"blue"in n&&t.colors.push(n.red/255,n.green/255,n.blue/255);break;case"face":const r=n.vertex_indices||n.vertex_index;r.length===3?t.indices.push(r[0],r[1],r[2]):r.length===4&&(t.indices.push(r[0],r[1],r[3]),t.indices.push(r[1],r[2],r[3]));break}}const Aw={...gO,parse:async(t,e)=>Qc(t,e==null?void 0:e.ply),parseTextSync:(t,e)=>Qc(t,e==null?void 0:e.ply),parseSync:(t,e)=>Qc(t,e==null?void 0:e.ply),parseInBatches:(t,e)=>SO(t,e==null?void 0:e.ply)};function Um(t){if(t){if(t instanceof Int32Array||t instanceof Uint32Array||t instanceof Uint16Array||t instanceof Uint8Array)return t;if(Array.isArray(t))return new Int32Array(t)}}async function PO(t,e){var c,u,f,h,d,y,w,x,m,_;const n=await Ds(t,Aw,{worker:!1}),r={};let i=0;const s=n.attributes||n;try{const g=Object.keys(n||{}),T=Object.keys(s||{}),C=((u=(c=s==null?void 0:s.POSITION)==null?void 0:c.value)==null?void 0:u.length)??((f=s==null?void 0:s.positions)==null?void 0:f.length)??0,S=((d=(h=s==null?void 0:s.COLOR_0)==null?void 0:h.value)==null?void 0:d.length)??((y=s==null?void 0:s.colors)==null?void 0:y.length)??0;console.log("[PLY] loaded",t,{keys:g,attrKeys:T,posLen:C,colLen:S})}catch{}s.POSITION?(r.positions=s.POSITION.value,i=s.POSITION.value.length/(s.POSITION.size||3)):s.positions&&(r.positions=s.positions,i=r.positions.length/3),e!=null&&e.dropColor||((w=s.COLOR_0)!=null&&w.value&&(r.colors=s.COLOR_0.value),s.colors&&(r.colors=s.colors)),(x=s.NORMAL)!=null&&x.value&&(r.normals=s.NORMAL.value),s.normals&&(r.normals=s.normals);const o=Um(((m=s.label)==null?void 0:m.value)??s.label??s.Label);o&&(r.label=o);const a=Um(((_=s.point_id)==null?void 0:_.value)??s.point_id??s.id??s.vertex_id);a&&(r.point_id=a);const l=Object.keys(s).map(g=>{var T;return(T=s[g])!=null&&T.value,g}).filter(g=>typeof s[g]!="function");if((e!=null&&e.filterLabelNotIn||e!=null&&e.filterLabelIn)&&r.label){const g=new Uint8Array(i);let T=0;for(let C=0;C<i;C++){const S=r.label[C],M=e.filterLabelIn?e.filterLabelIn.has(S):!0,k=e.filterLabelNotIn?!e.filterLabelNotIn.has(S):!0;M&&k&&(g[C]=1,T++)}if(T<i){const C=new Int32Array(T);let S=0;for(let k=0;k<i;k++)g[k]&&(C[S++]=k);const M=(k,F=1)=>{if(!k)return;const D=Object.getPrototypeOf(k).constructor,L=new D(T*F);for(let z=0;z<T;z++){const H=C[z]*F,W=z*F;for(let re=0;re<F;re++)L[W+re]=k[H+re]}return L};r.positions=M(r.positions,3),r.colors&&(r.colors=M(r.colors,3)),r.normals&&(r.normals=M(r.normals,3)),r.label&&(r.label=M(r.label,1)),r.point_id&&(r.point_id=M(r.point_id,1)),i=T}}return{length:i,attributes:r,meta:{hasColor:!!r.colors,hasNormal:!!r.normals,hasLabel:!!r.label,propertyNames:l}}}async function kO(t){var a,l;const e=await Ds(t,Aw,{worker:!1}),n=e.attributes||e;try{const c=Object.keys(e||{}),u=Object.keys(n||{});console.log("[PLY-MESH] loaded",t,{keys:c,attrKeys:u,hasIndices:!!(e.indices||n.indices)})}catch{}const r=((a=n.POSITION)==null?void 0:a.value)??n.positions;if(!r)throw new Error("PLY mesh missing POSITION/positions");const i=((l=n.NORMAL)==null?void 0:l.value)??n.normals,s=e.indices||n.indices,o=s!=null&&s.value?s.value:s;try{console.log("[PLY-MESH] meta",{pos:r.length/3,idx:o?o.length/3:0})}catch{}return{positions:r,normals:i,indices:o}}const MO={target:[0,0,0],rotationOrbit:0,rotationX:30,zoom:6};function Lm(t,e){for(let n=0;n<t.length;n+=3){const r=t[n],i=t[n+1],s=t[n+2];r<e.min[0]&&(e.min[0]=r),r>e.max[0]&&(e.max[0]=r),i<e.min[1]&&(e.min[1]=i),i>e.max[1]&&(e.max[1]=i),s<e.min[2]&&(e.min[2]=s),s>e.max[2]&&(e.max[2]=s)}}function OO(t){return[.5*(t.min[0]+t.max[0]),.5*(t.min[1]+t.max[1]),.5*(t.min[2]+t.max[2])]}function NO(t){return[t.max[0]-t.min[0],t.max[1]-t.min[1],t.max[2]-t.min[2]]}function DO(t,{includeColor:e=!0}={}){const n={getPosition:{value:t.attributes.positions,size:3}};if(e&&t.attributes.colors){const r=t.attributes.colors instanceof Uint8Array;n.getColor={value:t.attributes.colors,size:3,normalized:r}}return t.attributes.normals&&(n.getNormal={value:t.attributes.normals,size:3}),n}function FO({manifest:t}){const[e,n]=Z.useState([]),[r,i]=Z.useState(!0),[s,o]=Z.useState(null),[a,l]=Z.useState(null),[c,u]=Z.useState(null),[f,h]=Z.useState(MO),[d,y]=Z.useState(4),[w,x]=Z.useState(.35),[m,_]=Z.useState(null);Z.useEffect(()=>{let S=!1;return(async()=>{var M,k,F,D,L,z;try{i(!0),o(null);const H=(t.items||[]).map(ge=>({...ge}));for(let ge=0;ge<H.length;ge++){const xe=H[ge];if(xe.kind==="pointcloud"){const V=(M=xe.filters)!=null&&M.labelInclude?new Set(xe.filters.labelInclude):void 0,X=(k=xe.filters)!=null&&k.labelExclude?new Set(xe.filters.labelExclude):void 0,q=((F=xe.style)==null?void 0:F.colorMode)==="constant",ce=await PO(xe.source.url,{filterLabelIn:V,filterLabelNotIn:X,dropColor:q});if(S)return;H[ge]={...xe,cloud:ce}}else if(xe.kind==="mesh"){const V=await kO(xe.source.url);if(S)return;H[ge]={...xe,mesh:V}}}if(S)return;const W={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};let re=!1;for(const ge of H)(L=(D=ge.cloud)==null?void 0:D.attributes)!=null&&L.positions?(Lm(ge.cloud.attributes.positions,W),re=!0):(z=ge.mesh)!=null&&z.positions&&(Lm(ge.mesh.positions,W),re=!0);if(re){const ge=OO(W),xe=NO(W);l(ge),u(xe);const V=Math.max(xe[0],xe[1],xe[2]),X=8-Math.log2(Math.max(1e-6,V)),q=Math.max(2,Math.min(14,X));h(ce=>({...ce,target:ge,zoom:q}))}n(H)}catch(H){S||o(String((H==null?void 0:H.message)||H))}finally{S||i(!1)}})(),()=>{S=!0}},[t]);const g=Z.useMemo(()=>{var M,k,F;const S=[];for(const D of e)if(D.visible!==!1){if(D.kind==="pointcloud"){const L=D.cloud;if(!L)continue;const z=((M=D.style)==null?void 0:M.colorMode)!=="constant",H=((k=D.style)==null?void 0:k.color)??[128,128,128];S.push(new md({id:D.id,...DO(L,{includeColor:z}),pointSize:d,sizeUnits:"pixels",coordinateSystem:J.CARTESIAN,getColor:z?void 0:H,pickable:!0,onClick:W=>{if(W&&Number.isFinite(W.index)){const re=W.index,ge={};L.attributes.label&&(ge.label=L.attributes.label[re]),L.attributes.point_id&&(ge.point_id=L.attributes.point_id[re]),_({itemId:D.id,index:re,attrs:{...ge,name:D.name,group:D.group}})}}}))}else if(D.kind==="mesh"){if(!D.mesh)continue;const L=((F=D.style)==null?void 0:F.color)??[30,144,255],z=Math.max(0,Math.min(1,w)),H=[...L,Math.round(z*255)],W={positions:{value:D.mesh.positions,size:3}};D.mesh.normals&&(W.normals={value:D.mesh.normals,size:3});const re={attributes:W,indices:D.mesh.indices,mode:4};S.push(new _d({id:D.id,mesh:re,getColor:H,opacity:z,pickable:!1,coordinateSystem:J.CARTESIAN,wireframe:!1,parameters:{depthTest:!0,blend:!0,cull:!1},material:{ambient:1,diffuse:0,shininess:0,specularColor:[0,0,0]}}))}}return S},[e,d,w]),T=Z.useMemo(()=>new yw({far:1e5}),[]),C=Z.useMemo(()=>{const S=new Map;for(const M of e){const k=M.group||"ungrouped";S.has(k)||S.set(k,[]),S.get(k).push(M)}return S},[e]);return Y.jsxs("div",{style:{height:"100%",position:"relative"},children:[r&&Y.jsx("div",{style:{position:"absolute",top:8,left:12,background:"rgba(255,255,255,0.9)",padding:"4px 8px",borderRadius:4,zIndex:10},children:"Loading..."}),s&&Y.jsxs("div",{style:{position:"absolute",top:8,left:12,color:"#b00",background:"rgba(255,255,255,0.9)",padding:"4px 8px",borderRadius:4,zIndex:10},children:["Error: ",s]}),Y.jsx(GM,{views:T,viewState:f,controller:!0,onViewStateChange:S=>h(S.viewState),layers:g,style:{position:"absolute",inset:"0"}}),Y.jsxs("div",{style:{position:"absolute",right:12,top:12,width:380,background:"rgba(255,255,255,0.95)",border:"1px solid #ddd",borderRadius:6,padding:8},children:[Y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[Y.jsx("div",{style:{fontWeight:600},children:"Layers"}),Y.jsx("button",{onClick:()=>h(S=>({...S,target:a??S.target,zoom:6,rotationOrbit:0,rotationX:30})),children:""})]}),Y.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",alignItems:"center",gap:8,marginBottom:8},children:[Y.jsx("div",{style:{fontSize:12,color:"#555"},children:""}),Y.jsx("input",{type:"range",min:1,max:10,step:1,value:d,onChange:S=>y(Number(S.target.value))}),Y.jsx("div",{style:{fontFamily:"ui-monospace, Menlo, monospace",fontSize:12,width:28,textAlign:"right"},children:d}),e.some(S=>S.kind==="mesh")&&Y.jsxs(Y.Fragment,{children:[Y.jsx("div",{style:{fontSize:12,color:"#555"},children:"UOBB"}),Y.jsx("input",{type:"range",min:0,max:1,step:.05,value:w,onChange:S=>x(Number(S.target.value))}),Y.jsx("div",{style:{fontFamily:"ui-monospace, Menlo, monospace",fontSize:12,width:28,textAlign:"right"},children:w.toFixed(2)})]})]}),Y.jsx("div",{style:{maxHeight:220,overflow:"auto",marginBottom:8},children:[...C.entries()].map(([S,M])=>Y.jsxs("div",{style:{marginBottom:6},children:[Y.jsx("div",{style:{fontWeight:600,fontSize:12,color:"#555",margin:"4px 0"},children:S}),M.map(k=>{var F;return Y.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[Y.jsx("input",{type:"checkbox",checked:k.visible!==!1,onChange:D=>{const L=e.map(z=>z.id===k.id?{...z,visible:D.target.checked}:z);n(L)}}),Y.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:k.name}),((F=k.style)==null?void 0:F.colorMode)==="constant"&&Y.jsx("span",{style:{fontSize:11,color:"#888"},children:"gray"})]},k.id)})]},S))}),Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Stats"}),Y.jsxs("div",{style:{fontFamily:"ui-monospace, SFMono-Regular, Menlo, monospace",fontSize:12,marginBottom:8},children:[Y.jsxs("div",{children:["items loaded: ",e.filter(S=>S.cloud||S.mesh).length," / ",e.length]}),Y.jsxs("div",{children:["total points: ",e.reduce((S,M)=>{var k;return S+(((k=M.cloud)==null?void 0:k.length)||0)},0)]}),c&&Y.jsxs("div",{children:["scene size: ",c.map(S=>S.toFixed(2)).join("  ")]})]}),Y.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Inspector"}),!m&&Y.jsx("div",{style:{color:"#666"},children:"Click a point to inspect attributes."}),m&&Y.jsxs("div",{style:{fontFamily:"ui-monospace, SFMono-Regular, Menlo, monospace",fontSize:12},children:[Y.jsxs("div",{children:["item: ",m.attrs.name??m.itemId]}),m.attrs.group&&Y.jsxs("div",{children:["group: ",m.attrs.group]}),m.attrs.point_id!==void 0&&Y.jsxs("div",{children:["point_id: ",String(m.attrs.point_id)]}),m.attrs.label!==void 0&&Y.jsxs("div",{children:["label: ",String(m.attrs.label)]}),Y.jsxs("div",{children:["index: ",m.index]})]})]})]})}async function BO(t){const e=await fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status} for ${t}`);return await e.json()}function UO(){return Z.useMemo(()=>new URLSearchParams(window.location.search),[])}function LO(){const t=UO(),[e,n]=Z.useState(null),[r,i]=Z.useState(null),s=t.get("manifest")??"/manifests/room_007.json";return Z.useEffect(()=>{BO(s).then(o=>n(o)).catch(o=>i(String(o)))},[s]),Y.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[Y.jsxs("header",{style:{padding:"8px 12px",borderBottom:"1px solid #eee"},children:[Y.jsx("strong",{children:"Point Cloud Viewer"}),Y.jsx("span",{style:{marginLeft:8,color:"#666"},children:(e==null?void 0:e.title)??s})]}),Y.jsxs("div",{style:{flex:1,minHeight:0},children:[r&&Y.jsxs("div",{style:{padding:12,color:"#b00"},children:["Failed to load manifest: ",r]}),e&&Y.jsx(FO,{manifest:e})]})]})}const Rw=document.getElementById("root");if(!Rw)throw new Error("Root container not found");const VO=Gy(Rw);VO.render(Y.jsx(LO,{}));
